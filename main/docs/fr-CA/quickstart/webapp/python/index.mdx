---
title: "Python"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";

<div id="by-evan-sims">
  ##### Par Evan Sims
</div>

Ce tutoriel explique comment ajouter une fonctionnalitÃ© de connexion utilisateur Ã  une application Web Python crÃ©Ã©e avec le framework Flask et la bibliothÃ¨que OAuth Authlib. Nous vous recommandons dâ€™ouvrir une session pour suivre ce DÃ©marrage rapide avec des exemples configurÃ©s pour votre compte.

{/* <Card title="Voir sur GitHub" href="https://github.com/auth0-samples/auth0-python-web-app/tree/master/01-Login" icon="github">
  Configuration systÃ¨me requise : Python 3 | Authlib 1.0 | Flask 2.0
  </Card> */}

<Info>
  **Vous dÃ©butez en matiÃ¨re dâ€™authentification?** DÃ©couvrez [comment fonctionne Auth0](/docs/fr-CA/get-started/auth0-overview), comment il [sâ€™intÃ¨gre aux applications Web classiques](/docs/fr-CA/get-started/architecture-scenarios/sso-for-regular-web-apps) et quel [protocole](/docs/fr-CA/get-started/authentication-and-authorization-flow) Auth0 utilise.
</Info>

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenir les clÃ©s de votre Application
</div>

Lorsque vous vous Ãªtes inscrit Ã  Auth0, une nouvelle Application a Ã©tÃ© crÃ©Ã©e pour vous, ou vous avez peut-Ãªtre choisi dâ€™en crÃ©er une nouvelle. Vous aurez besoin de certains renseignements sur cette Application pour communiquer avec Auth0. Vous pouvez obtenir ces renseignements dans la section [ParamÃ¨tres de lâ€™Application](https://manage.auth0.com/#/applications) de lâ€™Auth0 Dashboard.

<Frame>![Tableau de bord de lâ€™Application](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

Vous avez besoin des renseignements suivants :

* **Domaine**
* **ID client**
* **Secret client**

<Info>
  Si vous tÃ©lÃ©chargez lâ€™exemple en haut de cette page, ces champs sont dÃ©jÃ  renseignÃ©s pour vous.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de rappel (callback)
</div>

Une URL de rappel (callback) est une URL de votre application vers laquelle Auth0 redirige lâ€™utilisateur aprÃ¨s son authentification. Lâ€™URL de rappel de votre application doit Ãªtre ajoutÃ©e au champ **URL de redirection autorisÃ©es** dans vos [paramÃ¨tres dâ€™Application](https://manage.auth0.com/#/applications). Si ce champ nâ€™est pas dÃ©fini, les utilisateurs ne pourront pas se connecter Ã  lâ€™application et recevront un message dâ€™erreur.

<Info>
  Si vous suivez le projet dâ€™exemple que vous avez tÃ©lÃ©chargÃ© en haut de cette page, lâ€™URL de rappel que vous devez ajouter au champ **URL de redirection autorisÃ©es** est `http://localhost:3000/callback`.
</Info>

<div id="configure-logout-urls">
  ### Configurer les URL de dÃ©connexion
</div>

Une URL de dÃ©connexion est une URL dans votre application vers laquelle Auth0 peut revenir aprÃ¨s que lâ€™utilisateur a Ã©tÃ© dÃ©connectÃ© du serveur dâ€™autorisation. Elle est indiquÃ©e dans le paramÃ¨tre de requÃªte `returnTo`. Lâ€™URL de dÃ©connexion de votre application doit Ãªtre ajoutÃ©e au champ **URL de dÃ©connexion autorisÃ©es** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ nâ€™est pas dÃ©fini, les utilisateurs ne pourront pas se dÃ©connecter de lâ€™application et verront un message dâ€™erreur.

<Info>
  Si vous suivez le projet dâ€™exemple que vous avez tÃ©lÃ©chargÃ© en haut de cette page, lâ€™URL de dÃ©connexion que vous devez ajouter au champ **URL de dÃ©connexion autorisÃ©es** est `http://localhost:3000`.
</Info>

<div id="install-dependencies">
  ## Installer les dÃ©pendances
</div>

Pour les besoins de cet exemple, nous utiliserons la bibliothÃ¨que OAuth [Authlib](https://authlib.org/) et [Flask](https://flask.palletsprojects.com/en/2.0.x/).

Commencez par crÃ©er un fichier `requirements.txt` dans le rÃ©pertoire de votre projetÂ :

```txt lines
# ğŸ“ requirements.txt -----

flask>=2.0.3
python-dotenv>=0.19.2
authlib>=1.0
requests>=2.27.1
```

Vous devez maintenant exÃ©cuter `pip install -r requirements.txt` dans votre shell pour que ces dÃ©pendances soient disponibles pour votre projet.

<div id="configure-your-env-file">
  ## Configurez votre fichier .env
</div>

Ensuite, crÃ©ez un fichier `.env` dans le rÃ©pertoire de votre projet. Ce fichier contiendra vos clÃ©s client et dâ€™autres dÃ©tails de configuration.

export const codeExample = `# ğŸ“ .env -----

AUTH0_CLIENT_ID={yourClientId}
AUTH0_CLIENT_SECRET={yourClientSecret}
AUTH0_DOMAIN={yourDomain}
APP_SECRET_KEY=`;

<AuthCodeBlock children={codeExample} language="env" />

* GÃ©nÃ©rez une chaÃ®ne de caractÃ¨res appropriÃ©e pour `APP_SECRET_KEY` en exÃ©cutant `openssl rand -hex 32` dans votre shell.

<div id="setup-your-application">
  ## Configurez votre application
</div>

Vous Ãªtes maintenant prÃªt Ã  commencer Ã  coder votre application. CrÃ©ez un fichier `server.py` dans le rÃ©pertoire de votre projet â€” ce fichier contiendra toute la logique de votre application.

Commencez par importer toutes les bibliothÃ¨ques que votre application utiliseraÂ :

```py lines
# ğŸ“ server.py -----

import json
from os import environ as env
from urllib.parse import quote_plus, urlencode

from authlib.integrations.flask_client import OAuth
from dotenv import find_dotenv, load_dotenv
from flask import Flask, redirect, render_template, session, url_for
```

Ensuite, votre application devra charger le fichier de configuration `.env` que vous avez crÃ©Ã© Ã  lâ€™Ã©tape prÃ©cÃ©denteÂ :

```env lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ceci Ã  votre fichier server.py.

ENV_FILE = find_dotenv()
if ENV_FILE:
    load_dotenv(ENV_FILE)
```

Vous pouvez maintenant configurer Flask pour rÃ©pondre aux besoins de votre applicationÂ :

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ceci Ã  votre fichier server.py.

app = Flask(__name__)
app.secret_key = env.get("APP_SECRET_KEY")
```

Enfin, vous pouvez configurer Authlib pour gÃ©rer l&#39;authentification de votre application avec Auth0Â :

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ceci Ã  votre fichier server.py.

oauth = OAuth(app)

oauth.register(
    "auth0",
    client_id=env.get("AUTH0_CLIENT_ID"),
    client_secret=env.get("AUTH0_CLIENT_SECRET"),
    client_kwargs={
        "scope": "openid profile email",
    },
    server_metadata_url=f'https://{env.get("AUTH0_DOMAIN")}/.well-known/openid-configuration'
)
```

Vous pouvez en apprendre davantage sur les options de configuration disponibles pour la mÃ©thode OAuth `register()` dâ€™Authlib dans [leur documentation.](https://docs.authlib.org/en/latest/client/frameworks.html#using-oauth-2-0-to-log-in)

<div id="setup-your-routes">
  ## Configurez vos routes
</div>

Pour cette dÃ©monstration, nous allons ajouter 4 routes pour votre application : vos routes de connexion, de callback, de dÃ©connexion et dâ€™accueil.

<div id="triggering-authentication-with-login">
  ### DÃ©clencher lâ€™authentification avec /login
</div>

Lorsque les visiteurs de votre application accÃ¨dent Ã  la route `/login`, ils sont redirigÃ©s vers Auth0 pour dÃ©marrer le processus dâ€™authentification.

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ceci Ã  votre fichier server.py.

@app.route("/login")
def login():
    return oauth.auth0.authorize_redirect(
        redirect_uri=url_for("callback", _external=True)
    )
```

<div id="finalizing-authentication-with-callback">
  ### Finaliser lâ€™authentification avec /callback
</div>

Une fois que vos utilisateurs ont terminÃ© de se connecter avec Auth0, ils seront renvoyÃ©s vers votre application sur la route `/callback`. Cette route a pour rÃ´le dâ€™enregistrer la session de lâ€™utilisateur, de sorte que lorsquâ€™ils reviendront plus tard, ils nâ€™auront pas Ã  se reconnecter.

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ceci Ã  votre fichier server.py.

@app.route("/callback", methods=["GET", "POST"])
def callback():
    token = oauth.auth0.authorize_access_token()
    session["user"] = token
    return redirect("/")
```

<div id="clearing-a-session-with-logout">
  ### Effacer une session avec /logout
</div>

Comme vous pouvez vous y attendre, cette route gÃ¨re la dÃ©connexion dâ€™un utilisateur de votre application. Elle efface la session de lâ€™utilisateur dans votre application, puis effectue une brÃ¨ve redirection vers le point de terminaison de dÃ©connexion dâ€™Auth0 pour sâ€™assurer que sa session est complÃ¨tement effacÃ©e, avant de le renvoyer vers votre route dâ€™accueil (prÃ©sentÃ©e Ã  la section suivante).

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ce code Ã  votre fichier server.py.

@app.route("/logout")
def logout():
    session.clear()
    return redirect(
        "https://" + env.get("AUTH0_DOMAIN")
        + "/v2/logout?"
        + urlencode(
            {
                "returnTo": url_for("home", _external=True),
                "client_id": env.get("AUTH0_CLIENT_ID"),
            },
            quote_via=quote_plus,
        )
    )
```

<div id="theres-no-place-like-home">
  ### On n&#39;est bien que chez /home
</div>

Enfin, votre route dâ€™accueil servira soit Ã  afficher les dÃ©tails d&#39;un utilisateur authentifiÃ©, soit Ã  permettre aux visiteurs de se connecter.

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes prÃ©cÃ©dentes. Ajoutez ceci Ã  votre fichier server.py.

@app.route("/")
def home():
    return render_template("home.html", session=session.get('user'), pretty=json.dumps(session.get('user'), indent=4))
```

<div id="server-instantiation">
  ### Instanciation du serveur
</div>

Enfin, vous devrez ajouter un peu de code standard avec Flask pour quâ€™il exÃ©cute rÃ©ellement votre application et se mette Ã  lâ€™Ã©coute des connexions.

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ceci Ã  votre fichier server.py.

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=env.get("PORT", 3000))
```

<div id="add-templates">
  ## Ajouter les gabarits
</div>

Il ne reste plus quâ€™Ã  crÃ©er les fichiers de gabarit simples utilisÃ©s dans les routes ci-dessus (lors des appels Ã  `render_template()`).

CrÃ©ez un nouveau sous-rÃ©pertoire dans votre dossier de projet nommÃ© `templates`, et crÃ©ez deux fichiers Ã  lâ€™intÃ©rieur : `dashboard.html` et `home.html`. Vous pouvez coller le contenu des deux champs ci-dessous dans ces fichiers, respectivement :

```html lines
# ğŸ“ templates/home.html -----

<html>
  <head>
    <meta charset="utf-8" />
    <title>Exemple Auth0</title>
  </head>
  <body>
    {% if session %}
        <h1>Bienvenue, {{session.userinfo.name}}!</h1>
        <p><a href="/docs/logout">DÃ©connexion</a></p>
        <div><pre>{{pretty}}</pre></div>
    {% else %}
        <h1>Bienvenue, invitÃ©</h1>
        <p><a href="/docs/login">Connexion</a></p>
    {% endif %}
  </body>
</html>
```

<div id="run-your-application">
  ## ExÃ©cutez votre application
</div>

Vous Ãªtes prÃªt Ã  exÃ©cuter votre applicationÂ ! Ã€ partir du rÃ©pertoire de votre projet, ouvrez un terminal et exÃ©cutezÂ :

```bash lines
python3 server.py
```

Votre application est maintenant prÃªte : vous pouvez lâ€™ouvrir dans votre navigateur Ã  lâ€™adresse `http://localhost:3000`.

<Note>
  ##### Que pouvez-vous faire ensuite ?

  <table>
    <tr>
      <td><a href="/docs/fr-CA/authenticate/identity-providers">Configurer d&#39;autres fournisseurs d&#39;identitÃ©</a></td>
      <td><a href="/docs/fr-CA/secure/multi-factor-authentication">Activer l&#39;authentification multifacteur</a></td>
    </tr>

    <tr>
      <td><a href="/docs/fr-CA/secure/attack-protection">En savoir plus sur la protection contre les attaques</a></td>
      <td><a href="/docs/fr-CA/customize/rules">En savoir plus sur les Rules</a></td>
    </tr>
  </table>

  [Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/native/flutter/01-login.md)
</Note>
