---
title: Ajouter la fonctionnalité de connexion à votre application ASP.NET OWIN
sidebarTitle: ASP.NET OWIN

---

import {AuthCodeGroup} from "/snippets/fr-CA/AuthCodeGroup.jsx";

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/fr-CA/recipe.jsx"
import WebConfig from "/snippets/fr-CA/quickstart/webapp/aspnet-owin/web-config.mdx"
import AccountController1 from "/snippets/fr-CA/quickstart/webapp/aspnet-owin/AccountController1.mdx"
import AccountController2 from "/snippets/fr-CA/quickstart/webapp/aspnet-owin/AccountController2.mdx"
import AccountController3 from "/snippets/fr-CA/quickstart/webapp/aspnet-owin/AccountController3.mdx"

export const sections = [
  { id: "configure-auth0", title: "Configurer Auth0" },
  { id: "configure-the-project", title: "Configurer le projet" },
  { id: "configure-the-middleware", title: "Configurer le middleware" },
  { id: "add-login-to-your-application", title: "Ajouter une connexion à votre application" },
  { id: "add-logout-to-your-application", title: "Ajouter une déconnexion à votre application" },
  { id: "show-user-profile-information", title: "Afficher les informations du profil de l’utilisateur" }
]

<Recipe isSingleColumn>
  <Content>
    Auth0 vous permet d&#39;ajouter rapidement l&#39;authentification et d&#39;accéder aux informations de profil d&#39;utilisateur dans votre application. Ce guide explique comment intégrer Auth0 à toute application ASP.NET OWIN nouvelle ou existante en utilisant le package NuGet `Microsoft.Owin.Security.OpenIdConnect`.

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Pour utiliser les services Auth0, vous devez configurer une application dans Auth0 Dashboard. L’Application Auth0 est l’endroit où vous configurez le fonctionnement de l’authentification pour le projet que vous développez.

      ### Configurer une application

      Utilisez le sélecteur interactif pour créer une nouvelle Application Auth0 ou sélectionner une Application existante qui représente le projet que vous voulez intégrer. Chaque Application dans Auth0 se voit attribuer un ID client alphanumérique unique que le code de votre application utilisera pour appeler les API Auth0 via la Trousse de développement logiciel (SDK).

      Tous les paramètres que vous configurez à l’aide de ce démarrage rapide seront automatiquement mis à jour pour votre Application dans le [Dashboard](https://manage.auth0.com/#/), où vous pourrez gérer vos Applications à l’avenir.

      Si vous préférez explorer une configuration complète, vous pouvez plutôt consulter une application d’exemple.

      ### Configurer les URL de rappel (callback)

      Une URL de rappel (callback URL) est une URL dans votre application vers laquelle vous voulez qu’Auth0 redirige les utilisateurs après leur authentification. Si elle n’est pas définie, les utilisateurs ne seront pas renvoyés vers votre application après leur connexion.

      <Info>
        Si vous suivez notre projet d’exemple, définissez cette valeur à `http://localhost:3000/callback`.
      </Info>

      ### Configurer les URL de déconnexion

      Une URL de déconnexion est une URL dans votre application vers laquelle vous voulez qu’Auth0 redirige les utilisateurs après leur déconnexion. Si elle n’est pas définie, les utilisateurs ne pourront pas se déconnecter de votre application et recevront une erreur.

      <Info>
        Si vous suivez notre projet d’exemple, définissez cette valeur à `http://localhost:3000`.
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      ### Installer à partir de NuGet

      Pour intégrer Auth0 à ASP.NET OWIN, vous pouvez utiliser les packages NuGet `Microsoft.Owin.Security.OpenIdConnect` et `Microsoft.Owin.Security.Cookies`.

      ```text lines
      Install-Package Microsoft.Owin.Security.OpenIdConnect
      Install-Package Microsoft.Owin.Security.Cookies
      ```

      <Info>
        Des problèmes surviennent lorsque vous configurez le middleware de cookies OWIN et les cookies System.Web simultanément. Pour en savoir plus, consultez la documentation [System.Web cookie integration issues](https://github.com/aspnet/AspNetKatana/wiki/System.Web-response-cookie-integration-issues) afin d’atténuer ces problèmes.
      </Info>

      ### Configurer les informations d’identification

      Pour que la Trousse de développement logiciel (SDK) fonctionne correctement, définissez les propriétés suivantes dans `Web.config` :

      * `auth0:Domain` : le domaine de votre locataire Auth0. Vous pouvez le trouver dans Auth0 Dashboard, sous **Settings** de votre application, dans le champ **Domain**. Si vous utilisez un [domaine personnalisé](/docs/fr-CA/customize/custom-domains), définissez plutôt cette valeur sur celle de votre domaine personnalisé.
      * `auth0:ClientId` : l’ID de l’Application Auth0 que vous avez créée dans Auth0 Dashboard. Vous pouvez le trouver dans Auth0 Dashboard, sous **Settings** de votre application, dans le champ **Client ID**.

      <AuthCodeGroup>
        <WebConfig />

        <AccountController1 />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      Pour activer l’authentification dans votre application ASP.NET OWIN, accédez à la méthode Configuration de votre classe Startup et configurez les middlewares de cookies et d’OIDC.

      Il est essentiel d’enregistrer à la fois le middleware de cookies et le middleware OpenID Connect, car les deux sont requis (dans cet ordre) pour que l’authentification fonctionne. Le middleware OpenID Connect gère l’authentification avec Auth0. Une fois que les utilisateurs sont authentifiés, leur identité est stockée par le middleware de cookies.

      Dans l’extrait de code, AuthenticationType est défini sur **Auth0**. Utilisez AuthenticationType dans la section suivante pour déclencher le middleware OpenID Connect et démarrer le flux d’authentification. L’événement de notification RedirectToIdentityProvider construit l’URL de déconnexion appropriée.

      <AuthCodeGroup>
        <WebConfig />

        <AccountController1 />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      Pour permettre aux utilisateurs de se connecter à votre application ASP.NET OWIN, ajoutez une action `Login` à votre contrôleur.

      Appelez `HttpContext.GetOwinContext().Authentication.Challenge` et transmettez `"Auth0"` en tant que schéma d’authentification. Cela appelle le gestionnaire d’authentification OIDC qui a été enregistré précédemment. Assurez-vous de spécifier les `AuthenticationProperties` correspondantes, y compris une `RedirectUri`.

      Une fois l’appel à `HttpContext.GetOwinContext().Authentication.Challenge` effectué avec succès, l’utilisateur est redirigé vers Auth0, puis connecté à la fois au middleware OIDC et au middleware de cookies lorsqu’il est renvoyé vers votre application. Ainsi, les utilisateurs seront authentifiés lors des requêtes suivantes.

      <Info>
        ##### Point de contrôle

        Maintenant que vous avez configuré l’action `Login`, exécutez votre application pour vérifier que :

        * Lorsque vous accédez à votre action `Login`, vous êtes redirigé vers Auth0
        * Lorsque vous saisissez vos identifiants, vous êtes redirigé vers votre application.
      </Info>

      <AuthCodeGroup>
        <AccountController1 />

        <WebConfig />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      À partir de l’action de votre contrôleur, appelez `HttpContext.GetOwinContext().Authentication.SignOut` avec le schéma d’authentification `CookieAuthenticationDefaults.AuthenticationType` pour déconnecter l’utilisateur de votre application.

      De plus, si vous voulez déconnecter l’utilisateur d’Auth0 (ce qui peut aussi le déconnecter d’autres applications qui s’appuient sur l’authentification unique Single Sign-On), appelez `HttpContext.GetOwinContext().Authentication.SignOut` avec le schéma d’authentification `"Auth0"`.

      <Info>
        ##### Point de contrôle

        Maintenant que vous avez configuré la déconnexion, exécutez votre application pour vérifier que :

        * Accéder à votre action `Logout` garantit que l’utilisateur est déconnecté.
        * Pendant la déconnexion, vous êtes redirigé vers Auth0, puis immédiatement redirigé vers votre application.
      </Info>

      <AuthCodeGroup>
        <AccountController2 />

        <WebConfig />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      Une fois que le middleware a récupéré les jetons auprès d’Auth0, il extrait les renseignements et les revendications de l’utilisateur à partir du jeton ID et les rend disponibles sous la forme de `ClaimsIdentity`. Accédez aux renseignements extraits à l’aide de la propriété `User` sur le contrôleur.

      Pour créer le profil d’un utilisateur, récupérez le nom, l’adresse de courriel et l’image de profil de l’utilisateur à partir de `User` et transmettez-les à la vue depuis votre contrôleur.

      <Info>
        ##### Point de contrôle

        Maintenant que vous avez configuré votre action pour afficher le profil de l’utilisateur, exécutez votre application afin de vérifier que :

        * L’accès à votre action `Profile` après vous être connecté avec succès affiche le profil de l’utilisateur.
      </Info>

      <AuthCodeGroup>
        <AccountController3 />

        <WebConfig />
      </AuthCodeGroup>
    </Section>

    ## Prochaines étapes

    Excellent travail! Si vous vous êtes rendu jusqu&#39;ici, vous devriez maintenant avoir la connexion, la déconnexion et les informations de profil utilisateur qui fonctionnent dans votre application.

    Ce tutoriel de démarrage rapide est maintenant terminé, mais il reste encore beaucoup à découvrir. Pour en savoir plus sur ce que vous pouvez faire avec Auth0, consultez :

    * [Auth0 Dashboard](https://manage.auth0.com/) - Découvrez comment configurer et gérer votre tenant Auth0 et vos Applications
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Découvrez les intégrations que vous pouvez activer pour étendre les fonctionnalités d’Auth0
  </Content>
</Recipe>