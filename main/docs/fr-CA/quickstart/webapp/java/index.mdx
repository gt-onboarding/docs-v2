---
title: "Java"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";

<div id="by-jim-anderson">
  ##### Par Jim Anderson
</div>

Ce tutoriel montre comment ajouter une fonctionnalité de connexion utilisateur à une application Java Servlet. Nous vous recommandons de vous connecter à Auth0 pour suivre ce Démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Voir sur GitHub" href="https://github.com/auth0-samples/auth0-servlet-sample/tree/master/01-Login" icon="github">
  Configuration système requise : Java 8 | Gradle 3.3 ou version ultérieure
  </Card> */}

<Info>
  **Vous débutez avec l’authentification?** Découvrez [comment fonctionne Auth0](/docs/fr-CA/get-started/auth0-overview), comment il [s’intègre aux Applications Web classiques (Regular Web Applications)](/docs/fr-CA/get-started/architecture-scenarios/sso-for-regular-web-apps) et le [protocole](/docs/fr-CA/get-started/authentication-and-authorization-flow) qu’il utilise.
</Info>

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenir les identifiants de votre Application
</div>

Lorsque vous vous êtes inscrit à Auth0, une nouvelle Application a été créée pour vous, ou vous en avez peut‑être créé une nouvelle. Vous aurez besoin de certaines informations concernant cette Application pour communiquer avec Auth0. Vous pouvez obtenir ces informations dans la section [Application Settings](https://manage.auth0.com/#/applications) de l’Auth0 Dashboard.

<Frame>![Tableau de bord de l’Application](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

Vous aurez besoin des renseignements suivants :

* **Domaine**
* **ID client**
* **Secret client**

<Info>
  Si vous téléchargez l’exemple en haut de cette page, ces renseignements sont déjà renseignés pour vous.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de redirection
</div>

Une URL de redirection est une URL dans votre application où Auth0 redirige l’utilisateur après son authentification. L’URL de redirection de votre application doit être ajoutée au champ **Allowed Callback URLs** (URL de redirection autorisées) dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n’est pas configuré, les utilisateurs ne pourront pas se connecter à l’application et recevront un message d’erreur.

<Info>
  Si vous suivez le projet d’exemple que vous avez téléchargé en haut de cette page, l’URL de redirection que vous devez ajouter au champ **Allowed Callback URLs** (URL de redirection autorisées) est `http://localhost:3000/callback`.
</Info>

<div id="configure-logout-urls">
  ### Configurer les URL de déconnexion
</div>

Une URL de déconnexion est une URL dans votre application vers laquelle Auth0 peut retourner une fois que l’utilisateur a été déconnecté du serveur d’autorisation. Celle-ci est spécifiée dans le paramètre de requête `returnTo`. L’URL de déconnexion de votre application doit être ajoutée au champ **URL de déconnexion autorisées** dans vos [paramètres d’Application](https://manage.auth0.com/#/applications). Si ce champ n’est pas défini, les utilisateurs ne pourront pas se déconnecter de l’application et recevront un message d’erreur.

<Info>
  Si vous suivez le projet d’exemple que vous avez téléchargé en haut de cette page, l’URL de déconnexion que vous devez ajouter au champ **URL de déconnexion autorisées** est `http://localhost:3000/login`.
</Info>

<div id="integrate-auth0-in-your-application">
  ## Intégrez Auth0 à votre application
</div>

<div id="setup-dependencies">
  ### Configurer les dépendances
</div>

Pour intégrer votre application Java à Auth0, ajoutez les dépendances suivantes :

* **javax.servlet-api** : bibliothèque qui vous permet de créer des servlets Java. Vous devez ensuite ajouter une dépendance de serveur comme Tomcat ou Gretty, le choix vous revient. Consultez notre exemple de code pour plus d’information.
* **auth0-java-mvc-commons** : [bibliothèque Java](https://github.com/auth0/auth0-java-mvc-common) qui vous permet d’utiliser Auth0 avec Java pour des applications web MVC côté serveur. Elle génère l’URL Authorize que vous devez appeler pour lancer l’authentification et valide la réponse reçue au retour afin d’obtenir les [jetons Auth0](/docs/fr-CA/secure/tokens) qui identifient l’utilisateur.

Si vous utilisez Gradle, ajoutez-les à votre `build.gradle` :

```gradle lines
// build.gradle

compile 'javax.servlet:javax.servlet-api:3.1.0'
compile 'com.auth0:mvc-auth-commons:1.+'
```

Si vous utilisez Maven, ajoutez-les à votre `pom.xml` :

```xml lines
<!-- pom.xml -->

<dependency>
  <groupId>com.auth0</groupId>
  <artifactId>mvc-auth-commons</artifactId>
  <version>[1.0, 2.0)</version>
</dependency>
<dependency>
  <groupId>javax.servlet</groupId>
  <artifactId>javax.servlet-api</artifactId>
  <version>3.1.0</version>
</dependency>
```

<div id="configure-your-java-app">
  ### Configurez votre application Java
</div>

Votre application Java a besoin de certaines informations pour s’authentifier auprès de votre compte Auth0. Les exemples récupèrent ces informations à partir du descripteur de déploiement `src/main/webapp/WEB-INF/web.xml`, mais vous pouvez les stocker ailleurs. Les informations requises sont :

export const codeExample = `<!-- src/main/webapp/WEB-INF/web.xml -->

<context-param>
    <param-name>com.auth0.domain</param-name>
    <param-value>{yourDomain}</param-value>
</context-param>

<context-param>
    <param-name>com.auth0.clientId</param-name>
    <param-value>{yourClientId}</param-value>
</context-param>

<context-param>
    <param-name>com.auth0.clientSecret</param-name>
    <param-value>{yourClientSecret}</param-value>
</context-param>`;

<AuthCodeBlock children={codeExample} language="xml" />

Ces informations seront utilisées pour configurer la bibliothèque **auth0-java-mvc-commons** afin de permettre aux utilisateurs de se connecter à votre application. Pour en savoir plus sur la bibliothèque, y compris ses différentes options de configuration, consultez la [documentation de la bibliothèque](https://github.com/auth0/auth0-java-mvc-common/blob/master/README.md).

<Note>
  ### Vérifiez les attributs renseignés

  Si vous avez téléchargé cet exemple à l’aide du bouton **Download Sample**, les attributs `domain`, `clientId` et `clientSecret` seront déjà renseignés pour vous. Vérifiez que les valeurs sont correctes, surtout si vous avez plusieurs Applications Auth0 dans votre compte.
</Note>

<div id="project-structure">
  ### Structure du projet
</div>

L’exemple de projet Login présente la structure suivante :

```bash lines
- src
-- main
---- java
------ com
-------- auth0
---------- example
------------ Auth0Filter.java
------------ AuthenticationControllerProvider.java
------------ HomeServlet.java
------------ CallbackServlet.java
------------ LoginServlet.java
------------ LogoutServlet.java
---- webapp
------ WEB-INF
-------- jsp
---------- home.jsp
-------- web.xml
- build.gradle
```

Le projet contient une seule JSP : `home.jsp`, qui affiche les jetons associés à l’utilisateur après une connexion réussie et offre une option de déconnexion.

Le projet contient un WebFilter : `Auth0Filter.java`, qui vérifie l’existence de jetons avant de donner à l’utilisateur accès à notre chemin protégé `/portal/*`. Si les jetons n’existent pas, la requête est redirigée vers `LoginServlet`.

Le projet contient également quatre servlets :

* `LoginServlet.java` : Invoqué lorsque l’utilisateur tente de se connecter. Le servlet utilise les paramètres `client_id` et `domain` pour créer une URL Authorize valide et y redirige l’utilisateur.
* `CallbackServlet.java` : Le servlet intercepte les requêtes vers notre URL de rappel (Callback) et traite les données pour obtenir les informations d’identification. Après une connexion réussie, les informations d’identification sont ensuite enregistrées dans le HttpSession de la requête.
* `HomeServlet.java` : Le servlet lit les jetons enregistrés précédemment et les affiche dans la ressource `home.jsp`.
* `LogoutServlet.java` : Invoqué lorsque l’utilisateur clique sur le lien de déconnexion. Le servlet invalide la session de l’utilisateur et le redirige vers la page de connexion, gérée par `LoginServlet`.
* `AuthenticationControllerProvider` : Responsable de créer et de gérer une instance unique de `AuthenticationController`

<div id="create-the-authenticationcontroller">
  ## Créer le AuthenticationController
</div>

Pour permettre aux utilisateurs de s’authentifier, créez une instance de `AuthenticationController` fournie par la Trousse de développement logiciel (SDK) `auth0-java-mvc-commons` en utilisant le `domain`, le `clientId` et le `clientSecret`. L’exemple montre comment configurer le composant pour une utilisation avec des jetons signés à l’aide de l’algorithme de signature asymétrique RS256, en spécifiant un `JwkProvider` pour récupérer la clé publique utilisée pour vérifier la signature du jeton. Consultez le [référentiel jwks-rsa-java](https://github.com/auth0/jwks-rsa-java) pour en savoir plus sur les options de configuration supplémentaires. Si vous utilisez HS256, il n’est pas nécessaire de configurer le `JwkProvider`.

<Info>
  Le `AuthenticationController` ne stocke aucun contexte et est conçu pour être réutilisé. Des créations inutiles peuvent entraîner l’allocation de ressources supplémentaires, ce qui pourrait avoir une incidence sur la performance.
</Info>

```java lines
class AuthenticationControllerProvider {

    private AuthenticationControllerProvider() {}

    private static AuthenticationController INSTANCE;

    // si plusieurs threads peuvent appeler cette méthode, la synchroniser et envisager le verrouillage double
    static AuthenticationController getInstance(ServletConfig config) throws UnsupportedEncodingException {
        if (INSTANCE == null) {
            String domain = config.getServletContext().getInitParameter("com.auth0.domain");
            String clientId = config.getServletContext().getInitParameter("com.auth0.clientId");
            String clientSecret = config.getServletContext().getInitParameter("com.auth0.clientSecret");

            if (domain == null || clientId == null || clientSecret == null) {
                throw new IllegalArgumentException("Domaine, clientId ou clientSecret manquant. Avez-vous mis à jour src/main/webapp/WEB-INF/web.xml ?");
            }

            // JwkProvider requis pour les jetons RS256. Si vous utilisez HS256, ne pas l'utiliser.
            JwkProvider jwkProvider = new JwkProviderBuilder(domain).build();
            INSTANCE = AuthenticationController.newBuilder(domain, clientId, clientSecret)
                    .withJwkProvider(jwkProvider)
                    .build();
        }

        return INSTANCE;
    }
```

<div id="trigger-authentication">
  ## Déclencher l’authentification
</div>

Pour permettre aux utilisateurs de se connecter, votre application les redirigera vers la page [Universal Login](https://auth0.com/docs/universal-login). À l’aide de l’instance `AuthenticationController`, vous pouvez générer l’URL de redirection en appelant la méthode `buildAuthorizeUrl(HttpServletRequest request, HttpServletResponse response, String redirectUrl)`. L’URL de redirection doit correspondre à l’URL qui a été ajoutée au champ **Allowed Callback URLs** de votre Application Auth0.

```java lines
// src/main/java/com/auth0/example/LoginServlet.java

@Override
protected void doGet(final HttpServletRequest req, final HttpServletResponse res) throws ServletException, IOException {
    String redirectUri = req.getScheme() + "://" + req.getServerName();
    if ((req.getScheme().equals("http") && req.getServerPort() != 80) || (req.getScheme().equals("https") && req.getServerPort() != 443)) {
        redirectUri += ":" + req.getServerPort();
    }
    redirectUri += "/callback";

    String authorizeUrl = authenticationController.buildAuthorizeUrl(req, res, redirectUri)
            .build();
    res.sendRedirect(authorizeUrl);
}
```

Une fois que l’utilisateur s’est connecté, le résultat est reçu dans notre `CallbackServlet` par une requête HTTP GET ou POST. Comme nous utilisons l’Authorization Code Flow (valeur par défaut), une requête GET sera envoyée. Si vous avez configuré la bibliothèque pour l’Implicit Flow, une requête POST sera envoyée à la place.

La requête contient le contexte d’appel que la bibliothèque a préalablement établi en générant l’URL Authorize avec l’`AuthenticationController`. Une fois la requête transmise au contrôleur, vous obtenez soit une instance `Tokens` valide, soit une Exception indiquant ce qui s’est mal passé. En cas de succès, vous devez enregistrer les informations d’identification à un endroit où vous pourrez y accéder ultérieurement. Vous pouvez utiliser la `HttpSession` associée à la requête au moyen de la classe `SessionsUtils` incluse dans la bibliothèque.

```java lines
// src/main/java/com/auth0/example/CallbackServlet.java

@Override
public void doGet(HttpServletRequest req, HttpServletResponse res) throws IOException, ServletException {
    handle(req, res);
}

@Override
public void doPost(HttpServletRequest req, HttpServletResponse res) throws IOException, ServletException {
    handle(req, res);
}

private void handle(HttpServletRequest req, HttpServletResponse res) throws IOException {
    try {
        // Analyser la demande
        Tokens tokens = authenticationController.handle(req, res);
        SessionUtils.set(req, "accessToken", tokens.getAccessToken());
        SessionUtils.set(req, "idToken", tokens.getIdToken());
        res.sendRedirect(redirectOnSuccess);
    } catch (IdentityVerificationException e) {
        e.printStackTrace();
        res.sendRedirect(redirectOnFail);
    }
}
```

<Info>
  Il est recommandé de conserver l’heure à laquelle les jetons ont été demandés ainsi que la valeur `expiresIn` reçue, afin que, lors de la prochaine utilisation du jeton, vous puissiez vérifier s’il a déjà expiré ou s’il est toujours valide. Dans le cadre de cet exemple, nous allons ignorer cette validation.
</Info>

<div id="display-the-home-page">
  ## Afficher la page d’accueil
</div>

Maintenant que l’utilisateur est authentifié (les jetons existent), `Auth0Filter` lui permet d’accéder à nos ressources protégées. Dans `HomeServlet`, nous récupérons les jetons à partir de la session de la requête et nous les définissons comme attribut `userId` afin qu’ils puissent être utilisés dans le code JSP :

```java lines
// src/main/java/com/auth0/example/HomeServlet.java

protected void doGet(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {
    final String accessToken = (String) SessionUtils.get(req, "accessToken");
    final String idToken = (String) SessionUtils.get(req, "idToken");
    if (accessToken != null) {
        req.setAttribute("userId", accessToken);
    } else if (idToken != null) {
        req.setAttribute("userId", idToken);
    }
    req.getRequestDispatcher("/WEB-INF/jsp/home.jsp").forward(req, res);
}
```

<div id="handle-logout">
  ## Gérer la déconnexion
</div>

Pour gérer correctement la déconnexion, nous devons mettre fin à la session et déconnecter l’utilisateur d’Auth0. Cette logique est gérée dans le `LogoutServlet` de notre application d’exemple.

D’abord, nous mettons fin à la session en appelant `request.getSession().invalidate()`. Nous construisons ensuite l’URL de déconnexion, en veillant à inclure le paramètre de requête `returnTo`, qui correspond à l’emplacement où l’utilisateur sera redirigé après sa déconnexion. Enfin, nous redirigeons la réponse vers notre URL de déconnexion.

```java lines
// src/main/java/com/auth0/example/LogoutServlet.java

@Override
protected void doGet(final HttpServletRequest request, final HttpServletResponse response) throws ServletException, IOException {
    if (request.getSession() != null) {
        request.getSession().invalidate();
    }

    String returnUrl = String.format("%s://%s", request.getScheme(), request.getServerName());
    if ((request.getScheme().equals("http") && request.getServerPort() != 80) || (request.getScheme().equals("https") && request.getServerPort() != 443)) {
        returnUrl += ":" + request.getServerPort();
    }
    returnUrl += "/login";

    // Construire l'URL de déconnexion comme suit :
    // https://{VOTRE-DOMAINE}/v2/logout?client_id={VOTRE-CLIENT-ID}&returnTo=http://localhost:3000/login
    String logoutUrl = String.format(
            "https://%s/v2/logout?client_id=%s&returnTo=%s",
            domain,
            clientId,
            returnUrl
    );
    response.sendRedirect(logoutUrl);
}
```

<div id="run-the-sample">
  ## Exécuter l’exemple
</div>

Pour exécuter l’exemple depuis un terminal, accédez au répertoire racine du projet et exécutez la commande suivante :

```bash lines
./gradlew clean appRun
```

Après quelques secondes, l&#39;application sera accessible à l&#39;adresse `http://localhost:3000/`. Essayez d&#39;accéder à la ressource protégée `http://localhost:3000/portal/home` et remarquez que vous êtes redirigé par le `Auth0Filter` vers la page de connexion d&#39;Auth0. Le widget affiche toutes les connexions sociales et de base de données que vous avez définies pour cette application dans le [tableau de bord](https://manage.auth0.com/#/).

<Frame>![Auth0 Universal Login](https://cdn2.auth0.com/docs/1.14550.0/media/quickstarts/universal-login.png)</Frame>

Après vous être authentifié avec succès, vous pourrez voir le contenu de la page d&#39;accueil.

<Frame>![Display Token](https://cdn2.auth0.com/docs/1.14550.0/media/articles/java/display-token.png)</Frame>

Déconnectez-vous en cliquant sur le bouton **Logout** en haut à droite de la page d&#39;accueil.

<Note>
  ##### Que pouvez-vous faire ensuite ?

  <table>
    <tr>
      <td><a href="/docs/fr-CA/authenticate/identity-providers">Configurer d&#39;autres fournisseurs d&#39;identité</a></td>
      <td><a href="/docs/fr-CA/secure/multi-factor-authentication">Activer l&#39;authentification multifacteur</a></td>
    </tr>

    <tr>
      <td><a href="/docs/fr-CA/secure/attack-protection">En savoir plus sur la protection contre les attaques</a></td>
      <td><a href="/docs/fr-CA/customize/rules">En savoir plus sur la fonctionnalité Rules</a></td>
    </tr>
  </table>

  [Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/native/flutter/01-login.md)
</Note>
