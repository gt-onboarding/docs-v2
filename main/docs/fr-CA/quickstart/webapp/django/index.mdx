---
title: "Django"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";

<div id="by-evan-sims">
  ##### Par Evan Sims
</div>

Ce tutoriel montre comment ajouter une fonctionnalitÃ© de connexion utilisateur Ã  une application Web Python crÃ©Ã©e avec le framework Django et la bibliothÃ¨que OAuth Authlib. Nous vous recommandons de vous connecter afin de suivre ce DÃ©marrage rapide avec des exemples adaptÃ©s Ã  votre compte.

{/* <Card title="Voir sur GitHub" href="https://github.com/auth0-samples/auth0-django-web-app/tree/master/01-Login" icon="github">
  Configuration systÃ¨me requise : Python 3 | Authlib 1.0 | Django 4.0
  </Card> */}

<Info>
  **Nouveau dans lâ€™authentification?** DÃ©couvrez [comment fonctionne Auth0](/docs/fr-CA/get-started/auth0-overview), comment Auth0 [sâ€™intÃ¨gre aux applications Web classiques](/docs/fr-CA/get-started/architecture-scenarios/sso-for-regular-web-apps) et quel [protocole](/docs/fr-CA/get-started/authentication-and-authorization-flow) il utilise.
</Info>

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenir les clÃ©s de votre Application
</div>

Lorsque vous vous Ãªtes inscrit Ã  Auth0, une nouvelle Application a Ã©tÃ© crÃ©Ã©e pour vous, ou vous en avez crÃ©Ã© une vousâ€‘mÃªme. Vous aurez besoin de certaines informations concernant cette Application pour communiquer avec Auth0. Vous pouvez obtenir ces informations dans la section [Application Settings](https://manage.auth0.com/#/applications) de lâ€™Auth0 Dashboard.

<Frame>![App Dashboard](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

Vous avez besoin des informations suivantes :

* **Domaine**
* **ID client**
* **Secret client**

<Info>
  Si vous tÃ©lÃ©chargez lâ€™exemple depuis le haut de cette page, ces informations sont dÃ©jÃ  renseignÃ©es pour vous.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de rappel (callback)
</div>

Une URL de rappel est une URL de votre application vers laquelle Auth0 redirige l&#39;utilisateur aprÃ¨s son authentification. L&#39;URL de rappel de votre application doit Ãªtre ajoutÃ©e au champ **URL de redirection autorisÃ©es** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n&#39;est pas dÃ©fini, les utilisateurs ne pourront pas se connecter Ã  l&#39;application et recevront une erreur.

<Info>
  Si vous suivez le projet d&#39;exemple que vous avez tÃ©lÃ©chargÃ© en haut de cette page, l&#39;URL de rappel que vous devez ajouter au champ **URL de redirection autorisÃ©es** est `http://localhost:3000/callback`.
</Info>

<div id="configure-logout-urls">
  ### Configurer les URL de dÃ©connexion
</div>

Une URL de dÃ©connexion est une URL dans votre application vers laquelle Auth0 peut revenir aprÃ¨s la dÃ©connexion de lâ€™utilisateur du Serveur dâ€™autorisation. Elle est spÃ©cifiÃ©e dans le paramÃ¨tre de requÃªte `returnTo`. Lâ€™URL de dÃ©connexion de votre application doit Ãªtre ajoutÃ©e au champ **URL de dÃ©connexion autorisÃ©es** dans vos [ParamÃ¨tres de lâ€™Application](https://manage.auth0.com/#/applications). Si ce champ nâ€™est pas configurÃ©, les utilisateurs ne pourront pas se dÃ©connecter de lâ€™application et recevront une erreur.

<Info>
  Si vous suivez le projet dâ€™exemple que vous avez tÃ©lÃ©chargÃ© en haut de cette page, lâ€™URL de dÃ©connexion que vous devez ajouter au champ **URL de dÃ©connexion autorisÃ©es** est `http://localhost:3000`.
</Info>

<div id="create-application">
  ## CrÃ©er lâ€™application
</div>

Dans ce guide, nous vous montrons comment intÃ©grer Auth0 Ã  une application Python Ã  lâ€™aide du [framework Django](https://www.djangoproject.com/) et dâ€™[Authlib](https://authlib.org/). Commencez par vÃ©rifier que Django est installÃ© sur votre systÃ¨me. Depuis votre shell, exÃ©cutez la commande suivante :

```bash lines
pip install django~=4.0
```

Si vous avez dÃ©jÃ  une application Python configurÃ©e, vous pouvez passer Ã  lâ€™Ã©tape suivante. Sinon, crÃ©ons notre nouveau projet dâ€™application. Dans votre terminal, exÃ©cutez la commande suivante, puis rendez-vous dans le nouveau dossier du projet :

```bash lines
django-admin startproject webappexample
cd webappexample
```

<div id="install-dependencies">
  ## Installer les dÃ©pendances
</div>

Pour cette intÃ©gration, vous aurez besoin de quelques bibliothÃ¨ques, dont Authlib. CrÃ©ez un fichier `requirements.txt` dans le rÃ©pertoire de votre projet et incluez-y ce qui suitÂ :

```txt lines
# ğŸ“ requirements.txt -----

authlib ~= 1.0
django ~= 4.0
python-dotenv ~= 0.19
requests ~= 2.27
```

Vous devez maintenant exÃ©cuter la commande `pip install -r requirements.txt` depuis votre shell pour que ces dÃ©pendances soient disponibles pour votre projet.

<div id="configure-your-env-file">
  ## Configurez votre fichier .env
</div>

CrÃ©ez ensuite un fichier `.env` dans le rÃ©pertoire de votre projet. Ce fichier contiendra les clÃ©s du client et d&#39;autres paramÃ¨tres de configuration.

export const codeExample = `# ğŸ“ .env -----

AUTH0_CLIENT_ID={yourClientId}
AUTH0_CLIENT_SECRET={yourClientSecret}
AUTH0_DOMAIN={yourDomain}`;

<AuthCodeBlock children={codeExample} language="env" />

<div id="update-settingspy">
  ## Mettre Ã  jour settings.py
</div>

Vous devez apporter quelques petites modifications Ã  votre fichier `webappexample/settings.py` pour lire les valeurs dÃ©finies dans le fichier `.env`. En haut du fichier, ajoutez ces importsÂ :

```py lines
# ğŸ“ webappexample/settings.py -----

import os
from dotenv import load_dotenv, find_dotenv
```

Ensuite, sous la dÃ©finition de &#39;BASE&#95;DIR&#39;, ajoutez ce qui suit :

```py lines
# ğŸ“ webappexample/settings.py -----

# Ajoutez la ligne suivante aprÃ¨s 'BASE_DIR = ...'
TEMPLATE_DIR = os.path.join(BASE_DIR, "webappexample", "templates")
```

Ensuite, trouvez la variable `TEMPLATES` et mettez Ã  jour la valeur `DIRS` pour ajouter notre chaÃ®ne `TEMPLATE_DIR`. Cela indique Ã  Django oÃ¹ chercher nos fichiers de gabarits une fois que nous les aurons crÃ©Ã©s. Gardez tout autre contenu de ce tableau tel quel.

```py lines
# ğŸ“ webappexample/settings.py -----

TEMPLATES = [
    {
        # Laissez les autres lignes telles quelles; nous ne mettons Ã  jour que `DIRS`.
        "DIRS": [TEMPLATE_DIR],
    },
]
```

Enfin, Ã  la fin de ce fichier, ajoutez ce qui suit :

```py lines
# ğŸ“ webappexample/settings.py -----

# Charger le fichier de dÃ©finition de l'environnement
ENV_FILE = find_dotenv()
if ENV_FILE:
    load_dotenv(ENV_FILE)


# Charger les paramÃ¨tres de l'Application Auth0 en mÃ©moire
AUTH0_DOMAIN = os.environ.get("AUTH0_DOMAIN")
AUTH0_CLIENT_ID = os.environ.get("AUTH0_CLIENT_ID")
AUTH0_CLIENT_SECRET = os.environ.get("AUTH0_CLIENT_SECRET")
```

<div id="setup-your-application">
  ## Configurer votre application
</div>

Vous Ãªtes maintenant prÃªt Ã  commencer Ã  dÃ©velopper votre application. Ouvrez le fichier `webappexample/views.py` dans le rÃ©pertoire de votre projet.

Commencez par importer toutes les bibliothÃ¨ques que votre application utilisera :

```py lines
# ğŸ“ webappexample/views.py -----

import json
from authlib.integrations.django_client import OAuth
from django.conf import settings
from django.shortcuts import redirect, render
from django.urls import reverse
from urllib.parse import quote_plus, urlencode
```

Vous pouvez maintenant configurer Authlib pour gÃ©rer lâ€™authentification de votre application via Auth0Â :

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ce qui suit Ã  votre fichier webappexample/views.py.

oauth = OAuth()

oauth.register(
    "auth0",
    client_id=settings.AUTH0_CLIENT_ID,
    client_secret=settings.AUTH0_CLIENT_SECRET,
    client_kwargs={
        "scope": "openid profile email",
    },
    server_metadata_url=f"https://{settings.AUTH0_DOMAIN}/.well-known/openid-configuration",
)
```

Vous pouvez en savoir plus sur les options de configuration disponibles pour la mÃ©thode OAuth `register()` d&#39;Authlib dans [leur documentation.](https://docs.authlib.org/en/latest/client/frameworks.html#using-oauth-2-0-to-log-in)

<div id="setup-your-route-handlers">
  ## Configurez vos gestionnaires de routes
</div>

Pour cette dÃ©monstration, vous allez ajouter quatre routes pour votre applicationÂ : /login, /callback, /logout et la route dâ€™index.

<div id="triggering-authentication-with-login">
  ### DÃ©clenchement de lâ€™authentification avec /login
</div>

Lorsque les visiteurs de votre application accÃ¨dent Ã  la route `/login`, ils sont redirigÃ©s vers Auth0 pour commencer le flux dâ€™authentification.

```py lines
# ğŸ‘† Nous poursuivons les Ã©tapes ci-dessus. Ajoutez ceci Ã  votre fichier webappexample/views.py.

def login(request):
    return oauth.auth0.authorize_redirect(
        request, request.build_absolute_uri(reverse("callback"))
    )
```

<div id="finalizing-authentication-with-callback">
  ### Finaliser lâ€™authentification avec /callback
</div>

Une fois que vos utilisateurs ont terminÃ© de se connecter avec Auth0, ils seront renvoyÃ©s vers votre application Ã  la route `/callback`. Cette route est responsable dâ€™enregistrer la session de lâ€™utilisateur afin que, lorsquâ€™ils reviennent plus tard, ils nâ€™aient pas Ã  se reconnecter.

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ceci Ã  votre fichier webappexample/views.py.

def callback(request):
    token = oauth.auth0.authorize_access_token(request)
    request.session["user"] = token
    return redirect(request.build_absolute_uri(reverse("index")))
```

<div id="clearing-a-session-with-logout">
  ### Effacer une session avec /logout
</div>

Comme vous pouvez vous y attendre, cette route gÃ¨re la dÃ©connexion dâ€™un utilisateur de votre application. Elle efface la session de lâ€™utilisateur dans votre application et redirige briÃ¨vement vers le point de terminaison de dÃ©connexion dâ€™Auth0 pour sâ€™assurer que sa session soit complÃ¨tement supprimÃ©e, avant quâ€™il ne soit renvoyÃ© vers votre route dâ€™accueil (prÃ©sentÃ©e ensuite).

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ceci Ã  votre fichier webappexample/views.py.

def logout(request):
    request.session.clear()

    return redirect(
        f"https://{settings.AUTH0_DOMAIN}/v2/logout?"
        + urlencode(
            {
                "returnTo": request.build_absolute_uri(reverse("index")),
                "client_id": settings.AUTH0_CLIENT_ID,
            },
            quote_via=quote_plus,
        ),
    )
```

<div id="theres-no-place-like-home">
  ### Rien ne vaut /home
</div>

Enfin, votre route d&#39;accueil servira Ã  afficher les informations d&#39;un utilisateur authentifiÃ© ou Ã  proposer aux visiteurs de se connecter.

```py lines
# ğŸ‘† Nous poursuivons Ã  partir des Ã©tapes ci-dessus. Ajoutez ceci Ã  votre fichier webappexample/views.py.

def index(request):
    return render(
        request,
        "index.html",
        context={
            "session": request.session.get("user"),
            "pretty": json.dumps(request.session.get("user"), indent=4),
        },
    )
```

<div id="register-your-routes">
  ### Enregistrez vos routes
</div>

Enfin, vous devez indiquer Ã  Django comment associer ces nouvelles routes. Remplacez le contenu de votre fichier `webappexample/urls.py` par ce qui suitâ€¯:

```py lines
# ğŸ“ webappexample/urls.py -----

from django.urls import path

from . import views

urlpatterns = [
    path("", views.index, name="index"),
    path("login", views.login, name="login"),
    path("logout", views.logout, name="logout"),
    path("callback", views.callback, name="callback"),
]
```

<div id="add-templates">
  ## Ajouter des gabarits
</div>

Il ne reste plus qu&#39;Ã  crÃ©er les fichiers de gabarit simples utilisÃ©s dans les routes Â« about Â» (pendant les appels Ã  `render()`).

CrÃ©ez un nouveau sous-rÃ©pertoire dans le dossier `webappexample` nommÃ© `templates`, et crÃ©ez un fichier `index.html` :

```html lines
# ğŸ“ webappexample/templates/index.html -----

<html>
  <head>
    <meta charset="utf-8" />
    <title>Auth0 Example</title>
  </head>
  <body>
    {% if session %}
    <h1>Bienvenue {{session.userinfo.name}} !</h1>
    <p><a href="{% url 'logout' %}">DÃ©connexion</a></p>
    <div><pre>{{pretty}}</pre></div>
    {% else %}
    <h1>Bienvenue</h1>
    <p><a href="{% url 'login' %}">Connexion</a></p>
    {% endif %}
  </body>
</html>
```

<div id="run-your-application">
  ## ExÃ©cutez votre application
</div>

Vous Ãªtes prÃªt Ã  exÃ©cuter votre applicationÂ ! Ã€ partir du rÃ©pertoire de votre projet, ouvrez un terminal et exÃ©cutezÂ :

```bash lines
python3 manage.py migrate
python3 manage.py runserver 3000
```

Votre application devrait maintenant Ãªtre prÃªte Ã  Ãªtre ouverte dans votre navigateur Ã  lâ€™adresse `http://localhost:3000`.

<Note>
  ##### Que pouvez-vous faire ensuite ?

  <table>
    <tr>
      <td><a href="/docs/fr-CA/authenticate/identity-providers">Configurer dâ€™autres fournisseurs dâ€™identitÃ©</a></td>
      <td><a href="/docs/fr-CA/secure/multi-factor-authentication">Activer lâ€™authentification multifacteur</a></td>
    </tr>

    <tr>
      <td><a href="/docs/fr-CA/secure/attack-protection">En savoir plus sur la protection contre les attaques</a></td>
      <td><a href="/docs/fr-CA/customize/rules">En savoir plus sur la fonctionnalitÃ© Rules</a></td>
    </tr>
  </table>

  [Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/native/flutter/01-login.md)
</Note>
