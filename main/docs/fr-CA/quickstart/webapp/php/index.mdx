---
title: "PHP"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";

<div id="by-evan-sims">
  ##### Par Evan Sims
</div>

Ce guide explique comment int√©grer Auth0 √† une application PHP √† l‚Äôaide de la Trousse de d√©veloppement logiciel (SDK) Auth0 pour PHP. Nous vous recommandons de vous connecter pour suivre ce d√©marrage rapide avec des exemples configur√©s pour votre compte.

{/* <Card title="Voir sur GitHub" href="https://github.com/auth0-samples/auth0-php-web-app/tree/main/app" icon="github">
  Configuration syst√®me requise : PHP 7.4+ (8.0 recommand√©) | Auth0-PHP 8.0 | Composer
  </Card> */}

<Info>
  **Vous d√©butez avec Auth0¬†?** Apprenez [comment Auth0 fonctionne](/docs/fr-CA/get-started/auth0-overview), comment il [s‚Äôint√®gre aux Regular Web Applications](/docs/fr-CA/get-started/architecture-scenarios/sso-for-regular-web-apps) et quel [protocole](/docs/fr-CA/get-started/authentication-and-authorization-flow) il utilise.
</Info>

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenir les cl√©s de votre application
</div>

Lors de votre inscription √† Auth0, une nouvelle application a √©t√© cr√©√©e pour vous, ou vous avez pu en cr√©er une nouvelle. Vous aurez besoin de certaines informations concernant cette application pour communiquer avec Auth0. Vous pouvez obtenir ces informations dans la section [Application Settings](https://manage.auth0.com/#/applications) de l‚ÄôAuth0 Dashboard.

<Frame>![Tableau de bord de l‚Äôapplication](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

Vous avez besoin des informations suivantes :

* **Domaine**
* **ID client**
* **Secret client**

<Info>
  Si vous t√©l√©chargez l‚Äôexemple en haut de cette page, ces informations sont d√©j√† renseign√©es pour vous.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de redirection (callback)
</div>

Une URL de redirection (callback) est une URL de votre application vers laquelle Auth0 redirige l&#39;utilisateur apr√®s son authentification. L&#39;URL de redirection pour votre application doit √™tre ajout√©e au champ **URL de redirection autoris√©es** dans vos [param√®tres d&#39;Application](https://manage.auth0.com/#/applications). Si ce champ n&#39;est pas configur√©, les utilisateurs ne pourront pas se connecter √† l&#39;application et recevront une erreur.

<Info>
  Si vous suivez le projet d&#39;exemple que vous avez t√©l√©charg√© en haut de cette page, l&#39;URL de redirection que vous devez ajouter au champ **URL de redirection autoris√©es** est `http://127.0.0.1:3000/`.
</Info>

<div id="configure-logout-urls">
  ### Configurer les URL de d√©connexion
</div>

Une URL de d√©connexion est une URL dans votre application vers laquelle Auth0 peut revenir apr√®s que l‚Äôutilisateur a √©t√© d√©connect√© du serveur d‚Äôautorisation. Elle est sp√©cifi√©e dans le param√®tre de requ√™te `returnTo`. L‚ÄôURL de d√©connexion de votre application doit √™tre ajout√©e au champ **URL de d√©connexion autoris√©es** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n‚Äôest pas d√©fini, les utilisateurs ne pourront pas se d√©connecter de l‚Äôapplication et recevront une erreur.

<Info>
  Si vous suivez le projet d‚Äôexemple que vous avez t√©l√©charg√© en haut de cette page, l‚ÄôURL de d√©connexion que vous devez ajouter au champ **URL de d√©connexion autoris√©es** est `http://127.0.0.1:3000`.
</Info>

<div id="integrate-your-php-application">
  ## Int√©grez votre application PHP
</div>

Cr√©ons une application PHP d&#39;exemple qui authentifie un utilisateur. Nous allons adopter ici une approche simple, adapt√©e √† ce format √©crit. Vous devriez tout de m√™me consulter l&#39;[application D√©marrage rapide associ√©e sur GitHub](https://github.com/auth0-samples/auth0-php-web-app/) pour un exemple plus robuste.

<div id="installing-http-client-and-messaging-factories">
  ### Installation des fabriques de client HTTP et de messagerie
</div>

La Trousse de d√©veloppement logiciel (SDK) Auth0 pour PHP prend en charge de nombreuses normes [PHP-FIG](https://www.php-fig.org) offrant des options d‚Äôinterop√©rabilit√© avec votre architecture. Deux sont particuli√®rement importantes‚ÄØ: [PSR-17](https://www.php-fig.org/psr/psr-17/) et [PSR-18](https://www.php-fig.org/psr/psr-18/). Ces normes vous permettent de brancher les composants r√©seau de votre choix pour g√©rer la messagerie et les requ√™tes. Vous devrez installer dans votre projet des biblioth√®ques compatibles pour que le SDK puisse les utiliser.

La biblioth√®que r√©seau la plus r√©pandue pour PHP est [Guzzle](https://docs.guzzlephp.org/), m√™me si de nombreuses autres options sont disponibles dans la communaut√© PHP. Utilisons Guzzle pour cette application d‚Äôexemple. Encore une fois, √† partir du r√©pertoire de votre projet, ex√©cutez la commande shell suivante‚ÄØ:

```bash lines
composer require guzzlehttp/guzzle guzzlehttp/psr7 http-interop/http-factory-guzzle
```

<div id="installing-the-php-sdk">
  ### Installation de la trousse de d√©veloppement logiciel (SDK) PHP
</div>

La trousse de d√©veloppement logiciel (SDK) PHP Auth0 n√©cessite [Composer](https://getcomposer.org/doc/00-intro.md#installation-linux-unix-macos), un gestionnaire de d√©pendances pour PHP. Composer vous permet de d√©clarer les biblioth√®ques dont votre projet a besoin et de les installer pour vous. Assurez-vous que Composer est install√© et accessible √† partir de votre shell avant de continuer.

Ex√©cutez la commande suivante dans le r√©pertoire de votre projet pour installer la trousse de d√©veloppement logiciel (SDK) PHP Auth0¬†:

```bash lines
composer require auth0/auth0-php
```

Cela cr√©era un dossier `vendor` dans votre projet et t√©l√©chargera toutes les d√©pendances n√©cessaires pour utiliser la trousse de d√©veloppement logiciel (SDK) Auth0 PHP. Cela cr√©era √©galement un fichier `vendor/autoload.php` utilis√© dans l‚Äôexemple pour charger toutes les classes n√©cessaires au bon fonctionnement de votre application. Il est important d‚Äôinclure ce fichier `autoload` dans votre projet pour que le SDK fonctionne correctement.

<div id="configuring-the-sdk">
  ### Configuration de la trousse de d√©veloppement logiciel (SDK)
</div>

Pour commencer, cr√©ons un fichier `.env` √† la racine du r√©pertoire de votre projet afin d‚Äôy stocker la configuration de notre application d‚Äôexemple et d‚Äôy renseigner les variables d‚Äôenvironnement :

export const codeExample = `# ID client de votre application Auth0
AUTH0_CLIENT_ID={yourClientId}

# URL du domaine de votre tenant Auth0
AUTH0_DOMAIN={yourDomain}

# Secret client de votre application Auth0
AUTH0_CLIENT_SECRET={yourClientSecret}

# Une longue valeur secr√®te utilis√©e pour chiffrer le cookie de session.
# Vous pouvez la g√©n√©rer avec \`openssl rand -hex 32\` depuis votre shell.
AUTH0_COOKIE_SECRET=

# Une URL depuis laquelle votre application est accessible. Mettez-la √† jour au besoin.
AUTH0_BASE_URL=http://127.0.0.1:3000`;

<AuthCodeBlock children={codeExample} language="env" />

Comme PHP ne peut pas lire notre fichier `.env` par lui-m√™me, nous devons installer une biblioth√®que pour nous aider. M√™me si nous utilisons une biblioth√®que particuli√®re pour les besoins de notre application d‚Äôexemple, dans une application r√©elle, n‚Äôimporte quel chargeur ¬´ dotenv ¬ª que vous pr√©f√©rez conviendra. √Ä partir du r√©pertoire de notre projet, ex√©cutez la commande suivante dans le shell pour installer la biblioth√®que :

```bash lines
composer require vlucas/phpdotenv
```

Ensuite, cr√©ons le fichier source PHP que nous utiliserons pour ces exemples de code, `index.php`, et configurons une instance de la trousse de d√©veloppement logiciel (SDK) PHP d&#39;Auth0 pour notre application d&#39;exemple¬†:

```php lines
<?php

// Importer le chargeur automatique Composer pour rendre les classes du SDK accessibles :
require 'vendor/autoload.php';

// Charger nos variables d'environnement √† partir du fichier .env :
(Dotenv\Dotenv::createImmutable(__DIR__))->load();

// Maintenant, instancier la classe Auth0 avec notre configuration :
$auth0 = new \Auth0\SDK\Auth0([
    'domain' => $_ENV['AUTH0_DOMAIN'],
    'clientId' => $_ENV['AUTH0_CLIENT_ID'],
    'clientSecret' => $_ENV['AUTH0_CLIENT_SECRET'],
    'cookieSecret' => $_ENV['AUTH0_COOKIE_SECRET']
]);
```

<div id="setting-up-your-application-routes">
  ### Configuration des routes de votre application
</div>

Les applications PHP modernes utilisent un mod√®le de routage pour transmettre les requ√™tes HTTP entrantes au code qui les traite, afin de d√©terminer ce qui doit se produire lorsque nos utilisateurs visitent une ¬´‚ÄØpage‚ÄØ¬ª particuli√®re de notre application. Il n‚Äôexiste pas une seule bonne fa√ßon d‚Äôimpl√©menter le routage dans votre application, et de nombreuses biblioth√®ques permettent de le faire. Nous utiliserons une biblioth√®que particuli√®re pour les besoins de notre application d‚Äôexemple, mais n‚Äôh√©sitez pas √† en choisir une autre dans une application r√©elle.

√Ä partir du r√©pertoire de notre projet, ex√©cutons la commande shell suivante pour installer la biblioth√®que de routage¬†:

```bash lines
composer require steampixel/simple-php-router
```

Ensuite, rouvrez votre fichier `index.php` et donnez vie √† votre application. Commencez par importer la biblioth√®que de routage et d√©finir les URL compl√®tes des routes de notre application d‚Äôexemple en tant que constantes nomm√©es, pour des raisons de commodit√©, puisque nous devrons nous y r√©f√©rer √† plusieurs endroits dans notre application d‚Äôexemple¬†:

```php lines
// üëÜ Nous poursuivons √† partir des √©tapes ci-dessus. Ajoutez ceci √† votre fichier index.php.

// Import our router library:
use Steampixel\Route;

// Define route constants:
define('ROUTE_URL_INDEX', rtrim($_ENV['AUTH0_BASE_URL'], '/'));
define('ROUTE_URL_LOGIN', ROUTE_URL_INDEX . '/login');
define('ROUTE_URL_CALLBACK', ROUTE_URL_INDEX . '/callback');
define('ROUTE_URL_LOGOUT', ROUTE_URL_INDEX . '/logout');
```

Nous pouvons maintenant passer √† l‚Äôajout de la logique de traitement des routes de notre application et aux int√©grations avec la trousse de d√©veloppement logiciel (SDK) :

<div id="checking-for-a-session">
  ## V√©rifier la pr√©sence d&#39;une session
</div>

La trousse de d√©veloppement logiciel (SDK) PHP Auth0 fournit une m√©thode pratique pour v√©rifier si notre utilisateur s‚Äôest authentifi√© et si son profil a √©t√© renvoy√©, `getCredentials()`. Ajoutons-la √† notre route d‚Äôindex pour afficher le profil de l‚Äôutilisateur s‚Äôil est connect√© ou indiquer qu‚Äôil doit se connecter.

```php lines
// üëÜ Nous poursuivons √† partir des √©tapes ci-dessus. Ajoutez ceci √† votre fichier index.php.

Route::add('/', function() use ($auth0) {
  $session = $auth0->getCredentials();

  if ($session === null) {
    // The user isn't logged in.
    echo '<p>Please <a href="/docs/login">log in</a>.</p>';
    return;
  }

  // The user is logged in.
  echo '<pre>';
  print_r($session->user);
  echo '</pre>';

  echo '<p>You can now <a href="/docs/logout">log out</a>.</p>';
});
```

Nous pouvons acc√©der √† toutes les propri√©t√©s du profil de notre utilisateur √† partir de la r√©ponse de la propri√©t√© `user`, qui est un tableau. Par exemple, nous pouvons r√©cup√©rer le surnom de l&#39;utilisateur en utilisant `$session->user<a href="https://auth0.com/docs/users/user-profile-structure" target="_blank" rel="noreferrer">nickname`, ou son adresse de courriel √† partir de `$session->useremail`. La structure est un profil d&#39;utilisateur normalis√©, sur lequel vous pouvez en apprendre davantage [ici](https://auth0.com/docs/users/normalized-user-profiles).

Il est important de noter que le contenu du profil de l&#39;utilisateur variera selon le ou les fournisseurs de r√©seaux sociaux que vous utilisez. Vous ne devez donc jamais supposer qu&#39;une valeur particuli√®re sera toujours pr√©sente dans la logique de votre application. Utilisez des constructions du langage PHP comme `isset` ou l&#39;op√©rateur de coalescence nulle pour g√©rer correctement la pr√©sence, ou l&#39;absence, d&#39;une valeur, par exemple¬†:

```php lines
// ‚úã Nous n'avons pas besoin d'inclure ceci dans notre exemple d'application, c'est seulement un exemple.
$name = $session->user['name'] ?? $session->user['nickname'] ?? $session->user['email'] ?? 'Unknown';
```

<div id="logging-in">
  ## Connexion
</div>

Cr√©ons maintenant notre route /login, qui utilisera la Trousse de d√©veloppement logiciel (SDK) PHP Auth0 et sa m√©thode `login()` pour √©tablir la session de l‚Äôutilisateur et retourner une URL personnalis√©e vers la page Universal Login d‚ÄôAuth0 afin de connecter cet utilisateur.

```php lines
// üëÜ Nous poursuivons √† partir des √©tapes ci-dessus. Ajoutez ceci √† votre fichier index.php.

Route::add('/login', function() use ($auth0) {
    // Il est recommand√© de r√©initialiser les sessions utilisateur √† chaque connexion pour √©viter les erreurs ¬´ invalid state ¬ª en cas de probl√®mes r√©seau ou d'autres probl√®mes qui interrompent un processus de connexion pr√©c√©dent :
    $auth0->clear();

    // Enfin, configurez la session de l'application locale et redirigez l'utilisateur vers la page Universal Login d'Auth0 pour l'authentification.
    header("Location: " . $auth0->login(ROUTE_URL_CALLBACK));
    exit;
});
```

<div id="handling-authentication-callback">
  ## Gestion du rappel d‚Äôauthentification
</div>

Une fois que nos utilisateurs reviennent apr√®s s‚Äô√™tre authentifi√©s avec la page Universal Login d‚ÄôAuth0, ils sont redirig√©s vers notre application d‚Äôexemple √† la route de rappel `/callback`, que nous allons g√©rer √† cette √©tape.

Quand Auth0 nous renvoie nos utilisateurs, la plateforme inclut quelques param√®tres essentiels dans la cha√Æne de requ√™te (query) de la requ√™te HTTP. La m√©thode `exchange()` de la Trousse de d√©veloppement logiciel (SDK) PHP Auth0 prend ces param√®tres en charge, ce qui simplifie la finalisation de notre flux d‚Äôauthentification‚ÄØ:

```php lines
// üëÜ We're continuing from the steps above. Append this to your index.php file.

Route::add('/callback', function() use ($auth0) {
    // Have the SDK complete the authentication flow:
    $auth0->exchange(ROUTE_URL_CALLBACK);

    // Enfin, redirigez l'utilisateur final vers la route / index pour afficher son profil d'utilisateur :
    header("Location: " . ROUTE_URL_INDEX);
    exit;
});
```

<div id="logging-out">
  ## D√©connexion
</div>

Enfin, traitons correctement la d√©connexion de nos utilisateurs. La m√©thode `logout()` de la Trousse de d√©veloppement logiciel (SDK) Auth0 pour PHP se charge de supprimer les t√©moins de session de notre application d‚Äôexemple, de rediriger l‚Äôutilisateur vers le [/logout endpoint](https://auth0.com/docs/logout) d‚ÄôAuth0 (qui ferme la couche de session Auth0 ainsi que toutes les couches de session des fournisseurs d‚Äôidentit√©), puis de renvoyer l‚Äôutilisateur vers notre route d‚Äôindex `/`.

```php lines
// üëÜ We're continuing from the steps above. Append this to your index.php file.

Route::add('/logout', function() use ($auth0) {
    // Effacez la session locale de l'utilisateur avec notre application, puis redirigez-le vers le point de terminaison de d√©connexion Auth0 pour effacer sa session Auth0.
    header("Location: " . $auth0->logout(ROUTE_URL_INDEX));
    exit;
});
```

<div id="run-your-app">
  ## Lancez votre application¬†!
</div>

Enfin, nous devons indiquer √† notre middleware de routage qu‚Äôil doit effectivement acheminer les requ√™tes¬†:

```php lines
// üëÜ Nous poursuivons √† partir des √©tapes ci-dessus. Ajoutez ceci √† votre fichier index.php.

// Ceci indique √† notre routeur que nous avons termin√© de configurer nos routes et que nous sommes pr√™ts √† commencer le routage des requ√™tes HTTP entrantes :
Route::run('/');
```

Voil√†‚ÄØ! Vous √™tes pr√™t √† ex√©cuter votre nouvelle application‚ÄØ; encore une fois, depuis le r√©pertoire de votre projet, ex√©cutez la commande shell suivante¬†:

```bash lines
php -S 127.0.0.1:3000 index.php
```

Ouvrez votre navigateur √† [http://127.0.0.1:3000](https://127.0.0.1:3000) et faites un essai.

<Note>
  ##### Que pouvez-vous faire ensuite?

  <table>
    <tr>
      <td><a href="/docs/fr-CA/authenticate/identity-providers">Configurer d&#39;autres fournisseurs d&#39;identit√©</a></td>
      <td><a href="/docs/fr-CA/secure/multi-factor-authentication">Activer l&#39;authentification multifactorielle</a></td>
    </tr>

    <tr>
      <td><a href="/docs/fr-CA/secure/attack-protection">En savoir plus sur la protection contre les attaques</a></td>
      <td><a href="/docs/fr-CA/customize/rules">En savoir plus sur Rules</a></td>
    </tr>
  </table>

  [Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/native/flutter/01-login.md)
</Note>
