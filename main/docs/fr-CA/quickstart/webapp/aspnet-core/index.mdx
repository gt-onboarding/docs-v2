---
title: "ASP.NET Core MVC"
permalink: "01-login"
---

<div id="by-frederik-prijck">
  ##### Par Frederik Prijck
</div>

Ce tutoriel montre comment ajouter une fonctionnalité de connexion utilisateur à une application ASP.NET Core. Nous vous recommandons de vous connecter pour suivre ce Démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Afficher sur GitHub" href="https://github.com/auth0-samples/auth0-aspnetcore-mvc-samples/tree/master/Quickstart/Sample" icon="github">
  Configuration système requise : .NET 6.0 | .NET 7.0 | .NET 8.0
  </Card> */}

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenir les clés de votre application
</div>

Lorsque vous vous êtes inscrit à Auth0, une nouvelle Application a été créée pour vous, ou vous en avez peut‑être créé une vous‑même. Vous aurez besoin de certains renseignements à propos de cette Application pour communiquer avec Auth0. Vous pouvez obtenir ces renseignements dans la section [Application Settings](https://manage.auth0.com/#/applications) du Auth0 Dashboard.

<Frame>![App Dashboard](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

Vous avez besoin des renseignements suivants :

* **Domaine**
* **ID client**

<Info>
  Si vous téléchargez l&#39;exemple fourni en haut de cette page, ces valeurs sont déjà renseignées pour vous.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de rappel (Callback)
</div>

L’URL de rappel (Callback URL) de votre application est l’URL vers laquelle Auth0 vous redirigera une fois l’utilisateur authentifié afin que la trousse de développement logiciel (SDK) puisse terminer le processus d’authentification.

Vous devrez ajouter cette URL à la liste des URL autorisées pour votre application dans vos [Application Settings](https://manage.auth0.com/#/applications), cette URL prendra généralement la forme `https://YOUR_APPLICATION_URL/callback`.

<div id="configure-logout-urls">
  ### Configurer les URL de déconnexion
</div>

Une URL de déconnexion est une URL dans votre application vers laquelle Auth0 peut renvoyer l’utilisateur après qu’il a été déconnecté du serveur d’autorisation. Celle-ci est spécifiée dans le paramètre de requête `returnTo`. L’URL de déconnexion de votre application doit être ajoutée au champ **URL de déconnexion autorisées** dans vos [paramètres d’Application](https://manage.auth0.com/#/applications). Si ce champ n’est pas configuré, les utilisateurs ne pourront pas se déconnecter de l’application et recevront une erreur.

<Info>
  Si vous suivez le projet d’exemple que vous avez téléchargé en haut de cette page, l’URL de déconnexion que vous devez ajouter au champ **URL de déconnexion autorisées** est `http://localhost:3000`.
</Info>

<div id="integrate-auth0">
  ## Intégrer Auth0
</div>

[Universal Login](/docs/fr-CA/authenticate/login/auth0-universal-login) est la façon la plus simple de mettre en place l’authentification dans votre application. Nous vous recommandons de l’utiliser pour offrir la meilleure expérience, la meilleure sécurité et la gamme de fonctionnalités la plus complète. Ce guide l’utilisera pour permettre à vos utilisateurs de se connecter à votre application ASP.NET Core.

<div id="install-dependencies">
  ### Installer les dépendances
</div>

Pour intégrer Auth0 à ASP.NET Core, vous pouvez utiliser notre Trousse de développement logiciel (SDK) en installant le package NuGet `Auth0.AspNetCore.Authentication` dans votre application.

```bash lines
Install-Package Auth0.AspNetCore.Authentication
```

<div id="install-and-configure-the-sdk">
  ### Installer et configurer la trousse de développement logiciel (SDK)
</div>

Pour activer l’authentification dans votre application ASP.NET Core, utilisez le middleware fourni par la trousse de développement logiciel (SDK). Ouvrez le fichier `Program.cs` et appelez `builder.Services.AddAuth0WebAppAuthentication()` pour configurer le SDK ASP.NET Core d’Auth0.

Veillez à configurer `Domain` et `ClientId`; ces champs sont obligatoires pour que le SDK sache quel tenant Auth0 et quelle Application utiliser.

```cs lines
var builder = WebApplication.CreateBuilder(args);
// Configuration des témoins pour HTTP afin de prendre en charge les témoins avec SameSite=None
builder.Services.ConfigureSameSiteNoneCookies();

// Configuration des témoins pour HTTPS
//  builder.Services.Configure<CookiePolicyOptions>(options =>
//  {
//     options.MinimumSameSitePolicy = SameSiteMode.None;
//  });
builder.Services.AddAuth0WebAppAuthentication(options =>
{
    options.Domain = builder.Configuration["Auth0:Domain"];
    options.ClientId = builder.Configuration["Auth0:ClientId"];
});
builder.Services.AddControllersWithViews();
var app = builder.Build();
```

<Info>
  La méthode `ConfigureSameSiteNoneCookies` utilisée ci-dessus a été ajoutée dans le cadre de [l&#39;application d&#39;exemple](https://github.com/auth0-samples/auth0-aspnetcore-mvc-samples/blob/master/Quickstart/Sample/Support/SameSiteServiceCollectionExtensions.cs) afin de ([faire en sorte que les témoins avec SameSite=None fonctionnent sur HTTP lors de l&#39;utilisation de Chrome](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html)). Nous recommandons d&#39;utiliser HTTPS plutôt que HTTP, ce qui élimine le besoin de la méthode `ConfigureSameSiteNoneCookies`.
</Info>

Assurez-vous d&#39;avoir activé l&#39;authentification et l&#39;autorisation dans votre fichier Program.cs :

```cs lines
app.UseAuthentication();
app.UseAuthorization();
```

<div id="login">
  ## Connexion
</div>

Pour ajouter l’étape de `Login`, appelez `ChallengeAsync` et passez &quot;Auth0&quot; (`Auth0Constants.AuthenticationScheme`) comme schéma d’authentification. Cela invoquera le gestionnaire d’authentification OIDC que notre Trousse de développement logiciel (SDK) enregistre en interne.

Après que le middleware OIDC a authentifié l’utilisateur, celui-ci est aussi automatiquement authentifié par le middleware de témoins (cookies). Cela permet à l’utilisateur d’être authentifié lors des requêtes suivantes.

```cs lines
using Microsoft.AspNetCore.Authentication;
using Microsoft.AspNetCore.Authentication.Cookies;
using Auth0.AspNetCore.Authentication;

public class AccountController : Controller
{
    public async Task Login(string returnUrl = "/")
    {
        var authenticationProperties = new LoginAuthenticationPropertiesBuilder()
            // Indiquez ici où Auth0 doit rediriger l'utilisateur après une connexion.
            // Notez que l'URI absolu résultant doit être ajouté aux paramètres
            // **URL de redirection autorisées** de l'application.
            .WithRedirectUri(returnUrl)
            .Build();

        await HttpContext.ChallengeAsync(Auth0Constants.AuthenticationScheme, authenticationProperties);
    }
}
```

<div id="display-user-profile">
  ## Afficher le profil de l&#39;utilisateur
</div>

La Trousse de développement logiciel (SDK) extrait les informations de l&#39;utilisateur à partir du jeton ID et les rend disponibles via la propriété `User.Claims` du contrôleur.

Vous pouvez créer une page de profil utilisateur personnalisée pour afficher le nom, l&#39;adresse de courriel et l&#39;image de profil d&#39;un utilisateur, en transmettant les informations correspondantes à la vue à partir de votre contrôleur.

```cs lines
public class AccountController : Controller
{
    [Authorize]
    public IActionResult Profile()
    {
        return View(new
        {
            Name = User.Identity.Name,
            EmailAddress = User.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Email)?.Value,
            ProfileImage = User.Claims.FirstOrDefault(c => c.Type == "picture")?.Value
        });
    }
}
```

<div id="logout">
  ## Déconnexion
</div>

Pour ajouter `Logout`, vous devez fermer la session de l’utilisateur à la fois dans le middleware Auth0 et dans le middleware de cookies.

```cs lines
using Microsoft.AspNetCore.Authentication;
using Microsoft.AspNetCore.Authentication.Cookies;
using Auth0.AspNetCore.Authentication;

public class AccountController : Controller
{
    [Authorize]
    public async Task Logout()
    {
        var authenticationProperties = new LogoutAuthenticationPropertiesBuilder()
            // Indiquez ici où Auth0 oit rediriger l'utilisateur après une déconnexion.
            // Notez que l'URI absolu résultant doit être ajouté aux
            // paramètres **URL de déconnexion autorisées** de l'application.
            .WithRedirectUri(Url.Action("Index", "Home"))
            .Build();

        await HttpContext.SignOutAsync(Auth0Constants.AuthenticationScheme, authenticationProperties);
        await HttpContext.SignOutAsync(CookieAuthenticationDefaults.AuthenticationScheme);
    }
}
```

<div id="whats-next">
  ## Et ensuite ?
</div>

Nous avons rassemblé quelques exemples illustrant l’utilisation du SDK dans des cas d’usage plus avancés :

* [Configuration des scopes](https://github.com/auth0/auth0-aspnetcore-authentication/blob/main/EXAMPLES.md#scopes)
* [Obtenir un jeton d’accès pour appeler une API](https://github.com/auth0/auth0-aspnetcore-authentication/blob/main/EXAMPLES.md#calling-an-api)
* [Ajout d’une autorisation basée sur les rôles](https://github.com/auth0/auth0-aspnetcore-authentication/blob/main/EXAMPLES.md#roles)

[Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/webapp/aspnet-core/01-login.md)