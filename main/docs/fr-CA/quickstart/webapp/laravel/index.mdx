---
title: "Laravel"
permalink: "01-login"
---

<div id="by-evan-sims">
  ##### Par Evan Sims
</div>

La trousse de développement logiciel (SDK) Laravel d&#39;Auth0 vous permet d&#39;ajouter rapidement l&#39;authentification, la gestion des profils d&#39;utilisateurs et le contrôle d&#39;accès des routes à votre application Laravel. Ce guide explique comment intégrer Auth0 à une nouvelle application Laravel 9 ou 10 ou à une application existante. Nous vous recommandons d&#39;ouvrir une session pour suivre ce démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Voir sur GitHub" icon="github" href="https://github.com/auth0-samples/laravel/tree/7.x/sample">
  Configuration système requise : Laravel 9 / 10 | PHP 8.0+ | Composer
  </Card> */}


<div id="laravel-installation">
  ## Installation de Laravel
</div>

**Si vous n’avez pas encore configuré d’application Laravel**, ouvrez un terminal et placez-vous dans un répertoire approprié pour un nouveau projet, puis exécutez la commande suivante :

```bash lines
composer create-project --prefer-dist laravel/laravel auth0-laravel-app ^9.0
```

Toutes les commandes de ce guide partent du principe que vous les exécutez à partir de la racine de votre projet Laravel. Vous devez donc vous placer dans le nouveau répertoire du projet avec la commande `cd` :

```bash lines
cd auth0-laravel-app
```


<div id="sdk-installation">
  ## Installation de la trousse de développement logiciel (SDK)
</div>

Exécutez la commande suivante dans le répertoire de votre projet pour installer le [SDK Auth0 pour Laravel](https://github.com/auth0/laravel-auth0) :

```bash lines
composer require auth0/login:^7.8 --update-with-all-dependencies
```

Générez ensuite un fichier de configuration du SDK pour votre application :

```bash lines
php artisan vendor:publish --tag auth0
```


<div id="sdk-configuration">
  ## Configuration du SDK
</div>

Exécutez la commande suivante dans le répertoire de votre projet pour télécharger la [CLI Auth0](https://github.com/auth0/auth0-cli) :

```bash lines
curl -sSfL https://raw.githubusercontent.com/auth0/auth0-cli/main/install.sh | sh -s -- -b .
```

Authentifiez ensuite l&#39;outil CLI avec votre compte Auth0, en choisissant &quot;en tant qu&#39;utilisateur&quot; lorsqu&#39;on vous le demande :

```bash lines
./auth0 login
```

Ensuite, créez une nouvelle Application dans Auth0 :

```bash lines
./auth0 apps create \
  --name "My Laravel Application" \
  --type "regular" \
  --auth-method "post" \
  --callbacks "http://localhost:8000/callback" \
  --logout-urls "http://localhost:8000" \
  --reveal-secrets \
  --no-input \
  --json > .auth0.app.json
```

Vous devez également créer une nouvelle API :

```bash lines
./auth0 apis create \
  --name "API de mon application Laravel" \
  --identifier "https://github.com/auth0/laravel-auth0" \
  --offline-access \
  --no-input \
  --json > .auth0.api.json
```

Cela génère deux fichiers dans le répertoire de votre projet qui configurent la trousse de développement logiciel (SDK).

Comme ces fichiers contiennent des identifiants, il est important de les traiter comme des informations sensibles. Assurez-vous de ne pas les consigner dans votre système de gestion de versions. Si vous utilisez Git, vous devez les ajouter à votre fichier `.gitignore` :

```bash lines
echo ".auth0.*.json" >> .gitignore
```


<div id="login-routes">
  ## Routes de connexion
</div>

La Trousse de développement logiciel (SDK) enregistre automatiquement toutes les routes nécessaires à l’authentification des utilisateurs de votre application.

<table class="table"><thead>
<tr>
<th>Route</th>
<th>But</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/login</code></td>
<td>Initie le flux d’authentification.</td>
</tr>
<tr>
<td><code>/logout</code></td>
<td>Déconnecte l’utilisateur.</td>
</tr>
<tr>
<td><code>/callback</code></td>
<td>Gère le rappel (callback) provenant d’Auth0.</td>
</tr>
</tbody>
</table>

Si vous avez besoin de davantage de contrôle sur ces routes, ou si elles entrent en conflit avec des routes existantes dans votre application, vous pouvez plutôt enregistrer manuellement les contrôleurs du SDK. Consultez [le fichier README du SDK](https://github.com/auth0/laravel-auth0) pour des intégrations avancées.

<div id="access-control">
  ## Contrôle d&#39;accès
</div>

Les mécanismes d&#39;authentification de Laravel utilisent des « guards » pour définir comment les utilisateurs sont authentifiés pour chaque requête. Vous pouvez utiliser le guard d&#39;authentification fourni par la Trousse de développement logiciel (SDK) Auth0 pour restreindre l&#39;accès aux routes de votre application.

Pour exiger que les utilisateurs s&#39;authentifient avant d&#39;accéder à une route, vous pouvez utiliser le middleware `auth` de Laravel :

```php lines
Route::get('/private', function () {
  return response('Welcome! You are logged in.');
})->middleware('auth');
```

Vous pouvez aussi exiger que les utilisateurs authentifiés disposent d&#39;[autorisations](https://auth0.com/docs/manage-users/access-control/rbac) spécifiques en le combinant au middleware `can` de Laravel :

```php lines
Route::get('/scope', function () {
    return response('You have the `read:messages` permissions, and can therefore access this resource.');
})->middleware('auth')->can('read:messages');
```


<div id="user-information">
  ## Renseignements sur l&#39;utilisateur
</div>

Les renseignements sur l&#39;utilisateur authentifié sont accessibles au moyen de la façade `Auth` de Laravel ou de la fonction utilitaire `auth()`.

Par exemple, pour récupérer l&#39;identifiant et l&#39;adresse de courriel de l&#39;utilisateur :

```php lines
Route::get('/', function () {
  if (! auth()->check()) {
    return response('You are not logged in.');
  }

  $user = auth()->user();
  $name = $user->name ?? 'User';
  $email = $user->email ?? '';

  return response("Hello {$name}! Your email address is {$email}.");
});
```


<div id="user-management">
  ## Gestion des utilisateurs
</div>

Vous pouvez mettre à jour les informations d’un utilisateur à l’aide de la [Management API d’Auth0](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md). Tous les endpoints de la Management API sont accessibles via la méthode `management()` du SDK.

**Avant d’effectuer des appels à la Management API, vous devez permettre à votre application de communiquer avec la Management API.** Pour ce faire, accédez à la [page API de l’Auth0 Dashboard](https://manage.auth0.com/#/apis/), choisissez `Auth0 Management API`, puis sélectionnez l’onglet « Machine to Machine Applications ». Autorisez votre application Laravel, puis cliquez sur la flèche pour choisir les scopes que vous souhaitez accorder.

Pour l’exemple suivant, dans lequel nous allons mettre à jour les métadonnées d’un utilisateur et lui attribuer une couleur préférée aléatoire, vous devez accorder les scopes `read:users` et `update:users`. Vous trouverez une liste des endpoints de l’API et des scopes requis dans [la documentation de la Management API](https://auth0.com/docs/api/management/v2).

```php lines
use Auth0\Laravel\Facade\Auth0;

Route::get('/colors', function () {
  $endpoint = Auth0::management()->users();

  $colors = ['red', 'blue', 'green', 'black', 'white', 'yellow', 'purple', 'orange', 'pink', 'brown'];

  $endpoint->update(
    id: auth()->id(),
    body: [
        'user_metadata' => [
            'color' => $colors[random_int(0, count($colors) - 1)]
        ]
    ]
  );

  $metadata = $endpoint->get(auth()->id());
  $metadata = Auth0::json($metadata);

  $color = $metadata['user_metadata']['color'] ?? 'unknown';
  $name = auth()->user()->name;

  return response("Bonjour {$name}! Votre couleur préférée est {$color}.");
})->middleware('auth');
```

Un guide de référence rapide de toutes les méthodes de la Management API du SDK se trouve [ici](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md).


<div id="run-the-application">
  ## Exécuter l’application
</div>

Vous pouvez maintenant démarrer votre application Laravel afin qu’elle puisse accepter des requêtes :

```bash lines
php artisan serve
```


<div id="checkpoint">
  ### Point de contrôle
</div>

Ouvrez votre navigateur Web et essayez d'accéder aux routes suivantes :

* `http://localhost:8000` pour voir la route publique.
* `http://localhost:8000/private` pour être invité à vous authentifier.
* `http://localhost:8000` pour voir la route publique, maintenant authentifié.
* `http://localhost:8000/scope` pour vérifier si vous avez la [permission](https://auth0.com/docs/manage-users/access-control/rbac) `read:messages`.
* `http://localhost:8000/update` pour mettre à jour le profil de l'utilisateur.
* `http://localhost:8000/logout` pour vous déconnecter.

Si vous rencontrez des problèmes, voici quelques éléments à essayer :

* Essayez d'exécuter `php artisan optimize:clear` pour vider le cache de Laravel.
* Assurez-vous que vos fichiers `.auth0.app.json` et `.auth0.api.json` se trouvent à la racine de votre projet.
* Assurez-vous d’avoir activé votre application Laravel comme application machine-à-machine et que vous lui avez accordé toutes les scopes nécessaires pour le `Auth0 Management API` à partir de l’[Auth0 Dashboard](https://manage.auth0.com/#/apis/).

Vous rencontrez des problèmes? Consultez la [documentation](https://github.com/auth0/laravel-auth0) de la trousse de développement logiciel (SDK) ou notre [centre de documentation](https://auth0.com/docs). Vous pouvez aussi visiter [la communauté](https://community.auth0.com), où notre équipe et d'autres membres de la communauté peuvent vous aider à répondre à vos questions.

<div id="additional-reading">
  ### Lectures supplémentaires
</div>

* [User Repositories and Models](https://github.com/auth0/laravel-auth0/blob/main/docs/Users.md) décrit comment étendre la trousse de développement logiciel (SDK) Laravel Auth0 pour utiliser des modèles d’utilisateur personnalisés, ainsi que la façon de stocker et de récupérer des utilisateurs à partir d’une base de données.
* [Hooking Events](https://github.com/auth0/laravel-auth0/blob/main/docs/Events.md) explique comment écouter les événements générés par la trousse de développement logiciel (SDK) Laravel Auth0 afin de personnaliser entièrement le comportement de votre intégration.
* [Management API](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md) la prise en charge de la Management API est intégrée à la trousse de développement logiciel (SDK) Laravel Auth0, ce qui vous permet d’interagir avec la Management API à partir de votre application Laravel.

[Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/webapp/laravel/01-login.md)