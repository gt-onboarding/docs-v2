---
title: Ajouter une connexion à votre application Web Java EE

sidebarTitle: Java EE
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/fr-CA/recipe.jsx";
import { LoggedInForm } from "/snippets/fr-CA/Login.jsx";
import Web from "/snippets/fr-CA/quickstart/webapp/java-ee/web.xml.mdx";
import Auth0authenticationconfig from "/snippets/fr-CA/quickstart/webapp/java-ee/Auth0AuthenticationConfig.java.mdx";
import Loginservlet from "/snippets/fr-CA/quickstart/webapp/java-ee/LoginServlet.java.mdx";
import Homeservlet from "/snippets/fr-CA/quickstart/webapp/java-ee/HomeServlet.java.mdx";
import Logoutservlet from "/snippets/fr-CA/quickstart/webapp/java-ee/LogoutServlet.java.mdx";

import {AuthCodeGroup} from "/snippets/fr-CA/AuthCodeGroup.jsx";

export const sections = [
  { id: "system-requirements", title: "Configuration système requise" },
  { id: "configure-auth0", title: "Configurer Auth0" },
  { id: "configure-java-ee-to-use-auth0", title: "Configurer Java EE pour utiliser Auth0" },
  { id: "configure-java-ee-security", title: "Configurer la sécurité Java EE" },
  { id: "trigger-authentication", title: "Déclencher l’authentification" },
  { id: "display-user-information", title: "Afficher les informations sur l’utilisateur" },
  { id: "handle-logout", title: "Gérer la déconnexion" },
  { id: "run-the-sample", title: "Exécuter l’exemple" }
]


<Recipe isSingleColumn>
  <Content>
    Ce tutoriel montre comment ajouter la connexion utilisateur à une application web Java EE. Nous vous recommandons de vous connecter pour
    suivre ce Démarrage rapide avec des exemples configurés pour votre compte.

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Ce tutoriel et ce projet d&#39;exemple ont été testés avec les éléments suivants :

      * Java 11

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      ### Obtenez les clés de votre Application

      Lorsque vous vous êtes inscrit à Auth0, une nouvelle Application a été créée pour vous, ou vous avez pu en créer une nouvelle. Vous
      aurez besoin de certaines informations concernant cette Application pour communiquer avec Auth0. Vous pouvez obtenir ces informations dans la section [Application
      Settings](https://manage.auth0.com/#/applications) de l’Auth0 Dashboard.

      <Frame>
        <img src="/docs/images/cdy7uua7fh8z/1NtemqhRTHLFgWkGyAVSC6/ae66506a56ffab891e8a36e1344e6376/uwp.png" />
      </Frame>

      Vous avez besoin des informations suivantes :

      * **Domaine**
      * **Client ID**
      * **Secret client**

      <Info>
        Si vous téléchargez l’exemple à partir du haut de cette page, ces informations sont déjà renseignées pour vous.
      </Info>

      ### Configurer les URL de rappel

      Une URL de rappel est une URL dans votre application vers laquelle Auth0 redirige l’utilisateur après son authentification. L’URL
      de rappel de votre application doit être ajoutée au champ **URL de redirection autorisées** dans vos [Application
      Settings](https://manage.auth0.com/#/applications). Si ce champ n’est pas défini, les utilisateurs ne pourront pas se connecter à l’application et recevront une erreur.

      <Info>
        Si vous suivez le projet d’exemple que vous avez téléchargé en haut de cette page, l’URL
        de rappel que vous devez ajouter au champ **URL de redirection autorisées** est
        `http://localhost:3000/callback`.
      </Info>

      ### Configurer les URL de déconnexion

      Une URL de déconnexion est une URL dans votre application vers laquelle Auth0 peut revenir après que l’utilisateur a été déconnecté du
      Serveur d’autorisation. Celle-ci est indiquée dans le paramètre de requête `returnTo`. L’URL de déconnexion de votre application
      doit être ajoutée au champ **URL de déconnexion autorisées** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n’est pas défini, les utilisateurs ne pourront pas se déconnecter de l’application et recevront une erreur.

      <Info>
        Si vous suivez le projet d’exemple que vous avez téléchargé en haut de cette page, l’URL de déconnexion
        que vous devez ajouter au champ **URL de déconnexion autorisées** est `http://localhost:3000/`.
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      ### Configurer les dépendances

      Pour intégrer votre application Java EE à Auth0, ajoutez les dépendances suivantes :

      * **javax.javaee-api** : l’API Java EE 8 nécessaire pour écrire des applications qui utilisent Java EE 8. L’implémentation
        proprement dite est fournie par le conteneur d’applications, il n’est donc pas nécessaire de l’inclure dans le fichier WAR.
      * **javax.security.enterprise** : l’API de sécurité Java EE 8 qui permet de gérer les aspects de sécurité dans une
        application EE. Comme pour la dépendance `javax.javaee-api`, l’implémentation est fournie par le
        conteneur d’applications, elle n’est donc pas incluse dans le fichier WAR.
      * **auth0-java-mvc-commons** : la [trousse de développement logiciel (SDK) Auth0 Java MVC](https://github.com/auth0/auth0-java-mvc-common) vous permet d’utiliser Auth0 avec Java pour des applications Web MVC côté serveur.
        Elle génère l’URL Authorize que votre application doit appeler pour authentifier un
        utilisateur avec Auth0.

      Si vous utilisez Maven, ajoutez ces dépendances à votre `pom.xml` :

      ```xml lines
      <!-- pom.xml -->
      <dependency>
      <groupId>com.auth0</groupId>
      <artifactId>mvc-auth-commons</artifactId>
      <version>[1.0, 2.0)</version>
      </dependency>
      <dependency>
      <groupId>javax</groupId>
      <artifactId>javaee-api</artifactId>
      <version>8.0.1</version>
      <scope>provided</scope>
      </dependency>
      <dependency>
      <groupId>javax.security.enterprise</groupId>
      <artifactId>javax.security.enterprise-api</artifactId>
      <version>1.0</version>
      <scope>provided</scope>
      </dependency>
      ```

      Si vous utilisez Gradle, ajoutez-les à votre fichier `build.gradle` :

      ```java lines
      // build.gradle
      providedCompile 'javax:javaee-api:8.0.1'
      providedCompile 'javax.security.enterprise:javax.security.enterprise-api:1.0'
      implementation 'com.auth0:mvc-auth-commons:1. '
      ```

      ### Configurer votre application Java EE

      <Info>
        L’exemple qui accompagne ce tutoriel est écrit à l’aide de JSP et a été testé avec le serveur d’applications [WildFly](https://wildfly.org/).
        Vous pourriez devoir ajuster certaines étapes si vous utilisez un autre conteneur d’applications ou
        d’autres technologies.
      </Info>

      Votre application Java EE a besoin de certaines informations pour authentifier des utilisateurs auprès de votre application Auth0. Le
      descripteur de déploiement `web.xml` peut être utilisé pour stocker ces informations, mais vous pouvez aussi les stocker
      dans un autre emplacement sécurisé.

      Ces informations seront utilisées pour configurer la bibliothèque **auth0-java-mvc-commons** afin de permettre aux utilisateurs de se connecter à
      votre application. Pour en savoir plus sur la bibliothèque, y compris ses différentes options de configuration, consultez le [README](https://github.com/auth0/auth0-java-mvc-common/blob/master/README.md) de la bibliothèque.

      <AuthCodeGroup>
        <Web />

        <Auth0authenticationconfig />

        <Loginservlet />

        <Homeservlet />

        <Logoutservlet />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      L&#39;API de sécurité Java EE 8 a introduit l&#39;interface `HttpAuthenticationMechanism` pour permettre
      aux applications d&#39;obtenir les informations d&#39;identification d&#39;un utilisateur. Des implémentations par défaut existent pour l&#39;authentification de base et par formulaire,
      et elle fournit un moyen simple de configurer une stratégie d&#39;authentification personnalisée.

      Pour vous authentifier avec Auth0, fournissez des implémentations personnalisées des interfaces suivantes :

      * HttpAuthenticationMechanism : responsable du processus d’authentification pour les utilisateurs de retour depuis
        Auth0. ([JavaDoc](https://javaee.github.io/javaee-spec/javadocs/javax/security/enterprise/authentication/mechanism/http/HttpAuthenticationMechanism.html)).
      * IdentityStore : Chargé de valider les identifiants de l&#39;utilisateur ([JavaDoc](https://javaee.github.io/javaee-spec/javadocs/javax/security/enterprise/identitystore/IdentityStore.html)).
      * CallerPrincipal : Représente le principal appelant de la requête HTTP en cours ([JavaDoc](https://javaee.github.io/javaee-spec/javadocs/javax/security/enterprise/CallerPrincipal.html)).
      * Credential : Représente les informations d’identification que l’appelant utilisera pour s’authentifier ([JavaDoc](https://javaee.github.io/javaee-spec/javadocs/javax/security/enterprise/credential/Credential.html)).

      Tout d&#39;abord, rendez vos paramètres Auth0 disponibles pour l&#39;Application en créant un bean @ApplicationScoped pour récupérer
      les valeurs du contexte web et les rendre disponibles via des accesseurs.

      Ensuite, créez un `CallerPrincipal` personnalisé qui représente l&#39;appelant de la demande en cours :

      ```java lines
      // src/main/java/com/auth0/example/security/Auth0JwtPrincipal.java
      public class Auth0JwtPrincipal extends CallerPrincipal {
      private final DecodedJWT idToken;



      Auth0JwtPrincipal(DecodedJWT idToken) {

          super(idToken.getClaim(&quot;name&quot;).asString());

          this.idToken = idToken;

      }



      public DecodedJWT getIdToken() {

          return this.idToken;

      }

      }
      ```

      Vous pouvez maintenant implémenter un `Credential` personnalisé qui sera utilisé pour représenter les informations d&#39;identification de l&#39;utilisateur. Il contiendra des informations sur le principal :

      ```java lines
      // src/main/java/com/auth0/example/security/Auth0JwtCredential.java
      class Auth0JwtCredential implements Credential {
      private Auth0JwtPrincipal auth0JwtPrincipal;



      Auth0JwtCredential(String token) {

          DecodedJWT decodedJWT = JWT.decode(token);

          this.auth0JwtPrincipal = new Auth0JwtPrincipal(decodedJWT);

      }



      Auth0JwtPrincipal getAuth0JwtPrincipal() {

          return auth0JwtPrincipal;

      }

      }
      ```

      Vous avez maintenant défini les classes qui représentent un principal appelant et des informations d&#39;identification. Ensuite, créez une
      implémentation personnalisée de `IdentityStore`. Cette classe sera responsable de la validation des
      informations d&#39;identification de l&#39;utilisateur :

      ```java lines
      // src/main/java/com/auth0/example/security/Auth0JwtIdentityStore.java
      @ApplicationScoped
      public class Auth0JwtIdentityStore implements IdentityStore {
      @Override

      public CredentialValidationResult validate(final Credential credential) {

          CredentialValidationResult result = CredentialValidationResult.NOT_VALIDATED_RESULT;

          if (credential instanceof Auth0JwtCredential) {

              Auth0JwtCredential auth0JwtCredential = (Auth0JwtCredential) credential;

              result = new CredentialValidationResult(auth0JwtCredential.getAuth0JwtPrincipal());

          }

          return result;

      }

      }
      ```

      Si le `credential` est un `Auth0Credential`, l&#39;utilisateur appelant est authentifié et valide,
      donc un `CredentialValidationResult` créé avec les informations d&#39;identification est retourné pour indiquer la réussite. S&#39;il ne s&#39;agit
      pas d&#39;un `Auth0Credential`, retournez `CredentialValidationResult.NOT_VALIDATED_RESULT`.

      Avant d&#39;implémenter l&#39;interface `HttpAuthenticationMechanism` qui utilisera tous ces collaborateurs,
      créez un bean qui fournira une instance configurée de `AuthenticationController` provenant de la
      trousse de développement logiciel (SDK) Java MVC d&#39;Auth0. `AuthenticationController` est utilisé pour construire l&#39;URL d&#39;autorisation où les utilisateurs se
      connecteront et pour gérer l&#39;échange de jetons afin d&#39;authentifier les utilisateurs.

      * Si votre Application Auth0 est configurée pour utiliser l’**algorithme de signature RS256** (valeur par défaut lors de la création
        d’une nouvelle Application Auth0), vous devez configurer un `JwkProvider` pour obtenir la clé publique utilisée pour
        vérifier la signature du jeton. Consultez le [dépôt jwks-rsa-java](https://github.com/auth0/jwks-rsa-java) pour en savoir plus sur les options de configuration supplémentaires.
      * Si votre Application Auth0 est configurée pour utiliser l’**algorithme de signature HS256**, vous n’avez pas besoin de configurer le `JwkProvider`.

      <Info>
        Pour en savoir plus sur les algorithmes de signature disponibles, consultez la [documentation](https://auth0.com/docs/tokens/concepts/signing-algorithms).
      </Info>

      L&#39;exemple ci-dessous montre comment configurer le `AuthenticationController` pour utiliser l&#39;**algorithme de signature RS256** :

      ```java lines
      // src/main/java/com/auth0/example/security/Auth0AuthenticationProvider.java
      @ApplicationScoped
      public class Auth0AuthenticationProvider {
      @Produces

      public AuthenticationController authenticationController(Auth0AuthenticationConfig config) {

          JwkProvider jwkProvider = new JwkProviderBuilder(config.getDomain()).build();

          return AuthenticationController.newBuilder(config.getDomain(), config.getClientId(), config.getClientSecret())

                  .withJwkProvider(jwkProvider)

                  .build();

      }

      }
      ```

      Enfin, implémentez un `HttpAuthenticationMechanism` personnalisé

      ``

      ```java lines expandable
      // src/main/java/com/auth0/example/security/Auth0AuthenticationMechanism.java
      @ApplicationScoped
      @AutoApplySession
      public class Auth0AuthenticationMechanism implements HttpAuthenticationMechanism {
      private final AuthenticationController authenticationController;

      private final IdentityStoreHandler identityStoreHandler;



      @Inject

      Auth0AuthenticationMechanism(AuthenticationController authenticationController, IdentityStoreHandler identityStoreHandler) {

          this.authenticationController = authenticationController;

          this.identityStoreHandler = identityStoreHandler;

      }



      @Override

      public AuthenticationStatus validateRequest(HttpServletRequest httpServletRequest,

                                                  HttpServletResponse httpServletResponse,

                                                  HttpMessageContext httpMessageContext) throws AuthenticationException {



          // Échanger le code contre le jeton ID et notifier le conteneur du résultat.

          if (isCallbackRequest(httpServletRequest)) {

              try {

                  Tokens tokens = authenticationController.handle(httpServletRequest, httpServletResponse);

                  Auth0JwtCredential auth0JwtCredential = new Auth0JwtCredential(tokens.getIdToken());

                  CredentialValidationResult result = identityStoreHandler.validate(auth0JwtCredential);

                  return httpMessageContext.notifyContainerAboutLogin(result);

              } catch (IdentityVerificationException e) {

                  return httpMessageContext.responseUnauthorized();

              }

          }

          return httpMessageContext.doNothing();

      }



      private boolean isCallbackRequest(HttpServletRequest request) {

          return request.getRequestURI().equals(&quot;/callback&quot;) &amp;&amp; request.getParameter(&quot;code&quot;) != null;

      }

      }
      ```

      La classe remplace la méthode `validateRequest`, qui est appelée à chaque requête vers notre application
      et qui est chargée d&#39;informer le conteneur de l&#39;état d&#39;authentification.

      Cet exemple utilise le [flux de code d&#39;autorisation](https://auth0.com/docs/flows/concepts/auth-code) pour échanger un code d&#39;autorisation contre un jeton pendant le flux d&#39;authentification. Si cette requête est envoyée au point de terminaison `/callback` et contient le paramètre de requête `code`, elle effectue quelques opérations importantes :

      * Appelle la méthode `handle` de `AuthenticationController` pour échanger le
        code d’autorisation contre un jeton ID et un jeton d’accès.
      * Utilise le jeton ID pour créer un nouveau `Auth0Credential`.
      * Appelle la méthode `validate` de l’implémentation personnalisée d’`IdentityStore` pour obtenir le résultat de la validation.
      * Informe le conteneur d’application du statut de connexion.

      Si la ressource demandée n&#39;est pas `/callback`, retournez `httpMessageContext.doNothing()` pour
      permettre la poursuite du traitement de la requête. Vous verrez bientôt comment utiliser les informations d&#39;authentification lors du
      déclenchement de l&#39;authentification et de l&#39;affichage des vues Web.

      Enfin, notez que l&#39;annotation `@AutoApplySession` a été ajoutée pour permettre au conteneur de créer une session pour l&#39;utilisateur authentifié.

      <AuthCodeGroup>
        <Auth0authenticationconfig />

        <Web />

        <Loginservlet />

        <Homeservlet />

        <Logoutservlet />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      Pour permettre à un utilisateur de se connecter, créez un servlet qui traitera les requêtes pour le chemin `/login`.

      Le `LoginController` est chargé de rediriger la requête vers l’URL d’autorisation appropriée,
      où l’utilisateur peut s’authentifier avec Auth0. Il utilise l’`AuthenticationController` de la Trousse de développement logiciel (SDK) Java
      MVC d’Auth0 pour générer la bonne URL d’autorisation, en utilisant les valeurs de configuration injectées via
      `Auth0AuthenticationConfig`. Par défaut, cet exemple demande les scopes `"openid profile email"`,
      afin de permettre à l’application de récupérer les informations de base du profil de l’utilisateur authentifié. Pour en savoir plus
      sur ces scopes, consultez la documentation [OpenID
      Connect Scopes](https://auth0.com/docs/scopes/current/oidc-scopes).

      Une fois que l’utilisateur a saisi ses informations d’identification et autorisé les permissions demandées, Auth0 enverra une requête
      à `callbackUrl` et inclura un paramètre de requête `code` qui peut être échangé contre un ID
      token et un jeton d’accès. Rappelez-vous que l’`Auth0HttpAuthenticationMechanism` créé plus haut gère
      cet échange afin de pouvoir informer le conteneur de l’application de l’état de l’authentification. Cela permet au servlet
      qui traite les requêtes pour le chemin `/callback` de simplement faire suivre la requête vers la ressource
      initialement demandée avant la connexion, ou simplement de rediriger vers la page d’accueil :

      ```java lines
      // src/main/com/auth0/example/web/CallbackServlet.java
      @WebServlet(urlPatterns = {"/callback"})
      public class CallbackServlet extends HttpServlet {
      @Override

      public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {

          String referer = (String) request.getSession().getAttribute(&quot;Referer&quot;);

          String redirectTo = referer != null ? referer : &quot;/&quot;;



          response.sendRedirect(redirectTo);

      }

      }
      ```

      <AuthCodeGroup>
        <Loginservlet />

        <Web />

        <Auth0authenticationconfig />

        <Homeservlet />

        <Logoutservlet />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      Vous pouvez utiliser `Auth0JwtPrincipal` pour obtenir des informations de profil de l&#39;utilisateur authentifié. L&#39;exemple de code `HomeServlet.java` montre comment utiliser les revendications dans le [jeton ID](https://auth0.com/docs/tokens/id-token) pour définir les données de profil en tant qu&#39;attribut de requête.

      Vous pouvez ensuite utiliser ces informations de profil dans votre vue pour afficher des informations sur l&#39;utilisateur :

      ```xml lines
      <!-- src/main/webapp/WEB-INF/jsp/fragments/navbar.jspf -->
      <c:choose>
      <c:when test="{empty profile}">
      <li>
      <form action="/login" method="GET">
      <input type="submit" value="Connexion"/>
      </form>
      </li>
      </c:when>
      <c:otherwise>
      <li>
      <a href="#">
      <!-- L'image de profil doit être définie sur la photo de profil provenant du jeton ID -->
      <img src="{profile.get('picture').asString()}" alt="Photo de profil"/>
      </a>
      <div>
      <!-- Afficher ici le nom complet de l'utilisateur provenant du jeton ID -->
      <div>"{profile.get('name').asString()}"</div>
      <a href="/docs/profile">Profil</a>
      <a href="/docs/logout">Déconnexion</a>
      </div>
      </li>
      </c:otherwise>
      </c:choose>
      ```

      <AuthCodeGroup>
        <Homeservlet />

        <Web />

        <Auth0authenticationconfig />

        <Loginservlet />

        <Logoutservlet />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7" isSingleColumn>
      Pour déconnecter un utilisateur, vous devez mettre fin à la session de l&#39;application et le déconnecter d’Auth0. Cette opération est gérée dans
      `LogoutServlet`.

      D’abord, mettez fin à la session en appelant `request.getSession().invalidate()`. Ensuite, construisez l’URL de déconnexion
      en vous assurant d’inclure le paramètre de requête `returnTo`, qui indique l’endroit où l’utilisateur sera redirigé
      après la déconnexion. Finalement, redirigez la réponse vers l’URL de déconnexion de l’application.

      <AuthCodeGroup>
        <Logoutservlet />

        <Web />

        <Auth0authenticationconfig />

        <Loginservlet />

        <Homeservlet />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[7].id} title={sections[7].title} stepNumber="8" isSingleColumn>
      Pour créer et exécuter l’exemple, exécutez l’objectif Maven wildfly:run pour démarrer un serveur d’applications WildFly embarqué avec cette application déployée dessus. Consultez la documentation du [WildFly Maven Plugin](https://docs.jboss.org/wildfly/plugins/maven/latest/) pour plus d’informations.

      Si vous utilisez Linux ou macOS :

      ```sh lines
      ./mvnw clean wildfly:run
      ```

      Windows :

      ```sh lines
      mvnw.cmd clean wildfly:run
      ```

      Accédez à `http:``//localhost:3000.` Cliquez sur le lien **Log In** pour vous connecter ou
      créer un compte sur votre tenant Auth0.

      Après une connexion réussie, vous verrez la photo de profil de l&#39;utilisateur et un menu déroulant à l&#39;emplacement du lien **Log In**.
      Vous pouvez ensuite afficher la page de profil de l&#39;utilisateur en cliquant sur le lien **Profile**. Vous pouvez vous déconnecter en cliquant sur le
      lien **Logout** dans le menu déroulant.

      <LoggedInForm />
    </Section>

    ## Prochaines étapes

    Excellent travail! Si vous vous êtes rendu jusqu&#39;ici, vous devriez maintenant avoir la connexion, la déconnexion et les informations de profil utilisateur qui fonctionnent dans votre application.

    Ce tutoriel de démarrage rapide est maintenant terminé, mais il reste encore beaucoup à découvrir. Pour en savoir plus sur ce que vous pouvez faire avec Auth0, consultez :

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Découvrez comment configurer et gérer votre tenant Auth0 et vos Applications
    * [auth0-java-mvc-common trousse de développement logiciel (SDK)](https://github.com/auth0/auth0-java-mvc-common) - Découvrez plus en détail la trousse de développement logiciel (SDK) utilisée dans ce tutoriel
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Découvrez des intégrations que vous pouvez activer pour étendre les fonctionnalités d’Auth0
  </Content>
</Recipe>