---
title: "ASP.NET Core Blazor Server"
permalink: "01-login"
---

<div id="by-frederik-prijck">
  ##### Par Frederik Prijck
</div>

Ce tutoriel montre comment ajouter une fonctionnalité de connexion pour les utilisateurs à une application ASP.NET Core Blazor Server. Nous vous recommandons de vous connecter pour suivre ce Démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Voir sur GitHub" href="https://github.com/auth0-samples/auth0-aspnetcore-blazor-server-samples/tree/main/Quickstart/Sample" icon="github">
  Configuration système requise : .NET 6.0 | .NET 7.0 | .NET 8.0
  </Card> */}

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenez les clés de votre application
</div>

Lorsque vous vous êtes inscrit à Auth0, une nouvelle application a été créée pour vous, ou vous en avez peut‑être créé une nouvelle. Vous aurez besoin de certaines informations sur cette application pour communiquer avec Auth0. Vous pouvez obtenir ces informations dans la section [Application Settings](https://manage.auth0.com/#/applications) de l’Auth0 Dashboard.

<Frame>![Tableau de bord de l’application](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

Vous avez besoin des informations suivantes :

* **Domaine**
* **ID client**

<Info>
  Si vous téléchargez l’exemple en haut de cette page, ces informations sont déjà renseignées pour vous.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de redirection (callback)
</div>

L’URL de redirection (callback) de votre application est l’URL vers laquelle Auth0 vous redirigera après l’authentification de l’utilisateur afin que la trousse de développement logiciel (SDK) puisse terminer le processus d’authentification.

Vous devrez ajouter cette URL à la liste des URL autorisées pour votre application dans vos [paramètres d’Application](https://manage.auth0.com/#/applications), cette URL prenant généralement la forme `https://YOUR_APPLICATION_URL/callback`.

<div id="configure-logout-urls">
  ### Configurer les URL de déconnexion
</div>

Une URL de déconnexion est une URL de votre application vers laquelle Auth0 peut revenir lorsque l’utilisateur a été déconnecté du serveur d’autorisation. Celle-ci est spécifiée dans le paramètre de requête `returnTo`. L’URL de déconnexion de votre application doit être ajoutée au champ **URL de déconnexion autorisées** dans vos [paramètres de l’Application](https://manage.auth0.com/#/applications). Si ce champ n’est pas défini, les utilisateurs ne pourront pas se déconnecter de l’application et recevront une erreur.

<Info>
  Si vous suivez le projet d’exemple que vous avez téléchargé en haut de cette page, l’URL de déconnexion que vous devez ajouter au champ **URL de déconnexion autorisées** est `http://localhost:3000`.
</Info>

<div id="integrate-auth0">
  ## Intégrer Auth0
</div>

[Universal Login](/docs/fr-CA/authenticate/login/auth0-universal-login) est la façon la plus simple de mettre en place l’authentification pour votre application. Nous vous recommandons de l’utiliser pour offrir la meilleure expérience, une sécurité accrue et l’éventail de fonctionnalités le plus complet. Ce guide utilise Universal Login pour offrir à vos utilisateurs un moyen de se connecter à votre application Blazor Server.

<div id="install-dependencies">
  ### Installer les dépendances
</div>

Pour intégrer Auth0 à Blazor Server, vous pouvez utiliser notre trousse de développement logiciel (SDK) en installant le package NuGet `Auth0.AspNetCore.Authentication` à votre application.

```bash lines
Install-Package Auth0.AspNetCore.Authentication
```

<div id="install-and-configure-the-sdk">
  ### Installer et configurer la trousse de développement logiciel (SDK)
</div>

Pour activer l’authentification dans votre application Blazor Server, utilisez le middleware fourni par la trousse de développement logiciel (SDK). Allez au fichier `Program.cs` et appelez `builder.Services.AddAuth0WebAppAuthentication()` pour configurer le SDK Auth0 ASP.NET Core.

Assurez-vous de configurer `Domain` et `ClientId`, car ces champs sont obligatoires pour que le SDK sache quel tenant Auth0 et quelle Application Auth0 il doit utiliser.

```cs lines
var builder = WebApplication.CreateBuilder(args);

builder.Services.AddAuth0WebAppAuthentication(options =>
{
    options.Domain = builder.Configuration["Auth0:Domain"];
    options.ClientId = builder.Configuration["Auth0:ClientId"];
});

var app = builder.Build();
```

Assurez-vous d’avoir activé l’authentification et l’autorisation dans le fichier Program.cs :

```cs lines
app.UseAuthentication();
app.UseAuthorization();
```

<div id="login">
  ## Connexion
</div>

Pour permettre aux utilisateurs de se connecter à votre application Blazor Server, ajoutez un `LoginModel` à votre répertoire `Pages`.

Dans la méthode `OnGet` du `LoginModel`, appelez `HttpContext.ChallengeAsync()` et passez `Auth0Constants.AuthenticationScheme` comme schéma d’authentification. Cela invoquera le gestionnaire d’authentification OIDC que notre Trousse de développement logiciel (SDK) enregistre en interne. Assurez-vous également de spécifier les `authenticationProperties` correspondantes, que vous pouvez créer à l’aide de `LoginAuthenticationPropertiesBuilder`.

Après l’appel réussi à `HttpContext.ChallengeAsync()`, l’utilisateur sera redirigé vers Auth0 et sera connecté à la fois au middleware OIDC et au middleware de témoins (cookies) lorsque la redirection vers votre application aura lieu. Cela permettra d’authentifier les utilisateurs lors des requêtes ultérieures.

```cs lines
public class LoginModel : PageModel
{
    public async Task OnGet(string redirectUri)
    {
        var authenticationProperties = new LoginAuthenticationPropertiesBuilder()
            .WithRedirectUri(redirectUri)
            .Build();

        await HttpContext.ChallengeAsync(Auth0Constants.AuthenticationScheme, authenticationProperties);
    }
}
```

<div id="display-user-profile">
  ## Afficher le profil de l’utilisateur
</div>

Une fois que le middleware a récupéré avec succès les jetons auprès d’Auth0, il extrait les informations et les revendications de l’utilisateur à partir du jeton ID et les rend accessibles via `AuthenticationState`, que vous pouvez ajouter en tant que `CascadingParameter`.

Vous pouvez créer une page de profil d’utilisateur personnalisée pour afficher le nom de l’utilisateur, ainsi que des revendications supplémentaires (comme le courriel et la photo), en récupérant les informations correspondantes à partir de la propriété `User` de `AuthenticationState` et en les transmettant à la vue dans le code Blazor.

```cs lines
@page "/Profile"
@attribute [Authorize]

<PageTitle>Profile</PageTitle>

<div class="row">
    <div class="col-md-12">
        <div class="row">
            <h2>Profile</h2>
            <div class="col-md-4">
                <h3>@Username</h3>
            </div>
        </div>
    </div>
</div>

@code {
    [CascadingParameter]
    public Task<AuthenticationState> AuthenticationStateTask { get; set; }
    private string Username = "";

    protected override async Task OnInitializedAsync()
    {
        var state = await AuthenticationStateTask;

        Username = state.User.Identity.Name ?? string.Empty;

        await base.OnInitializedAsync();
    }
}
```

<div id="logout">
  ## Déconnexion
</div>

La déconnexion de l’utilisateur depuis votre propre application peut se faire en appelant `HttpContext.SignOutAsync` avec le schéma d’authentification `CookieAuthenticationDefaults.AuthenticationScheme` à partir de la méthode `OnGet` d’un `LogoutModel`.

De plus, si vous voulez aussi déconnecter l’utilisateur d’Auth0 (ce qui *pourrait* également le déconnecter d’autres applications qui s’appuient sur l’authentification unique [SSO, Single Sign-On]), appelez `HttpContext.SignOutAsync` avec le schéma d’authentification `Auth0Constants.AuthenticationScheme`, ainsi que les `authenticationProperties` appropriées qui peuvent être construites à l’aide de `LogoutAuthenticationPropertiesBuilder`.

<Info>
  Lorsque vous ne déconnectez l’utilisateur que de votre propre application, mais pas d’Auth0, assurez-vous de retourner `Redirect("/")` ou toute autre redirection appropriée.
</Info>

```cs lines
[Authorize]
public class LogoutModel : PageModel
{
    public async Task OnGet()
    {
        var authenticationProperties = new LogoutAuthenticationPropertiesBuilder()
            .WithRedirectUri("/")
            .Build();

        await HttpContext.SignOutAsync(Auth0Constants.AuthenticationScheme, authenticationProperties);
        await HttpContext.SignOutAsync(CookieAuthenticationDefaults.AuthenticationScheme);
    }
}
```

<div id="whats-next">
  ## Prochaines étapes
</div>

Nous avons rassemblé quelques exemples montrant comment utiliser la Trousse de développement logiciel (SDK) dans des cas d&#39;utilisation plus avancés :

* [Configuration des scopes](https://github.com/auth0/auth0-aspnetcore-authentication/blob/main/EXAMPLES.md#blazor-server)

[Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/webapp/aspnet-core-blazor-server/01-login.md)