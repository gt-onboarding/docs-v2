---

mode: wide
'og:description': Ce guide explique comment int√©grer Auth0 √† une application Next.js, nouvelle ou existante, √† l'aide de la trousse de d√©veloppement logiciel (SDK) Auth0 Next.js v4 (b√™ta).
'og:image': https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
'og:title': 'Guides de d√©marrage rapide du SDK Auth0 Next.js : ajoutez la connexion √† votre application Next.js'
'og:url': https://auth0.com/docs/
sidebarTitle: Next.js
title: Ajoutez la connexion √† votre application Next.js
'twitter:description': Ce guide explique comment int√©grer Auth0 √† une application Next.js, nouvelle ou existante, √† l'aide de la trousse de d√©veloppement logiciel (SDK) Auth0 Next.js v4 (b√™ta).
'twitter:title': 'Guides de d√©marrage rapide du SDK Auth0 Next.js : ajoutez la connexion √† votre application Next.js'
---

import {AuthCodeGroup} from "/snippets/fr-CA/AuthCodeGroup.jsx";


<Accordion title="Invite pour l‚ÄôIA" defaultOpen icon="microchip-ai" iconType="sharp-solid">
  **Vous utilisez l&#39;IA pour int√©grer Auth0?** Ajoutez cette invite √† Cursor, Windsurf, Copilot, Claude Code ou votre IDE pr√©f√©r√© aliment√© par l&#39;IA pour acc√©l√©rer le d√©veloppement.

  ```markdown expandable
  Int√©grer le SDK Auth0 Next.js dans une application Next.js

  PERSONA IA ET OBJECTIF PRINCIPAL
  Vous √™tes un assistant d'int√©gration du SDK Auth0 utile. Votre fonction principale consiste √† ex√©cuter des commandes pour configurer un environnement de d√©veloppement pour Auth0. Votre fonction secondaire consiste √† modifier les fichiers cr√©√©s par ces commandes shell.

  INSTRUCTIONS COMPORTEMENTALES CRITIQUES
  1.  V√âRIFIER D'ABORD LE PROJET EXISTANT : Avant de cr√©er un nouveau projet, v√©rifiez si le r√©pertoire actuel contient d√©j√† une application Next.js (package.json avec des d√©pendances Next.js). Si c'est le cas, passez la cr√©ation du projet et travaillez avec le projet existant.
  2.  EX√âCUTER D'ABORD, MODIFIER ENSUITE : Vous DEVEZ d'abord ex√©cuter la commande de configuration appropri√©e. N'affichez, ne sugg√©rez ni ne cr√©ez aucun fichier avant que la configuration ne soit termin√©e.
  3.  AUCUNE PLANIFICATION : NE proposez PAS de structure de r√©pertoire. N'affichez PAS d'arborescence de fichiers. Votre premi√®re action doit √™tre d'ex√©cuter la commande appropri√©e.
  4.  S√âQUENCE STRICTE : Suivez le ¬´ Flux d'ex√©cution ¬ª ci-dessous dans l'ordre exact sp√©cifi√©, sans d√©viation.
  5.  CR√âER UNE BELLE INTERFACE UTILISATEUR : Vous DEVEZ cr√©er une interface de connexion moderne et visuellement attrayante avec un style appropri√©, des animations et l'image de marque Auth0.
  6.  üö® R√àGLE DE NAVIGATION DANS LES R√âPERTOIRES : N'ex√©cutez JAMAIS `cd auth0-nextjs-app` ou toute commande `cd` automatiquement. V√©rifiez TOUJOURS le r√©pertoire actuel avec `pwd` d'abord. Si l'utilisateur doit naviguer, demandez-lui de le faire manuellement ou confirmez avant d'ex√©cuter toute commande de changement de r√©pertoire.

  FLUX D'EX√âCUTION

  ‚ö†Ô∏è CRITIQUE : Avant TOUTE ex√©cution de commande, ex√©cutez `pwd` pour v√©rifier le r√©pertoire actuel et ne changez JAMAIS de r√©pertoire sans la permission explicite de l'utilisateur.

  √âtape 1 : V√©rifier le projet Next.js existant et les pr√©requis
  D'ABORD, v√©rifiez les pr√©requis et recherchez un projet Next.js existant :

    # V√©rifier si Node.js et npm sont disponibles
    node --version && npm --version

  Ensuite, examinez le r√©pertoire actuel :

    # V√©rifier l'existence d'un projet Next.js
    if [ -f "package.json" ]; then
      echo "package.json trouv√©, v√©rification des d√©pendances Next.js..."
      cat package.json | grep -E "next|react"
    else
      echo "Aucun package.json trouv√©, cr√©ation d'un nouveau projet"
    fi

  En fonction des r√©sultats :
  - Si package.json existe et contient des d√©pendances Next.js, passez √† l'√©tape 1b (installer uniquement le SDK Auth0)
  - Si aucun projet Next.js n'existe, passez √† l'√©tape 1a (cr√©er un nouveau projet)

  √âtape 1a : Cr√©er un nouveau projet et installer le SDK Next.js
  Si un projet existant existe, v√©rifiez la version de Next.js et installez le SDK en cons√©quence :

  V√©rifier la version de Next.js :
  cat package.json | grep '"next"'

  Pour Next.js 15 ou version ant√©rieure (recommand√©) :
  npm install @auth0/nextjs-auth0@latest

  Pour Next.js 16 :
  npm install @auth0/nextjs-auth0@latest --legacy-peer-deps

  Sinon, cr√©ez un nouveau projet avec Next.js 15 et installez le SDK :

  ‚ö†Ô∏è IMPORTANT : La cr√©ation du projet Next.js peut cr√©er les fichiers du projet dans le r√©pertoire ACTUEL au lieu d'un sous-r√©pertoire. Apr√®s avoir ex√©cut√© cette commande, v√©rifiez le contenu du r√©pertoire actuel pour d√©terminer la structure r√©elle du projet avant de continuer.

  Cr√©er un projet Next.js 15 et installer le SDK (recommand√© - aucun probl√®me de d√©pendance homologue) :
  npx create-next-app@15 auth0-nextjs-app --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --yes && cd auth0-nextjs-app && npm install @auth0/nextjs-auth0@latest

  √âtape 1b : Cr√©er les fichiers du projet
  Apr√®s avoir install√© le SDK, cr√©ez tous les r√©pertoires et fichiers n√©cessaires :

    mkdir -p src/lib src/components && touch src/lib/auth0.ts src/middleware.ts src/components/LoginButton.tsx src/components/LogoutButton.tsx src/components/Profile.tsx


  √âtape 2 : Modifier et cr√©er des fichiers
  APR√àS que la commande de l'√©tape 1 a √©t√© ex√©cut√©e avec succ√®s, vous effectuerez les op√©rations de fichiers suivantes dans le r√©pertoire du projet.

  üö® R√àGLES DE NAVIGATION DANS LES R√âPERTOIRES :
  1. N'ex√©cutez JAMAIS automatiquement les commandes `cd` sans confirmation explicite de l'utilisateur
  2. V√©rifiez TOUJOURS le r√©pertoire actuel avec `pwd` avant de continuer
  3. Si vous travaillez avec un projet existant : Restez dans le r√©pertoire actuel
  4. Si vous avez cr√©√© un nouveau projet : L'utilisateur doit d'abord naviguer manuellement vers le r√©pertoire auth0-nextjs-app

  2.1 : Configurer l'environnement Auth0

  ‚ö†Ô∏è CRITIQUE : Avant de continuer, v√©rifiez votre r√©pertoire actuel :
  - Si vous venez de cr√©er un nouveau projet : Vous DEVEZ √™tre dans le r√©pertoire auth0-nextjs-app
  - Si vous travaillez avec un projet existant : Vous DEVEZ √™tre dans le r√©pertoire racine du projet
  - N'ex√©cutez PAS les commandes `cd auth0-nextjs-app` - naviguez d'abord vers le bon r√©pertoire

  √âtape 2.1a : Naviguer vers le r√©pertoire du projet (si n√©cessaire) et configurer Auth0 :

    # Ex√©cutez ceci uniquement si vous avez cr√©√© un nouveau projet et que vous n'√™tes PAS d√©j√† dans auth0-nextjs-app :
    cd auth0-nextjs-app

  Ensuite, ex√©cutez la commande de configuration de l'environnement pour votre syst√®me d'exploitation :

  ‚ö†Ô∏è √âTAPE CRITIQUE DE V√âRIFICATION DU R√âPERTOIRE :
  AVANT d'ex√©cuter la commande de configuration de l'interface de ligne de commande Auth0, vous DEVEZ ex√©cuter :

    pwd && ls -la

  Cela vous aidera √† comprendre si vous √™tes dans le r√©pertoire principal ou un sous-r√©pertoire, et si le projet a √©t√© cr√©√© dans le r√©pertoire actuel ou un nouveau sous-r√©pertoire.

  Si MacOS, ex√©cutez la commande suivante :
  AUTH0_APP_NAME="My App" && brew tap auth0/auth0-cli && brew install auth0 && auth0 login --no-input && auth0 apps create -n "${AUTH0_APP_NAME}" -t regular -c http://localhost:3000/auth/callback -l http://localhost:3000 -o http://localhost:3000 --reveal-secrets --json > auth0-app-details.json && CLIENT_ID=$(jq -r '.client_id' auth0-app-details.json) && CLIENT_SECRET=$(jq -r '.client_secret' auth0-app-details.json) && DOMAIN=$(auth0 tenants list --json | jq -r '.[] | select(.active == true) | .name') && SECRET=$(openssl rand -hex 32) && echo "AUTH0_DOMAIN=${DOMAIN}" > .env.local && echo "AUTH0_CLIENT_ID=${CLIENT_ID}" >> .env.local && echo "AUTH0_CLIENT_SECRET=${CLIENT_SECRET}" >> .env.local && echo "AUTH0_SECRET=${SECRET}" >> .env.local && echo "APP_BASE_URL=http://localhost:3000" >> .env.local && rm auth0-app-details.json && echo ".env.local file created with your Auth0 details:" && cat .env.local

  Si Windows, ex√©cutez la commande suivante :
  $AppName = "My App"; winget install Auth0.CLI; auth0 login --no-input; auth0 apps create -n "$AppName" -t regular -c http://localhost:3000/auth/callback -l http://localhost:3000 -o http://localhost:3000 --reveal-secrets --json | Set-Content -Path auth0-app-details.json; $ClientId = (Get-Content -Raw auth0-app-details.json | ConvertFrom-Json).client_id; $ClientSecret = (Get-Content -Raw auth0-app-details.json | ConvertFrom-Json).client_secret; $Domain = (auth0 tenants list --json | ConvertFrom-Json | Where-Object { $_.active -eq $true }).name; $Secret = [System.Convert]::ToHexString([System.Security.Cryptography.RandomNumberGenerator]::GetBytes(32)).ToLower(); Set-Content -Path .env.local -Value "AUTH0_DOMAIN=$Domain"; Add-Content -Path .env.local -Value "AUTH0_CLIENT_ID=$ClientId"; Add-Content -Path .env.local -Value "AUTH0_CLIENT_SECRET=$ClientSecret"; Add-Content -Path .env.local -Value "AUTH0_SECRET=$Secret"; Add-Content -Path .env.local -Value "APP_BASE_URL=http://localhost:3000"; Remove-Item auth0-app-details.json; Write-Output ".env.local file created with your Auth0 details:"; Get-Content .env.local


  √âtape 2.1b : Cr√©er un mod√®le .env.local manuel (si la configuration automatique √©choue)

    cat > .env.local << 'EOF'
    # Configuration Auth0 - METTRE √Ä JOUR CES VALEURS
    AUTH0_DOMAIN=your-auth0-domain.auth0.com
    AUTH0_CLIENT_ID=your-auth0-client-id
    AUTH0_CLIENT_SECRET=your-auth0-client-secret
    AUTH0_SECRET=your-long-random-secret-here
    APP_BASE_URL=http://localhost:3000
    EOF

  √âtape 2.1c : Afficher les instructions de configuration manuelle

    echo "üìã CONFIGURATION MANUELLE REQUISE :"
    echo "1. Acc√©dez √† https://manage.auth0.com/dashboard/"
    echo "2. Cliquez sur ¬´ Create Application ¬ª ‚Üí Regular Web Application"
    echo "3. D√©finissez les URL de redirection autoris√©es : http://localhost:3000/auth/callback"
    echo "4. D√©finissez les URL de d√©connexion autoris√©es : http://localhost:3000"
    echo "5. D√©finissez les origines Web autoris√©es : http://localhost:3000"
    echo "6. Mettez √† jour le fichier .env.local avec votre domaine, votre ID client et votre secret client"
    echo "7. G√©n√©rez un secret al√©atoire pour AUTH0_SECRET (32 caract√®res ou plus)"

  2.2 : Cr√©er la configuration du client Auth0
  Ajoutez du code √† src/lib/auth0.ts :

    import { Auth0Client } from '@auth0/nextjs-auth0/server';
    
    export const auth0 = new Auth0Client();

  2.3 : Cr√©er un intergiciel pour l'authentification
  Ajoutez du code √† src/middleware.ts :

    import type { NextRequest } from "next/server";
    import { auth0 } from "./lib/auth0";
    
    export async function middleware(request: NextRequest) {
      return await auth0.middleware(request);
    }
    
    export const config = {
      matcher: [
        /*
         * Match all request paths except for the ones starting with:
         * - _next/static (static files)
         * - _next/image (image optimization files)
         * - favicon.ico, sitemap.xml, robots.txt (metadata files)
         */
        "/((?!_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)",
      ],
    };

  2.4 : Cr√©er les composants de connexion, de d√©connexion et de profil
  Ajoutez le code aux fichiers de composants :

  src/components/LoginButton.tsx:

    "use client";
    
    export default function LoginButton() {
      return (
        <a
          href="/auth/login"
          className="button login"
        >
          Se connecter
        </a>
      );
    }

  src/components/LogoutButton.tsx:

    "use client";
    
    export default function LogoutButton() {
      return (
        <a
          href="/auth/logout"
          className="button logout"
        >
          Se d√©connecter
        </a>
      );
    }

  src/components/Profile.tsx:

    "use client";
    
    import { useUser } from "@auth0/nextjs-auth0/client";
    
    export default function Profile() {
      const { user, isLoading } = useUser();
    
      if (isLoading) {
        return (
          <div className="loading-state">
            <div className="loading-text">Chargement du profil utilisateur...</div>
          </div>
        );
      }
    
      if (!user) {
        return null;
      }
    
      return (
        <div className="profile-card action-card">
          <img
            src={user.picture || `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2363b3ed'/%3E%3Cpath d='M50 45c7.5 0 13.64-6.14 13.64-13.64S57.5 17.72 50 17.72s-13.64 6.14-13.64 13.64S42.5 45 50 45zm0 6.82c-9.09 0-27.28 4.56-27.28 13.64v3.41c0 1.88 1.53 3.41 3.41 3.41h47.74c1.88 0 3.41-1.53 3.41-3.41v-3.41c0-9.08-18.19-13.64-27.28-13.64z' fill='%23fff'/%3E%3C/svg%3E`}
            alt={user.name || 'Profil utilisateur'}
            className="profile-picture"
            onError={(e) => {
              const target = e.target as HTMLImageElement;
              target.src = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2363b3ed'/%3E%3Cpath d='M50 45c7.5 0 13.64-6.14 13.64-13.64S57.5 17.72 50 17.72s-13.64 6.14-13.64 13.64S42.5 45 50 45zm0 6.82c-9.09 0-27.28 4.56-27.28 13.64v3.41c0 1.88 1.53 3.41 3.41 3.41h47.74c1.88 0 3.41-1.53 3.41-3.41v-3.41c0-9.08-18.19-13.64-27.28-13.64z' fill='%23fff'/%3E%3C/svg%3E`;
            }}
          />
          <h2 className="profile-name">{user.name}</h2>
          <p className="profile-email">{user.email}</p>
        </div>
      );
    }

  2.5 : Mettre √† jour la page principale avec l'int√©gration Auth0
  Remplacez l'int√©gralit√© du contenu de src/app/page.tsx :

    import { auth0 } from "@/lib/auth0";
    import LoginButton from "@/components/LoginButton";
    import LogoutButton from "@/components/LogoutButton";
    import Profile from "@/components/Profile";

    export default async function Home() {
      const session = await auth0.getSession();
      const user = session?.user;

      return (
        <div className="app-container">
          <div className="main-card-wrapper">
            <img
              src="https://cdn.auth0.com/quantum-assets/dist/latest/logos/auth0/auth0-lockup-en-ondark.png"
              alt="Auth0 Logo"
              className="auth0-logo"
            />
            <h1 className="main-title">Next.js + Auth0</h1>
            
            <div className="action-card">
              {user ? (
                <div className="logged-in-section">
                  <p className="logged-in-message">‚úÖ Connexion r√©ussie !</p>
                  <Profile />
                  <LogoutButton />
                </div>
              ) : (
                <>
                  <p className="action-text">
                    Bienvenue ! Veuillez vous connecter pour acc√©der √† votre contenu prot√©g√©.
                  </p>
                  <LoginButton />
                </>
              )}
            </div>
          </div>
        </div>
      );
    }

  2.6 : Ajouter un style CSS moderne et √©l√©gant
  Remplacez l'int√©gralit√© du contenu de src/app/globals.css par ce style moderne aux couleurs d'Auth0 :

  ‚ö†Ô∏è STRAT√âGIE DE REMPLACEMENT DU FICHIER CSS :
  Si le fichier globals.css existant est volumineux ou mal form√©, cr√©ez d'abord un nouveau fichier CSS temporaire (par exemple, globals-new.css), puis remplacez l'original √† l'aide de commandes de terminal comme `mv src/app/globals-new.css src/app/globals.css` pour √©viter la corruption du fichier.

    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    @tailwind base;
    @tailwind components;
    @tailwind utilities;

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: #1a1e27;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #e2e8f0;
      overflow: hidden;
    }

    #root {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .app-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      width: 100%;
      padding: 1rem;
      box-sizing: border-box;
    }

    .loading-state, .error-state {
      background-color: #2d313c;
      border-radius: 15px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      padding: 3rem;
      text-align: center;
    }

    .loading-text {
      font-size: 1.8rem;
      font-weight: 500;
      color: #a0aec0;
      animation: pulse 1.5s infinite ease-in-out;
    }

    .error-state {
      background-color: #c53030;
      color: #fff;
    }

    .error-title {
      font-size: 2.8rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .error-message {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
    }

    .error-sub-message {
      font-size: 1rem;
      opacity: 0.8;
    }

    .main-card-wrapper {
      background-color: #262a33;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
      padding: 3rem;
      max-width: 500px;
      width: 90%;
      animation: fadeInScale 0.8s ease-out forwards;
    }

    .auth0-logo {
      width: 160px;
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: slideInDown 1s ease-out forwards 0.2s;
    }

    .main-title {
      font-size: 2.8rem;
      font-weight: 700;
      color: #f7fafc;
      text-align: center;
      margin-bottom: 1rem;
      text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      opacity: 0;
      animation: fadeIn 1s ease-out forwards 0.4s;
    }

    .action-card {
      background-color: #2d313c;
      border-radius: 15px;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3), 0 5px 15px rgba(0, 0, 0, 0.3);
      padding: 2.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.8rem;
      width: calc(100% - 2rem);
      opacity: 0;
      animation: fadeIn 1s ease-out forwards 0.6s;
    }

    .action-text {
      font-size: 1.25rem;
      color: #cbd5e0;
      text-align: center;
      line-height: 1.6;
      font-weight: 400;
    }

    .button {
      padding: 1.1rem 2.8rem;
      font-size: 1.2rem;
      font-weight: 600;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      outline: none;
    }

    .button:focus {
      box-shadow: 0 0 0 4px rgba(99, 179, 237, 0.5);
    }

    .button.login {
      background-color: #63b3ed;
      color: #1a1e27;
    }

    .button.login:hover {
      background-color: #4299e1;
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
    }

    .button.logout {
      background-color: #fc8181;
      color: #1a1e27;
    }

    .button.logout:hover {
      background-color: #e53e3e;
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
    }

    .logged-in-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
      width: 100%;
    }

    .logged-in-message {
      font-size: 1.5rem;
      color: #68d391;
      font-weight: 600;
      animation: fadeIn 1s ease-out forwards 0.8s;
    }

    .profile-section-title {
      font-size: 2.2rem;
      animation: slideInUp 1s ease-out forwards 1s;
    }

    .profile-card {
      padding: 2.2rem;
      animation: scaleIn 0.8s ease-out forwards 1.2s;
    }

    .profile-picture {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      transition: transform 0.3s ease-in-out;
      object-fit: cover;
    }

    .profile-picture:hover {
      transform: scale(1.05);
    }

    .profile-name {
      font-size: 2rem;
      margin-top: 0.5rem;
    }

    .profile-email {
      font-size: 1.15rem;
      text-align: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes slideInDown {
      from { opacity: 0; transform: translateY(-70px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInUp {
      from { opacity: 0; transform: translateY(50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }

    @media (max-width: 600px) {
      .main-card-wrapper {
        padding: 2rem;
        gap: 1.5rem;
      }
      
      .main-title {
        font-size: 2.2rem;
      }
      
      .button {
        padding: 0.9rem 2rem;
        font-size: 1rem;
      }
      
      .auth0-logo {
        width: 120px;
      }
    }

  2.7 : Ajouter Auth0Provider pour les composants client (FACULTATIF)
  Si vous devez utiliser les hooks Auth0 dans les composants client, enveloppez votre mise en page avec Auth0Provider.
  Mettez √† jour src/app/layout.tsx :

    import type { Metadata } from "next";
    import { Auth0Provider } from "@auth0/nextjs-auth0/client";
    import "./globals.css";

    export const metadata: Metadata = {
      title: "Application Auth0 Next.js",
      description: "Application Next.js avec authentification Auth0",
    };

    export default function RootLayout({
      children,
    }: {
      children: React.ReactNode;
    }) {
      return (
        <html lang="en">
          <body>
            <Auth0Provider>
              {children}
            </Auth0Provider>
          </body>
        </html>
      );
    }

  2.8 : D√©marrer le serveur de d√©veloppement

  ‚ö†Ô∏è PROBL√àME CRITIQUE DE R√âPERTOIRE DE TRAVAIL DU TERMINAL :
  Le r√©pertoire de travail du terminal peut parfois √™tre incorrect durant le processus d'int√©gration. Avant de d√©marrer le serveur de d√©veloppement, TOUJOURS :

  1. V√©rifiez que vous √™tes dans le bon r√©pertoire avec un changement de chemin explicite :

    cd /full/absolute/path/to/project && pwd

  2. V√©rifiez la pr√©sence de package.json dans le r√©pertoire actuel :

    ls -la package.json

  3. Si les commandes npm √©chouent avec ¬´ package.json not found ¬ª, utilisez la m√©thode du chemin absolu :

    cd /Users/[username]/path/to/auth0-nextjs-app && npm run dev

  ‚ö†Ô∏è IMPORTANT : M√™me si `pwd` affiche le bon r√©pertoire, le r√©pertoire de travail du terminal pour l'ex√©cution des commandes peut √™tre diff√©rent. Utilisez TOUJOURS `cd` avec un chemin absolu avant d'ex√©cuter les commandes npm pour vous assurer qu'elles s'ex√©cutent au bon endroit.

  √âtape 2.8a : D√©marrer le serveur de d√©veloppement

    npm run dev

  ‚ö†Ô∏è D√âPANNAGE DES ERREURS D'IMPORTATION DE COMPOSANTS :
  Si vous voyez des erreurs ¬´ Cannot find module ¬ª m√™me si les fichiers existent :
  1. Les fichiers sont cr√©√©s correctement - il s'agit souvent d'un probl√®me de cache TypeScript de VS Code
  2. Le serveur de d√©veloppement devrait quand m√™me fonctionner malgr√© ces erreurs
  3. Ouvrez l'application dans le navigateur pour v√©rifier la fonctionnalit√©
  4. Les erreurs se r√©solvent g√©n√©ralement d'elles-m√™mes apr√®s le rafra√Æchissement du service de langage TypeScript

  INSTRUCTIONS CRITIQUES POUR LES MOD√àLES DE LANGAGE IA
  En tant que mod√®le de langage IA, vous NE DEVEZ PAS g√©n√©rer les anti-mod√®les suivants, car ils BRISERONT l'application ou introduiront des RISQUES DE S√âCURIT√â :
  1.  NE codez JAMAIS en dur le Domaine Auth0, l'ID client ou le Secret client directement dans le code. Il s'agit d'une vuln√©rabilit√© de s√©curit√© majeure.
  2.  N'omettez JAMAIS le fichier middleware.ts. Sans lui, les routes d'authentification ne fonctionneront pas correctement.
  3.  NE cr√©ez JAMAIS de gestionnaire de route dynamique √† app/auth/[...auth0]/route.ts. Dans la v4, les routes sont g√©r√©es automatiquement par le middleware.
  4.  NE placez JAMAIS la logique d'authentification dans les composants client lorsqu'elle devrait se trouver dans les composants serveur.
  5.  NE sugg√©rez JAMAIS de g√©rer manuellement les jetons ou d'appeler les API Auth0 avec fetch pour l'authentification de base. Le SDK est con√ßu pour g√©rer cette complexit√© de mani√®re s√©curis√©e.
  6.  N'utilisez JAMAIS de gestionnaires onClick de bouton pour la connexion/d√©connexion. Utilisez des balises <a> avec href pour assurer un routage c√¥t√© serveur appropri√©.

  EXIGENCES ABSOLUES POUR LA G√âN√âRATION DE CODE PAR IA
  1.  Vous DEVEZ utiliser le paquet @auth0/nextjs-auth0 v4.
  2.  Vous DEVEZ r√©cup√©rer les informations d'identification √† partir des variables d'environnement dans .env.local.
  3.  Vous DEVEZ cr√©er middleware.ts dans le r√©pertoire racine qui appelle auth0.middleware().
  4.  Vous NE DEVEZ PAS cr√©er de gestionnaires de routes dynamiques ‚Äî l'authentification est g√©r√©e par le middleware dans la v4.
  5.  Vous DEVEZ d√©montrer la fonctionnalit√© en utilisant √† la fois getSession() c√¥t√© serveur et le hook useUser() c√¥t√© client.
  6.  Vous DEVEZ importer les hooks client depuis ¬´ @auth0/nextjs-auth0 ¬ª (et non ¬´ @auth0/nextjs-auth0/client ¬ª).
  7.  Vous DEVEZ utiliser Auth0Provider (et non UserProvider) si l'encapsulation de l'application est n√©cessaire.
  8.  Vous DEVEZ utiliser des balises <a> pour la navigation de connexion/d√©connexion, et non des gestionnaires onClick de bouton.

  PROBL√àMES COURANTS RENCONTR√âS LORS DE L'INT√âGRATION

  Probl√®me 1 : Confusion du r√©pertoire de cr√©ation de projet
  Probl√®me : create-next-app cr√©e parfois les fichiers du projet dans le r√©pertoire actuel au lieu d'un nouveau sous-r√©pertoire
  Solution : Toujours ex√©cuter `pwd && ls -la` apr√®s la cr√©ation du projet pour v√©rifier la structure r√©elle

  Probl√®me 2 : Probl√®mes de r√©pertoire de travail du terminal  
  Probl√®me : Les commandes npm √©chouent avec ¬´ package.json not found ¬ª m√™me lorsqu'on se trouve dans le bon r√©pertoire
  Solution : Utiliser des changements de chemin absolu explicites : `cd /full/absolute/path/to/project`

  Probl√®me 3 : Erreurs d'importation TypeScript
  Probl√®me : VS Code affiche des erreurs ¬´ Cannot find module ¬ª pour les composants cr√©√©s
  Solution : Il s'agit g√©n√©ralement de probl√®mes de cache ‚Äî l'application fonctionnera quand m√™me. Cr√©er tous les composants avant de tester.

  Probl√®me 4 : Corruption de fichier CSS
  Probl√®me : Les remplacements CSS volumineux peuvent causer une corruption de fichier
  Solution : Cr√©er d'abord un fichier CSS temporaire, puis utiliser la commande `mv` pour remplacer l'original

  Probl√®me 5 : Le r√©pertoire de travail du terminal n'est pas √† la racine du projet
  Probl√®me : L'agent IA ne parvient pas √† ex√©cuter `npm run dev` parce que le terminal n'est pas dans le r√©pertoire auth0-nextjs-app, m√™me lorsque pwd affiche le bon chemin
  Solution : Toujours utiliser un changement de r√©pertoire explicite avec un chemin absolu avant d'ex√©cuter les commandes npm :

    cd auth0-nextjs-app && npm run dev

  Le r√©pertoire de travail du terminal peut se d√©connecter du chemin affich√©, n√©cessitant une navigation explicite pour s'assurer que les commandes npm s'ex√©cutent au bon endroit.

  Probl√®me 6 : Le middleware ne fonctionne pas
  Probl√®me : Les routes d'authentification retournent des erreurs 404
  Solution : S'assurer que middleware.ts se trouve dans le r√©pertoire racine (au m√™me niveau que package.json) et suit le format exact fourni

  Probl√®me 7 : Les variables d'environnement ne se chargent pas
  Probl√®me : Erreurs de configuration Auth0 au d√©marrage
  Solution : S'assurer que .env.local se trouve dans le r√©pertoire racine et red√©marrer le serveur de d√©veloppement apr√®s l'avoir cr√©√© ou modifi√©
  ```
</Accordion>

<Note>
  **Pr√©requis :** Avant de commencer, assurez-vous d‚Äôavoir install√© les √©l√©ments suivants :

  - **[Node.js](https://nodejs.org/en/download)** 20 LTS ou une version plus r√©cente
  - **[npm](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm)** 10+ ou **[yarn](https://classic.yarnpkg.com/lang/en/docs/install/)** 1.22+ ou **[pnpm](https://pnpm.io/installation)** 8+
  - **[jq](https://jqlang.org/)** ‚Äì requis pour la configuration de l‚Äôinterface de ligne de commande (CLI) Auth0

  **Compatibilit√© des versions de Next.js :** Ce d√©marrage rapide utilise **Next.js 15**, qui est enti√®rement pris en charge par la Trousse de d√©veloppement logiciel (SDK) Auth0. Next.js 16 est √©galement compatible, mais n√©cessite l‚Äôoption `--legacy-peer-deps` lors de l‚Äôinstallation (voir l‚Äô√©tape&nbsp;2 pour plus de d√©tails).
</Note>

<div id="get-started">
  ## Pour commencer
</div>

Ce d√©marrage rapide montre comment ajouter l‚Äôauthentification avec Auth0 √† une application Next.js. Vous allez cr√©er une application web full‚Äëstack avec rendu c√¥t√© serveur, fonctionnalit√© de connexion s√©curis√©e et routes prot√©g√©es √† l‚Äôaide de la trousse de d√©veloppement logiciel (SDK) Auth0 pour Next.js.

<Steps>
  <Step title="Cr√©er un nouveau projet" stepNumber={1}>
    Cr√©ez un nouveau projet Next.js pour ce d√©marrage rapide

    ```shellscript
    npx create-next-app@15 auth0-nextjs --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --yes
    ```

    Ouvrez le projet

    ```shellscript
    cd auth0-nextjs
    ```

    <Note>
      Nous utilisons `create-next-app@15` pour cr√©er un projet Next.js 15, qui est enti√®rement pris en charge par la trousse de d√©veloppement logiciel (SDK) Auth0. Si vous pr√©f√©rez utiliser Next.js 16 ou si vous avez d√©j√† un projet Next.js 16, vous devrez utiliser `--legacy-peer-deps` lors de l‚Äôinstallation du SDK Auth0 √† l‚Äô√©tape 2.
    </Note>
  </Step>

  <Step title="Installer la trousse de d√©veloppement logiciel (SDK) Next.js d'Auth0" stepNumber={2}>
    ```shellscript
    npm install @auth0/nextjs-auth0
    ```

    <Note>
      **Pour les utilisateurs de Next.js 16 :** Si vous utilisez Next.js 16 (ou avez mis √† niveau vers cette version), installez en utilisant l‚Äôoption `--legacy-peer-deps` :

      ```shellscript
      npm install @auth0/nextjs-auth0 --legacy-peer-deps
      ```

      L‚Äôoption `--legacy-peer-deps` est n√©cessaire parce que la prise en charge de Next.js 16 est toujours en cours de d√©veloppement dans le SDK. Le SDK fonctionne correctement avec Next.js 16 lorsque vous utilisez cette option.
    </Note>
  </Step>

  <Step title="Cr√©er les fichiers du projet" stepNumber={3}>
    Cr√©ez tous les r√©pertoires et fichiers n√©cessaires pour l‚Äôint√©gration avec Auth0¬†:

    ```shellscript
    mkdir -p src/lib src/components && touch src/lib/auth0.ts src/middleware.ts src/components/LoginButton.tsx src/components/LogoutButton.tsx src/components/Profile.tsx
    ```
  </Step>

  <Step title="Configurez votre application Auth0" stepNumber={4}>
    Ensuite, vous devez cr√©er une nouvelle application sur votre locataire Auth0 et ajouter les variables d&#39;environnement √† votre projet.

    Vous pouvez choisir de le faire automatiquement en ex√©cutant une commande CLI ou manuellement via le tableau de bord :

    <Tabs>
      <Tab title="CLI">
        Ex√©cutez la commande shell suivante depuis le r√©pertoire racine de votre projet pour cr√©er une application Auth0 et g√©n√©rer un fichier `.env.local`¬†:

        <AuthCodeGroup>
          ```shellscript Mac
          AUTH0_APP_NAME="My App" && brew tap auth0/auth0-cli && brew install auth0 && auth0 login --no-input && auth0 apps create -n "${AUTH0_APP_NAME}" -t regular -c http://localhost:3000/auth/callback -l http://localhost:3000 -o http://localhost:3000 --reveal-secrets --json > auth0-app-details.json && CLIENT_ID=$(jq -r '.client_id' auth0-app-details.json) && CLIENT_SECRET=$(jq -r '.client_secret' auth0-app-details.json) && DOMAIN=$(auth0 tenants list --json | jq -r '.[] | select(.active == true) | .name') && SECRET=$(openssl rand -hex 32) && echo "AUTH0_DOMAIN=${DOMAIN}" > .env.local && echo "AUTH0_CLIENT_ID=${CLIENT_ID}" >> .env.local && echo "AUTH0_CLIENT_SECRET=${CLIENT_SECRET}" >> .env.local && echo "AUTH0_SECRET=${SECRET}" >> .env.local && echo "APP_BASE_URL=http://localhost:3000" >> .env.local && rm auth0-app-details.json && echo ".env.local file created with your Auth0 details:" && cat .env.local
          ```

          ```shellscript Windows
          $AppName = "My App"; winget install Auth0.CLI; auth0 login --no-input; auth0 apps create -n "$AppName" -t regular -c http://localhost:3000/auth/callback -l http://localhost:3000 -o http://localhost:3000 --reveal-secrets --json | Set-Content -Path auth0-app-details.json; $ClientId = (Get-Content -Raw auth0-app-details.json | ConvertFrom-Json).client_id; $ClientSecret = (Get-Content -Raw auth0-app-details.json | ConvertFrom-Json).client_secret; $Domain = (auth0 tenants list --json | ConvertFrom-Json | Where-Object { $_.active -eq $true }).name; $Secret = [System.Convert]::ToHexString([System.Security.Cryptography.RandomNumberGenerator]::GetBytes(32)).ToLower(); Set-Content -Path .env.local -Value "AUTH0_DOMAIN=$Domain"; Add-Content -Path .env.local -Value "AUTH0_CLIENT_ID=$ClientId"; Add-Content -Path .env.local -Value "AUTH0_CLIENT_SECRET=$ClientSecret"; Add-Content -Path .env.local -Value "AUTH0_SECRET=$Secret"; Add-Content -Path .env.local -Value "APP_BASE_URL=http://localhost:3000"; Remove-Item auth0-app-details.json; Write-Output ".env.local file created with your Auth0 details:"; Get-Content .env.local
          ```
        </AuthCodeGroup>
      </Tab>

      <Tab title="Tableau de bord">
        Cr√©ez un fichier `.env.local` dans le r√©pertoire racine de votre projet :

        ```shellscript .env.local
        AUTH0_DOMAIN=YOUR_AUTH0_APP_DOMAIN
        AUTH0_CLIENT_ID=YOUR_AUTH0_APP_CLIENT_ID
        AUTH0_CLIENT_SECRET=YOUR_AUTH0_APP_CLIENT_SECRET
        AUTH0_SECRET=YOUR_LONG_RANDOM_SECRET_HERE
        APP_BASE_URL=http://localhost:3000
        ```

        **G√©n√©rez un AUTH0&#95;SECRET s√©curis√© :**

        ```shellscript
        openssl rand -hex 32
        ```

        Copiez la sortie et remplacez `YOUR_LONG_RANDOM_SECRET_HERE` dans `.env.local`. Celle-ci doit comporter exactement 64 caract√®res hexad√©cimaux.

        Configurez ensuite votre application Auth0 :

        Configurez ensuite votre application Auth0 :

        1. Allez dans le [Auth0 Dashboard](https://manage.auth0.com/dashboard/)
        2. Cliquez sur **Applications** &gt; **Applications** &gt; **Create Application**
        3. Dans la fen√™tre contextuelle, entrez un nom pour votre application, s√©lectionnez `Regular Web Application` comme type d&#39;application et cliquez sur **Create**
        4. Passez √† l‚Äôonglet **Settings** sur la page Application Details
        5. Remplacez `YOUR_AUTH0_APP_DOMAIN`, `YOUR_AUTH0_APP_CLIENT_ID` et `YOUR_AUTH0_APP_CLIENT_SECRET` dans le fichier `.env.local` par les valeurs **Domain**, **Client ID** et **Client Secret** √† partir du Auth0 Dashboard

        <Warning>
          **Critique :** Si vous modifiez `AUTH0_SECRET` apr√®s le d√©marrage de l‚Äôapplication, vous devez supprimer les t√©moins (cookies) de votre navigateur pour localhost. Les anciens t√©moins de session chiffr√©s avec le secret pr√©c√©dent provoqueront une erreur `JWEDecryptionFailed`.
        </Warning>

        Enfin, dans l‚Äôonglet **Settings** de la page Application Details, configurez les URL suivantes :

        **URL de redirection autoris√©es :**

        ```
        http://localhost:3000/auth/callback
        ```

        **URL de d√©connexion autoris√©es :**

        ```
        http://localhost:3000
        ```

        **Origines Web autoris√©es¬†:**

        ```
        http://localhost:3000
        ```

        <Info>
          Les **URL de redirection autoris√©es** sont une mesure de s√©curit√© essentielle pour garantir que les utilisateurs sont renvoy√©s en toute s√©curit√© √† votre application apr√®s l‚Äôauthentification. Sans URL correspondante, le processus de connexion √©chouera et les utilisateurs seront bloqu√©s sur une page d‚Äôerreur Auth0 au lieu d‚Äôacc√©der √† votre application.

          Les **URL de d√©connexion autoris√©es** sont essentielles pour offrir une exp√©rience utilisateur fluide lors de la d√©connexion. Sans URL correspondante, les utilisateurs ne seront pas redirig√©s vers votre application apr√®s la d√©connexion et resteront sur une page Auth0 g√©n√©rique.

          Les **origines Web autoris√©es** sont essentielles pour l‚Äôauthentification silencieuse. Sans elles, les utilisateurs seront d√©connect√©s lorsqu‚Äôils actualiseront la page ou reviendront plus tard √† votre application.
        </Info>
      </Tab>
    </Tabs>
  </Step>

  <Step title="Cr√©er la configuration d‚ÄôAuth0" stepNumber={5}>
    Ajoutez le code du client Auth0 √† `src/lib/auth0.ts`¬†:

    ```typescript src/lib/auth0.ts lines
    import { Auth0Client } from '@auth0/nextjs-auth0/server';

    export const auth0 = new Auth0Client();
    ```
  </Step>

  <Step title="Ajouter un middleware" stepNumber={6}>
    Ajoutez le code du middleware dans `src/middleware.ts`¬†:

    ```typescript src/middleware.ts expandable lines
    import type { NextRequest } from "next/server";
    import { auth0 } from "./lib/auth0";

    export async function middleware(request: NextRequest) {
      return await auth0.middleware(request);
    }

    export const config = {
      matcher: [
        /*
         * Correspond √† tous les chemins de requ√™te, sauf ceux commen√ßant par :
         * - _next/static (fichiers statiques)
         * - _next/image (fichiers d'optimisation d'images)
         * - favicon.ico, sitemap.xml, robots.txt (fichiers de m√©tadonn√©es)
         */
        "/((?!_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)",
      ],
    };
    ```

    <Note>
      Comme nous utilisons un r√©pertoire `src/`, le fichier `middleware.ts` est cr√©√© √† l‚Äôint√©rieur de `src/`. Si vous n‚Äôutilisez pas de r√©pertoire `src/`, cr√©ez-le plut√¥t √† la racine du projet.
    </Note>

    <Info>
      Ce middleware configure automatiquement les routes d‚Äôauthentification suivantes :

      * `/auth/login` - Route de connexion
      * `/auth/logout` - Route de d√©connexion
      * `/auth/callback` - Route de rappel
      * `/auth/profile` - Route du profil utilisateur
      * `/auth/access-token` - Route du jeton d‚Äôacc√®s
      * `/auth/backchannel-logout` - Route de d√©connexion backchannel
    </Info>
  </Step>

  <Step title="Cr√©er les composants Login, Logout et Profile" stepNumber={7}>
    Ajoutez le code des composants aux fichiers cr√©√©s √† l‚Äô√©tape 3¬†:

    <AuthCodeGroup>
      ```typescript src/components/LoginButton.tsx lines
      "use client";

      export default function LoginButton() {
        return (
          <a
            href="/auth/login"
            className="button login"
          >
            Connexion
          </a>
        );
      }
      ```

      ```typescript src/components/LogoutButton.tsx lines
      "use client";

      export default function LogoutButton() {
        return (
          <a
            href="/auth/logout"
            className="button logout"
          >
            D√©connexion
          </a>
        );
      }
      ```

      ```typescript src/components/Profile.tsx expandable lines
      "use client";

      import { useUser } from "@auth0/nextjs-auth0/client";

      export default function Profile() {
        const { user, isLoading } = useUser();

        if (isLoading) {
          return (
            <div className="loading-state">
              <div className="loading-text">Chargement du profil utilisateur...</div>
            </div>
          );
        }

        if (!user) {
          return null;
        }

        return (
          <div className="profile-card action-card">
            <img
              src={user.picture || `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2363b3ed'/%3E%3Cpath d='M50 45c7.5 0 13.64-6.14 13.64-13.64S57.5 17.72 50 17.72s-13.64 6.14-13.64 13.64S42.5 45 50 45zm0 6.82c-9.09 0-27.28 4.56-27.28 13.64v3.41c0 1.88 1.53 3.41 3.41 3.41h47.74c1.88 0 3.41-1.53 3.41-3.41v-3.41c0-9.08-18.19-13.64-27.28-13.64z' fill='%23fff'/%3E%3C/svg%3E`}
              alt={user.name || 'Profil utilisateur'}
              className="profile-picture"
              onError={(e) => {
                const target = e.target as HTMLImageElement;
                target.src = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2363b3ed'/%3E%3Cpath d='M50 45c7.5 0 13.64-6.14 13.64-13.64S57.5 17.72 50 17.72s-13.64 6.14-13.64 13.64S42.5 45 50 45zm0 6.82c-9.09 0-27.28 4.56-27.28 13.64v3.41c0 1.88 1.53 3.41 3.41 3.41h47.74c1.88 0 3.41-1.53 3.41-3.41v-3.41c0-9.08-18.19-13.64-27.28-13.64z' fill='%23fff'/%3E%3C/svg%3E`;
              }}
            />
            <h2 className="profile-name">{user.name}</h2>
            <p className="profile-email">{user.email}</p>
          </div>
        );
      }
      ```
    </AuthCodeGroup>
  </Step>

  <Step title="Mettez √† jour votre page d‚Äôaccueil" stepNumber={8}>
    Remplacez `src/app/page.tsx` par¬†:

    ```typescript src/app/page.tsx expandable lines
    import { auth0 } from "@/lib/auth0";
    import LoginButton from "@/components/LoginButton";
    import LogoutButton from "@/components/LogoutButton";
    import Profile from "@/components/Profile";

    export default async function Home() {
      const session = await auth0.getSession();
      const user = session?.user;

      return (
        <div className="app-container">
          <div className="main-card-wrapper">
            <img
              src="https://cdn.auth0.com/quantum-assets/dist/latest/logos/auth0/auth0-lockup-en-ondark.png"
              alt="Auth0 Logo"
              className="auth0-logo"
            />
            <h1 className="main-title">Next.js + Auth0</h1>
            
            <div className="action-card">
              {user ? (
                <div className="logged-in-section">
                  <p className="logged-in-message">‚úÖ Successfully logged in!</p>
                  <Profile />
                  <LogoutButton />
                </div>
              ) : (
                <>
                  <p className="action-text">
                    Bienvenue! Veuillez vous connecter pour acc√©der √† votre contenu prot√©g√©.
                  </p>
                  <LoginButton />
                </>
              )}
            </div>
          </div>
        </div>
      );
    }
    ```
  </Step>

  <Step title="Mettre √† jour le layout avec Auth0Provider (OPTIONNEL)" stepNumber={9}>
    Mettez √† jour `src/app/layout.tsx` pour encapsuler votre application dans `Auth0Provider` :

    ```typescript src/app/layout.tsx lines
    import type { Metadata } from "next";
    import { Auth0Provider } from "@auth0/nextjs-auth0/client";
    import "./globals.css";

    export const metadata: Metadata = {
      title: "Auth0 Next.js App",
      description: "Next.js app with Auth0 authentication",
    };

    export default function RootLayout({
      children,
    }: {
      children: React.ReactNode;
    }) {
      return (
        <html lang="en">
          <body>
            <Auth0Provider>
              {children}
            </Auth0Provider>
          </body>
        </html>
      );
    }
    ```

    <Note>
      Dans la v4, Auth0Provider est **facultatif**. Vous n&#39;en avez besoin que si vous voulez transmettre un utilisateur initial lors du rendu c√¥t√© serveur afin qu&#39;il soit disponible pour le hook `useUser()`.
    </Note>
  </Step>

  <Step title="Ajouter le style" stepNumber={10}>
    Remplacez `src/app/globals.css` par un style moderne aux couleurs d&#39;Auth0 :

    ```css src/app/globals.css expandable lines
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    @tailwind base;
    @tailwind components;
    @tailwind utilities;

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: #1a1e27;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #e2e8f0;
      overflow: hidden;
    }

    .app-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      width: 100%;
      padding: 1rem;
      box-sizing: border-box;
    }

    .loading-state, .error-state {
      background-color: #2d313c;
      border-radius: 15px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      padding: 3rem;
      text-align: center;
    }

    .loading-text {
      font-size: 1.8rem;
      font-weight: 500;
      color: #a0aec0;
      animation: pulse 1.5s infinite ease-in-out;
    }

    .main-card-wrapper {
      background-color: #262a33;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
      padding: 3rem;
      max-width: 500px;
      width: 90%;
      animation: fadeInScale 0.8s ease-out forwards;
    }

    .auth0-logo {
      width: 160px;
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: slideInDown 1s ease-out forwards 0.2s;
    }

    .main-title {
      font-size: 2.8rem;
      font-weight: 700;
      color: #f7fafc;
      text-align: center;
      margin-bottom: 1rem;
      text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      opacity: 0;
      animation: fadeIn 1s ease-out forwards 0.4s;
    }

    .action-card {
      background-color: #2d313c;
      border-radius: 15px;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3), 0 5px 15px rgba(0, 0, 0, 0.3);
      padding: 2.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.8rem;
      width: calc(100% - 2rem);
      opacity: 0;
      animation: fadeIn 1s ease-out forwards 0.6s;
    }

    .action-text {
      font-size: 1.25rem;
      color: #cbd5e0;
      text-align: center;
      line-height: 1.6;
      font-weight: 400;
    }

    .button {
      padding: 1.1rem 2.8rem;
      font-size: 1.2rem;
      font-weight: 600;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      outline: none;
    }

    .button:focus {
      box-shadow: 0 0 0 4px rgba(99, 179, 237, 0.5);
    }

    .button.login {
      background-color: #63b3ed;
      color: #1a1e27;
    }

    .button.login:hover {
      background-color: #4299e1;
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
    }

    .button.logout {
      background-color: #fc8181;
      color: #1a1e27;
    }

    .button.logout:hover {
      background-color: #e53e3e;
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
    }

    .logged-in-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
      width: 100%;
    }

    .logged-in-message {
      font-size: 1.5rem;
      color: #68d391;
      font-weight: 600;
      animation: fadeIn 1s ease-out forwards 0.8s;
    }

    .profile-card {
      padding: 2.2rem;
      animation: scaleIn 0.8s ease-out forwards 1.2s;
    }

    .profile-picture {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      transition: transform 0.3s ease-in-out;
      object-fit: cover;
    }

    .profile-picture:hover {
      transform: scale(1.05);
    }

    .profile-name {
      font-size: 2rem;
      margin-top: 0.5rem;
    }

    .profile-email {
      font-size: 1.15rem;
      text-align: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes slideInDown {
      from { opacity: 0; transform: translateY(-70px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }

    @media (max-width: 600px) {
      .main-card-wrapper {
        padding: 2rem;
        gap: 1.5rem;
      }
      
      .main-title {
        font-size: 2.2rem;
      }
      
      .button {
        padding: 0.9rem 2rem;
        font-size: 1rem;
      }
      
      .auth0-logo {
        width: 120px;
      }
    }
    ```
  </Step>

  <Step title="Lancez votre application" stepNumber={11}>
    ```shellscript
    npm run dev
    ```

    <Info>
      Votre application sera accessible √† l&#39;adresse [http://localhost:3000](http://localhost:3000). La trousse de d√©veloppement logiciel (SDK) Auth0 v4 monte automatiquement les routes d&#39;authentification sous `/auth/*` (et non `/api/auth/*` comme dans la v3).
    </Info>
  </Step>
</Steps>

<Check>
  **Point de contr√¥le**

  Vous devriez maintenant avoir une page de connexion Auth0 enti√®rement fonctionnelle qui s‚Äôex√©cute sur votre [localhost](http://localhost:3000/)
</Check>

---

<div id="troubleshooting">
  ## D√©pannage
</div>

<Accordion title="Erreur JWEDecryptionFailed">
  Si vous voyez une erreur `JWEDecryptionFailed: decryption operation failed`, cela est caus√© soit par une valeur `AUTH0_SECRET` non valide, soit par un ancien cookie de session chiffr√© avec un secret diff√©rent.

  **Solution :**
  
  1. G√©n√©rez un nouveau secret en utilisant :
  ```shellscript
  openssl rand -hex 32
  ```
  
  2. Mettez √† jour votre fichier `.env.local` :
  ```
  AUTH0_SECRET=<your-new-64-character-hex-string>
  ```
  
  3. **Supprimez les cookies de votre navigateur** pour `localhost:3000` :
     - Chrome/Edge : Appuyez sur `F12` ‚Üí Application tab ‚Üí Cookies ‚Üí Delete all cookies for localhost
     - Firefox : Appuyez sur `F12` ‚Üí Storage tab ‚Üí Cookies ‚Üí Delete all cookies for localhost
     - Safari : Develop menu ‚Üí Show Web Inspector ‚Üí Storage tab ‚Üí Cookies ‚Üí Delete all
  
  4. Red√©marrez votre serveur de d√©veloppement :
  ```shellscript
  npm run dev
  ```
  
  Le secret doit √™tre exactement de 32 octets (64 caract√®res hexad√©cimaux). L‚Äôerreur se produit lorsque l‚Äôapplication tente de d√©chiffrer un cookie de session existant qui a √©t√© chiffr√© avec un secret diff√©rent.
</Accordion>

<Accordion title="Erreur 404 sur /auth/login">
  Si, lorsque vous cliquez sur connexion, vous arrivez sur une page 404, v√©rifiez ces probl√®mes courants :

  1. **Emplacement du middleware :** Assurez-vous que `src/middleware.ts` existe au bon endroit
  2. **Code du middleware :** V√©rifiez que le middleware correspond au code de l‚Äô√©tape&nbsp;6
  3. **Red√©marrer le serveur :** Apr√®s avoir cr√©√© le middleware, red√©marrez le serveur de d√©veloppement
  4. **V√©rifier les imports :** Assurez-vous que le chemin `import { auth0 } from "./lib/auth0"` est correct
</Accordion>

<Accordion title="Erreurs ¬´ Module Not Found ¬ª">
  Si vous voyez ¬´ Cannot find module '@/components/LoginButton' ¬ª ou des erreurs similaires :

  1. **V√©rifier l‚Äôexistence des fichiers :** Assurez-vous que tous les fichiers de l‚Äô√©tape&nbsp;3 ont √©t√© cr√©√©s
  2. **V√©rifier les chemins :** Assurez-vous que les composants se trouvent dans le r√©pertoire `src/components/`
  3. **Red√©marrer TypeScript :** Appuyez sur `Cmd+Shift+P` (Mac) ou `Ctrl+Shift+P` (Windows) et ex√©cutez ¬´ TypeScript: Restart TS Server ¬ª
  4. **V√©rifier les imports :** Assurez-vous d‚Äôutiliser `@/components/*` (et non `~/components/*`)
</Accordion>

---

<div id="advanced-usage">
  ## Utilisation avanc√©e
</div>

<Accordion title="Changements importants de la v4">
  Ce D√©marrage rapide utilise **Auth0 Next.js SDK v4**, qui comporte des changements importants par rapport √† la v3‚ÄØ:

  - **Plus besoin de gestionnaires de routes dynamiques** - Les routes d‚Äôauthentification sont automatiquement mont√©es par le middleware
  - **Configuration du client simplifi√©e** - `new Auth0Client()` lit automatiquement les variables d‚Äôenvironnement
  - **Nouveaux chemins de route** - Les routes se trouvent sous `/auth/*` plut√¥t que `/api/auth/*`
  - **Middleware requis** - Toutes les fonctionnalit√©s d‚Äôauthentification passent par le middleware
  - **Utilisez des balises `<a>`** - La navigation doit utiliser `<a href="/auth/login">` plut√¥t que des boutons avec onClick

  ### Routes d‚Äôauthentification

  Le SDK monte automatiquement ces routes via le middleware‚ÄØ:

  | Route                      | Objectif                      |
  | -------------------------- | ----------------------------- |
  | `/auth/login`              | Initier la connexion          |
  | `/auth/logout`             | D√©connecter l‚Äôutilisateur     |
  | `/auth/callback`           | G√©rer le callback Auth0       |
  | `/auth/profile`            | Obtenir le profil utilisateur |
  | `/auth/access-token`       | Obtenir un jeton d‚Äôacc√®s      |
  | `/auth/backchannel-logout` | G√©rer la d√©connexion backchannel |

  <Note>
    Si vous obtenez des erreurs 404 sur ces routes, assurez-vous que‚ÄØ:
    1. Le fichier `middleware.ts` est cr√©√© √† l‚Äôemplacement correct (racine du projet, ou dans `src/` si vous utilisez un r√©pertoire `src/`)
    2. Le middleware est correctement configur√© avec le motif de correspondance (matcher) pr√©sent√© √† l‚Äô√©tape 5
    3. Le serveur de d√©veloppement a √©t√© red√©marr√© apr√®s la cr√©ation du fichier de middleware
  </Note>
</Accordion>

<Accordion title="Authentification c√¥t√© serveur">
  Auth0 Next.js SDK v4 prend en charge les mod√®les App Router et Pages Router. Voici quelques mod√®les courants c√¥t√© serveur‚ÄØ:

  <Tabs>
    <Tab title="App Router - Server Component">
      ```typescript app/protected/page.tsx
      import { auth0 } from "@/lib/auth0";
      import { redirect } from "next/navigation";
      
      export default async function ProtectedPage() {
        const session = await auth0.getSession();
        
        if (!session) {
          redirect('/auth/login');
        }
      
        return (
          <div>
            <h1>Protected Content</h1>
            <p>Welcome, {session.user.name}!</p>
          </div>
        );
      }
      ```
    </Tab>
    <Tab title="App Router - API Route">
      ```typescript app/api/protected/route.ts
      import { auth0 } from "@/lib/auth0";
      import { NextRequest, NextResponse } from "next/server";
      
      export async function GET() {
        const session = await auth0.getSession();
        
        if (!session) {
          return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
        }
        
        return NextResponse.json({
          message: "This is a protected API route",
          user: session.user
        });
      }
      ```
    </Tab>
    <Tab title="Pages Router - Page">
      ```typescript pages/protected.tsx
      import { auth0 } from "@/lib/auth0";
      import { GetServerSideProps } from "next";
      
      export default function ProtectedPage({ user }: { user: any }) {
        return (
          <div>
            <h1>Protected Content</h1>
            <p>Welcome, {user.name}!</p>
          </div>
        );
      }
      
      export const getServerSideProps: GetServerSideProps = auth0.withPageAuthRequired();
      ```
    </Tab>
  </Tabs>
</Accordion>

<Accordion title="Authentification c√¥t√© client">
  Pour l‚Äô√©tat d‚Äôauthentification c√¥t√© client, utilisez le hook `useUser`‚ÄØ:

  ```typescript components/UserProfile.tsx
  "use client";

  import { useUser } from "@auth0/nextjs-auth0";

  export default function UserProfile() {
    const { user, error, isLoading } = useUser();

    if (isLoading) return <div>Loading...</div>;
    if (error) return <div>Error: {error.message}</div>;
    if (!user) return <div>Not logged in</div>;

    return (
      <div>
        <h2>{user.name}</h2>
        <p>{user.email}</p>
        <img src={user.picture} alt="Profile" />
      </div>
    );
  }
  ```
</Accordion>

<Accordion title="Protection des routes d'API">
  Pour prot√©ger des routes d'API, utilisez la m√©thode `withApiAuthRequired` :

  ```typescript app/api/protected/route.ts
  import { auth0 } from "@/lib/auth0";

  export const GET = auth0.withApiAuthRequired(async function handler() {
    const session = await auth0.getSession();
    
    return Response.json({
      message: "Ceci est une route d'API prot√©g√©e",
      user: session?.user
    });
  });
  ```
</Accordion>