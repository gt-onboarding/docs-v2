---
title: "Java Spring Boot"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";

<div id="by-jim-anderson">
  ##### Par Jim Anderson
</div>

Le Starter Okta Spring Boot facilite l’ajout de la fonctionnalité de connexion à votre application Spring Boot. Nous vous recommandons de vous connecter pour suivre ce Démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Voir sur GitHub" href="https://github.com/auth0-samples/auth0-spring-boot-login-samples/tree/master/mvc-login" icon="github">
  Configuration système requise : Java 17
  </Card> */}

<Note>
  ### Vous utilisez Spring WebFlux ?

  Ce tutoriel utilise [Spring MVC](https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html). Si vous utilisez [Spring WebFlux](https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#spring-web-reactive), les étapes pour ajouter l’authentification sont similaires, mais certains détails d’implémentation sont différents. Consultez l’[exemple de code Spring Boot WebFlux](https://github.com/auth0-samples/auth0-spring-boot-login-samples/tree/master/webflux-login) pour voir comment intégrer Auth0 à votre application Spring Boot WebFlux.
</Note>

<Info>
  **Vous débutez avec l’authentification?** Découvrez le [fonctionnement d’Auth0](/docs/fr-CA/get-started/auth0-overview), comment il [s’intègre aux applications Web classiques](/docs/fr-CA/get-started/architecture-scenarios/sso-for-regular-web-apps) et quel [protocole](/docs/fr-CA/get-started/authentication-and-authorization-flow) il utilise.
</Info>

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenir les clés de votre Application
</div>

Lors de votre inscription à Auth0, une nouvelle Application a été créée pour vous ou vous avez pu en créer une nouvelle. Vous aurez besoin de certains paramètres de cette Application pour communiquer avec Auth0. Vous pouvez obtenir ces informations dans la section [Application Settings](https://manage.auth0.com/#/applications) de l’Auth0 Dashboard.

<Frame>![Tableau de bord de l’application](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

Vous avez besoin des informations suivantes :

* **Domaine**
* **ID client**
* **Secret client**

<Info>
  Si vous téléchargez l’exemple en haut de cette page, ces informations y sont déjà renseignées.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de redirection (callback)
</div>

Une URL de redirection (callback) est une URL dans votre application vers laquelle Auth0 redirige l’utilisateur après son authentification. L’URL de redirection de votre application doit être ajoutée au champ **URL de redirection autorisées** dans vos [paramètres de l’Application](https://manage.auth0.com/#/applications). Si ce champ n’est pas défini, les utilisateurs ne pourront pas se connecter à l’Application et recevront un message d’erreur.

<Info>
  Si vous suivez le projet d’exemple que vous avez téléchargé à partir du haut de cette page, l’URL de redirection que vous devez ajouter au champ **URL de redirection autorisées** est `http://localhost:3000/login/oauth2/code/okta`.
</Info>

<div id="configure-logout-urls">
  ### Configurer les URL de déconnexion
</div>

Une URL de déconnexion est une URL de votre application vers laquelle Auth0 peut rediriger l’utilisateur après sa déconnexion du serveur d’autorisation. Elle est spécifiée dans le paramètre de requête `returnTo`. L’URL de déconnexion de votre application doit être ajoutée au champ **URL de déconnexion autorisées** dans vos [paramètres d’Application](https://manage.auth0.com/#/applications). Si ce champ n’est pas défini, les utilisateurs ne pourront pas se déconnecter de l’application et recevront un message d’erreur.

<Info>
  Si vous suivez le projet d’exemple que vous avez téléchargé en haut de cette page, l’URL de déconnexion que vous devez ajouter au champ **URL de déconnexion autorisées** est `http://localhost:3000/`.
</Info>

<div id="configure-spring-boot-application">
  ## Configurer l&#39;application Spring Boot
</div>

<div id="add-dependencies">
  ### Ajouter des dépendances
</div>

Pour intégrer votre application Spring Boot à Auth0, ajoutez [Okta Spring Boot Starter](https://github.com/okta/okta-spring-boot/) aux dépendances de votre application.

<Info>
  Ce guide utilise [Thymeleaf](https://www.thymeleaf.org/) et le [module d’intégration Spring Security](https://github.com/thymeleaf/thymeleaf-extras-springsecurity) pour la couche de présentation. Si vous utilisez un autre moteur de vues, la configuration et les composants Spring Security demeurent les mêmes.
</Info>

Si vous utilisez Gradle, vous pouvez inclure ces dépendances comme illustré ci-dessous.

```gradle lines
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.1.4'
    id 'io.spring.dependency-management' version '1.1.3'
}

implementation 'com.okta.spring:okta-spring-boot-starter:3.0.5'
implementation 'org.springframework.boot:spring-boot-starter-web'
implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity6'
implementation 'nz.net.ultraq.thymeleaf:thymeleaf-layout-dialect'
```

Si vous utilisez Maven :

```xml lines
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.1.5</version>
    <relativePath/>
</parent>

<dependencies>
    <dependency>
        <groupId>com.okta</groupId>
        <artifactId>okta-spring-boot-starter</artifactId>
        <version>3.0.5</version>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-oauth2-client</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-thymeleaf</artifactId>
    </dependency>
    <dependency>
        <groupId>org.thymeleaf.extras</groupId>
        <artifactId>thymeleaf-extras-springsecurity6</artifactId>
    </dependency>
    <dependency>
        <groupId>nz.net.ultraq.thymeleaf</groupId>
        <artifactId>thymeleaf-layout-dialect</artifactId>
    </dependency>
</dependencies>
```

<div id="configure-spring-security">
  ### Configurer Spring Security
</div>

Le starter Okta Spring Boot facilite la configuration de votre application avec Auth0. L’exemple ci-dessous utilise un fichier `application.yml`, mais vous pouvez aussi utiliser des fichiers de propriétés ou l’un des autres [mécanismes pris en charge pour l’externalisation de la configuration](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config).

export const codeExample = `# src/main/resources/application.yml
okta:
  oauth2:
    issuer: https://{yourDomain}/
    client-id: {yourClientId}
    client-secret: {yourClientSecret}

# L'exemple et les instructions ci-dessus pour la configuration des URL de rappel et de déconnexion emploient le port 3000.
# Si vous souhaitez utiliser un autre port, modifiez cette valeur et assurez-vous que vos URL de rappel et de déconnexion
# sont configurées avec le port approprié.
server:
  port: 3000`;

<AuthCodeBlock children={codeExample} language="yml" />

<div id="add-login-to-your-application">
  ## Ajouter la connexion à votre application
</div>

Pour activer la connexion des utilisateurs avec Auth0, créez une classe qui enregistre un [SecurityFilterChain](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/web/SecurityFilterChain.html) et ajoutez l’annotation `@Configuration`.

```java lines
package com.auth0.example;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;

import static org.springframework.security.config.Customizer.withDefaults;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain configure(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(authorize -> authorize
                .anyRequest().authenticated()
            )
            .oauth2Login(withDefaults());
        return http.build();
    }
}
```

<Info>
  Vous pouvez configurer davantage l’instance [HttpSecurity](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html) pour exiger une authentification sur tous les chemins ou seulement sur certains. Par exemple, pour exiger une authentification sur tous les chemins sauf la page d’accueil :

  ```java lines
  http
      .authorizeHttpRequests(authorize -> authorize
          .requestMatchers("/").permitAll()
          .anyRequest().authenticated()
      );
  ```
</Info>

L’Okta Spring Boot Starter utilisera la configuration du client que vous avez définie plus tôt pour gérer la connexion lorsqu’un utilisateur visite le chemin `/oauth2/authorization/okta` de votre application. Vous pouvez l’utiliser pour créer un lien de connexion dans votre application.

```html lines
<!-- src/main/resources/templates/index.html -->
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
    <body>
        <div sec:authorize="!isAuthenticated()">
            <a th:href="@{/oauth2/authorization/okta}">Log In</a>
        </div>
        <div sec:authorize="isAuthenticated()">
            <p>You are logged in!</p>
        </div>
    </body>
</html>
```

Assurez-vous de créer ou de mettre à jour un contrôleur pour rendre votre vue.

```java lines
package com.auth0.example;

import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.security.oauth2.core.oidc.user.OidcUser;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

/**
 * Contrôleur de la page d'accueil.
 */
@Controller
public class HomeController {

    @GetMapping("/")
    public String home(Model model, @AuthenticationPrincipal OidcUser principal) {
        return "index";
    }
}
```

<Note>
  ### Point de contrôle

  Ajoutez le lien de connexion à votre application. Lorsque vous cliquez dessus, vérifiez que votre application vous redirige vers la page [Auth0 Universal Login](https://auth0.com/universal-login) et que vous pouvez maintenant vous connecter ou vous inscrire à l’aide d’un nom d’utilisateur et d’un mot de passe ou d’un fournisseur social.

  Une fois cette étape terminée, vérifiez qu’Auth0 vous redirige vers votre application et que vous êtes connecté.
</Note>

<Frame>![Auth0 Universal Login](https://cdn2.auth0.com/docs/1.14550.0/media/quickstarts/universal-login.png)</Frame>

<Info>
  Auth0 active le fournisseur social Google par défaut sur les nouveaux tenants et vous offre des clés de développement pour tester la connexion avec des [fournisseurs d&#39;identité sociale](https://auth0.com/docs/connections/identity-providers-social). Cependant, ces clés de développement comportent certaines limites susceptibles de faire en sorte que votre application se comporte différemment. Pour plus de détails sur ce comportement possible et sur la façon de le corriger, consultez le document [Tester les connexions sociales avec les clés de développement Auth0](https://auth0.com/docs/connections/social/devkeys#limitations-of-developer-keys).
</Info>

<div id="add-logout-to-your-application">
  ## Ajouter la déconnexion à votre application
</div>

Maintenant que les utilisateurs peuvent se connecter à votre application, ils ont besoin [d’un moyen de se déconnecter](https://auth0.com/docs/logout/guides/logout-auth0). Par défaut, lorsque la déconnexion est activée, Spring Security déconnecte l’utilisateur de votre application et efface la session. Pour que la déconnexion via Auth0 fonctionne correctement, vous pouvez fournir un `LogoutHandler` pour rediriger les utilisateurs vers votre [point de terminaison de déconnexion Auth0](https://auth0.com/docs/api/authentication?javascript#logout) (`https://{yourDomain}/v2/logout`), puis les rediriger immédiatement vers votre application.

Dans la classe `SecurityConfig`, fournissez un `LogoutHandler` qui redirige vers le point de terminaison de déconnexion Auth0, puis configurez `HttpSecurity` pour ajouter ce gestionnaire de déconnexion :

```java lines
package com.auth0.example;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.logout.LogoutHandler;
import org.springframework.web.servlet.support.ServletUriComponentsBuilder;

import java.io.IOException;

import static org.springframework.security.config.Customizer.withDefaults;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Value("${okta.oauth2.issuer}")
    private String issuer;
    @Value("${okta.oauth2.client-id}")
    private String clientId;

    @Bean
    public SecurityFilterChain configure(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(authorize -> authorize
                .requestMatchers("/", "/images/**").permitAll()
                .anyRequest().authenticated()
            )
            .oauth2Login(withDefaults())

            // configurer la déconnexion avec Auth0
            .logout(logout -> logout
                .addLogoutHandler(logoutHandler()));
        return http.build();
    }

    private LogoutHandler logoutHandler() {
        return (request, response, authentication) -> {
            try {
                String baseUrl = ServletUriComponentsBuilder.fromCurrentContextPath().build().toUriString();
                response.sendRedirect(issuer + "v2/logout?client_id=" + clientId + "&returnTo=" + baseUrl);
            } catch (IOException e) {
                throw new RuntimeException(e);
            }
        };
    }
}
```

Vous pouvez ensuite mettre à jour votre vue pour qu’elle envoie une requête POST au point de terminaison `/logout` (fourni par défaut par Spring Security), ce qui permettra aux utilisateurs de se déconnecter.

```html lines
<div sec:authorize="isAuthenticated()">
    <p>Vous êtes connecté!</p>
    <form name="logoutForm" th:action="@{/logout}" method="post">
        <button type="submit" value="Déconnexion"/>
    </form>
</div>
```

<Note>
  ### Point de contrôle

  Ajoutez un lien de déconnexion dans l’interface de votre application. Lorsque vous cliquez dessus, vérifiez que votre application vous redirige vers l’adresse que vous avez spécifiée comme l’une des &quot;URL de déconnexion autorisées&quot; dans les &quot;Paramètres&quot; et que vous n’êtes plus connecté à votre application.
</Note>

<div id="show-user-profile-information">
  ## Afficher les informations de profil de l’utilisateur
</div>

Vous pouvez récupérer les [informations de profil](https://auth0.com/docs/users/concepts/overview-user-profile) associées aux utilisateurs connectés à l’aide de la classe [OidcUser](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/oauth2/core/oidc/user/OidcUser.html), qui peut être utilisée conjointement avec l’[annotation AuthenticationPrincipal](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/annotation/AuthenticationPrincipal.html).

Dans votre contrôleur, ajoutez les informations de profil de l’utilisateur au modèle :

```java lines
@Controller
public class HomeController {

    @GetMapping("/")
    public String home(Model model, @AuthenticationPrincipal OidcUser principal) {
        if (principal != null) {
            model.addAttribute("profile", principal.getClaims());
        }
        return "index";
    }
}
```

Vous pouvez ensuite utiliser ces informations de profil dans votre vue, comme montré ci-dessous.

```html lines
<div sec:authorize="isAuthenticated()">
    <Frame><img th:src="${profile.get('picture')}" th:attr="alt=${profile.get('name')}"/></Frame>
    <h2 th:text="${profile.get('name')}"></h2>
    <p th:text="${profile.get('email')}"></p>
    <a th:href="@{/logout}">Se déconnecter</a>
</div>
```

<Note>
  ### Point de contrôle

  Vérifiez que vous pouvez afficher le nom de l&#39;utilisateur ou [toute autre propriété `user`](https://auth0.com/docs/users/references/user-profile-structure#user-profile-attributes) après vous être connecté.
</Note>

<Note>
  ##### Que pouvez-vous faire ensuite ?

  <table>
    <tr>
      <td><a href="/docs/fr-CA/authenticate/identity-providers">Configurer d&#39;autres fournisseurs d&#39;identité</a></td>
      <td><a href="/docs/fr-CA/secure/multi-factor-authentication">Activer l&#39;authentification multifacteur</a></td>
    </tr>

    <tr>
      <td><a href="/docs/fr-CA/secure/attack-protection">En savoir plus sur la protection contre les attaques</a></td>
      <td><a href="/docs/fr-CA/customize/rules">En savoir plus sur les Rules</a></td>
    </tr>
  </table>

  [Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/native/flutter/01-login.md)
</Note>
