---
title: "Express"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";


<div id="by-david-patrick">
  ##### Par David Patrick
</div>

Ce tutoriel montre comment ajouter les fonctionnalités de connexion, de déconnexion et de profil utilisateur à une application Node.js Express. Nous vous recommandons de vous connecter pour suivre ce Démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Voir sur GitHub" href="https://github.com/auth0-samples/auth0-express-webapp-sample/tree/master/01-Login" icon="github">
  Configuration système requise : Node.js 10.13+ | Express 4.17+
  </Card> */}


<div id="configure-auth0">
  ## Configurer Auth0
</div>

Vous devez enregistrer votre application auprès d’Auth0 pour pouvoir commencer à authentifier des utilisateurs. Dans l’Auth0 Dashboard, accédez à l’écran [Applications](https://manage.auth0.com/#/applications), créez une nouvelle **Regular Web Application**, puis suivez les étapes ci-dessous.

<div id="1-configure-callback-url">
  ### 1. Configurer l’URL de rappel
</div>

Une URL de rappel est une URL de l’Application vers laquelle Auth0 redirige les utilisateurs après qu’ils se sont authentifiés. Cette URL doit être enregistrée auprès d’Auth0, sinon les utilisateurs ne pourront pas se connecter à l’Application et recevront une erreur « Callback URL mismatch ».

L’URL de rappel pour l’Application créée dans ce Démarrage rapide est `http://localhost:3000/callback`. Collez-la dans le champ **URL de redirection autorisées** de l’Application que vous venez de créer.

<div id="2-configure-logout-url">
  ### 2. Configurer l’URL de déconnexion
</div>

Une URL de déconnexion est une route de l’application vers laquelle Auth0 peut renvoyer les utilisateurs après leur déconnexion. Cette URL doit être enregistrée auprès d’Auth0, sinon les utilisateurs ne pourront pas se déconnecter de l’application et recevront une « erreur de configuration ».

L’URL de déconnexion pour l’application créée dans ce démarrage rapide est `http://localhost:3000`. Collez-la dans le champ **URL de déconnexion autorisées** de l’Application que vous venez de créer, puis faites défiler la page vers le bas et cliquez sur **Save Changes**.

<div id="3-get-your-application-keys">
  ### 3. Récupérez les clés de votre Application
</div>

Enfin, copiez les champs suivants pour votre Application, que vous utiliserez à l’étape&nbsp;7 :

* **Domaine**
* **ID client**

<div id="integrate-auth0">
  ## Intégrer Auth0
</div>

<div id="4-install-dependencies">
  ### 4. Installer les dépendances
</div>

Votre application aura besoin du module [`express-openid-connect`](https://github.com/auth0/express-openid-connect), une bibliothèque compatible OIDC pour Express dont Auth0 assure la maintenance.

```bash lines
npm install express express-openid-connect --save
```


<div id="5-configure-router">
  ### 5. Configurer le routeur
</div>

La bibliothèque Express OpenID Connect fournit le routeur `auth` pour ajouter des routes d’authentification à votre application. Vous devez configurer le routeur avec les clés de configuration suivantes :

* `authRequired` - Détermine si l’authentification est requise pour toutes les routes
* `auth0Logout` - Utilise la fonctionnalité de déconnexion Auth0
* `baseURL` - L’URL à partir de laquelle l’application est accessible
* `secret` - Une longue chaîne aléatoire utilisée pour chiffrer le cookie de session
* `issuerBaseURL` - Le Domaine sous forme d’URL sécurisée, tel qu’indiqué dans vos [paramètres d’Application](https://manage.auth0.com/#/applications/\{yourClientId}/settings)
* `clientID` - L’ID client indiqué dans vos [paramètres d’Application](https://manage.auth0.com/#/applications/\{yourClientId}/settings)

Voici un exemple de configuration de ce routeur :

export const codeExample = `const { auth } = require('express-openid-connect');

const config = {
  authRequired: false,
  auth0Logout: true,
  baseURL: 'http://localhost:3000',
  clientID: '{yourClientId}',
  issuerBaseURL: 'https://{yourDomain}',
  secret: 'LONG_RANDOM_STRING'
};

// le routeur auth ajoute les routes /login, /logout et /callback à baseURL
app.use(auth(config));

// req.isAuthenticated est fourni par le routeur auth
app.get('/', (req, res) => {
  res.send(req.oidc.isAuthenticated() ? 'Connecté' : 'Déconnecté')
});`;

<AuthCodeBlock children={codeExample} language="javascript" />

Pour obtenir des options de configuration supplémentaires, consultez la [documentation de l’API](https://auth0.github.io/express-openid-connect).

<Info>
  Vous pouvez générer une chaîne appropriée pour `LONG_RANDOM_STRING` en utilisant `openssl rand -hex 32` dans la ligne de commande.
</Info>


<div id="login">
  ## Connexion
</div>

Un utilisateur peut maintenant se connecter à votre application en accédant à la route `/login` fournie par la bibliothèque. Si votre projet s’exécute sur `localhost:3000`, ce lien sera [`http://localhost:3000/login`](http://localhost:3000/login).

<div id="display-user-profile">
  ## Afficher le profil de l&#39;utilisateur
</div>

Pour afficher le profil de l&#39;utilisateur, votre application doit définir une route protégée.

Ajoutez le middleware `requiresAuth` pour les routes qui nécessitent une authentification. Toute route utilisant ce middleware vérifiera l&#39;existence d&#39;une session utilisateur valide et, si aucune n&#39;existe, redirigera l&#39;utilisateur vers la connexion.

```javascript lines
const { requiresAuth } = require('express-openid-connect');

app.get('/profile', requiresAuth(), (req, res) => {
  res.send(JSON.stringify(req.oidc.user));
});
```


<div id="logout">
  ## Déconnexion
</div>

Un utilisateur peut se déconnecter de votre application en se rendant sur la route `/logout` fournie par la bibliothèque. Si vous exécutez votre projet sur `localhost:3000`, ce lien sera [`http://localhost:3000/logout`](http://localhost:3000/logout).

<Info>
Pour une analyse approfondie de la mise en œuvre de l’authentification des utilisateurs dans Express, consultez le guide [Complete Guide to Node.js User Authentication with Auth0](https://auth0.com/blog/complete-guide-to-nodejs-express-user-authentication/). Ce guide fournit des détails supplémentaires, comme la création d’un bouton d’inscription, la protection des routes et l’émission d’appels sécurisés vers une API.
</Info>

<div id="whats-next">
  ## Prochaine étape
</div>

Nous avons préparé quelques exemples d'utilisation de [Express OpenID Connect](https://github.com/auth0/express-openid-connect) pour des cas d'utilisation plus avancés :

* [Personnalisation des routes](https://github.com/auth0/express-openid-connect/blob/master/EXAMPLES.md#3-route-customization)
* [Obtenir des jetons d’accès pour des API externes](https://github.com/auth0/express-openid-connect/blob/master/EXAMPLES.md#4-obtaining-access-tokens-to-call-external-apis)
* [Exiger l’authentification pour des routes spécifiques](https://github.com/auth0/express-openid-connect/blob/master/EXAMPLES.md#2-require-authentication-for-specific-routes)

[Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/webapp/express/01-login.md)