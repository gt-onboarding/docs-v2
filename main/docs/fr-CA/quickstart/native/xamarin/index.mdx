---
title: ".NET pour Android et iOS"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";

<div id="by-frederik-prijck">
  ##### Par Frederik Prijck
</div>

Ce tutoriel montre comment ajouter une fonctionnalité de connexion utilisateur à une application Xamarin à l’aide d’Auth0. Nous vous recommandons de vous connecter pour suivre ce Démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Afficher sur GitHub" href="https://github.com/auth0-samples/auth0-xamarin-oidc-samples/tree/master/Quickstart/01-Login" icon="github">
  Configuration système requise : Visual Studio 2022 ou Visual Studio pour Mac | Xamarin pour Visual Studio | .NET 6+
  </Card> */}

<Info>
  Ce démarrage rapide porte sur .NET Android et iOS, puisqu&#39;ils constituent la nouvelle génération de `Xamarin.Android` et `Xamarin.iOS`. Si vous utilisez toujours `Xamarin.Android` et `Xamarin.iOS`, vous pouvez également suivre ce guide, car l&#39;intégration est identique et les SDK sont compatibles.
</Info>

<Info>
  **Nouveau dans l&#39;authentification ?** Apprenez [comment fonctionne Auth0](/docs/fr-CA/get-started/auth0-overview), comment il [s&#39;intègre aux applications natives](/docs/fr-CA/get-started/architecture-scenarios/mobile-api) et quel [protocole](/docs/fr-CA/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce) il utilise.
</Info>

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenir les clés de votre Application
</div>

Lorsque vous vous êtes inscrit à Auth0, une nouvelle Application a été créée pour vous, ou vous avez peut-être choisi d’en créer une nouvelle. Vous aurez besoin de certaines informations concernant cette Application pour communiquer avec Auth0. Vous pouvez obtenir ces informations dans la section [Application Settings](https://manage.auth0.com/#/applications) de l’Auth0 Dashboard.

<Frame>![Tableau de bord de l'application](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

<Info>
  Lorsque vous utilisez l’Application Default App avec une Application native ou une application monopage (Single Page Application), assurez-vous de mettre à jour la **Token Endpoint Authentication Method** sur `None` et de définir le paramètre **Application Type** sur `SPA` ou `Native`.
</Info>

Vous avez besoin des renseignements suivants :

* **Domaine**
* **ID client**

<Info>
  Si vous téléchargez l’exemple depuis le haut de cette page, ces détails sont déjà renseignés pour vous.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de redirection
</div>

Une URL de redirection est une URL dans votre application vers laquelle Auth0 redirige l&#39;utilisateur après son authentification. L&#39;URL de redirection de votre application doit être ajoutée au champ **Allowed Callback URLs** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n&#39;est pas configuré, les utilisateurs ne pourront pas se connecter à l&#39;application et recevront un message d’erreur.

Les URL de redirection sont les URL qu&#39;Auth0 appelle après le processus d&#39;authentification. Auth0 redirige votre application vers cette URL et y ajoute des paramètres supplémentaires, notamment un code qui sera échangé contre un jeton ID (ID Token), un jeton d’accès (Access Token) et un Jeton d’actualisation (Refresh Token).

Comme les URL de redirection peuvent être manipulées, vous devez ajouter l’URL de votre application aux *Allowed Callback URLs* de votre application pour des raisons de sécurité. Cela permettra à Auth0 de reconnaître ces URL comme valides. Si vous les omettez, l&#39;authentification échouera.

* Pour Android, l&#39;URL de redirection sera au format

  ```
  YOUR_ANDROID_PACKAGE_NAME://{yourDomain}/android/YOUR_ANDROID_PACKAGE_NAME/callback
  ```

  où `YOUR_ANDROID_PACKAGE_NAME` est le Package Name de votre application, par exemple `com.mycompany.myapplication`.
* Pour iOS, l&#39;URL de redirection sera au format

  ```
  YOUR_BUNDLE_IDENTIFIER://{yourDomain}/ios/YOUR_BUNDLE_IDENTIFIER/callback
  ```

  où `YOUR_BUNDLE_IDENTIFIER` est le Bundle Identifier de votre application, par exemple `com.mycompany.myapplication`.

Assurez-vous que l&#39;URL de redirection est en minuscules.

<div id="configure-logout-urls">
  ### Configurer les URL de déconnexion
</div>

Une URL de déconnexion est une URL dans votre application vers laquelle Auth0 peut rediriger l’utilisateur après qu’il a été déconnecté du Serveur d’autorisation. Celle-ci est spécifiée dans le paramètre de requête `returnTo`. L’URL de déconnexion de votre application doit être ajoutée au champ **URL de déconnexion autorisées** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n’est pas configuré, les utilisateurs ne pourront pas se déconnecter de l’application et recevront un message d’erreur.

<Info>
  Si vous suivez le projet d’exemple que vous avez téléchargé en haut de cette page, l’URL de déconnexion que vous devez ajouter au champ **URL de déconnexion autorisées** est la même que l’URL de rappel (callback URL).
</Info>

<div id="install-dependencies">
  ## Installer les dépendances
</div>

Si vous utilisez Visual Studio, ouvrez simplement la « Package Manager Console » (View -&gt; Other Windows -&gt; Package Manager Console) et installez le package :

**Pour Android :**

```
Install-Package Auth0.OidcClient.AndroidX
```

**Pour iOS :**

```
Install-Package Auth0.OidcClient.iOS
```

Sinon, si vous utilisez Visual Studio pour Mac, effectuez les étapes suivantes :

1. Avec le projet chargé dans Visual Studio pour Mac, effectuez un Ctrl+clic (ou un clic droit) sur le dossier **Packages** du projet dans le **Solution Pad**, puis sélectionnez **Add Packages...**
2. La boîte de dialogue **Add Packages** s’affichera. Recherchez le package nommé `Auth0.OidcClient.AndroidX` ou `Auth0.OidcClient.iOS` selon votre plateforme.
3. Cochez la case à côté du package pour le sélectionner, puis cliquez sur le bouton **Add Package**.

<div id="trigger-authentication">
  ## Déclencher l’authentification
</div>

Pour intégrer la connexion Auth0 à votre application, créez une instance de la classe `Auth0Client` et configurez le domaine Auth0 ainsi que l’ID client :

export const codeExample1 = `using Auth0.OidcClient;

var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "{yourDomain}",
    ClientId = "{yourClientId}"
}, this);`;

<AuthCodeBlock children={codeExample1} language="cs" />

Ensuite, appelez la méthode `LoginAsync`, qui redirigera l’utilisateur vers l’écran de connexion. Vous ferez généralement cela dans le gestionnaire d’événements d’un contrôle de l’interface utilisateur, comme un bouton de connexion.

```cs lines
var loginResult = await client.LoginAsync();
```

<div id="handing-the-callback-url">
  ### Gestion de l’URL de rappel
</div>

Après qu’un utilisateur se soit connecté, il sera redirigé vers votre application à l’**URL de rappel** qui a été enregistrée au préalable. Sur Android comme sur iOS, vous devez gérer cette URL de rappel pour terminer le processus d’authentification.

<div id="android">
  ### Android
</div>

Enregistrez un intent qui gérera cette URL de rappel. Le plus simple est d’enregistrer l’intent dans la même activité à partir de laquelle vous avez appelé la méthode `LoginAsync` pour lancer le flux d’authentification.

export const codeExample2 = `[Activity(Label = "AndroidSample", MainLauncher = true, Icon = "@drawable/icon",
    LaunchMode = LaunchMode.SingleTask)]
[IntentFilter(
    new[] { Intent.ActionView },
    Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
    DataScheme = "YOUR_ANDROID_PACKAGE_NAME",
    DataHost = "{yourDomain}",
    DataPathPrefix = "/android/YOUR_ANDROID_PACKAGE_NAME/callback")]
public class MainActivity : Activity
{
    // Code omis
}`;

<AuthCodeBlock children={codeExample2} language="cs" />

Remplacez `YOUR_ANDROID_PACKAGE_NAME` dans l’exemple de code ci-dessus par le nom de package de votre application, par exemple `com.mycompany.myapplication`. Assurez-vous aussi que l’intégralité du texte de `DataScheme`, `DataHost` et `DataPathPrefix` est en minuscules. De plus, définissez `LaunchMode = LaunchMode.SingleTask` pour l’`Activity`, sinon le système créera une nouvelle instance de l’activité chaque fois que la Callback URL sera appelée.

Écrivez maintenant le code pour gérer l’intent. Pour ce faire, surchargez la méthode `OnNewIntent`. À l’intérieur de cette méthode, vous devez appeler la méthode `Send` sur `ActivityMediator` pour terminer le cycle d’authentification :

```cs lines
protected override async void OnNewIntent(Intent intent)
{
    base.OnNewIntent(intent);

    Auth0.OidcClient.ActivityMediator.Instance.Send(intent.DataString);
}
```

<div id="ios">
  ### iOS
</div>

Enregistrez le schéma d’URL de la Callback URL que votre application doit gérer :

1. Ouvrez le fichier `Info.plist` de votre application dans Visual Studio for Mac et allez à l’onglet **Advanced**.
2. Sous **URL Types**, cliquez sur le bouton **Add URL Type**.
3. Définissez **Identifier** sur `Auth0`, **URL Schemes** avec la même valeur que le **Bundle Identifier** de votre application, et **Role** sur `None`.

Voici un exemple de la représentation XML de votre fichier `info.plist` après avoir ajouté le type d’URL :

```xml lines
<key>CFBundleURLTypes</key>
<array>
    <dict>
        <key>CFBundleTypeRole</key>
        <string>None</string>
        <key>CFBundleURLName</key>
        <string>Auth0</string>
        <key>CFBundleURLSchemes</key>
        <array>
            <string>YOUR_BUNDLE_IDENTIFIER</string>
        </array>
    </dict>
</array>
```

Vous devez gérer l’URL de rappel (Callback URL) dans l’événement `OpenUrl` de votre classe `AppDelegate`. Vous devez informer le Client OIDC Auth0 afin qu’il termine le flux d’authentification en appelant la méthode `Send` du singleton `ActivityMediator`, en lui transmettant l’URL reçue :

```cs lines
using Auth0.OidcClient;

[Register("AppDelegate")]
public class AppDelegate : UIApplicationDelegate
{
    public override bool OpenUrl(UIApplication application, NSUrl url, string sourceApplication, NSObject annotation)
    {
        ActivityMediator.Instance.Send(url.AbsoluteString);

        return true;
    }
}
```

<div id="run-the-application">
  ### Exécuter l’application
</div>

Avec le code ci-dessus, un utilisateur peut se connecter à votre application à l’aide d’Auth0.

<Frame>![Universal Login](https://cdn2.auth0.com/docs/1.14550.0/media/articles/native-platforms/android/login-android.png)</Frame>

<div id="accessing-the-users-information">
  ## Accéder aux informations de l&#39;utilisateur
</div>

Le résultat de la connexion renvoyé indiquera si l&#39;authentification a réussi et, le cas échéant, contiendra les jetons et les revendications (claims) de l&#39;utilisateur.

<div id="authentication-error">
  ### Erreur d’authentification
</div>

Vous pouvez vérifier la propriété `IsError` du résultat afin de déterminer si la connexion a échoué. La propriété `ErrorMessage` contiendra plus de détails sur l’erreur qui s’est produite.

```cs lines
var loginResult = await client.LoginAsync();

if (loginResult.IsError)
{
    Debug.WriteLine($"Une erreur s'est produite lors de la connexion : {loginResult.Error}")
}
```

<div id="accessing-the-tokens">
  ### Accéder aux jetons
</div>

Après une connexion réussie, le résultat de la connexion contiendra le jeton d&#39;identité et le jeton d&#39;accès dans les propriétés `IdentityToken` et `AccessToken`, respectivement.

```cs lines
var loginResult = await client.LoginAsync();

if (!loginResult.IsError)
{
    Debug.WriteLine($"id_token: {loginResult.IdentityToken}");
    Debug.WriteLine($"access_token: {loginResult.AccessToken}");
}
```

<div id="obtaining-the-user-information">
  ### Récupération des renseignements sur l’utilisateur
</div>

Après une connexion réussie, le résultat de la connexion contiendra les renseignements sur l’utilisateur dans la propriété `User`, qui est un [ClaimsPrincipal](https://msdn.microsoft.com/en-us/library/system.security.claims.claimsprincipal\(v=vs.110\).aspx).

Pour obtenir des renseignements sur l’utilisateur, vous pouvez interroger les revendications. Vous pouvez, par exemple, obtenir le nom et l’adresse de courriel de l’utilisateur à partir des revendications `name` et `email` :

```cs lines
if (!loginResult.IsError)
{
    Debug.WriteLine($"name: {loginResult.User.FindFirst(c => c.Type == "name")?.Value}");
    Debug.WriteLine($"email: {loginResult.User.FindFirst(c => c.Type == "email")?.Value}");
}
```

<Info>
  Les déclarations exactes renvoyées dépendent des scopes qui ont été demandés. Pour en savoir plus, consultez la section [Using Scopes](https://auth0.github.io/auth0-oidc-client-net/documentation/advanced-scenarios/scopes.html) dans la documentation de l’Application Auth0 OIDC.
</Info>

Vous pouvez obtenir la liste de toutes les déclarations contenues dans le jeton ID en parcourant la collection `Claims` :

```cs lines
if (!loginResult.IsError)
{
    foreach (var claim in loginResult.User.Claims)
    {
        Debug.WriteLine($"{claim.Type} = {claim.Value}");
    }
}
```

<div id="logout">
  ## Déconnexion
</div>

Pour déconnecter l’utilisateur, appelez la méthode `LogoutAsync`.

```cs lines
BrowserResultType browserResult = await client.LogoutAsync();
```

<Info>
  ##### Que pouvez-vous faire ensuite ?

  <table>
    <tr>
      <td><a href="/docs/fr-CA/authenticate/identity-providers">Configurer d&#39;autres fournisseurs d&#39;identité</a></td>
      <td><a href="/docs/fr-CA/secure/multi-factor-authentication">Activer l&#39;authentification multifacteur</a></td>
    </tr>

    <tr>
      <td><a href="/docs/fr-CA/secure/attack-protection">En savoir plus sur la protection contre les attaques</a></td>
      <td><a href="/docs/fr-CA/customize/rules">En savoir plus sur Rules</a></td>
    </tr>
  </table>

  [Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>
