---
title: "Ionic et Capacitor (React)"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";

<div id="by-steve-hobbs">
  ##### Par Steve Hobbs
</div>

Ce tutoriel montre comment ajouter une connexion utilisateur avec Auth0 à une application Ionic React et Capacitor. Nous vous recommandons de vous connecter afin de suivre ce démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Voir sur GitHub" href="https://github.com/auth0-samples/auth0-ionic-samples/tree/main/react" icon="github">
  Prérequis système : Node et npm (LTS) | XCode 12+ (pour iOS) | Android Studio 4+ (pour Android) | React 18
  </Card> */}

<div id="getting-started">
  ## Mise en route
</div>

Ce démarrage rapide part du principe que vous avez déjà une application [Ionic](https://ionicframework.com/) fonctionnelle avec [Capacitor](https://capacitorjs.com/). Sinon, consultez le guide [Using Capacitor with Ionic Framework](https://capacitorjs.com/docs/getting-started/with-ionic) pour démarrer avec une application simple, ou clonez [nos applications d’exemple](https://github.com/auth0-samples/auth0-ionic-samples).

Vous devriez aussi connaître le [flux de travail de développement de Capacitor](https://capacitorjs.com/docs/basics/workflow).

<Info>
  **Vous débutez avec l’authentification ?** Découvrez [le fonctionnement d’Auth0](/docs/fr-CA/get-started/auth0-overview), la façon dont Auth0 [s’intègre aux applications natives](/docs/fr-CA/get-started/architecture-scenarios/mobile-api) et le [protocole](/docs/fr-CA/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce) qu’il utilise.
</Info>

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenir les clés de votre Application
</div>

Lorsque vous vous êtes inscrit à Auth0, une nouvelle Application a été créée pour vous, ou vous avez peut‑être créé une nouvelle Application. Vous aurez besoin de certains détails au sujet de cette Application pour communiquer avec Auth0. Vous pouvez obtenir ces détails dans la section [Application Settings](https://manage.auth0.com/#/applications) d’Auth0 Dashboard.

<Frame>![App Dashboard](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

<Info>
  Lorsque vous utilisez l’Application Default App avec une application native ou une application monopage, assurez‑vous de définir **Token Endpoint Authentication Method** sur `None` et de définir **Application Type** sur `SPA` ou `Native`.
</Info>

Vous avez besoin des informations suivantes :

* **Domaine**
* **ID client**

<Info>
  Si vous téléchargez l’exemple depuis le haut de cette page, ces détails sont déjà remplis pour vous.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de redirection (callback)
</div>

Une URL de redirection (callback) est une URL de votre application vers laquelle Auth0 redirige l’utilisateur après son authentification. L’URL de redirection de votre application doit être ajoutée au champ **Allowed Callback URLs** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n’est pas configuré, les utilisateurs ne pourront pas ouvrir une session dans l’application et recevront une erreur.

<Info>
  Dans tout cet article, `YOUR_PACKAGE_ID` correspond à l’id de package de votre application. Vous pouvez le trouver et le configurer dans le champ `appId` de votre fichier `capacitor.config.ts`. Consultez [Capacitors Config schema](https://capacitorjs.com/docs/config#schema) pour plus d’informations.
</Info>

Accédez à la section [Application Settings](https://manage.auth0.com/#/applications/\{yourClientId}/settings) de votre Auth0 Dashboard et définissez votre **URL de redirection (Callback URL)** dans le champ **Allowed Callback URLs**.

Vous devez définir la valeur de **Allowed Callback URL** à :

```
YOUR_PACKAGE_ID://{yourDomain}/capacitor/YOUR_PACKAGE_ID/callback
```

<div id="configure-logout-urls">
  ### Configurer les URL de déconnexion
</div>

Une URL de déconnexion est une URL dans votre application vers laquelle Auth0 peut rediriger après que l’utilisateur a été déconnecté du serveur d’autorisation. Celle-ci est spécifiée dans le paramètre de requête `returnTo`. L’URL de déconnexion de votre application doit être ajoutée au champ **URL de déconnexion autorisées** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n’est pas configuré, les utilisateurs ne pourront pas se déconnecter de l’application et recevront un message d’erreur.

Vous devez définir les **URL de déconnexion autorisées** sur

```
YOUR_PACKAGE_ID://{yourDomain}/capacitor/YOUR_PACKAGE_ID/callback
```

<div id="configure-origins">
  ### Configurer les origines
</div>

Pour pouvoir envoyer des requêtes depuis votre application vers Auth0, configurez les **origines autorisées** suivantes dans vos [Application Settings](https://manage.auth0.com/#/applications/\{yourClientId}/settings).

```
capacitor://localhost, http://localhost
```

Ces origines sont requises pour iOS et Android, respectivement.

Enfin, assurez-vous que le **Application Type** de votre application est paramétré sur **Native** dans les [Application Settings](https://manage.auth0.com/#/applications/\{yourClientId}/settings).

<div id="install-the-auth0-react-sdk">
  ## Installer la trousse de développement logiciel (SDK) Auth0 React
</div>

Exécutez la commande suivante dans le répertoire de votre projet pour installer la trousse de développement logiciel (SDK) Auth0 React :

```bash lines
npm install @auth0/auth0-react
```

La Trousse de développement logiciel (SDK) expose des méthodes et des variables qui vous permettent d’intégrer Auth0 à votre application React de manière idiomatique à l’aide des [React Hooks](https://react.dev/reference/react/hooks) ou des [Higher-Order Components](https://reactjs.org/docs/higher-order-components.html).

<div id="install-capacitor-plugins">
  ### Installer les plugins Capacitor
</div>

Ce démarrage rapide et l’exemple utilisent certains plugins officiels de Capacitor. Installez-les dans votre application à l’aide de la commande suivante :

```bash lines
npm install @capacitor/browser @capacitor/app
```

* [`@capacitor/browser`](https://capacitorjs.com/docs/apis/browser) - vous permet d’interagir avec le navigateur système de l’appareil et est utilisé pour ouvrir l’URL du point de terminaison d’authentification d’Auth0
* [`@capacitor/app`](https://capacitorjs.com/docs/apis/app) - vous permet de vous abonner à des événements d’application de haut niveau, utile pour gérer les retours d’appel (callbacks) provenant d’Auth0

<Info>
  Le plugin Browser de Capacitor sur iOS utilise [`SFSafariViewController`](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller) qui, sur iOS 11 et les versions ultérieures, ne partage pas les témoins (cookies) avec Safari sur l’appareil. Cela signifie que le [SSO](https://auth0.com/docs/sso) ne fonctionnera pas sur ces appareils. Si vous avez besoin de SSO, utilisez plutôt un plugin compatible qui repose sur [ASWebAuthenticationSession](https://developer.apple.com/documentation/authenticationservices/aswebauthenticationsession).
</Info>

<div id="configure-the-auth0provider-component">
  ### Configurer le composant Auth0Provider
</div>

En arrière-plan, la Trousse de développement logiciel (SDK) Auth0 React utilise [React Context](https://reactjs.org/docs/context.html) pour gérer l’état d’authentification de vos utilisateurs. Une façon d’intégrer Auth0 à votre application React consiste à encapsuler votre composant racine dans un `Auth0Provider` que vous pouvez importer à partir du SDK.

Ouvrez `src/index.tsx` et encapsulez le composant `App` dans le composant `Auth0Provider`.

export const codeExample1 = `import React from 'react';
import { createRoot } from 'react-dom/client';
import { Auth0Provider } from '@auth0/auth0-react';
import App from './App';

const root = createRoot(document.getElementById('root'));

root.render(
  <Auth0Provider
    domain="{yourDomain}"
    clientId="{yourClientId}"
    useRefreshTokens={true}
    useRefreshTokensFallback={false}
    authorizationParams={{
      redirect_uri: "YOUR_PACKAGE_ID://{yourDomain}/capacitor/YOUR_PACKAGE_ID/callback"
    }}
  >
    <App />
  </Auth0Provider>
);`;

<AuthCodeBlock children={codeExample1} language="js" />

Le composant `Auth0Provider` accepte les props suivantes :

* `domain` : La valeur « domain » indiquée sous « Settings » de l’application que vous avez créée dans votre Auth0 Dashboard, ou votre domaine personnalisé si vous utilisez la [fonctionnalité Custom Domains](https://auth0.com/docs/custom-domains) d’Auth0.
* `clientId` : La valeur « client ID » indiquée sous « Settings » de l’application que vous avez créée dans votre Auth0 Dashboard.
* `useRefreshTokens` : Pour utiliser auth0-react avec Ionic sur Android et iOS, il est nécessaire d’activer les jetons d’actualisation.
* `useRefreshTokensFallback` : Pour utiliser auth0-react avec Ionic sur Android et iOS, il est nécessaire de désactiver le mécanisme de secours basé sur un iframe.
* `authorizationParams.redirect_uri` : L’URL vers laquelle vous souhaitez rediriger vos utilisateurs après leur authentification auprès d’Auth0.

<Warning>
  Pour conserver l’authentification après la fermeture et la réouverture de l’application, vous pouvez définir `cacheLocation` à `localstorage` lors de la configuration de la trousse de développement logiciel (SDK). Cependant, gardez à l’esprit les [risques liés au stockage de jetons dans localstorage](https://auth0.com/docs/libraries/auth0-single-page-app-sdk#change-storage-options). De plus, dans une application Capacitor, localstorage doit être considéré comme **transitoire**, car les données pourraient être récupérées de façon inattendue dans certaines circonstances. Veuillez lire les [recommandations sur le stockage dans la documentation de Capacitor](https://capacitorjs.com/docs/guides/storage#why-cant-i-just-use-localstorage-or-indexeddb).

  Par ailleurs, le SDK peut [utiliser une implémentation de cache personnalisée](https://github.com/auth0/auth0-spa-js/blob/master/EXAMPLES.md#creating-a-custom-cache) pour stocker les jetons, si vous devez utiliser un mécanisme de stockage plus sécurisé et persistant.

  **Remarque** : nous déconseillons **fortement** l’utilisation du [plugin Storage de Capacitor](https://capacitorjs.com/docs/apis/storage) pour stocker des jetons, car il s’appuie respectivement sur [UserDefaults](https://developer.apple.com/documentation/foundation/userdefaults) et [SharedPreferences](https://developer.android.com/reference/android/content/SharedPreferences) sur iOS et Android. Les données stockées avec ces API ne sont pas chiffrées, ne sont pas sécurisées et pourraient également être synchronisées dans le cloud.
</Warning>

<Note>
  ### Point de contrôle

  Maintenant que vous avez configuré `Auth0Provider`, exécutez votre application pour vérifier que le SDK s’initialise correctement et que votre application ne génère aucune erreur liée à Auth0.
</Note>

<div id="add-login-to-your-application">
  ## Ajouter la fonctionnalité de connexion à votre application
</div>

Dans une application Capacitor, le [plugiciel Browser de Capacitor](https://capacitorjs.com/docs/apis/browser) effectue une redirection vers la [page Universal Login](https://auth0.com/universal-login) d’Auth0. Définissez le paramètre `openUrl` pour la fonction `loginWithRedirect` afin d’utiliser `Browser.open`, de sorte que l’URL s’ouvre à l’aide du composant de navigateur système de l’appareil ([SFSafariViewController](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller) sur iOS et [Chrome Custom Tabs](https://developer.chrome.com/docs/android/custom-tabs) sur Android).

<Info>
  Par défaut, la méthode `loginWithRedirect` du SDK utilise `window.location.href` pour naviguer vers la page de connexion dans le navigateur par défaut de l’appareil de l’utilisateur plutôt que dans le composant de navigateur système approprié pour la plateforme. L’utilisateur quitterait ainsi votre application pour s’authentifier, ce qui pourrait entraîner une expérience utilisateur sous-optimale.
</Info>

Ajoutez un nouveau fichier `LoginButton.tsx` avec le code suivant :

```js lines
import { useAuth0 } from '@auth0/auth0-react';
import { Browser } from '@capacitor/browser';
import { IonButton } from '@ionic/react';

const LoginButton: React.FC = () => {
  const { loginWithRedirect } = useAuth0();

  const login = async () => {
    await loginWithRedirect({
      async openUrl(url) {
         // Redirection à l'aide du plugiciel Browser de Capacitor
        await Browser.open({
          url,
          windowName: "_self"
        });
      }
    });
  };

  return <IonButton onClick={login}>Log in</IonButton>;
};

export default LoginButton;
```

Ce composant :

* définit un gabarit avec un simple bouton qui connecte l&#39;utilisateur lorsqu&#39;on clique dessus
* utilise `loginWithRedirect` pour effectuer la connexion à l&#39;aide de la page Universal Login d&#39;Auth0
* utilise la fonction de rappel `openUrl` avec le plugin Browser de Capacitor pour ouvrir l&#39;URL et afficher la page de connexion à l&#39;utilisateur

<Info>
  Ce guide porte sur l&#39;utilisation du Hook React personnalisé `useAuth0()`. Si vous utilisez des composants de classe, consultez [ces exemples utilisant le composant d&#39;ordre supérieur `withAuth0()`](https://github.com/auth0/auth0-react/blob/master/EXAMPLES.md#use-with-a-class-component).
</Info>

<div id="handling-the-callback">
  ### Gestion du callback
</div>

Une fois que les utilisateurs se connectent avec la page Universal Login, ils sont redirigés vers votre application au moyen d’une URL avec un schéma d’URL personnalisé. L’événement `appUrlOpen` doit être géré dans votre application. Vous pouvez appeler la méthode `handleRedirectCallback` de la trousse de développement logiciel (SDK) Auth0 pour initialiser l’état d’authentification.

Vous pouvez uniquement utiliser cette méthode suite à une redirection à partir d’Auth0. Pour vérifier que l’opération a réussi, vérifiez la présence des paramètres `code` et `state` dans l’URL.

La méthode `Browser.close()` doit fermer le navigateur lorsque cet événement est déclenché.

Ajoutez le hook `useEffect` suivant à votre composant `App` principal :

```javascript lines
// Importer les plugiciels app et browser de Capacitor, nous donnant accès à `addListener` et `appUrlOpen`,
// ainsi qu'aux éléments nécessaires pour Auth0 et React
import { App as CapApp } from '@capacitor/app';
import { Browser } from '@capacitor/browser';
import { useEffect } from 'react';
import { useAuth0 } from '@auth0/auth0-react';

// ...

const App: React.FC = () => {
  // Get the callback handler from the Auth0 React hook
  const { handleRedirectCallback } = useAuth0();

  useEffect(() => {
    // Handle the 'appUrlOpen' event and call `handleRedirectCallback`
    CapApp.addListener('appUrlOpen', async ({ url }) => {
      if (url.includes('state') && (url.includes('code') || url.includes('error'))) {
        await handleRedirectCallback(url);
      }
      // No-op on Android
      await Browser.close();
    });
  }, [handleRedirectCallback]);

  // ..
};
```

<Info>
  Cet article suppose que vous utiliserez des schémas d’URL personnalisés pour gérer le rappel dans votre application. Pour ce faire, enregistrez votre `YOUR_PACKAGE_ID` comme schéma d’URL pour la plateforme de votre choix. Pour en savoir plus, consultez [Defining a Custom URL Scheme](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) pour iOS, ou [Create Deep Links to App Content](https://developer.android.com/training/app-links/deep-linking) pour Android.
</Info>

<Note>
  ### Point de contrôle

  Ajoutez le composant `LoginButton` à votre application, ainsi que le gestionnaire pour l’événement « appUrlOpen » à votre composant `App`. Lorsque vous cliquez sur le bouton de connexion, vérifiez que votre application vous redirige vers la page Universal Login d’Auth0 et que vous pouvez maintenant vous connecter ou vous inscrire à l’aide d’un nom d’utilisateur et d’un mot de passe ou d’un fournisseur d’identité sociale.

  Une fois cette étape terminée, vérifiez qu’Auth0 vous redirige de nouveau vers votre application.
</Note>

<div id="add-logout-to-your-application">
  ## Ajouter la déconnexion à votre Application
</div>

Maintenant que les utilisateurs peuvent se connecter, vous devez configurer [un moyen de se déconnecter](https://auth0.com/docs/logout/guides/logout-auth0). Les utilisateurs doivent être redirigés vers le endpoint de déconnexion Auth0 dans le navigateur pour effacer leur session de navigation. Encore une fois, le plugin Browser de Capacitor doit effectuer cette redirection afin que l’utilisateur ne quitte pas votre application et ne subisse pas une expérience utilisateur sous-optimale.

Pour faire cela avec Ionic et Capacitor en conjonction avec la Trousse de développement logiciel (SDK) Auth0 :

* Construisez l’URL de votre application qu’Auth0 doit utiliser pour rediriger après la déconnexion. Il s’agit d’une URL qui utilise votre schéma personnalisé enregistré et votre Domaine Auth0. Ajoutez-la à votre configuration **URL de déconnexion autorisées** dans l’Auth0 Dashboard.
* Effectuez la déconnexion à partir du SDK en appelant `logout`, et transmettez votre URL de redirection en tant que paramètre `logoutParams.returnTo`.
* Définissez le paramètre `openUrl` sur une fonction de rappel qui utilise le plugin Browser de Capacitor pour ouvrir l’URL à l’aide de `Browser.open`.

<Info>
  Comme pour l’étape de connexion, si vous ne définissez pas `openUrl` lors de l’appel à `logout`, le SDK redirige l’utilisateur vers l’URL de déconnexion à l’aide de l’application de navigation par défaut sur l’appareil, ce qui offre une expérience utilisateur sous-optimale.
</Info>

Créez un nouveau fichier `LogoutButton.tsx` et ajoutez-y le code suivant. Ensuite, ajoutez le composant `LogoutButton` à votre application.

export const codeExample2 = `import { useAuth0 } from '@auth0/auth0-react';
import { Browser } from '@capacitor/browser';
import { IonButton } from '@ionic/react';

// Cela doit refléter l’URL ajoutée précédemment au paramètre « Allowed Logout URLs »
// dans l’Auth0 Dashboard.
const logoutUri = 'YOUR_PACKAGE_ID://{yourDomain}/capacitor/YOUR_PACKAGE_ID/callback';

const LogoutButton: React.FC = () => {
  const { logout } = useAuth0();

  const doLogout = async () => {
    await logout({
      logoutParams: {
        returnTo: logoutUri,
      },
      async openUrl(url) {
         // Redirection à l’aide du plugin Browser de Capacitor
        await Browser.open({
          url,
          windowName: "_self"
        });
      }
    });
  };

  return <IonButton onClick={doLogout}>Se déconnecter</IonButton>;
};

export default LogoutButton;`;

<AuthCodeBlock children={codeExample2} language="js" />

<Note>
  ### Point de contrôle

  Ajoutez le composant `LogoutButton` à votre application. Lorsque vous cliquez dessus, vérifiez que votre application Ionic vous redirige vers l’adresse que vous avez indiquée comme l’une des « URL de déconnexion autorisées » dans « Settings » et que vous n’êtes plus connecté à l’application.
</Note>

<div id="show-user-profile-information">
  ## Afficher les renseignements de profil de l’utilisateur
</div>

La Trousse de développement logiciel (SDK) React Auth0 vous aide à récupérer rapidement les [renseignements de profil](https://auth0.com/docs/users/concepts/overview-user-profile) associés aux utilisateurs connectés, dans n’importe quel composant où vous en avez besoin, par exemple leur nom ou leur photo de profil, afin de personnaliser l’interface utilisateur. Les renseignements de profil sont accessibles au moyen de la propriété `user` exposée par le hook `useAuth0()`. Prenez ce composant `Profile` comme exemple d’utilisation :

```js lines
import { useAuth0 } from '@auth0/auth0-react';

const Profile: React.FC = () => {
  const { user, isLoading } = useAuth0();

  // Si le SDK n'est pas prêt, ou si un utilisateur n'est pas authentifié, quitter.
  if (isLoading || !user) return null;

  return (
    <div>
      <Frame><img 
        src={user.picture || `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2363b3ed'/%3E%3Cpath d='M50 45c7.5 0 13.64-6.14 13.64-13.64S57.5 17.72 50 17.72s-13.64 6.14-13.64 13.64S42.5 45 50 45zm0 6.82c-9.09 0-27.28 4.56-27.28 13.64v3.41c0 1.88 1.53 3.41 3.41 3.41h47.74c1.88 0 3.41-1.53 3.41-3.41v-3.41c0-9.08-18.19-13.64-27.28-13.64z' fill='%23fff'/%3E%3C/svg%3E`}
        alt={user.name} 
        onError={(e) => {
          const target = e.target as HTMLImageElement;
          target.src = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2363b3ed'/%3E%3Cpath d='M50 45c7.5 0 13.64-6.14 13.64-13.64S57.5 17.72 50 17.72s-13.64 6.14-13.64 13.64S42.5 45 50 45zm0 6.82c-9.09 0-27.28 4.56-27.28 13.64v3.41c0 1.88 1.53 3.41 3.41 3.41h47.74c1.88 0 3.41-1.53 3.41-3.41v-3.41c0-9.08-18.19-13.64-27.28-13.64z' fill='%23fff'/%3E%3C/svg%3E`;
        }}
      /></Frame>
      <h2>{user.name}</h2>
      <p>{user.email}</p>
    </div>
  );
};

export default Profile;
```

La propriété `user` contient des renseignements sensibles et des artefacts liés à l’identité de l’utilisateur. Par conséquent, sa disponibilité dépend de l’état d’authentification de l’utilisateur. Pour éviter toute erreur de rendu, utilisez la propriété `isAuthenticated` de `useAuth0()` pour vérifier qu’Auth0 a authentifié l’utilisateur avant que React ne rende tout composant qui consomme la propriété `user`. Assurez-vous que la Trousse de développement logiciel (SDK) a terminé de se charger avant d’accéder à la propriété `isAuthenticated`, en vérifiant que `isLoading` est à `false`.

<Note>
  ### Point de contrôle

  Ajoutez le composant `Profile` à votre application et vérifiez que vous pouvez afficher `user.name` ou [toute autre propriété `user`](https://auth0.com/docs/users/references/user-profile-structure#user-profile-attributes) correctement dans un composant après vous être connecté.
</Note>

<Info>
  ##### Que faire ensuite ?

  <table>
    <tr>
      <td><a href="/docs/fr-CA/authenticate/identity-providers">Configurer d&#39;autres fournisseurs d&#39;identité</a></td>
      <td><a href="/docs/fr-CA/secure/multi-factor-authentication">Activer l&#39;authentification multifacteur</a></td>
    </tr>

    <tr>
      <td><a href="/docs/fr-CA/secure/attack-protection">En savoir plus sur la protection contre les attaques</a></td>
      <td><a href="/docs/fr-CA/customize/rules">En savoir plus sur Rules</a></td>
    </tr>
  </table>

  [Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>

***