---
title: "MAUI"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";

<div id="by-frederik-prijck">
  ##### Par Frederik Prijck
</div>

Ce didacticiel explique comment ajouter une fonctionnalité de connexion utilisateur avec Auth0 à une application .NET MAUI. Nous vous recommandons de vous connecter afin de suivre ce Démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Voir sur GitHub" href="https://github.com/auth0-samples/auth0-maui-samples/tree/master/Sample" icon="github">
  Configuration requise : Visual Studio 2022+ ou Visual Studio for Mac | .NET 6+
  </Card> */}

<Info>
  La trousse de développement logiciel (SDK) MAUI prend en charge Android, iOS, macOS et Windows. Poursuivez la lecture pour connaître la configuration propre à chaque plateforme.
</Info>

<Info>
  **Nouveau dans le domaine de l’authentification ?** Découvrez [comment Auth0 fonctionne](/docs/fr-CA/get-started/auth0-overview), comment il [s’intègre aux applications natives](/docs/fr-CA/get-started/architecture-scenarios/mobile-api) et quel [protocole](/docs/fr-CA/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce) il utilise.
</Info>

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenez les clés de votre Application
</div>

Lorsque vous vous êtes inscrit à Auth0, une nouvelle Application a été créée pour vous ou vous avez pu en créer une nouvelle. Vous aurez besoin de certains renseignements sur cette Application pour communiquer avec Auth0. Vous pouvez obtenir ces renseignements dans la section [Application Settings](https://manage.auth0.com/#/applications) de l’Auth0 Dashboard.

<Frame>![Tableau de bord de l’application](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

<Info>
  Lorsque vous utilisez l’Application par défaut avec une application native ou une application monopage, assurez-vous de mettre à jour la **Token Endpoint Authentication Method** et de la définir sur `None`, puis de définir **Application Type** sur `SPA` ou `Native`.
</Info>

Vous avez besoin des renseignements suivants :

* **Domaine**
* **ID client**

<Info>
  Si vous téléchargez l’exemple en haut de cette page, ces renseignements sont déjà remplis pour vous.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de rappel
</div>

Une URL de rappel est une URL de votre application vers laquelle Auth0 redirige l’utilisateur après son authentification. L’URL de rappel de votre application doit être ajoutée au champ **Allowed Callback URLs** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n’est pas défini, les utilisateurs ne pourront pas se connecter à l’application et recevront un message d’erreur.

Les URL de rappel sont les URL qu’Auth0 appelle après le processus d’authentification. Auth0 redirige votre application vers cette URL et y ajoute des paramètres supplémentaires, y compris un code d’autorisation qui sera échangé contre un jeton d&#39;identité, un jeton d’accès et un Jeton d’actualisation.

Comme les URL de rappel peuvent être manipulées, vous devez ajouter l’URL de votre application au paramètre *Allowed Callback URLs* de votre application pour des raisons de sécurité. Cela permettra à Auth0 de reconnaître ces URL comme valides. Si vous l’omettez, l’authentification échouera.

<Info>
  Lorsque vous suivez ce Démarrage rapide, configurez `myapp://callback` comme valeur pour *Allowed Callback URLs*.
</Info>

<div id="configure-logout-urls">
  ### Configurer les URL de déconnexion
</div>

Une URL de déconnexion est une URL de votre application vers laquelle Auth0 peut rediriger l’utilisateur après sa déconnexion du serveur d’autorisation. Elle est spécifiée dans le paramètre de requête `returnTo`. L’URL de déconnexion de votre application doit être ajoutée au champ **URL de déconnexion autorisées** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n’est pas défini, les utilisateurs ne pourront pas se déconnecter de l’application et recevront une erreur.

<Info>
  Lorsque vous suivez ce démarrage rapide, configurez `myapp://callback` comme valeur du champ *URL de déconnexion autorisées*.
</Info>

<div id="install-the-auth0-sdk">
  ## Installer la trousse de développement logiciel (SDK) Auth0
</div>

Auth0 fournit une trousse de développement logiciel (SDK) [MAUI](https://www.nuget.org/packages/Auth0.OidcClient.MAUI/) pour simplifier la mise en œuvre de l’authentification Auth0 dans les applications MAUI.

Utilisez le gestionnaire de packages NuGet (Tools -&gt; Library Package Manager -&gt; Package Manager Console) pour installer le package `Auth0.OidcClient.MAUI`.

Vous pouvez aussi utiliser la console du gestionnaire de packages NuGet (`Install-Package`) ou l’interface de ligne de commande `dotnet` (`dotnet add`).

```
Install-Package Auth0.OidcClient.MAUI
```

```
dotnet add package Auth0.OidcClient.MAUI
```

<div id="platform-specific-configuration">
  ## Configuration spécifique à la plateforme
</div>

Vous devez effectuer une configuration spécifique à la plateforme pour pouvoir utiliser la Trousse de développement logiciel (SDK) avec Android et Windows.

<div id="android">
  ### Android
</div>

Créez une nouvelle `Activity` qui hérite de `WebAuthenticatorCallbackActivity` :

```cs lines
[Activity(NoHistory = true, LaunchMode = LaunchMode.SingleTop, Exported = true)]
[IntentFilter(new[] { Intent.ActionView },
              Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
              DataScheme = CALLBACK_SCHEME)]
public class WebAuthenticatorActivity : Microsoft.Maui.Authentication.WebAuthenticatorCallbackActivity
{
    const string CALLBACK_SCHEME = "myapp";
}
```

L’activité ci-dessus garantira que l’application peut gérer l’URL `myapp://callback` lorsque Auth0 redirige vers l’application Android après la connexion.

<div id="windows">
  ### Windows
</div>

Pour vous assurer que votre application peut être correctement réactivée après avoir été redirigée vers Auth0, vous devez faire deux choses :

* Ajouter le protocole correspondant au fichier `Package.appxmanifest`. Dans cet exemple, il est défini sur `myapp`, mais vous pouvez le modifier comme vous le souhaitez (assurez-vous également de mettre à jour toutes les URL Auth0 pertinentes).

  ```xml lines
  <Applications>
    <Application Id="App" Executable="$targetnametoken$.exe" EntryPoint="$targetentrypoint$">
      <Extensions>
        <uap:Extension Category="windows.protocol">
          <uap:Protocol Name="myapp"/>
        </uap:Extension>
      </Extensions>
    </Application>
  </Applications>
  ```

* Appelez `Activator.Default.CheckRedirectionActivation()` dans le fichier `App.xaml.cs` spécifique à Windows.

  ```cs lines
  public App()
  {
    if (Auth0.OidcClient.Platforms.Windows.Activator.Default.CheckRedirectionActivation())
      return;

    this.InitializeComponent();
  }
  ```

<div id="instantiate-the-auth0client">
  ## Instancier Auth0Client
</div>

Pour intégrer Auth0 à votre application, instanciez la classe `Auth0Client` en lui passant une instance de `Auth0ClientOptions` qui contient votre Domaine Auth0, votre ID client et les scopes requis.
Vous devez également configurer `RedirectUri` et `PostLogoutRedirectUri` afin de vous assurer qu’Auth0 peut rediriger vers l’application en utilisant l’URL ou les URL configurées.

export const codeExample = `using Auth0.OidcClient;

var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "{yourDomain}",
    ClientId = "{yourDomain}",
    RedirectUri = "myapp://callback",
    PostLogoutRedirectUri = "myapp://callback",
    Scope = "openid profile email"
});`;

<AuthCodeBlock children={codeExample} language="cs" />

Par défaut, la Trousse de développement logiciel (SDK) utilisera Chrome Custom Tabs pour Android, ASWebAuthenticationSession pour iOS et macOS, et le navigateur par défaut de votre système sous Windows.

<div id="add-login-to-your-application">
  ## Ajouter la connexion à votre Application
</div>

Maintenant que vous avez configuré votre Application Auth0 et la trousse de développement logiciel (SDK) Auth0, vous devez mettre en place la connexion pour votre projet. Pour ce faire, vous utiliserez la méthode `LoginAsync()` du SDK pour créer un bouton de connexion qui redirige les utilisateurs vers la page Universal Login d’Auth0.

```cs lines
var loginResult = await client.LoginAsync();
```

S&#39;il n&#39;y a pas d&#39;erreur, vous pouvez accéder à `User`, `IdentityToken`, `AccessToken` et `RefreshToken` sur le `LoginResult` renvoyé par `LoginAsync()`.

<div id="add-logout-to-your-application">
  ## Ajouter la déconnexion à votre application
</div>

Les utilisateurs qui se connectent à votre projet auront aussi besoin d’un moyen de se déconnecter. Créez un bouton de déconnexion à l’aide de la méthode `LogoutAsync()` de la Trousse de développement logiciel (SDK). Lorsque les utilisateurs se déconnectent, ils sont redirigés vers votre point de terminaison de déconnexion Auth0, qui les redirigera ensuite immédiatement vers l’URL de déconnexion que vous avez configurée plus tôt dans ce démarrage rapide.

```cs lines
await client.LogoutAsync();
```

<div id="show-user-profile-information">
  ## Afficher les informations de profil de l’utilisateur
</div>

Maintenant que vos utilisateurs peuvent se connecter et se déconnecter, vous souhaiterez probablement pouvoir récupérer les [informations de profil](https://auth0.com/docs/users/concepts/overview-user-profile) associées aux utilisateurs authentifiés. Par exemple, vous pourriez vouloir afficher le nom d’un utilisateur connecté ou sa photo de profil dans votre projet.

La Trousse de développement logiciel (SDK) Auth0 pour MAUI fournit les informations sur l’utilisateur par l’entremise de la propriété `LoginResult.User`.

```cs lines
if (loginResult.IsError == false)
{
    var user = loginResult.User;
    var name = user.FindFirst(c => c.Type == "name")?.Value;
    var email = user.FindFirst(c => c.Type == "email")?.Value;
    var picture = user.FindFirst(c => c.Type == "picture")?.Value;
}
```

<Info>
  ##### Que pouvez-vous faire ensuite ?

  <table>
    <tr>
      <td><a href="/docs/fr-CA/authenticate/identity-providers">Configurer d&#39;autres fournisseurs d&#39;identité</a></td>
      <td><a href="/docs/fr-CA/secure/multi-factor-authentication">Activer l&#39;authentification multifacteur</a></td>
    </tr>

    <tr>
      <td><a href="/docs/fr-CA/secure/attack-protection">En savoir plus sur la protection contre les attaques</a></td>
      <td><a href="/docs/fr-CA/customize/rules">En savoir plus sur la fonctionnalité Rules</a></td>
    </tr>
  </table>

  [Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>

***
