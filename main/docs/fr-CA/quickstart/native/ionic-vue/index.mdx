---
title: "Ionic & Capacitor (Vue)"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";

<div id="by-steve-hobbs">
  ##### Par Steve Hobbs
</div>

Ce tutoriel montre comment ajouter une fonctionnalité de connexion utilisateur avec Auth0 à une application Ionic Vue et Capacitor. Nous vous recommandons de vous connecter pour suivre ce démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Afficher sur GitHub" href="https://github.com/auth0-samples/auth0-ionic-samples/tree/main/vue" icon="github">
  Configuration système requise&nbsp;: Node et npm (LTS) | Xcode 12+ (pour iOS) | Android Studio 4+ (pour Android)
  </Card> */}

<div id="getting-started">
  ## Mise en route
</div>

Ce démarrage rapide part du principe que vous avez déjà une application [Ionic](https://ionicframework.com/) fonctionnelle avec [Capacitor](https://capacitorjs.com/). Sinon, consultez le guide [Using Capacitor with Ionic Framework](https://capacitorjs.com/docs/getting-started/with-ionic) pour démarrer avec une application simple, ou clonez [nos applications d’exemple](https://github.com/auth0-samples/auth0-ionic-samples).

Vous devriez aussi être à l’aise avec le [flux de travail de développement de Capacitor](https://capacitorjs.com/docs/basics/workflow).

<Info>
  **Nouveau dans l’authentification ?** Découvrez [le fonctionnement d’Auth0](/docs/fr-CA/get-started/auth0-overview), comment il [s’intègre aux applications natives](/docs/fr-CA/get-started/architecture-scenarios/mobile-api) et le [protocole](/docs/fr-CA/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce) qu’il utilise.
</Info>

<div id="configure-auth0">
  ## Configurer Auth0
</div>

<div id="get-your-application-keys">
  ### Obtenir les clés de votre application
</div>

Lorsque vous vous êtes inscrit à Auth0, une nouvelle application a été créée pour vous ou vous avez pu en créer une nouvelle. Vous aurez besoin de certains détails concernant cette application pour communiquer avec Auth0. Vous pouvez obtenir ces détails dans la section [Application Settings](https://manage.auth0.com/#/applications) de l&#39;Auth0 Dashboard.

<Frame>![Tableau de bord de l'application](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

<Info>
  Lorsque vous utilisez l&#39;application Default App avec une application native ou une application monopage, assurez-vous de mettre à jour **Token Endpoint Authentication Method** à `None` et de définir **Application Type** sur `SPA` ou `Native`.
</Info>

Vous avez besoin des informations suivantes :

* **Domaine**
* **ID client**

<Info>
  Si vous téléchargez l&#39;exemple à partir du haut de cette page, ces informations sont déjà renseignées pour vous.
</Info>

<div id="configure-callback-urls">
  ### Configurer les URL de redirection
</div>

Une URL de redirection est une URL dans votre application vers laquelle Auth0 redirige l’utilisateur après son authentification. L’URL de redirection de votre application doit être ajoutée au champ **Allowed Callback URLs** dans vos [Application Settings](https://manage.auth0.com/#/applications). Si ce champ n’est pas défini, les utilisateurs ne pourront pas se connecter à l’application et recevront une erreur.

<Info>
  Dans l’ensemble de cet article, `YOUR_PACKAGE_ID` correspond à l’identifiant de package de votre application. Vous pouvez le trouver et le configurer dans le champ `appId` de votre fichier `capacitor.config.ts`. Consultez la page [Capacitors Config schema](https://capacitorjs.com/docs/config#schema) pour plus d’informations.
</Info>

Accédez à la section [Application Settings](https://manage.auth0.com/#/applications/\{yourClientId}/settings) dans votre Auth0 Dashboard et définissez votre **URL de redirection** dans la zone **Allowed Callback URLs**.

Vous devez définir l’**URL de redirection autorisée** (**Allowed Callback URL**) sur :

```
YOUR_PACKAGE_ID://{yourDomain}/capacitor/YOUR_PACKAGE_ID/callback
```

<div id="configure-logout-urls">
  ### Configurer les URL de déconnexion
</div>

Une URL de déconnexion est une URL de votre application vers laquelle Auth0 peut rediriger l’utilisateur après sa déconnexion du serveur d’autorisation. Elle est spécifiée dans le paramètre de requête `returnTo`. L’URL de déconnexion de votre application doit être ajoutée au champ **URL de déconnexion autorisées** dans vos [paramètres d’Application](https://manage.auth0.com/#/applications). Si ce champ n’est pas configuré, les utilisateurs ne pourront pas se déconnecter de l’application et recevront une erreur.

Vous devez définir les **URL de déconnexion autorisées** sur

```
YOUR_PACKAGE_ID://{yourDomain}/capacitor/YOUR_PACKAGE_ID/callback
```

<div id="configure-origins">
  ### Configurer les origines
</div>

Pour pouvoir envoyer des requêtes depuis votre application vers Auth0, configurez les **origines autorisées** suivantes dans vos [paramètres d’Application](https://manage.auth0.com/#/applications/\{yourClientId}/settings).

```
capacitor://localhost, http://localhost
```

Ces origines sont requises pour iOS et Android, respectivement.

Enfin, assurez-vous que le paramètre **Application Type** de votre Application est réglé sur **Native** dans les [Application Settings](https://manage.auth0.com/#/applications/\{yourClientId}/settings).

<div id="install-the-auth0-vue-sdk">
  ## Installer la trousse de développement logiciel (SDK) Auth0 Vue
</div>

Exécutez la commande suivante dans le répertoire de votre projet pour installer la trousse de développement logiciel (SDK) Auth0 Vue :

```
npm install @auth0/auth0-vue
```

La trousse de développement logiciel (SDK) met à disposition plusieurs types qui vous aident à intégrer Auth0 de façon idiomatique dans votre application Vue, notamment un module et un service d’authentification.

<div id="install-capacitor-plugins">
  ### Installer les plugins Capacitor
</div>

Ce démarrage rapide et l’exemple utilisent certains des plugins officiels de Capacitor. Installez-les dans votre application à l’aide de la commande suivante :

```
npm install @capacitor/browser @capacitor/app
```

* [`@capacitor/browser`](https://capacitorjs.com/docs/apis/browser) - vous permet d&#39;interagir avec le navigateur système de l&#39;appareil et sert à ouvrir l&#39;URL du point de terminaison d&#39;autorisation Auth0
* [`@capacitor/app`](https://capacitorjs.com/docs/apis/app) - vous permet de vous abonner à des événements globaux de l&#39;application, ce qui est utile pour gérer les callbacks en provenance d&#39;Auth0

<Info>
  Le plugiciel Browser de Capacitor sur iOS utilise [`SFSafariViewController`](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller) qui, sur iOS 11+, ne partage pas les témoins (cookies) avec Safari sur l&#39;appareil. Cela signifie que le [SSO](https://auth0.com/docs/sso) ne fonctionnera pas sur ces appareils. Si vous avez besoin de SSO, utilisez plutôt un plugiciel compatible qui repose sur [ASWebAuthenticationSession](https://developer.apple.com/documentation/authenticationservices/aswebauthenticationsession).
</Info>

<div id="configure-the-createauth0-plugin">
  ### Configurer le plugin createAuth0
</div>

La trousse de développement logiciel (SDK) exporte `createAuth0`, un composable qui regroupe tous les services nécessaires au fonctionnement du SDK. Pour l’enregistrer dans votre application :

Ouvrez `src/main.ts` et installez le plugin en appelant `app.use`.

export const codeExample = `import { createApp } from "vue";
import App from "./App.vue";
import router from "./router";

import { IonicVue } from "@ionic/vue";

import { createAuth0 } from "@auth0/auth0-vue";
import config from "./auth.config";

// ..

// Construire l’URL vers laquelle Auth0 doit rediriger
const redirect_uri = \`\${config.appId}://{yourDomain}/capacitor/\${config.appId}/callback\`;

const app = createApp(App).use(IonicVue).use(router);

app.use(
  createAuth0({
    domain: "{yourDomain}",
    clientId: "{yourClientId}",
    useRefreshTokens: true,
    useRefreshTokensFallback: false,
    authorizationParams: {
      redirect_uri
    }
  })
);

router.isReady().then(() => {
  app.mount("#app");
});`;

<AuthCodeBlock children={codeExample} language="js" />

Le plugin `createAuth0` accepte les props suivantes :

* `domain` : La valeur « domain » qui se trouve sous « Settings » de l’application que vous avez créée dans votre Auth0 Dashboard, ou votre domaine personnalisé si vous utilisez la [fonctionnalité Custom Domains d’Auth0](https://auth0.com/docs/custom-domains)
* `clientId` : La valeur « client ID » qui se trouve sous « Settings » de l’application que vous avez créée dans votre Auth0 Dashboard
* `useRefreshTokens` : Pour utiliser auth0-vue avec Ionic sur Android et iOS, vous devez activer les jetons d’actualisation.
* `useRefreshTokensFallback` : Pour utiliser auth0-vue avec Ionic sur Android et iOS, vous devez désactiver le mécanisme de repli basé sur un iframe.
* `authorizationParams.redirect_uri` : L’URL vers laquelle vous voulez rediriger vos utilisateurs après leur authentification avec Auth0.

<Warning>
  Pour conserver l’authentification après avoir fermé et rouvert l’application, vous pouvez définir `cacheLocation` à `localstorage` lors de la configuration de la Trousse de développement logiciel (SDK), mais sachez qu’il existe [des risques liés au stockage de jetons dans localstorage](https://auth0.com/docs/libraries/auth0-single-page-app-sdk#change-storage-options). De plus, dans une application Capacitor, localstorage doit être considéré comme **transitoire**, puisque les données peuvent être récupérées de façon inattendue dans certaines circonstances. Veuillez lire les [recommandations sur le stockage dans la documentation Capacitor](https://capacitorjs.com/docs/guides/storage#why-cant-i-just-use-localstorage-or-indexeddb).

  En outre, la Trousse de développement logiciel (SDK) peut [utiliser une implémentation de cache personnalisée](https://github.com/auth0/auth0-spa-js/blob/master/EXAMPLES.md#creating-a-custom-cache) pour stocker les jetons, si vous devez utiliser un mécanisme de stockage plus sécuritaire et plus persistant.

  **Remarque** : nous déconseillons **fortement** d’utiliser le [plugin Storage de Capacitor](https://capacitorjs.com/docs/apis/storage) pour stocker des jetons, puisqu’il repose respectivement sur [UserDefaults](https://developer.apple.com/documentation/foundation/userdefaults) et [SharedPreferences](https://developer.android.com/reference/android/content/SharedPreferences) sur iOS et Android. Les données stockées au moyen de ces API ne sont pas chiffrées, ne sont pas sécuritaires et pourraient également être synchronisées dans le cloud.
</Warning>

<Note>
  ### Point de contrôle

  Maintenant que vous avez configuré le plugin `createAuth0`, exécutez votre application pour vérifier que la Trousse de développement logiciel (SDK) s’initialise correctement et que votre application ne génère aucune erreur liée à Auth0.
</Note>

<div id="add-login-to-your-application">
  ## Ajouter une connexion à votre application
</div>

Dans une application Capacitor, le [plugiciel Browser de Capacitor](https://capacitorjs.com/docs/apis/browser) effectue une redirection vers la [page Universal Login](https://auth0.com/universal-login) d&#39;Auth0. Définissez le paramètre `openUrl` de la fonction `loginWithRedirect` pour utiliser `Browser.open`, afin que l’URL soit ouverte à l’aide du composant de navigateur système de l’appareil ([SFSafariViewController](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller) sur iOS et [Chrome Custom Tabs](https://developer.chrome.com/docs/android/custom-tabs) sur Android).

<Info>
  Par défaut, la méthode `loginWithRedirect` de la trousse de développement logiciel (SDK) utilise `window.location.href` pour naviguer vers la page de connexion dans le navigateur par défaut sur l’appareil de l’utilisateur plutôt que d’utiliser le composant de navigateur système approprié pour la plateforme. L’utilisateur quitterait alors votre application pour s’authentifier, ce qui pourrait entraîner une expérience utilisateur de moindre qualité.
</Info>

Ajoutez un nouveau fichier `LoginButton.vue` avec le code suivant :

```html lines
<template>
  <ion-button @click="login">Se connecter</ion-button>
</template>

<script lang="ts">
import { defineComponent } from "vue";
import { IonApp, IonRouterOutlet } from "@ionic/vue";

import { useAuth0 } from "@auth0/auth0-vue";
import { App as CapApp } from "@capacitor/app";
import { Browser } from "@capacitor/browser";

export default defineComponent({
  components: {
    IonButton,
  },
  setup() {
    const { loginWithRedirect } = useAuth0();

    const login = async () => {
      await loginWithRedirect({
        openUrl: (url: string) =>
          Browser.open({
            url,
            windowName: "_self",
          }),
      });
    };

    return { login };
  },
});
</script>
```

Ce composant :

* définit un modèle avec un simple bouton qui connecte l&#39;utilisateur lorsqu&#39;on clique dessus
* utilise `loginWithRedirect` pour effectuer la connexion à l&#39;aide de la page Universal Login d&#39;Auth0
* utilise le callback `openUrl` avec le plugin Browser de Capacitor pour ouvrir l&#39;URL et afficher la page de connexion à l&#39;utilisateur

<div id="handling-the-callback">
  ### Gestion du callback
</div>

Une fois que les utilisateurs se connectent à l&#39;aide de la page Universal Login, ils sont redirigés vers votre application au moyen d’une URL utilisant un schéma d’URL personnalisé. L’événement `appUrlOpen` doit être géré dans votre application. Vous pouvez appeler la méthode `handleRedirectCallback` de la trousse de développement logiciel (SDK) Auth0 pour initialiser l’état d’authentification.

Vous pouvez uniquement utiliser cette méthode lors d’une redirection en provenance d’Auth0. Pour confirmer la réussite de l’opération, vérifiez la présence des paramètres `code` et `state` dans l’URL.

La méthode `Browser.close()` doit fermer le navigateur lorsque cet événement est déclenché.

Ajoutez l’écouteur d’application Capacitor suivant à votre composant principal `App` :

```html lines
<template>
  <ion-app>
    <ion-router-outlet />
  </ion-app>
</template>

<script lang="ts">
import { useAuth0 } from "@auth0/auth0-vue";
import { IonApp, IonRouterOutlet } from "@ionic/vue";
import { defineComponent } from "vue";
import { App as CapApp } from "@capacitor/app";
import { Browser } from "@capacitor/browser";

export default defineComponent({
  name: "App",
  components: {
    IonApp,
    IonRouterOutlet,
  },
  setup() {
    const { handleRedirectCallback } = useAuth0();

    // Gérer l'événement 'appUrlOpen' et appeler `handleRedirectCallback`
    CapApp.addListener('appUrlOpen', async ({ url }) => {
      if (url.includes('state') && (url.includes('code') || url.includes('error'))) {
        await handleRedirectCallback(url);
      }
      // Aucune opération sur Android
      await Browser.close();
    });
  },
});
</script>
```

<Info>
  Cet article part du principe que vous utiliserez des schémas d’URL personnalisés (Custom URL Schemes) pour gérer le rappel dans votre application. Pour ce faire, enregistrez votre `YOUR_PACKAGE_ID` comme schéma d’URL pour la plateforme que vous avez choisie. Pour en savoir plus, consultez [Defining a Custom URL Scheme](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app) pour iOS ou [Create Deep Links to App Content](https://developer.android.com/training/app-links/deep-linking) pour Android.
</Info>

<Note>
  ### Point de contrôle

  Ajoutez le composant `LoginButton` à votre application, ainsi que le gestionnaire de l’événement &quot;appUrlOpen&quot; à votre composant `App`. Lorsque vous cliquez sur le bouton de connexion, vérifiez que votre application vous redirige vers la page Universal Login d’Auth0 et que vous pouvez maintenant ouvrir une session ou vous inscrire à l’aide d’un nom d’utilisateur et d’un mot de passe ou d’un fournisseur d’identité sociale.

  Une fois cette étape terminée, vérifiez qu’Auth0 vous redirige vers votre application.
</Note>

<div id="add-logout-to-your-application">
  ## Ajouter la déconnexion à votre application
</div>

Maintenant que les utilisateurs peuvent se connecter, vous devez configurer [un moyen de se déconnecter](https://auth0.com/docs/logout/guides/logout-auth0). Les utilisateurs doivent être redirigés vers le endpoint de déconnexion Auth0 dans le navigateur pour effacer leur session de navigateur. Comme précédemment, le plugin Browser de Capacitor doit effectuer cette redirection afin que l’utilisateur ne quitte pas votre application et n’ait pas une expérience utilisateur sous-optimale.

Pour y parvenir avec Ionic et Capacitor conjointement avec la Trousse de développement logiciel (SDK) Auth0 :

* Créez l’URL de votre application qu’Auth0 doit utiliser pour la redirection après la déconnexion. Il s’agit d’une URL qui utilise votre schéma personnalisé enregistré et votre Domaine Auth0. Ajoutez-la à votre configuration **URL de déconnexion autorisées** dans l’Auth0 Dashboard.
* Effectuez la déconnexion à partir du SDK en appelant `logout`, et transmettez votre URL de redirection en tant que paramètre `logoutParams.returnTo`.
* Définissez le paramètre `openUrl` sur un callback qui utilise le plugin Browser de Capacitor pour ouvrir l’URL en utilisant `Browser.open`.

<Info>
  Comme pour l’étape de connexion, si vous ne définissez pas `openUrl` lors de l’appel à `logout`, le SDK redirige l’utilisateur vers l’URL de déconnexion en utilisant le navigateur par défaut sur l’appareil, ce qui offre une expérience utilisateur sous-optimale.
</Info>

Créez un nouveau fichier `LogoutButton.vue` et ajoutez-y le code suivant. Ensuite, ajoutez le composant `LogoutButton` à votre application.

```html lines
<template>
  <ion-button @click="onLogout">Se déconnecter</ion-button>
</template>

<script lang="ts">
import { defineComponent } from "vue";
import { useAuth0 } from "@auth0/auth0-vue";
import { Browser } from "@capacitor/browser";
import { IonButton } from "@ionic/vue";
import { callbackUri } from "../auth.config";

export default defineComponent({
  components: {
    IonButton,
  },
  setup() {
    const { logout } = useAuth0();

    const onLogout = async () => {
      await logout({
        logoutParams: {
          returnTo: callbackUri,
        },
        openUrl: (url: string) =>
          Browser.open({
            url,
            windowName: "_self",
          }),
      });
    };

    return {
      onLogout,
    };
  },
});
</script>
```

<Note>
  ### Point de contrôle

  Ajoutez le composant `LogoutButton` à votre application. Lorsque vous cliquez dessus, vérifiez que votre application Ionic vous redirige vers l’adresse que vous avez spécifiée comme l’une des « URL de déconnexion autorisées » dans « Settings » et que vous n’êtes plus connecté à l’application.
</Note>

<div id="show-user-profile-information">
  ## Afficher les renseignements de profil de l’utilisateur
</div>

La trousse de développement logiciel (SDK) Auth0 pour Vue vous permet de récupérer rapidement les [renseignements de profil](https://auth0.com/docs/users/concepts/overview-user-profile) associés aux utilisateurs connectés, dans n’importe quel composant où vous en avez besoin, comme leur nom ou leur photo de profil, afin de personnaliser l’interface utilisateur. Les renseignements de profil sont accessibles par l’entremise de la propriété `user` exposée par le composable `useAuth0()`. Prenez ce composant `UserProfile` comme exemple d’utilisation :

```html lines
<template>
  <div v-if="isLoading">Chargement en cours...</div>
  <div v-else-if="!user"></div>
  <div v-else class="profile-container">
    <ion-avatar>
      <Frame><img :src="user.picture" :alt="user.name" /></Frame>
    </ion-avatar>
    <h2>{{ user.name }}</h2>
    <p>{{ user.email }}</p>
  </div>
</template>

<script lang="ts">
import { defineComponent } from "vue";
import { useAuth0 } from "@auth0/auth0-vue";
import { IonAvatar } from "@ionic/vue";

export default defineComponent({
  components: {
    IonAvatar,
  },
  setup() {
    const { user, isLoading } = useAuth0();

    return { user, isLoading };
  },
});
</script>
```

La propriété `user` contient des renseignements sensibles et des éléments liés à l’identité de l’utilisateur. Par conséquent, sa disponibilité dépend de l’état d’authentification de l’utilisateur. Pour éviter toute erreur de rendu, utilisez la propriété `isAuthenticated` de `useAuth0()` pour vérifier qu’Auth0 a bien authentifié l’utilisateur avant que Vue ne rende un composant qui consomme la propriété `user`. Assurez-vous que la trousse de développement logiciel (SDK) a terminé son chargement avant d’accéder à la propriété `isAuthenticated`, en vérifiant que `isLoading` est à `false`.

<Note>
  ### Point de contrôle

  Ajoutez le composant `UserProfile` à votre application, puis vérifiez que vous pouvez afficher `user.name` ou [toute autre propriété `user`](https://auth0.com/docs/users/references/user-profile-structure#user-profile-attributes) correctement au sein d’un composant après vous être connecté.
</Note>

<Info>
  ##### Que pouvez-vous faire ensuite ?

  <table>
    <tr>
      <td><a href="/docs/fr-CA/authenticate/identity-providers">Configurer d’autres fournisseurs d’identité</a></td>
      <td><a href="/docs/fr-CA/secure/multi-factor-authentication">Activer l’authentification multifacteur</a></td>
    </tr>

    <tr>
      <td><a href="/docs/fr-CA/secure/attack-protection">En savoir plus sur la protection contre les attaques</a></td>
      <td><a href="/docs/fr-CA/customize/rules">En savoir plus sur Rules</a></td>
    </tr>
  </table>

  [Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>
