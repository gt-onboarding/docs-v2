---
title: Android - Connexion avec Facebook

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/fr-CA/recipe.jsx";
import { LoggedInForm } from "/snippets/fr-CA/Login.jsx";
import Performloginsimplecallback from "/snippets/fr-CA/quickstart/native/android-facebook-login/performLogin + SimpleCallback.mdx";
import Oncreate from "/snippets/fr-CA/quickstart/native/android-facebook-login/onCreate.mdx";
import Fetchsessiontoken from "/snippets/fr-CA/quickstart/native/android-facebook-login/fetchSessionToken.mdx";
import Fetchuserprofile from "/snippets/fr-CA/quickstart/native/android-facebook-login/fetchUserProfile.mdx";
import Exchangetokens from "/snippets/fr-CA/quickstart/native/android-facebook-login/exchangeTokens.mdx";
import Performlogin from "/snippets/fr-CA/quickstart/native/android-facebook-login/performLogin.mdx";

import {AuthCodeGroup} from "/snippets/fr-CA/AuthCodeGroup.jsx";

export const sections = [
      { id: "system-requirements", title: "Configuration requise" },
      { id: "before-you-start", title: "Avant de commencer" },
      { id: "request-facebook-permissions", title: "Demander les autorisations Facebook" },
      { id: "create-performlogin-method", title: "Créer la méthode performLogin" },
      { id: "call-performlogin-method", title: "Appeler la méthode performLogin" },
      { id: "integrate-facebook", title: "Intégrer Facebook" },
      { id: "fetch-facebook-session-access-token", title: "Récupérer le jeton d’accès de session Facebook" },
      { id: "fetch-facebook-user-profile", title: "Récupérer le profil utilisateur Facebook" },
      { id: "integrate-auth0", title: "Intégrer Auth0" },
      { id: "exchange-the-received-data-for-auth0-tokens", title: "Échanger les données reçues contre des jetons Auth0" },
      { id: "update-performlogin-method", title: "Mettre à jour la méthode performLogin" }
]


<Recipe isSingleColumn>
  <Content>
    Ce tutoriel montre comment ajouter la connexion utilisateur à une application Android en utilisant la connexion Facebook native. Nous vous recommandons de vous connecter pour suivre ce Démarrage rapide avec des exemples configurés pour votre compte.

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      * Android Studio 3.6.1
      * Android SDK 25
      * Un émulateur - Nexus 5X - Android 6.0

      Ce tutoriel explique comment implémenter la connexion avec la [trousse de développement logiciel (SDK) Facebook](https://developers.facebook.com/docs/).​

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      * Installez et configurez la trousse de développement logiciel (SDK) Facebook Login ([Facebook Login SDK](https://developers.facebook.com/docs/facebook-login/)). Vous passerez aussi par le processus de création d’une application Facebook
        sur [https://developers.facebook.com](https://developers.facebook.com/). **Lorsque vous aurez terminé cette étape, vous devriez avoir
        une application mobile fonctionnelle avec Facebook Login intégré.**

      Configurez votre application Auth0 dans le tableau de bord pour utiliser Facebook Native Sign In. Consultez la page [Add Facebook Login to Native
      Apps](https://auth0.com/docs/connections/nativesocial/facebook). **Lorsque vous aurez terminé cette étape, votre application pourra implémenter Facebook Native Login.**

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      Votre application peut déjà permettre la connexion avec Facebook. Cependant, pour vous assurer de disposer d’un profil utilisateur riche, vous devez mettre à jour les autorisations utilisées pour configurer le bouton Facebook Login.

      Définissez les autorisations demandées à `public_profile` et `email`. Ainsi, l’adresse courriel de l’utilisateur sera également incluse dans la réponse, pourvu que la demande d’accès soit acceptée par l’utilisateur.

      ```kt lines
      loginButton.setPermissions(Arrays.asList("public_profile", "email"));
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      Maintenant, pour lancer le processus d’authentification avec Auth0, créez une nouvelle méthode dans laquelle vous préparerez la charge utile
      à envoyer.

      Vous utiliserez une petite interface pour gérer nos callbacks internes.

      Dans l’exemple, la méthode a été nommée `performLogin` et l’interface `SimpleCallback`. Allez‑y et ajoutez les deux.

      <AuthCodeGroup>
        <Performloginsimplecallback />

        <Oncreate />

        <Fetchsessiontoken />

        <Fetchuserprofile />

        <Exchangetokens />

        <Performlogin />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      Appelez maintenant la méthode depuis la méthode `onSuccess` du callback de connexion Facebook.

      <AuthCodeGroup>
        <Oncreate />

        <Performloginsimplecallback />

        <Fetchsessiontoken />

        <Fetchuserprofile />

        <Exchangetokens />

        <Performlogin />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      Lorsque vous ouvrez une session avec Facebook sur Auth0, le backend effectuera certaines vérifications en arrière-plan pour s’assurer que l’utilisateur est bien la personne qu’il prétend être. Pour ce faire, il doit recevoir un jeton d’accès de session (Session Access Token).

      De plus, si un utilisateur doit être créé dans Auth0 pour représenter cet utilisateur Facebook, le backend aura besoin de certaines de ses informations, comme son prénom, son nom de famille et son courriel. Le courriel, s’il est fourni, sera marqué comme non vérifié dans le profil utilisateur Auth0.

      Pour obtenir le jeton d’accès de session (Session Access Token) et le profil utilisateur, deux requêtes supplémentaires doivent être effectuées auprès de l’API Facebook.

      <LoggedInForm />
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7" isSingleColumn>
      Faites une nouvelle requête GET vers le point de terminaison `/oauth/access_token` de l’API Facebook. Utilisez les paramètres de requête suivants :

      * `grant_type` : `fb_attenuate_token`.
      * `fb_exchange_token` : le jeton d’accès obtenu lors de la connexion.
      * `client_id` : votre App ID. Cette valeur provient du tableau de bord des développeurs Facebook et devrait
        déjà être utilisée dans votre application si vous avez intégré Facebook Login avec succès.

      Placez la logique correspondant à cette étape dans une méthode distincte. Vous l’appelerez plus tard à partir de la méthode ajoutée précédemment.

      L’exemple utilise la classe `GraphRequest` du SDK Facebook pour effectuer cette requête.

      <AuthCodeGroup>
        <Oncreate />

        <Performloginsimplecallback />

        <Fetchsessiontoken />

        <Fetchuserprofile />

        <Exchangetokens />

        <Performlogin />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[7].id} title={sections[7].title} stepNumber="8" isSingleColumn>
      Faites maintenant une autre requête GET, exactement comme à l’étape précédente. Le chemin de l’endpoint sera la valeur de l’ID d’utilisateur issue du résultat de la connexion Facebook (par exemple, `/904636746222815`). Utilisez les paramètres suivants :

      * `access_token` : le jeton d’accès reçu lors de la connexion.
      * `fields` : les champs du profil utilisateur que vous souhaitez récupérer dans la réponse. Ceux-ci sont
        directement liés aux autorisations du bouton Connexion Facebook qui ont été configurées au départ. Lorsqu’une
        autorisation est facultative, l’utilisateur doit d’abord consentir à y donner accès. Aux fins de l’inscription d’un utilisateur
        dans Auth0, son nom complet et son courriel seront suffisants.

      <AuthCodeGroup>
        <Fetchuserprofile />

        <Performloginsimplecallback />

        <Oncreate />

        <Fetchsessiontoken />

        <Exchangetokens />

        <Performlogin />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[8].id} title={sections[8].title} stepNumber="9" isSingleColumn>
      Maintenant que les artefacts requis ont été obtenus, vous êtes prêt à les échanger contre des informations
      d’identification d’utilisateur Auth0, comme les jetons d’identification (ID) et les jetons d’accès. Mais d’abord, vous devez configurer la Trousse de développement logiciel (SDK) Auth0 pour effectuer cette dernière requête.

      ### Obtenez les clés de votre application

      1. Accédez à la section **Applications** du [Auth0 Dashboard](https://manage.auth0.com/) et sélectionnez l’application existante dans laquelle vous avez activé
         **Se connecter avec Facebook**. Si vous avez besoin d’aide pour cette étape, consultez la section des prérequis au
         début de cet article.
      2. Copiez les valeurs **Domain** et **Client ID** à partir de la page des paramètres de l’application. Elles sont requises par
         le SDK.
      3. Créez deux nouvelles ressources dans le fichier strings.xml de votre application Android pour les enregistrer. Le nom des clés
         doit correspondre à celui utilisé ci‑dessous :

      ```xml lines
      <resources>

            <string name="com_auth0_domain">{yourDomain}</string>

            <string name="com_auth0_client_id">{yourClientId}</string>

      </resources>
      ```

      ### Installer la trousse de développement logiciel (SDK) Auth0

      Dans votre application Android, ajoutez cette ligne au fichier app/build.gradle :

      ```text lines
      dependencies {
            implementation 'com.auth0.android:auth0:1.+'
      }
      ```

      Il est maintenant temps d’exécuter la tâche Gradle Sync pour actualiser le projet et ses dépendances.

      ### Mettre à jour le manifeste pour l’authentification Web

      Si votre application ne prévoit pas d’utiliser le module Web Authentication fourni par la Trousse de développement logiciel (SDK), vous devrez
      supprimer l’activité inutilisée du fichier AndroidManifest.xml pour éviter les problèmes liés à Manifest Placeholder. Pour ce faire,
      ajoutez une déclaration d’activité et annotez-la avec tools:node=&quot;remove&quot;.

      ```xml lines
      <application>
      <!-- Ajoutez la ligne de déclaration d'activité ci-dessous -->
      <activity
      android:name="com.auth0.android.provider.AuthenticationActivity"
      tools:node="remove" />
      </application>
      ```

      Cependant, si vous prévoyez de prendre en charge l’authentification Web, rendez-vous [ici](https://auth0.com/docs/libraries/auth0-android#authentication-via-universal-login) pour savoir comment déclarer les espaces réservés du manifeste (Manifest Placeholders).

      <LoggedInForm />
    </Section>

    <Section id={sections[9].id} title={sections[9].title} stepNumber="10" isSingleColumn>
      La trousse de développement logiciel (SDK) doit être instanciée avant d&#39;être utilisée. Définissez un champ au niveau de la classe et initialisez-le dans la méthode
      `onCreate`. Notez que les informations d&#39;identification définies à l&#39;étape précédente sont transmises au
      constructeur `Auth0`, puis qu&#39;une nouvelle instance de `AuthenticationAPIClient` est créée avec
      celles-ci.

      ```kt lines
      private AuthenticationAPIClient auth0Client;
      @Override
      public void onCreate(Bundle savedInstanceState) {
      super.onCreate(savedInstanceState);



      setContentView(R.layout.activity_login);



      Auth0 account = new Auth0(getString(R.string.com_auth0_client_id), getString(R.string.com_auth0_domain));

      auth0Client = new AuthenticationAPIClient(account);



      //...

      }
      ```

      Créez la méthode qui contiendra la logique permettant d&#39;échanger les deux artefacts obtenus contre des identifiants d&#39;utilisateur Auth0. Dans l&#39;exemple, cette méthode s&#39;appelle `exchangeTokens`.

      Le client API déclare la méthode `loginWithNativeSocialToken`, qui reçoit un jeton et un type de sujet.
      Le premier correspond au jeton de session, et le second indique avec quel type de connexion le backend
      tentera de s&#39;authentifier.

      Pour la connexion Facebook native, utilisez la valeur suivante :
      `"http://auth0.com/oauth/token-type/facebook-info-session-access-token"`

      D&#39;autres valeurs à configurer sont le profil de l&#39;utilisateur (en utilisant la clé `user_profile`) et la
      portée que vous demandez pour les jetons Auth0.

      <Info>
        C&#39;est une bonne pratique de conserver, au début de la classe, toutes les valeurs dont vous savez qu&#39;elles ne changeront pas, sous forme de constantes. L&#39;exemple utilise des constantes pour le type de jeton de sujet, les autorisations Facebook et les
        portées Auth0. Vous pouvez en savoir plus sur les portées Auth0 dans l&#39;article dédié.
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[10].id} title={sections[10].title} stepNumber="11" isSingleColumn>
      Maintenant que chaque étape est définie dans sa propre méthode, il est temps de tout rassembler dans la méthode
      `performLogin`.

      Si tout s’est bien passé, vous devriez maintenant pouvoir vous authentifier de façon native avec le Facebook Login SDK. Cela signifie
      que si l’application Facebook est installée sur l’appareil, l’authentification sera gérée par l’application et
      non par un navigateur.

      <AuthCodeGroup>
        <Performlogin />

        <Performloginsimplecallback />

        <Oncreate />

        <Fetchsessiontoken />

        <Fetchuserprofile />

        <Exchangetokens />
      </AuthCodeGroup>
    </Section>
  </Content>
</Recipe>