---
title: Ajouter l’autorisation à votre API Express.js
sidebarTitle: API Node (Express)

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/fr-CA/recipe.jsx";
import { LoggedInForm } from "/snippets/fr-CA/Login.jsx";
import Server from "/snippets/fr-CA/quickstart/backend/nodejs/server.js.mdx";
import Server2 from "/snippets/fr-CA/quickstart/backend/nodejs/server.js2.mdx";

import {AuthCodeGroup} from "/snippets/fr-CA/AuthCodeGroup.jsx";

export const sections = [
  { id: "define-permissions", title: "Définir les autorisations" },
  { id: "install-dependencies", title: "Installer les dépendances" },
  { id: "configure-the-middleware", title: "Configurer le middleware" },
  { id: "protect-api-endpoints", title: "Protéger les points de terminaison de l'API" }
]


<Recipe isSingleColumn>
  <Content>
    Ce guide explique comment intégrer Auth0 à toute application API Express.js nouvelle ou existante à l&#39;aide du
    package `express-oauth2-jwt-bearer`.

    Si vous n&#39;avez pas encore créé d&#39;API dans votre Auth0 Dashboard, utilisez le sélecteur interactif pour créer une nouvelle API Auth0 ou sélectionner une API de projet existante.

    Pour configurer votre première API via le Auth0 Dashboard, consultez [notre guide de démarrage](https://auth0.com/docs/get-started/auth0-overview/set-up-apis). Chaque API Auth0 utilise l&#39;identifiant d&#39;API, que votre application doit utiliser pour valider le jeton d&#39;accès.

    <Info>
      **Nouveau chez Auth0 ?** Découvrez [le fonctionnement d’Auth0](https://auth0.com/docs/overview)
      et informez-vous sur [la mise en œuvre de l’authentification
      et de l’autorisation d’API](https://auth0.com/docs/api-auth) au moyen du framework OAuth 2.0.
    </Info>

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Les autorisations vous permettent de définir comment les ressources peuvent être accessibles au nom de l’utilisateur au moyen d’un jeton d’accès donné. Par exemple, vous pourriez choisir d’accorder un accès en lecture à la ressource `messages` si les utilisateurs ont le niveau d’accès gestionnaire, et un accès en écriture à cette ressource s’ils ont le niveau d’accès administrateur.

      Vous pouvez définir les autorisations à accorder dans la vue **Permissions** de la section [APIs](https://manage.auth0.com/#/apis) de l’Auth0 Dashboard.

      <Frame>
        <img src="/docs/images/cdy7uua7fh8z/5EnGfdqLVZ8fuIxbUn7gm1/7e6b2fb38a7452b2b540099a4a888822/configure-permissions.png" />
      </Frame>

      <Info>
        Cet exemple utilise la portée `read:messages`.
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      Tout d’abord, installez la trousse de développement logiciel (SDK) avec `npm`.

      ```bash lines
      npm install --save express-oauth2-jwt-bearer
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      Configurez `express-oauth2-jwt-bearer` avec votre Domaine et l’identifiant de votre API.

      Le middleware `checkJwt` affiché à droite vérifie si le jeton d’accès de l’utilisateur présent dans la requête
      est valide. Si le jeton n’est pas valide, l’utilisateur reçoit une erreur 401 d’autorisation lorsqu’il tente d’accéder aux
      points de terminaison.

      Le middleware ne vérifie pas si le jeton possède une portée suffisante pour accéder aux ressources demandées.

      <Server />
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      Pour protéger une route individuelle en exigeant un JWT valide, configurez la route avec le middleware `checkJwt`
      construit à partir de `express-oauth2-jwt-bearer`.

      Vous pouvez configurer des routes individuelles pour rechercher une portée particulière. Pour ce faire, configurez un autre intergiciel
      avec la méthode `requiresScope`. Fournissez les portées requises et appliquez l&#39;intergiciel à toutes les routes auxquelles vous
      souhaitez ajouter une autorisation.

      Passez les middlewares `checkJwt` et `requiredScopes` à la route que vous souhaitez protéger.

      Dans cette configuration, seuls les jetons d&#39;accès ayant la portée `read:messages` peuvent accéder au point de terminaison.

      ### Effectuer un appel à votre API

      Pour effectuer des appels à votre API, vous avez besoin d&#39;un jeton d&#39;accès. Vous pouvez obtenir un jeton d&#39;accès à des fins de test dans la vue
      **Test** de vos [paramètres
      d&#39;API](https://manage.auth0.com/#/apis).

      <Frame>
        <img src="/docs/images/cdy7uua7fh8z/5HUMcKGXoNOvdJNXFI73oi/46a590997c56f9ca9aaf4d7da916575a/Tokens_-_English.png" />
      </Frame>

      Fournissez le jeton d&#39;accès comme en-tête `Authorization` dans vos requêtes.

      <AuthCodeGroup>
        ```bash cURL lines
        curl --request get \
        --url 'http:///%7ByourDomain%7D/api_path' \
        --header 'authorization: Bearer YOUR_ACCESS_TOKEN_HERE'
        ```

        ```csharp C# lines
        var client = new RestClient("http:///%7ByourDomain%7D/api_path");
        var request = new RestRequest(Method.GET);
        request.AddHeader("authorization", "Bearer YOUR_ACCESS_TOKEN_HERE");
        IRestResponse response = client.Execute(request);
        ```

        ```go Go lines
        package main
        import (
        "fmt"
        "net/http"
        "io/ioutil"
        )
        func main() {
        url := "http:///%7ByourDomain%7D/api_path"
        req, _ := http.NewRequest("get", url, nil)
        req.Header.Add("authorization", "Bearer VOTRE_JETON_ACCES_ICI")
        res, _ := http.DefaultClient.Do(req)
        defer res.Body.Close()
        body, _ := ioutil.ReadAll(res.Body)
        fmt.Println(res)
        fmt.Println(string(body))
        }
        ```

        ```java Java lines
        HttpResponse<String> response = Unirest.get("http:///%7ByourDomain%7D/api_path")
        .header("authorization", "Bearer YOUR_ACCESS_TOKEN_HERE")
        .asString();
        ```

        ```javascript Node.JS lines
        var axios = require("axios").default;
        var options = {
        method: 'get',
        url: 'http:///%7ByourDomain%7D/api_path',
        headers: {authorization: 'Bearer VOTRE_JETON_ACCES_ICI'}
        };
        axios.request(options).then(function (response) {
        console.log(response.data);
        }).catch(function (error) {
        console.error(error);
        });
        ```

        ```objc Obj-C lines
        #import <Foundation/Foundation.h>
        NSDictionary *headers = @{ @"authorization": @"Bearer VOTRE_JETON_D_ACCES_ICI" };
        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http:///%7ByourDomain%7D/api_path"]
                                                        cachePolicy:NSURLRequestUseProtocolCachePolicy

                                                    timeoutInterval:10.0];

        [request setHTTPMethod:@"get"];
        [request setAllHTTPHeaderFields:headers];
        NSURLSession *session = [NSURLSession sharedSession];
        NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:request
                                                completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {

                                                    if (error) {

                                                        NSLog(@&quot;%@&quot;, error);

                                                    } else {

                                                        NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *) response;

                                                        NSLog(@&quot;%@&quot;, httpResponse);

                                                    }

                                                }];

        [dataTask resume];
        ```

        ```php PHP lines
        #import <Foundation/Foundation.h>
        NSDictionary *headers = @{ @"authorization": @"Bearer VOTRE_JETON_D_ACCES_ICI" };
        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http:///%7ByourDomain%7D/api_path"]
                                                        cachePolicy:NSURLRequestUseProtocolCachePolicy

                                                    timeoutInterval:10.0];

        [request setHTTPMethod:@"get"];
        [request setAllHTTPHeaderFields:headers];
        NSURLSession *session = [NSURLSession sharedSession];
        NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:request
                                                completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {

                                                    if (error) {

                                                        NSLog(@&quot;%@&quot;, error);

                                                    } else {

                                                        NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *) response;

                                                        NSLog(@&quot;%@&quot;, httpResponse);

                                                    }

                                                }];

        [dataTask resume];
        ```

        ```python Python lines
        import http.client
        conn = http.client.HTTPConnection("")
        headers = { 'authorization': "Bearer VOTRE_JETON_ACCES_ICI" }
        conn.request("get", "/%7ByourDomain%7D/api_path", headers=headers)
        res = conn.getresponse()
        data = res.read()
        print(data.decode("utf-8"))
        ```

        ```ruby Ruby lines
        require 'uri'
        require 'net/http'
        url = URI("http:///%7ByourDomain%7D/api_path")
        http = Net::HTTP.new(url.host, url.port)
        request = Net::HTTP::Get.new(url)
        request["authorization"] = 'Bearer YOUR_ACCESS_TOKEN_HERE'
        response = http.request(request)
        puts response.read_body
        ```

        ```swift Swift lines
        import Foundation
        let headers = ["authorization": "Bearer VOTRE_JETON_ACCES_ICI"]
        let request = NSMutableURLRequest(url: NSURL(string: "http:///%7ByourDomain%7D/api_path")! as URL,
                                            cachePolicy: .useProtocolCachePolicy,

                                        timeoutInterval: 10.0)

        request.httpMethod = "get"
        request.allHTTPHeaderFields = headers
        let session = URLSession.shared
        let dataTask = session.dataTask(with: request as URLRequest, completionHandler: { (data, response, error) -> Void in
        if (error != nil) {
        print(error)

        } else {
        let httpResponse = response as? HTTPURLResponse

        print(httpResponse)

        }
        })
        dataTask.resume()
        ```
      </AuthCodeGroup>

      <Note>
        ##### Point de contrôle

        Maintenant que vous avez configuré votre application, lancez-la afin de vérifier que :

        * `GET /api/public` est disponible pour les requêtes non authentifiées.
        * `GET /api/private` est disponible pour les requêtes authentifiées.
        * `GET /api/private-scoped` est disponible pour les requêtes authentifiées contenant un jeton d&#39;accès avec la portée `read:messages`.
      </Note>

      <Server2 />
    </Section>

    ## Prochaines étapes

    Excellent travail! Si vous vous êtes rendu jusqu&#39;ici, vous devriez maintenant avoir la connexion, la déconnexion et les informations de profil utilisateur qui fonctionnent dans votre application.

    Ce tutoriel de démarrage rapide est maintenant terminé, mais il reste encore beaucoup à découvrir. Pour en savoir plus sur ce que vous pouvez faire avec Auth0, consultez :

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Apprenez à configurer et gérer votre locataire Auth0 et vos applications
    * [express-oauth2-jwt-bearer SDK](https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer) - Explorez plus en détail la trousse de développement logiciel (SDK) utilisée dans ce tutoriel
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Découvrez des intégrations que vous pouvez activer pour étendre les fonctionnalités d’Auth0
  </Content>
</Recipe>