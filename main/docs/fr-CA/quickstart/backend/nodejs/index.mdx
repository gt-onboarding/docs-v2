---
title: "API Node (Express) : Autorisation"
permalink: "01-authorization"
---

import {AuthCodeBlock} from "/snippets/fr-CA/AuthCodeBlock.jsx";

<div id="by-david-patrick">
  ##### Par David Patrick
</div>

Ce tutoriel montre comment ajouter la gestion des autorisations à une API Express.js. Nous vous recommandons d’ouvrir une session pour suivre ce démarrage rapide avec des exemples configurés pour votre compte.

{/* <Card title="Voir sur GitHub" href="https://github.com/auth0-samples/auth0-express-api-samples/tree/master/01-Authorization-RS256" icon="github">
  Configuration système requise : express-oauth2-jwt-bearer 1.0.0
  </Card> */}

<Info>
  **Vous découvrez Auth0?** Découvrez [le fonctionnement d’Auth0](/docs/fr-CA/get-started/auth0-overview) et apprenez à [mettre en œuvre l’authentification et l’autorisation pour les API](/docs/fr-CA/get-started/authentication-and-authorization-flow) à l’aide du cadre OAuth 2.0.
</Info>

<div id="configure-auth0-apis">
  ## Configurer les API d&#39;Auth0
</div>

<div id="create-an-api">
  ### Créer une API
</div>

Dans la section [APIs](https://manage.auth0.com/#/apis) du Auth0 Dashboard, cliquez sur **Create API**. Indiquez un nom et un identifiant pour votre API, par exemple `https://quickstarts/api`. Vous utiliserez cet identifiant comme valeur d&#39;`audience` ultérieurement, lors de la configuration de la vérification du jeton d&#39;accès. Conservez **RS256** comme **Signing Algorithm**.

<Frame>![Créer une API](https://cdn2.auth0.com/docs/1.14550.0/media/articles/server-apis/create-api.png)</Frame>

Par défaut, votre API utilise RS256 comme algorithme de signature des jetons. Puisque RS256 utilise une paire de clés privée/publique, il vérifie les jetons à l&#39;aide de la clé publique associée à votre compte Auth0. La clé publique est disponible au format [JSON Web Key Set (JWKS)](/docs/fr-CA/secure/tokens/json-web-tokens/json-web-key-sets) et accessible [ici](https://\{yourDomain}/.well-known/jwks.json).

<Info>
  Nous recommandons d&#39;utiliser l&#39;[algorithme de signature](/docs/fr-CA/get-started/applications/signing-algorithms) RS256 par défaut pour votre API. Si vous devez utiliser l&#39;algorithme HS256, consultez l&#39;[exemple d&#39;intégration HS256](https://github.com/auth0-samples/auth0-express-api-samples/tree/master/02-Authorization-HS256).
</Info>

<div id="define-permissions">
  ### Définir des permissions
</div>

Les permissions vous permettent de définir comment les ressources peuvent être consultées au nom de l’utilisateur avec un jeton d’accès donné. Par exemple, vous pourriez choisir d’accorder un accès en lecture à la ressource `messages` si les utilisateurs ont le niveau d’accès de gestionnaire, et un accès en écriture à cette ressource s’ils ont le niveau d’accès d’administrateur.

Vous pouvez définir les permissions autorisées dans la vue **Permissions** de la section [APIs](https://manage.auth0.com/#/apis) de l’Auth0 Dashboard.

<Frame>![Configure Permissions](https://cdn2.auth0.com/docs/1.14550.0/media/articles/server-apis/configure-permissions.png)</Frame>

<Info>
  Cet exemple utilise la portée `read:messages`.
</Info>

Cet exemple illustre les éléments suivants :

* Comment vérifier la présence d’un JSON Web Token (JWT) dans l’en-tête `Authorization` d’une requête HTTP entrante.
* Comment vérifier si le jeton est valide en utilisant l’[ensemble de clés JSON Web (JWKS)](/docs/fr-CA/secure/tokens/json-web-tokens/json-web-key-sets) pour votre compte Auth0. Pour en savoir plus sur la validation des jetons d’accès, consultez [Valider les jetons d’accès](/docs/fr-CA/secure/tokens/access-tokens/validate-access-tokens).

<div id="validate-access-tokens">
  ## Valider les jetons d’accès
</div>

<div id="install-dependencies">
  ### Installer les dépendances
</div>

Ce guide explique comment protéger une API Express à l’aide du middleware [express-oauth2-jwt-bearer](https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer).

Commencez par installer la trousse de développement logiciel (SDK) en utilisant npm.

```bash
npm install --save express-oauth2-jwt-bearer
```

<div id="configure-the-middleware">
  ### Configurer le middleware
</div>

Configurez `express-oauth2-jwt-bearer` avec votre domaine et l’identifiant de votre API.

export const codeExample = `// server.js

const express = require('express');
const app = express();
const { auth } = require('express-oauth2-jwt-bearer');

// Middleware d'autorisation. Lorsqu'il est utilisé, le jeton d’accès doit
// exister et être vérifié par rapport au jeu de clés Web JSON d'Auth0.
const checkJwt = auth({
  audience: '{yourApiIdentifier}',
  issuerBaseURL: \`https://{yourDomain}/\`,
});`;

<AuthCodeBlock children={codeExample} language="javascript" />

Le middleware `checkJwt` illustré ci-dessus vérifie si le jeton d’accès de l’utilisateur inclus dans la requête est valide. Si le jeton n’est pas valide, l’utilisateur reçoit une erreur d’autorisation 401 lorsqu’il tente d’accéder aux points de terminaison. Le middleware ne vérifie pas si le jeton dispose de la portée nécessaire pour accéder aux ressources demandées.

<div id="protect-api-endpoints">
  ## Protéger les points de terminaison d’API
</div>

Les routes ci-dessous sont disponibles pour les requêtes suivantes :

* `GET /api/public` : disponible pour les requêtes non authentifiées
* `GET /api/private` : disponible pour les requêtes authentifiées contenant un jeton d’accès sans scopes supplémentaires
* `GET /api/private-scoped` : disponible pour les requêtes authentifiées contenant un jeton d’accès avec le scope `read:messages` accordé

Pour protéger une route individuelle qui nécessite un JWT valide, configure la route avec le middleware `checkJwt` d’`express-oauth2-jwt-bearer`.

```javascript lines
// server.js

// Cette route ne nécessite pas d'authentification
app.get('/api/public', function(req, res) {
  res.json({
    message: 'Hello from a public endpoint! You don\'t need to be authenticated to see this.'
  });
});

// Cette route nécessite une authentification
app.get('/api/private', checkJwt, function(req, res) {
  res.json({
    message: 'Hello from a private endpoint! You need to be authenticated to see this.'
  });
});
```

Vous pouvez configurer des routes individuelles pour vérifier la présence d’une portée particulière. Pour ce faire, configurez un middleware supplémentaire avec la méthode `requiresScope`. Indiquez les scopes requis et appliquez le middleware à toutes les routes pour lesquelles vous voulez ajouter une autorisation.

Passez les middlewares `checkJwt` et `requiredScopes` à la route que vous voulez protéger.

```javascript lines
// server.js
const { requiredScopes } = require('express-oauth2-jwt-bearer');

const checkScopes = requiredScopes('read:messages');

app.get('/api/private-scoped', checkJwt, checkScopes, function(req, res) {
  res.json({
    message: 'Bonjour depuis un point de terminaison privé! Vous devez être authentifié et disposer de la portée read:messages pour voir ceci.'
  });
});
```

Dans cette configuration, seuls les jetons d&#39;accès avec la portée `read:messages` peuvent accéder au point de terminaison.

<Info>
  ##### Que pouvez-vous faire ensuite ?

  <table>
    <tr>
      <td><a href="/docs/fr-CA/authenticate/identity-providers">Configurer d&#39;autres fournisseurs d&#39;identité</a></td>
      <td><a href="/docs/fr-CA/secure/multi-factor-authentication">Activer l&#39;authentification multifacteur</a></td>
    </tr>

    <tr>
      <td><a href="/docs/fr-CA/secure/attack-protection">En savoir plus sur la protection contre les attaques</a></td>
      <td><a href="/docs/fr-CA/customize/rules">En savoir plus sur Rules</a></td>
    </tr>
  </table>

  [Modifier sur GitHub](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>

***
