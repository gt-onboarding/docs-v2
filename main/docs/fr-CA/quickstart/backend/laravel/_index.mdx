---
title: Ajouter l’autorisation à votre application Laravel
sidebarTitle: API Laravel

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/fr-CA/recipe.jsx";
import { LoggedInForm } from "/snippets/fr-CA/Login.jsx";
import Api from "/snippets/fr-CA/quickstart/backend/laravel/api.php.mdx";
import Api2 from "/snippets/fr-CA/quickstart/backend/laravel/api.php2.mdx";
import Api3 from "/snippets/fr-CA/quickstart/backend/laravel/api.php3.mdx";

export const sections = [
  { id: "laravel-installation", title: "Installation de Laravel" },
  { id: "sdk-installation", title: "Installation du SDK" },
  { id: "sdk-configuration", title: "Configuration du SDK" },
  { id: "access-control", title: "Contrôle d'accès" },
  { id: "token-information", title: "Informations sur le jeton" },
  { id: "retrieve-user-information", title: "Obtenir les informations de l'utilisateur" },
  { id: "run-the-application", title: "Exécuter l'application" },
  { id: "retrieve-a-test-token", title: "Obtenir un jeton de test" }
]


<Recipe isSingleColumn>
  <Content>
    [La trousse de développement logiciel (SDK) Laravel d&#39;Auth0](https://github.com/auth0/laravel-auth0)
    vous permet d&#39;ajouter rapidement l&#39;autorisation basée sur les jetons et le contrôle d&#39;accès aux routes à votre application Laravel. Ce guide
    montre comment intégrer Auth0 avec une application [Laravel 9
    ou 10](https://github.com/auth0/laravel-auth0#support-policy) nouvelle (ou existante).

    **Les applications backend diffèrent des applications Web traditionnelles en ce qu&#39;elles ne gèrent pas l&#39;authentification des utilisateurs et
    n&#39;ont pas d&#39;interface utilisateur. Elles fournissent une API avec laquelle d&#39;autres applications peuvent interagir. Elles acceptent des **[jetons d&#39;accès](https://auth0.com/docs/secure/tokens/access-tokens)** provenant
    des en-têtes **`Authorization`** dans les requêtes pour contrôler l&#39;accès aux routes.**

    Des applications frontales distinctes sont généralement conçues pour interagir avec ces types de systèmes dorsaux. Celles-ci peuvent être
    des [applications monopages](https://auth0.com/docs/quickstart/spa) ou des [applications natives ou mobiles](https://auth0.com/docs/quickstart/native) (pour lesquelles Auth0 fournit
    également des trousses de développement logiciel (SDK)!)

    Lorsque les utilisateurs doivent interagir avec votre application backend, ils s&#39;authentifient d&#39;abord auprès d&#39;Auth0 à l&#39;aide de l&#39;application frontend. L&#39;application frontend récupère ensuite un jeton d&#39;accès d&#39;Auth0, qu&#39;elle peut utiliser pour effectuer des requêtes à votre application backend au nom de l&#39;utilisateur.

    Comme leur nom l&#39;indique, les [jetons d&#39;accès](https://auth0.com/docs/secure/tokens/access-tokens) sont conçus pour gérer le contrôle d&#39;accès (autorisation) et ne contiennent pas d&#39;informations sur l&#39;utilisateur. **Les applications backend fonctionnent exclusivement avec des jetons d&#39;accès.** Vous pouvez récupérer les informations sur l&#39;utilisateur qui a créé le jeton à l&#39;aide de l&#39;[API de gestion](https://auth0.com/docs/api/management/v2), ce que nous démontrerons plus tard.

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      **Si vous n&#39;avez pas encore d&#39;application Laravel configurée**, ouvrez un terminal dans un répertoire approprié pour un nouveau
      projet et exécutez la commande suivante :

      ```bash lines wrap
      composer create-project --prefer-dist laravel/laravel auth0-laravel-api ^9.0
      ```

      Toutes les commandes de ce guide partent du principe que vous les exécutez à partir de la racine de votre projet Laravel. Vous devez donc vous placer dans le nouveau répertoire du projet à l&#39;aide de `cd` :

      ```bash lines
      cd auth0-laravel-api
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      Exécutez la commande suivante dans le répertoire de votre projet pour installer la [Trousse de développement logiciel (SDK) Auth0 Laravel](https://github.com/auth0/laravel-auth0) :

      ```bash lines
      composer require auth0/login:^7.8 --update-with-all-dependencies
      ```

      Générez ensuite un fichier de configuration de la trousse de développement logiciel (SDK) pour votre application :

      ```bash lines
      php artisan vendor:publish --tag auth0
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      Exécutez la commande suivante dans le répertoire de votre projet pour télécharger [Auth0 CLI](https://github.com/auth0/auth0-cli) :

      ```bash lines wrap
      curl -sSfL https://raw.githubusercontent.com/auth0/auth0-cli/main/install.sh | sh -s -- -b .
      ```

      Authentifiez ensuite la CLI avec votre compte Auth0 et choisissez « en tant qu’utilisateur » lorsque vous y êtes invité :

      ```bash lines
      ./auth0 login
      ```

      Ensuite, créez une nouvelle Application dans Auth0 :

      ```bash lines
      ./auth0 apps create \
        --name "My Laravel Backend" \
        --type "regular" \
        --auth-method "post" \
        --callbacks "http://localhost:8000/callback" \
        --logout-urls "http://localhost:8000" \
        --reveal-secrets \
        --no-input \
        --json > .auth0.app.json
      ```

      Créez également une nouvelle API :

      ```bash lines
      ./auth0 apis create \
        --name "Mon API Backend Laravel" \
        --identifier "https://github.com/auth0/laravel-auth0" \
        --offline-access \
        --no-input \
        --json > .auth0.api.json
      ```

      Cela génère deux fichiers dans le répertoire de votre projet qui configurent la trousse de développement logiciel (SDK).

      Comme ces fichiers contiennent des identifiants, il est important de les traiter comme des données sensibles. Vous devez vous assurer de ne pas les valider dans votre système de contrôle de version. Si vous utilisez Git, vous devriez les ajouter à votre fichier `.gitignore` :

      ```bash lines
      echo ".auth0.*.json" >> .gitignore
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      Le SDK enregistre automatiquement son garde d&#39;autorisation dans votre application Laravel pour une utilisation avec le middleware `api`, que Laravel applique par défaut à toutes les routes du fichier `routes/api.php` de votre application.

      <Warning>
        Pour que le SDK fonctionne comme prévu sans configuration supplémentaire, **vous devez définir vos routes dans
        le fichier ****`routes/api.php`****.**
      </Warning>

      Vous pouvez utiliser le garde d&#39;autorisation du SDK Auth0 pour restreindre l&#39;accès aux routes de votre application.

      Pour rejeter les requêtes qui ne contiennent pas de jeton d’accès valide dans l’en-tête `Authorization`, vous pouvez utiliser
      le middleware `auth` de Laravel :

      ```php lines
      Route::get('/private', function () {
      return response()->json([
      'message' => 'Votre jeton est valide ; vous êtes autorisé.',
      ]);
      })->middleware('auth');
      ```

      Vous pouvez aussi exiger que le jeton fourni possède des [autorisations](https://auth0.com/docs/manage-users/access-control/rbac) spécifiques en le combinant
      avec le middleware `can` de Laravel :

      ```php lines
      Route::get('/scope', function () {
      return response()->json([
      'message' => 'Votre jeton est valide et possède la permission read:messages ; vous êtes autorisé.',
      ]);
      })->middleware('auth')->can('read:messages');
      ```

      <Api />
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      L’information relative au jeton d’accès fourni est disponible par l’entremise de la façade `Auth` de Laravel ou de la fonction d’assistance
      `auth()`.

      Par exemple, pour obtenir l’identifiant et l’adresse de courriel de l’utilisateur :

      ```php lines
      Route::get('/', function () {
      if (! auth()->check()) {
      return response()->json([
      'message' => 'You did not provide a valid token.',
      ]);
      }
      return response()->json([
      'message' => 'Votre jeton est valide ; vous êtes autorisé.',
      'id' => auth()->id(),
      'token' => auth()?->user()?->getAttributes(),
      ]);
      });
      ```

      <Api2 />
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      Vous pouvez récupérer des informations sur l’utilisateur qui a créé le jeton d’accès auprès d’Auth0 en utilisant la [Management API d’Auth0](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md). La Trousse de développement logiciel (SDK) fournit une interface pratique pour cette API, accessible au moyen de la méthode `management()` du SDK.

      **Avant d’effectuer des appels à la Management API, vous devez autoriser votre application à communiquer avec la Management API.** Vous pouvez le faire à partir de la [page API de l’Auth0 Dashboard](https://manage.auth0.com/#/apis/), en choisissant `Auth0 Management API`, puis en sélectionnant l’onglet `Machine to Machine Applications`. Autorisez votre application Laravel, puis cliquez sur la flèche vers le bas pour choisir les scopes que vous souhaitez accorder.

      Pour l’exemple suivant, vous devez accorder le scope `read:users`. Vous trouverez une liste des points de terminaison de l’API et des scopes requis dans [la documentation de la Management API](https://auth0.com/docs/api/management/v2).

      ```php lines
      use Auth0\Laravel\Facade\Auth0;
      Route::get('/me', function () {
      $user = auth()->id();
      $profile = cache()->get($user);
      if (null === $profile) {
      $endpoint = Auth0::management()->users();
      $profile = $endpoint->get($user);
      $profile = Auth0::json($profile);
      cache()->put($user, $profile, 120);
      }
      $name = $profile['name'] ?? 'Inconnu';
      $email = $profile['email'] ?? 'Inconnu';
      return response()->json([
      'name' => $name,
      'email' => $email,
      ]);
      })->middleware('auth');
      ```

      <Info>
        **Vous devriez mettre en cache les informations sur l’utilisateur dans votre application pour de courtes périodes.** Cela réduit le nombre
        de requêtes que votre application envoie à Auth0 et améliore les performances. Vous devriez éviter de stocker les
        informations sur l’utilisateur dans votre application pendant de longues périodes, car cela peut entraîner l’obsolescence des données. Vous devriez également éviter de stocker des informations sur l’utilisateur, autres que son identifiant, dans des bases de données persistantes.
      </Info>

      <Api3 />
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7" isSingleColumn>
      Vous pouvez maintenant démarrer votre application Laravel afin qu’elle puisse accepter des requêtes :

      ```bash lines
      php artisan serve
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[7].id} title={sections[7].title} stepNumber="8" isSingleColumn>
      Vous pouvez en apprendre davantage sur [la récupération de jetons d’accès ici](https://auth0.com/docs/secure/tokens/access-tokens/get-access-tokens). Pour ce démarrage rapide, toutefois, vous pouvez simplement utiliser un jeton d’accès
      provenant de [la vue « test » dans les paramètres de votre API](https://manage.auth0.com/#/apis).

      <Info>
        La route `/me` que nous avons créée plus haut ne fonctionnera pas avec un jeton de test, puisqu’aucun véritable utilisateur
        n’y est associé.
      </Info>

      <Note>
        ##### Point de contrôle

        Ouvrez un shell et essayez d’émettre des requêtes vers votre application.

        Commencez par appeler la route publique :

        `curl --request GET \ --url http://localhost:8000/api \ --header 'Accept: application/json'`

        Ensuite, utilisez votre jeton d’accès dans un en-tête `Authorization` pour appeler une route protégée :

        `curl --request GET \ --url http://localhost:8000/api/private \ --header 'Accept: application/json' \ --header 'Authorization: Bearer YOUR_ACCESS_TOKEN'`

        Enfin, essayez d’appeler la route protégée par portée, qui ne réussira que si le jeton d’accès s’est vu accorder la
        portée `read:messages` :

        `curl --request GET \ --url http://localhost:8000/api/scope \ --header 'Accept: application/json' \ --header 'Authorization: Bearer YOUR_ACCESS_TOKEN'`
      </Note>

      ### Lecture supplémentaire

      * [User Repositories and Models](https://github.com/auth0/laravel-auth0/blob/main/docs/Users.md) explique comment étendre la trousse de développement logiciel (SDK) Auth0 Laravel pour utiliser des modèles
        d’utilisateurs personnalisés, ainsi que la façon de stocker et de récupérer les utilisateurs à partir d’une base de données.
      * [Hooking Events](https://github.com/auth0/laravel-auth0/blob/main/docs/Events.md) décrit comment écouter les événements émis par le SDK Auth0 Laravel
        afin de personnaliser entièrement le comportement de votre intégration.
      * La prise en charge de la [Management API](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md) est intégrée au SDK Auth0 Laravel, ce qui vous permet
        d’interagir avec la Management API à partir de votre application Laravel.

      <LoggedInForm />
    </Section>

    ## Prochaines étapes

    Excellent travail! Si vous vous êtes rendu jusqu&#39;ici, vous devriez maintenant avoir la connexion, la déconnexion et les informations de profil utilisateur qui fonctionnent dans votre application.

    Ce tutoriel de démarrage rapide est maintenant terminé, mais il reste encore beaucoup à découvrir. Pour en savoir plus sur ce que vous pouvez faire avec Auth0, consultez :

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Découvrez comment configurer et gérer votre tenant Auth0 et vos applications
    * [Trousse de développement logiciel (SDK) laravel-auth0](https://github.com/auth0/laravel-auth0) - Pour en savoir plus sur la trousse de développement logiciel (SDK) utilisée dans ce tutoriel
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Découvrez des intégrations que vous pouvez activer pour étendre les fonctionnalités d’Auth0
  </Content>
</Recipe>