---
title: Ajouter l’autorisation à votre application Web API ASP.NET OWIN
sidebarTitle: ASP.NET Web API (OWIN)

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/fr-CA/recipe.jsx";
import { LoggedInForm } from "/snippets/fr-CA/Login.jsx";
import Openidconnectsigningkeyresolver from "/snippets/fr-CA/quickstart/backend/webapi-owin/OpenIdConnectSigningKeyResolver.cs.mdx";
import Scopeauthorizeattribute from "/snippets/fr-CA/quickstart/backend/webapi-owin/ScopeAuthorizeAttribute.cs.mdx";
import Apicontroller from "/snippets/fr-CA/quickstart/backend/webapi-owin/ApiController.cs.mdx";

import {AuthCodeGroup} from "/snippets/fr-CA/AuthCodeGroup.jsx";

export const sections = [
      { id: "define-permissions", title: "Définir les autorisations" },
      { id: "install-dependencies", title: "Installer les dépendances" },
      { id: "configure-the-middleware", title: "Configurer le middleware" },
      { id: "verify-the-token-signature", title: "Vérifier la signature du jeton" },
      { id: "validate-scopes", title: "Valider les scopes" },
      { id: "protect-api-endpoints", title: "Protéger les points de terminaison de l’API" }
]


<Recipe isSingleColumn>
  <Content>
    Auth0 vous permet d&#39;ajouter l&#39;autorisation à n&#39;importe quel type d&#39;application. Ce guide explique comment intégrer Auth0
    à toute application API Web ASP.NET Owin nouvelle ou existante à l&#39;aide du package `Microsoft.Owin.Security.Jwt`.

    Si vous n&#39;avez pas encore créé d&#39;API dans votre Auth0 Dashboard, vous pouvez utiliser le sélecteur interactif pour créer une nouvelle API Auth0 ou sélectionner une API existante pour votre projet.

    Pour configurer votre première API via le tableau de bord Auth0, consultez notre guide de démarrage.

    Chaque API Auth0 utilise l&#39;identifiant d&#39;API, que votre application doit utiliser pour valider le jeton d&#39;accès.

    <Info>
      **Nouveau chez Auth0 ?** Découvrez comment Auth0 fonctionne et
      apprenez à mettre en œuvre l’authentification et
      l’autorisation d’API à l’aide du framework OAuth 2.0.
    </Info>

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Les permissions vous permettent de définir comment les ressources peuvent être consultées au nom de l’utilisateur au moyen d’un jeton d’accès donné. Par
      exemple, vous pouvez choisir d’accorder un accès en lecture à la ressource `messages` si les utilisateurs ont le niveau d’accès gestionnaire
      et un accès en écriture à cette ressource s’ils ont le niveau d’accès administrateur.

      Vous pouvez définir les permissions autorisées dans la vue **Permissions** de la section [APIs](https://manage.auth0.com/#/apis) de l’Auth0 Dashboard. L’exemple suivant utilise la portée `read:messages`.

      <Frame>
        <img src="/docs/images/cdy7uua7fh8z/1s3Yp5zqJiKiSWqbPSezNO/e61793a2822d095666002c3f65c71ac2/configure-permissions.png" />
      </Frame>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      Installez le package NuGet `Microsoft.Owin.Security.Jwt`. Ce package contient le middleware JWT OWIN
      nécessaire pour utiliser les jetons d’accès Auth0 dans l’API Web OWIN ASP.NET.

      ```ps lines
      Install-Package Microsoft.Owin.Security.Jwt
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      Accédez à la méthode `Configuration` de votre classe `Startup` et ajoutez un appel à
      `UseJwtBearerAuthentication` en lui transmettant les `JwtBearerAuthenticationOptions` configurées.

      Les `JwtBearerAuthenticationOptions` doivent spécifier l’Identificateur d’API Auth0 dans la propriété
      `ValidAudience`, et le chemin complet vers votre domaine Auth0 comme `ValidIssuer`. Vous devrez
      configurer `IssuerSigningKeyResolver` pour utiliser l’instance de
      `OpenIdConnectSigningKeyResolver` afin de résoudre la clé de signature.

      <Warning>
        **N’oubliez pas la barre oblique finale.**

        Assurez-vous que l’URL indiquée pour `ValidIssuer` contient une barre oblique (`/`) à la fin.
        Celle-ci doit correspondre exactement à la revendication d’émetteur (`iss`) du JWT. Les appels à l’API ne
        seront pas authentifiés correctement si cette valeur est mal configurée.
      </Warning>

      <AuthCodeGroup>
        <Openidconnectsigningkeyresolver />

        <Scopeauthorizeattribute />

        <Apicontroller />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      Le middleware OWIN JWT n&#39;utilise pas Open ID Connect Discovery par défaut; vous devez donc fournir un
      `IssuerSigningKeyResolver` personnalisé.

      Créez la classe `OpenIdConnectSigningKeyResolver` et assurez-vous de retourner la `SecurityKey`
      correcte en implémentant `GetSigningKey`. Cette classe est ensuite utilisée comme
      `TokenValidationParameters.IssuerSigningKeyResolver` lors de la configuration du middleware dans
      `Startup.cs`.

      <Info>
        Ce résolveur personnalisé est déprécié et [n&#39;est plus disponible](https://github.com/auth0/auth0-aspnet-owin/blob/master/SECURITY-NOTICE.md). Vous devez fournir vous-même ce résolveur personnalisé.
      </Info>

      <AuthCodeGroup>
        <Openidconnectsigningkeyresolver />

        <Scopeauthorizeattribute />

        <Apicontroller />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      Le middleware JWT vérifie que le jeton d’accès inclus dans la requête est valide ; toutefois, il n’inclut pas encore de mécanisme pour vérifier que le jeton a la **portée** suffisante pour accéder aux ressources demandées.

      Créez une classe appelée `ScopeAuthorizeAttribute` qui hérite de `System.Web.Http.AuthorizeAttribute`. Cet attribut vérifiera que la revendication `scope` émise par votre tenant Auth0 est présente et, le cas échéant, s’assurera que la revendication `scope` contient la portée demandée.

      <AuthCodeGroup>
        <Scopeauthorizeattribute />

        <Openidconnectsigningkeyresolver />

        <Apicontroller />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      Les routes indiquées ci-dessous sont disponibles pour les requêtes suivantes :

      * `GET /api/public` : Disponible pour les requêtes non authentifiées.
      * `GET /api/private` : Disponible pour les requêtes authentifiées contenant un jeton d’accès sans
        portée supplémentaire.
      * `GET /api/private-scoped` : Disponible pour les requêtes authentifiées contenant un jeton d’accès avec
        la portée `read:messages` accordée.

      Le middleware JWT s’intègre aux mécanismes standard d’authentification et d’autorisation d’ASP.NET, vous
      n’avez donc qu’à décorer votre action de contrôleur avec l’attribut `[Authorize]` pour sécuriser un point de terminaison.

      Mettez à jour l’action avec l’attribut `ScopeAuthorize` et transmettez le nom de la
      `scope` requise dans le paramètre `scope`. Cela garantit que la portée correcte est disponible pour appeler
      un point de terminaison d’API spécifique.

      <Note>
        ##### Point de contrôle

        Maintenant que vous avez configuré votre application, exécutez votre application et vérifiez que :

        * `GET /api/public` est disponible pour les requêtes non authentifiées.
        * `GET /api/private` est disponible pour les requêtes authentifiées.
        * `GET /api/private-scoped` est disponible pour les requêtes authentifiées contenant un jeton d’accès
          avec la portée `read:messages`.
      </Note>

      <AuthCodeGroup>
        <Apicontroller />

        <Openidconnectsigningkeyresolver />

        <Scopeauthorizeattribute />
      </AuthCodeGroup>
    </Section>

    ## Prochaines étapes

    Excellent travail! Si vous vous êtes rendu jusqu&#39;ici, vous devriez maintenant avoir la connexion, la déconnexion et les informations de profil utilisateur qui fonctionnent dans votre application.

    Ce tutoriel de démarrage rapide est maintenant terminé, mais il reste encore beaucoup à découvrir. Pour en savoir plus sur ce que vous pouvez faire avec Auth0, consultez :

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Découvrez comment configurer et gérer votre tenant Auth0 et vos applications
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Découvrez des intégrations que vous pouvez activer pour étendre les fonctionnalités d’Auth0
  </Content>
</Recipe>