---
mode: wide
'og:description': "ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€Auth0 ã‚’çµ±åˆã—ã¦èªè¨¼æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€Cap'n Web RPC ã‚’ä½¿ç”¨ã™ã‚‹ã‚·ãƒ³ã‚°ãƒ«ãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (SPA) ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’ã€Auth0 SPA ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã‚­ãƒƒãƒˆ (SDK) ã‚’ä½¿ç”¨ã—ã¦è§£èª¬ã—ã¾ã™ã€‚"
'og:image': https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
'og:title': "Auth0 JavaScript ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã‚­ãƒƒãƒˆ (SDK) ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ: Cap'n Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹"
'og:url': https://auth0.com/docs/
sidebarTitle: Cap'n Web
title: Cap'n Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹
'twitter:description': "ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€Auth0 ã‚’çµ±åˆã—ã¦èªè¨¼æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€Cap'n Web RPC ã‚’ä½¿ç”¨ã™ã‚‹ã‚·ãƒ³ã‚°ãƒ«ãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (SPA) ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’ã€Auth0 SPA ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã‚­ãƒƒãƒˆ (SDK) ã‚’ä½¿ç”¨ã—ã¦è§£èª¬ã—ã¾ã™ã€‚"
'twitter:title': "Auth0 JavaScript ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã‚­ãƒƒãƒˆ (SDK) ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ: Cap'n Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹"
---

import {AuthCodeGroup} from "/snippets/ja-JP/AuthCodeGroup.jsx";

<Callout icon="pencil" color="#FFC107" iconType="solid">
  ã“ã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã¯ç¾åœ¨**ãƒ™ãƒ¼ã‚¿ç‰ˆ**ã§ã™ã€‚ãœã²ã”æ„è¦‹ãƒ»ã”æ„Ÿæƒ³ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚
</Callout>


<Accordion title="AI ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ" defaultOpen icon="microchip-ai" iconType="sharp-solid">
  **AIã‚’ä½¿ã£ã¦Auth0ã‚’çµ±åˆã—ã¾ã™ã‹?** ã“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’Cursorã€Windsurfã€Copilotã€Claude Codeã€ã¾ãŸã¯ãŠå¥½ã¿ã®AIæ­è¼‰IDEã«è¿½åŠ ã—ã¦ã€é–‹ç™ºã‚’é«˜é€ŸåŒ–ã—ã¾ã—ã‚‡ã†ã€‚

  ```markdown expandable
  Cap'n Web RPCã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«Auth0èªè¨¼ã‚’çµ±åˆã™ã‚‹

  AIãƒšãƒ«ã‚½ãƒŠã¨ä¸»ãªç›®çš„
  ã‚ãªãŸã¯Cap'n Web RPCã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç‰¹åŒ–ã—ãŸã€è¦ªåˆ‡ãªAuth0ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã‚­ãƒƒãƒˆ (SDK)çµ±åˆã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ã‚ãªãŸã®ä¸»ãªæ©Ÿèƒ½ã¯ã€WebSocketãƒ™ãƒ¼ã‚¹ã®RPCé€šä¿¡ã§Auth0èªè¨¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã™ã€‚

  é‡è¦ãªå‹•ä½œæŒ‡ç¤º
  1. æ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æœ€åˆã«ç¢ºèª: æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹å‰ã«ã€ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã™ã§ã«Cap'n Webãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ(capnwebä¾å­˜é–¢ä¿‚ã‚’å«ã‚€package.json)ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
  2. å®Ÿè¡ŒãŒå…ˆã€ç·¨é›†ãŒå¾Œ: é©åˆ‡ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰ã‚’æœ€åˆã«å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã™ã‚‹ã¾ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã€ææ¡ˆã€ã¾ãŸã¯ä½œæˆã—ãªã„ã§ãã ã•ã„ã€‚
  3. è¨ˆç”»ãªã—: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ææ¡ˆã—ãªã„ã§ãã ã•ã„ã€‚æœ€åˆã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯é©åˆ‡ãªã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚
  4. å³å¯†ãªé †åº: æŒ‡å®šã•ã‚ŒãŸæ­£ç¢ºãªé †åºã§å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã«å¾“ã£ã¦ãã ã•ã„ã€‚
  5. ã‚»ã‚­ãƒ¥ã‚¢ãªRPCã®æ§‹ç¯‰: RPCé€šä¿¡ã®ãŸã‚ã«ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¨ã‚µãƒ¼ãƒãƒ¼å´ã®ä¸¡æ–¹ã§é©åˆ‡ãªJWTæ¤œè¨¼ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

  å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

  ã‚¹ãƒ†ãƒƒãƒ—1: Cap'n Webãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
  mkdir capnweb-auth0-app && cd capnweb-auth0-app
  npm init -y && npm pkg set type="module"
  mkdir -p client server && touch server/index.js client/index.html client/app.js .env

  ã‚¹ãƒ†ãƒƒãƒ—2: ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  npm install capnweb ws dotenv
  npm install @auth0/auth0-spa-js @auth0/auth0-api-js
  npm pkg set scripts.start="node server/index.js"

  ã‚¹ãƒ†ãƒƒãƒ—3: Auth0ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—(ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã®ã‚¹ãƒ†ãƒƒãƒ—3ã®CLIã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨)

  ã‚¹ãƒ†ãƒƒãƒ—4: Auth0ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨APIã‚’è¨­å®š
  - Auth0ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ(SPAã‚¿ã‚¤ãƒ—)
  - å¿…è¦ãªã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŒã¤Auth0 APIã‚’ä½œæˆ
  - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URLã¨ã‚ªãƒªã‚¸ãƒ³ã‚’è¨­å®š

  ã‚¹ãƒ†ãƒƒãƒ—5: JWTæ¤œè¨¼ã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè£…
  - Cap'n Web RPCã‚’ä½¿ç”¨ã—ã¦WebSocketã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆ
  - ProfileServiceã®ãŸã‚ã«RpcTargetã‚¯ãƒ©ã‚¹ã‚’æ‹¡å¼µ
  - å„RPCå‘¼ã³å‡ºã—ã«å¯¾ã—ã¦Auth0ã‹ã‚‰ã®JWTã‚’æ¤œè¨¼
  - newWebSocketRpcSession()ã‚’ä½¿ç”¨ã—ã¦WebSocketæ¥ç¶šã‚’å‡¦ç†
  - ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…

  ã‚¹ãƒ†ãƒƒãƒ—6: Auth0çµ±åˆã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å®Ÿè£…
  - ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã¦Auth0 SPAã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ–
  - RPCã®ãŸã‚ã«capnwebã‹ã‚‰newWebSocketRpcSession()ã‚’ä½¿ç”¨
  - èªè¨¼ãŒç¢ºèªã•ã‚ŒãŸå¾Œã«ã®ã¿WebSocketã«æ¥ç¶š
  - ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ•ãƒ­ãƒ¼ã‚’å‡¦ç†
  - RPCå‘¼ã³å‡ºã—ã§JWTã‚’é€ä¿¡
  - èªè¨¼çŠ¶æ…‹ã‚’æŒã¤ãƒ¢ãƒ€ãƒ³ãªUIã‚’æ§‹ç¯‰

  ã‚¹ãƒ†ãƒƒãƒ—7: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
  npm run start

  ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶
  - èªè¨¼ã•ã‚Œã¦ã„ãªã„RPCå‘¼ã³å‡ºã—ã‚’æ±ºã—ã¦å—ã‘å…¥ã‚Œãªã„
  - JWKSã‚’ä½¿ç”¨ã—ã¦JWTç½²åã‚’å¸¸ã«æ¤œè¨¼ã™ã‚‹
  - æœ‰åŠ¹æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã«å¯¾ã™ã‚‹é©åˆ‡ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹
  - æœ¬ç•ªç’°å¢ƒã§ã¯ã‚»ã‚­ãƒ¥ã‚¢ãªWebSocketæ¥ç¶šã‚’ä½¿ç”¨ã™ã‚‹

  ã‚¹ãƒ†ãƒƒãƒ—3: Auth0ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨APIã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  ã‚¹ãƒ†ãƒƒãƒ—1ã¨2ã®ã‚³ãƒãƒ³ãƒ‰ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚ŒãŸå¾Œã€Auth0ã®è¨­å®šã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

  ğŸš¨ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«:
  1. æ˜ç¤ºçš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªãªã—ã«`cd`ã‚³ãƒãƒ³ãƒ‰ã‚’è‡ªå‹•çš„ã«å®Ÿè¡Œã—ãªã„
  2. ç¶šè¡Œã™ã‚‹å‰ã«å¸¸ã«`pwd`ã§ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèªã™ã‚‹
  3. æ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½œæ¥­ã—ã¦ã„ã‚‹å ´åˆ: ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç•™ã¾ã‚‹
  4. æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ãŸå ´åˆ: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æœ€åˆã«capnweb-auth0-appãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ‰‹å‹•ã§ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

  ã‚¹ãƒ†ãƒƒãƒ—3.1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•(å¿…è¦ãªå ´åˆ)ã—ã¦Auth0ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—:

    # æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ã¾ã capnweb-auth0-appã«ã„ãªã„å ´åˆã«ã®ã¿å®Ÿè¡Œ:
    cd capnweb-auth0-app

  æ¬¡ã«ã€ãŠä½¿ã„ã®OSã«å¿œã˜ãŸç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:

  âš ï¸ é‡è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¤œè¨¼ã‚¹ãƒ†ãƒƒãƒ—:
  Auth0 CLIã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:

    pwd && ls -la

  ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¡ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¾ãŸã¯ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã©ã¡ã‚‰ã«ã„ã‚‹ã‹ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¾ãŸã¯æ–°ã—ã„ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä½œæˆã•ã‚ŒãŸã‹ã‚’ç†è§£ã§ãã¾ã™ã€‚

  MacOSã®å ´åˆã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:
  AUTH0_APP_NAME="My Cap'n Web App" && AUTH0_API_NAME="Cap'n Web API" && AUTH0_API_IDENTIFIER="https://capnweb-api.$(date +%s).com" && brew tap auth0/auth0-cli && brew install auth0 && auth0 login --no-input && auth0 apis create --name "${AUTH0_API_NAME}" --identifier "${AUTH0_API_IDENTIFIER}" --scopes "read:profile,write:profile" --json > auth0-api-details.json && auth0 apps create -n "${AUTH0_APP_NAME}" -t spa -c http://localhost:3000 -l http://localhost:3000 -o http://localhost:3000 --json > auth0-app-details.json && CLIENT_ID=$(jq -r '.client_id' auth0-app-details.json) && DOMAIN=$(auth0 tenants list --json | jq -r '.[] | select(.active == true) | .name') && echo "AUTH0_DOMAIN=${DOMAIN}" > .env && echo "AUTH0_CLIENT_ID=${CLIENT_ID}" >> .env && echo "AUTH0_AUDIENCE=${AUTH0_API_IDENTIFIER}" >> .env && echo "PORT=3000" >> .env && echo "NODE_ENV=development" >> .env && rm auth0-app-details.json auth0-api-details.json && echo ".env file created with your Auth0 details:" && cat .env

  Windowsã®å ´åˆã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:
  $AppName = "My Cap'n Web App"; $ApiName = "Cap'n Web API"; $ApiIdentifier = "https://capnweb-api.$((Get-Date).Ticks).com"; winget install Auth0.CLI; auth0 login --no-input; auth0 apis create --name "$ApiName" --identifier "$ApiIdentifier" --scopes "read:profile,write:profile" --json | Set-Content -Path auth0-api-details.json; auth0 apps create -n "$AppName" -t spa -c http://localhost:3000 -l http://localhost:3000 -o http://localhost:3000 --json | Set-Content -Path auth0-app-details.json; $ClientId = (Get-Content -Raw auth0-app-details.json | ConvertFrom-Json).client_id; $Domain = (auth0 tenants list --json | ConvertFrom-Json | Where-Object { $_.active -eq $true }).name; Set-Content -Path .env -Value "AUTH0_DOMAIN=$Domain"; Add-Content -Path .env -Value "AUTH0_CLIENT_ID=$ClientId"; Add-Content -Path .env -Value "AUTH0_AUDIENCE=$ApiIdentifier"; Add-Content -Path .env -Value "PORT=3000"; Add-Content -Path .env -Value "NODE_ENV=development"; Remove-Item auth0-app-details.json, auth0-api-details.json; Write-Output ".env file created with your Auth0 details:"; Get-Content .env

  ã‚¹ãƒ†ãƒƒãƒ—3.2: æ‰‹å‹•ã§.envãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆ(è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¤±æ•—ã—ãŸå ´åˆ)

    cat > .env << 'EOF'
    # Auth0è¨­å®š - ã“ã‚Œã‚‰ã®å€¤ã‚’æ›´æ–°ã—ã¦ãã ã•ã„
    AUTH0_DOMAIN=your-auth0-domain.auth0.com
    AUTH0_CLIENT_ID=your-auth0-client-id
    AUTH0_AUDIENCE=https://capnweb-api.yourproject.com
    PORT=3000
    NODE_ENV=development
    EOF

  ã‚¹ãƒ†ãƒƒãƒ—3.3: æ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã‚’è¡¨ç¤º

    echo "ğŸ“‹ æ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¿…è¦:"
    echo "1. https://manage.auth0.com/dashboard/ ã«ã‚¢ã‚¯ã‚»ã‚¹"
    echo "2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ â†’ ã‚·ãƒ³ã‚°ãƒ«ãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³"
    echo "3. è¨±å¯ã•ã‚ŒãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URLã‚’è¨­å®š: http://localhost:3000"
    echo "4. è¨±å¯ã•ã‚ŒãŸãƒ­ã‚°ã‚¢ã‚¦ãƒˆURLã‚’è¨­å®š: http://localhost:3000"
    echo "5. è¨±å¯ã•ã‚ŒãŸWebã‚ªãƒªã‚¸ãƒ³ã‚’è¨­å®š: http://localhost:3000"
    echo "6. è­˜åˆ¥å­ã‚’ä½¿ç”¨ã—ã¦APIã‚’ä½œæˆ: https://capnweb-api.yourproject.com"
    echo "7. ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¿½åŠ : read:profile, write:profile"
    echo "8. ãƒ‰ãƒ¡ã‚¤ãƒ³ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã€APIã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã§.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°"

  ã‚¹ãƒ†ãƒƒãƒ—4: JWTæ¤œè¨¼ã‚’ä½¿ç”¨ã—ã¦ã‚»ã‚­ãƒ¥ã‚¢ãªWebSocketã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè£…
  Auth0ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ãŸå¾Œã€åŒ…æ‹¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‚™ãˆãŸã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã—ã¾ã™:

  4.1: ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ(server/index.js)
  ã‚»ã‚­ãƒ¥ã‚¢ãªWebSocketã‚µãƒ¼ãƒãƒ¼å®Ÿè£…ã§å…¨ä½“ã®å†…å®¹ã‚’ç½®ãæ›ãˆã¾ã™:

    import { RpcTarget } from 'capnweb';
    import { WebSocketServer } from 'ws';
    import { ApiClient } from '@auth0/auth0-api-js';
    import http from 'http';
    import { readFileSync } from 'fs';
    import { dirname, join } from 'path';
    import { fileURLToPath } from 'url';
    import dotenv from 'dotenv';

    dotenv.config();

    const __dirname = dirname(fileURLToPath(import.meta.url));
    const userProfiles = new Map();

    // Auth0è¨­å®š
    const AUTH0_DOMAIN = process.env.AUTH0_DOMAIN;
    const AUTH0_CLIENT_ID = process.env.AUTH0_CLIENT_ID;
    const AUTH0_AUDIENCE = process.env.AUTH0_AUDIENCE;

    if (!AUTH0_DOMAIN || !AUTH0_CLIENT_ID || !AUTH0_AUDIENCE) {
      console.error('âŒ å¿…è¦ãªAuth0ç’°å¢ƒå¤‰æ•°ãŒä¸è¶³ã—ã¦ã„ã¾ã™');
      if (!AUTH0_DOMAIN) console.error('   - AUTH0_DOMAINãŒå¿…è¦ã§ã™');
      if (!AUTH0_CLIENT_ID) console.error('   - AUTH0_CLIENT_IDãŒå¿…è¦ã§ã™');
      if (!AUTH0_AUDIENCE) console.error('   - AUTH0_AUDIENCEãŒå¿…è¦ã§ã™');
      process.exit(1);
    }

    // Auth0 APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ–ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼
    // @auth0/auth0-api-jsã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€jsonwebtokenã‚ˆã‚Šã‚‚å„ªã‚ŒãŸAuth0çµ±åˆãŒå®Ÿç¾ã•ã‚Œã¾ã™:
    // - JWKSã®è‡ªå‹•å‡¦ç†ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
    // - JWT/JWEãƒˆãƒ¼ã‚¯ãƒ³ã®çµ„ã¿è¾¼ã¿ã‚µãƒãƒ¼ãƒˆ
    // - OAuth 2.0ã¸ã®é©åˆ‡ãªæº–æ‹ 
    // - Auth0å›ºæœ‰ã®æœ€é©åŒ–
    const auth0ApiClient = new ApiClient({
      domain: AUTH0_DOMAIN,
      audience: AUTH0_AUDIENCE
    });

    async function verifyToken(token) {
      try {
        const payload = await auth0ApiClient.verifyAccessToken({
          accessToken: token
        });
        return payload;
      } catch (error) {
        throw new Error(`ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
      }
    }

  4.2: RPCã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®å®Ÿè£…ã¨HTTPã‚µãƒ¼ãƒãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ç¶šã‘ã¾ã™:

    // èªè¨¼æ©Ÿèƒ½ã‚’æŒã¤Cap'n Web RPCã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å®šç¾©
    class AuthenticatedRpcTarget extends RpcTarget {
      constructor() {
        super();
        this.authenticatedMethods = ['getProfile', 'updateProfile', 'getUserData'];
      }

      async authenticate(methodName, token) {
        if (this.authenticatedMethods.includes(methodName)) {
          try {
            const decoded = await verifyToken(token);
            return decoded;
          } catch (error) {
            throw new Error(`èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
          }
        }
        return null; // ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¯èªè¨¼ãŒä¸è¦
      }

      async getProfile(token) {
        const user = await this.authenticate('getProfile', token);
        if (!user) throw new Error('èªè¨¼ãŒå¿…è¦ã§ã™');

        const profile = userProfiles.get(user.sub) || {
          id: user.sub,
          name: user.name || 'ä¸æ˜ãªãƒ¦ãƒ¼ã‚¶ãƒ¼',
          email: user.email || 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“',
          picture: user.picture || null,
          preferences: {},
          lastLogin: new Date().toISOString()
        };

        console.log('ğŸ“‹ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¾ã—ãŸ:', user.sub);
        return profile;
      }

      async updateProfile(token, updates) {
        const user = await this.authenticate('updateProfile', token);
        if (!user) throw new Error('èªè¨¼ãŒå¿…è¦ã§ã™');

        const existingProfile = userProfiles.get(user.sub) || {};
        const updatedProfile = {
          ...existingProfile,
          ...updates,
          id: user.sub,
          lastUpdated: new Date().toISOString()
        };

        userProfiles.set(user.sub, updatedProfile);
        console.log('âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ:', user.sub);
        return updatedProfile;
      }

      async getPublicData() {
        // å…¬é–‹ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¯èªè¨¼ãŒä¸è¦
        return {
          message: 'ã“ã‚Œã¯ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨ã§ãã‚‹å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã§ã™',
          serverTime: new Date().toISOString(),
          version: '1.0.0'
        };
      }
    }

    // HTTPã‚µãƒ¼ãƒãƒ¼ã¨WebSocketã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆ
    const server = http.createServer((req, res) => {
      if (req.url === '/' || req.url === '/index.html') {
        const html = readFileSync(join(__dirname, '../client/index.html'), 'utf8');
        res.writeHead(200, { 'Content-Type': 'text/html' });
        res.end(html);
      } else if (req.url === '/app.js') {
        const js = readFileSync(join(__dirname, '../client/app.js'), 'utf8');
        res.writeHead(200, { 'Content-Type': 'application/javascript' });
        res.end(js);
      } else {
        res.writeHead(404);
        res.end('è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      }
    });

    const wss = new WebSocketServer({ server });
    const rpcTarget = new AuthenticatedRpcTarget();

    wss.on('connection', (ws) => {
      console.log('ğŸ”Œ æ–°ã—ã„WebSocketæ¥ç¶šãŒç¢ºç«‹ã•ã‚Œã¾ã—ãŸ');
      
      ws.on('message', async (message) => {
        try {
          const request = JSON.parse(message.toString());
          console.log('ğŸ“¨ RPCãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ã¾ã—ãŸ:', request.method);
          
          // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŠ½å‡º
          const token = request.token;
          let result;

          // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«åŸºã¥ã„ã¦é©åˆ‡ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—
          switch (request.method) {
            case 'getProfile':
              result = await rpcTarget.getProfile(token);
              break;
            case 'updateProfile':
              result = await rpcTarget.updateProfile(token, request.params);
              break;
            case 'getPublicData':
              result = await rpcTarget.getPublicData();
              break;
            default:
              throw new Error(`ä¸æ˜ãªãƒ¡ã‚½ãƒƒãƒ‰: ${request.method}`);
          }

          ws.send(JSON.stringify({
            id: request.id,
            result: result,
            error: null
          }));
        } catch (error) {
          console.error('âŒ RPCã‚¨ãƒ©ãƒ¼:', error.message);
          ws.send(JSON.stringify({
            id: request.id || null,
            result: null,
            error: error.message
          }));
        }
      });

      ws.on('close', () => {
        console.log('ğŸ”Œ WebSocketæ¥ç¶šãŒé–‰ã˜ã‚‰ã‚Œã¾ã—ãŸ');
      });

      ws.on('error', (error) => {
        console.error('âŒ WebSocketã‚¨ãƒ©ãƒ¼:', error);
      });
    });

    server.listen(PORT, () => {
      console.log('ğŸš€ Cap\'n Web Auth0ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã—ãŸ');
      console.log('ğŸ“ ã‚µãƒ¼ãƒãƒ¼ã¯http://localhost:' + PORTã§å®Ÿè¡Œä¸­ã§ã™');
      console.log('ğŸ” Auth0ãƒ‰ãƒ¡ã‚¤ãƒ³:', AUTH0_DOMAIN);
      console.log('ğŸ†” ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID:', AUTH0_CLIENT_ID.substring(0, 8) + '...');
      console.log('ğŸ¯ APIã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹:', AUTH0_AUDIENCE);
      console.log('\nğŸ“‹ åˆ©ç”¨å¯èƒ½ãªRPCãƒ¡ã‚½ãƒƒãƒ‰:');
      console.log('   - getProfile (èªè¨¼æ¸ˆã¿)');
      console.log('   - updateProfile (èªè¨¼æ¸ˆã¿)');
      console.log('   - getPublicData (å…¬é–‹)');
    });

  ã‚¹ãƒ†ãƒƒãƒ—5: JWTæ¤œè¨¼ã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè£…
  Auth0ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ãŸå¾Œã€Cap'n Web RPCã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã—ã¾ã™:

  5.1: ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«(server/index.js)ã‚’ä½œæˆ
  å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã€Auth0ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™:

    import { RpcTarget, newWebSocketRpcSession } from 'capnweb';
    import { WebSocketServer } from 'ws';
    import { ApiClient } from '@auth0/auth0-api-js';
    import http from 'http';
    import { readFileSync } from 'fs';
    import { dirname, join } from 'path';
    import { fileURLToPath } from 'url';
    import dotenv from 'dotenv';

    dotenv.config();

    const __dirname = dirname(fileURLToPath(import.meta.url));
    const userProfiles = new Map();

    // Auth0è¨­å®š
    const AUTH0_DOMAIN = process.env.AUTH0_DOMAIN;
    const AUTH0_CLIENT_ID = process.env.AUTH0_CLIENT_ID;
    const AUTH0_AUDIENCE = process.env.AUTH0_AUDIENCE;
    const PORT = process.env.PORT || 3000;

    // Initialize Auth0 API client for token verification
    const auth0ApiClient = new ApiClient({
      domain: AUTH0_DOMAIN,
      audience: AUTH0_AUDIENCE
    });

    async function verifyToken(token) {
      try {
        const payload = await auth0ApiClient.verifyAccessToken({
          accessToken: token
        });
        return payload;
      } catch (error) {
        throw new Error(`ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
      }
    }

  5.2: èªè¨¼æ©Ÿèƒ½ã‚’æŒã¤ProfileService RpcTargetã‚’ä½œæˆ:

    // ProfileService - Cap'n Web RPCã®ãŸã‚ã«RpcTargetã‚’æ‹¡å¼µ
    class ProfileService extends RpcTarget {
      async getProfile(accessToken) {
        const decoded = await verifyToken(accessToken);
        const userId = decoded.sub;
        const profile = userProfiles.get(userId) || { bio: '' };
        
        return {
          id: userId,
          email: decoded.email || 'ä¸æ˜ãªãƒ¦ãƒ¼ã‚¶ãƒ¼',
          bio: profile.bio
        };
      }

      async updateProfile(accessToken, bio) {
        const decoded = await verifyToken(accessToken);
        const userId = decoded.sub;
        userProfiles.set(userId, { bio });
        
        return { success: true, message: 'ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸ' };
      }
    }

  5.3: HTTPã‚µãƒ¼ãƒãƒ¼ã¨WebSocketã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆ:

    // é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¨Auth0è¨­å®šã‚’æä¾›ã™ã‚‹HTTPã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆ
    const server = http.createServer(async (req, res) => {
      res.setHeader('Access-Control-Allow-Origin', '*');
      
      if (req.url === '/api/config') {
        const config = { 
          auth0: { 
            domain: AUTH0_DOMAIN, 
            clientId: AUTH0_CLIENT_ID,
            audience: AUTH0_AUDIENCE
          } 
        };
        res.setHeader('Content-Type', 'application/json');
        res.writeHead(200);
        res.end(JSON.stringify(config));
        return;
      }

      // HTMLã€JSãƒ•ã‚¡ã‚¤ãƒ«ã€ãŠã‚ˆã³npmãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æä¾›
      if (req.url === '/' || req.url === '/index.html') {
        const html = readFileSync(join(__dirname, '../client/index.html'), 'utf8');
        res.setHeader('Content-Type', 'text/html');
        res.writeHead(200);
        res.end(html);
        return;
      }

      if (req.url === '/app.js') {
        const js = readFileSync(join(__dirname, '../client/app.js'), 'utf8');
        res.setHeader('Content-Type', 'application/javascript');
        res.writeHead(200);
        res.end(js);
        return;
      }

      // node_modulesã‹ã‚‰Auth0 SPA SDKã‚’é…ä¿¡
      if (req.url === '/@auth0/auth0-spa-js') {
        const modulePath = join(__dirname, '../node_modules/@auth0/auth0-spa-js/dist/auth0-spa-js.production.esm.js');
        const js = readFileSync(modulePath, 'utf8');
        res.setHeader('Content-Type', 'application/javascript');
        res.writeHead(200);
        res.end(js);
        return;
      }

      // node_modulesã‹ã‚‰capnwebã‚’é…ä¿¡
      if (req.url === '/capnweb') {
        const modulePath = join(__dirname, '../node_modules/capnweb/dist/index.js');
        const js = readFileSync(modulePath, 'utf8');
        res.setHeader('Content-Type', 'application/javascript');
        res.writeHead(200);
        res.end(js);
        return;
      }

      res.writeHead(404);
      res.end('è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    });

    // Cap'n Web RPCç”¨WebSocketã‚µãƒ¼ãƒãƒ¼
    const wss = new WebSocketServer({ server });

    wss.on('connection', (ws, req) => {
      // /apiãƒ‘ã‚¹ã®RPCæ¥ç¶šã®ã¿ã‚’å‡¦ç†
      if (req.url === '/api') {
        console.log('ğŸ”— æ–°ã—ã„Cap\'n Web RPCæ¥ç¶š');
        
        // ã“ã®æ¥ç¶šç”¨ã®æ–°ã—ã„ProfileServiceã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
        const profileService = new ProfileService();
        
        // capnwebã®newWebSocketRpcSessionã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šã‚’å‡¦ç†
        newWebSocketRpcSession(ws, profileService);
      }
    });

    // ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
    server.listen(PORT, () => {
      console.log(`ğŸš€ Cap'n Web Auth0ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã—ãŸ`);
      console.log(`ğŸ“ ã‚µãƒ¼ãƒãƒ¼ãŒhttp://localhost:${PORT}ã§å®Ÿè¡Œä¸­ã§ã™`);
      console.log(`ğŸ” Auth0ãƒ‰ãƒ¡ã‚¤ãƒ³: ${AUTH0_DOMAIN}`);
      console.log(`ğŸ†” ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID: ${AUTH0_CLIENT_ID.substring(0, 8)}...`);
      console.log(`ğŸ¯ APIã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹: ${AUTH0_AUDIENCE}`);
    });

  ã‚¹ãƒ†ãƒƒãƒ—6: Auth0çµ±åˆã‚’ä½¿ç”¨ã—ãŸãƒ¢ãƒ€ãƒ³ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
  6.1: ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒãƒƒãƒ—ã‚’å«ã‚€ãƒ¡ã‚¤ãƒ³HTMLãƒ•ã‚¡ã‚¤ãƒ«(client/index.html)ã‚’ä½œæˆ:

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Cap'n Web + Auth0ãƒ‡ãƒ¢</title>
        <script type="importmap">
        {
          "imports": {
            "@auth0/auth0-spa-js": "/@auth0/auth0-spa-js",
            "capnweb": "/capnweb"
          }
        }
        </script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <style>
            body {
                margin: 0;
                font-family: 'Inter', sans-serif;
                background: linear-gradient(135deg, #1a1e27 0%, #2d313c 100%);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                color: #e2e8f0;
            }

            .container {
                background-color: #262a33;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.05);
                padding: 3rem;
                max-width: 600px;
                width: 90%;
                text-align: center;
            }

            .logo {
                width: 160px;
                margin-bottom: 2rem;
            }

            h1 {
                font-size: 2.8rem;
                font-weight: 700;
                color: #f7fafc;
                margin-bottom: 1rem;
                text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            }

            .subtitle {
                font-size: 1.2rem;
                color: #a0aec0;
                margin-bottom: 2rem;
                line-height: 1.6;
            }

            .button {
                padding: 1.1rem 2.8rem;
                font-size: 1.2rem;
                font-weight: 600;
                border-radius: 10px;
                border: none;
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
                text-transform: uppercase;
                letter-spacing: 0.08em;
                margin: 0.5rem;
            }

            .button.login {
                background-color: #63b3ed;
                color: #1a1e27;
            }

            .button.login:hover {
                background-color: #4299e1;
                transform: translateY(-3px) scale(1.02);
            }

            .button.logout {
                background-color: #fc8181;
                color: #1a1e27;
            }

            .button.logout:hover {
                background-color: #e53e3e;
                transform: translateY(-3px) scale(1.02);
            }

            .button.rpc {
                background-color: #68d391;
                color: #1a1e27;
            }

            .button.rpc:hover {
                background-color: #48bb78;
                transform: translateY(-3px) scale(1.02);
            }

            .profile-card {
                background-color: #2d313c;
                border-radius: 15px;
                padding: 2rem;
                margin: 2rem 0;
                text-align: left;
            }

            .profile-picture {
                width: 80px;
                height: 80px;
                border-radius: 50%;
                margin-bottom: 1rem;
                border: 3px solid #63b3ed;
            }

            .status {
                margin: 1rem 0;
                padding: 1rem;
                border-radius: 10px;
                font-weight: 500;
            }

            .status.success {
                background-color: #2d7d32;
                color: #e8f5e8;
            }

            .status.error {
                background-color: #c62828;
                color: #ffebee;
            }

            .status.info {
                background-color: #1976d2;
                color: #e3f2fd;
            }

            .loading {
                display: inline-block;
                width: 20px;
                height: 20px;
                border: 3px solid #f3f3f3;
                border-top: 3px solid #63b3ed;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            .hidden {
                display: none;
            }

            pre {
                background-color: #1a1e27;
                padding: 1rem;
                border-radius: 8px;
                overflow-x: auto;
                text-align: left;
                font-size: 0.9rem;
                border: 1px solid #4a5568;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <img src="https://cdn.auth0.com/quantum-assets/dist/latest/logos/auth0/auth0-lockup-en-ondark.png" 
                 alt="Auth0 Logo" class="logo" 
                 onerror="this.style.display='none'">
            
            <h1>Cap'n Web + Auth0</h1>
            <p class="subtitle">èªè¨¼ã‚’ä½¿ç”¨ã—ãŸã‚»ã‚­ãƒ¥ã‚¢ãªWebSocket RPC</p>
            
            <div id="auth-section">
                <button id="login-btn" class="button login">ğŸ” ãƒ­ã‚°ã‚¤ãƒ³</button>
                <button id="logout-btn" class="button logout hidden">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>

            <div id="profile-section" class="hidden">
                <div class="profile-card">
                    <div id="profile-info"></div>
                </div>
            </div>

            <div id="rpc-section" class="hidden">
                <h3>ğŸ”Œ RPCæ“ä½œ</h3>
                <button id="get-profile-btn" class="button rpc">ğŸ“‹ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—</button>
                <button id="update-profile-btn" class="button rpc">âœï¸ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°</button>
                <button id="get-public-btn" class="button rpc">ğŸŒ å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—</button>
            </div>

            <div id="status"></div>
            <div id="rpc-results"></div>
        </div>

        <script type="module" src="/app.js"></script>
    </body>
    </html>

  6.2: JavaScriptã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ (client/app.js)
  capnwebã®newWebSocketRpcSessionã¨Auth0 SDKã‚’é©åˆ‡ãªESãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ä½¿ç”¨ã—ã¾ã™:

    import { createAuth0Client } from '@auth0/auth0-spa-js';
    import { newWebSocketRpcSession } from 'capnweb';

    // Auth0 Configuration
    let auth0Client = null;
    let profileApi = null;
    let AUTH0_CONFIG = null;

    // Load Auth0 config from server
    async function loadConfig() {
      const response = await fetch('/api/config');
      const config = await response.json();
      
      AUTH0_CONFIG = {
        domain: config.auth0.domain,
        clientId: config.auth0.clientId,
        authorizationParams: {
          redirect_uri: window.location.origin,
          audience: config.auth0.audience,
          scope: 'openid profile email'
        },
        useRefreshTokens: true,
        cacheLocation: 'localstorage'
      };
      
      return AUTH0_CONFIG;
    }

    // Initialize the application
    async function initializeApp() {
      try {
        showStatus('è¨­å®šã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...', 'info');
        const config = await loadConfig();
        
        showStatus('Auth0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™...', 'info');
        auth0Client = await createAuth0Client(config);
        
        // Handle redirect callback
        const query = window.location.search;
        if (query.includes('code=') && query.includes('state=')) {
          showStatus('ãƒ­ã‚°ã‚¤ãƒ³ã‚’å‡¦ç†ã—ã¦ã„ã¾ã™...', 'info');
          await auth0Client.handleRedirectCallback();
          window.history.replaceState({}, document.title, window.location.pathname);
        }
        
        // Check authentication status
        const isAuthenticated = await auth0Client.isAuthenticated();
        
        if (isAuthenticated) {
          // Only connect to WebSocket if authenticated
          showStatus('Cap\'n Web RPCã«æ¥ç¶šã—ã¦ã„ã¾ã™...', 'info');
          const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
          profileApi = newWebSocketRpcSession(`${protocol}//${window.location.host}/api`);
          
          await showProfileSection();
        } else {
          showAuthSection();
        }
        
        setupEventListeners();
      } catch (error) {
        console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
        showStatus(`åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      }
    }

    // Authentication functions
    async function login() {
      try {
        showStatus('Auth0ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ã„ã¾ã™...', 'info');
        await auth0Client.loginWithRedirect();
      } catch (error) {
        showStatus(`ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      }
    }

    async function logout() {
      try {
        if (profileApi) {
          profileApi[Symbol.dispose]();
        }
        await auth0Client.logout({
          logoutParams: { returnTo: window.location.origin }
        });
      } catch (error) {
        showStatus(`ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      }
    }

    async function getAccessToken() {
      try {
        return await auth0Client.getTokenSilently({
          authorizationParams: {
            audience: AUTH0_CONFIG.authorizationParams.audience
          }
        });
      } catch (error) {
        if (error.error === 'consent_required' || error.error === 'interaction_required') {
          await auth0Client.loginWithRedirect({
            authorizationParams: {
              audience: AUTH0_CONFIG.authorizationParams.audience,
              scope: 'openid profile email',
              prompt: 'consent'
            }
          });
        }
        throw error;
      }
    }

    // Profile management using Cap'n Web RPC
    async function fetchProfile() {
      try {
        showStatus('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¦ã„ã¾ã™...', 'info');
        const token = await getAccessToken();
        const user = await auth0Client.getUser();
        
        // Call RPC method directly on the profileApi stub
        const profile = await profileApi.getProfile(token);
        
        document.getElementById('userEmail').textContent = user.email || profile.email || 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“';
        document.getElementById('bioTextarea').value = profile.bio || '';
        
        showStatus('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸ!', 'success');
      } catch (error) {
        showStatus(`ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      }
    }

    async function saveProfile() {
      try {
        showStatus('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ã„ã¾ã™...', 'info');
        const token = await getAccessToken();
        const bio = document.getElementById('bioTextarea').value;
        
        // Call RPC method directly on the profileApi stub
        const result = await profileApi.updateProfile(token, bio);
        
        showStatus(result.message || 'ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£å¸¸ã«ä¿å­˜ã—ã¾ã—ãŸ!', 'success');
      } catch (error) {
        showStatus(`ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      }
    }

    // UI helper functions
    function showAuthSection() {
      document.getElementById('authSection').style.display = 'block';
      document.getElementById('profileSection').style.display = 'none';
      showStatus('ãƒ­ã‚°ã‚¤ãƒ³æº–å‚™å®Œäº†', 'info');
    }

    async function showProfileSection() {
      document.getElementById('authSection').style.display = 'none';
      document.getElementById('profileSection').style.display = 'block';
      await fetchProfile();
    }

    function showStatus(message, type) {
      const statusEl = document.getElementById('status');
      statusEl.textContent = message;
      statusEl.className = `status ${type}`;
    }

    // Event listeners
    function setupEventListeners() {
      document.getElementById('loginBtn').addEventListener('click', login);
      document.getElementById('logoutBtn').addEventListener('click', logout);
      document.getElementById('fetchBtn').addEventListener('click', fetchProfile);
      document.getElementById('saveBtn').addEventListener('click', saveProfile);
    }

    // Initialize app when DOM is loaded
    document.addEventListener('DOMContentLoaded', initializeApp);
          
          if (this.isAuthenticated) {
            this.user = await this.auth0Client.getUser();
            this.accessToken = await this.auth0Client.getTokenSilently();
            this.showLoggedInState();
            this.connectWebSocket();
          } else {
            this.showLoggedOutState();
          }

          this.setupEventListeners();
          this.showStatus('âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ­£å¸¸ã«åˆæœŸåŒ–ã—ã¾ã—ãŸ', 'success');
        } catch (error) {
          console.error('âŒ åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          this.showStatus(`âŒ åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      setupEventListeners() {
        document.getElementById('login-btn').addEventListener('click', () => this.login());
        document.getElementById('logout-btn').addEventListener('click', () => this.logout());
        document.getElementById('get-profile-btn').addEventListener('click', () => this.getProfile());
        document.getElementById('update-profile-btn').addEventListener('click', () => this.updateProfile());
        document.getElementById('get-public-btn').addEventListener('click', () => this.getPublicData());
      }

      async login() {
        try {
          this.showStatus('ğŸ”„ Auth0ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ã„ã¾ã™...', 'info');
          await this.auth0Client.loginWithRedirect();
        } catch (error) {
          console.error('âŒ ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          this.showStatus(`âŒ ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      async logout() {
        try {
          this.closeWebSocket();
          await this.auth0Client.logout({
            logoutParams: {
              returnTo: window.location.origin
            }
          });
        } catch (error) {
          console.error('âŒ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          this.showStatus(`âŒ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      connectWebSocket() {
        if (this.ws && this.ws.readyState === WebSocket.OPEN) {
          return; // ã™ã§ã«æ¥ç¶šæ¸ˆã¿
        }

        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}`;
        
        this.ws = new WebSocket(wsUrl);

        this.ws.onopen = () => {
          console.log('ğŸ”Œ WebSocketã«æ¥ç¶šã—ã¾ã—ãŸ');
          this.showStatus('ğŸ”Œ Cap\'n Webã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã¾ã—ãŸ', 'success');
        };

        this.ws.onmessage = (event) => {
          try {
            const response = JSON.parse(event.data);
            const pendingRequest = this.pendingRequests.get(response.id);
            
            if (pendingRequest) {
              this.pendingRequests.delete(response.id);
              if (response.error) {
                pendingRequest.reject(new Error(response.error));
              } else {
                pendingRequest.resolve(response.result);
              }
            }
          } catch (error) {
            console.error('âŒ WebSocketãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          }
        };

        this.ws.onerror = (error) => {
          console.error('âŒ WebSocketã‚¨ãƒ©ãƒ¼:', error);
          this.showStatus('âŒ WebSocketæ¥ç¶šã‚¨ãƒ©ãƒ¼', 'error');
        };

        this.ws.onclose = () => {
          console.log('ğŸ”Œ WebSocketã‹ã‚‰åˆ‡æ–­ã—ã¾ã—ãŸ');
          this.showStatus('ğŸ”Œ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰åˆ‡æ–­ã—ã¾ã—ãŸ', 'info');
          
          // èªè¨¼æ¸ˆã¿ã®å ´åˆã¯3ç§’å¾Œã«å†æ¥ç¶šã‚’è©¦è¡Œ
          if (this.isAuthenticated) {
            setTimeout(() => this.connectWebSocket(), 3000);
          }
        };
      }

      closeWebSocket() {
        if (this.ws) {
          this.ws.close();
          this.ws = null;
        }
      }

      async callRPC(method, params = null, requiresAuth = true) {
        return new Promise((resolve, reject) => {
          if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {
            return reject(new Error('WebSocketãŒæ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“'));
          }

          const id = ++this.requestId;
          const request = {
            id,
            method,
            params
          };

          if (requiresAuth && this.accessToken) {
            request.token = this.accessToken;
          }

          this.pendingRequests.set(id, { resolve, reject });
          
          // Set timeout for request
          setTimeout(() => {
            if (this.pendingRequests.has(id)) {
              this.pendingRequests.delete(id);
              reject(new Error('RPCãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ'));
            }
          }, 10000);

          this.ws.send(JSON.stringify(request));
        });
      }

      async getProfile() {
        try {
          this.showStatus('ğŸ”„ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ä¸­...', 'info');
          const profile = await this.callRPC('getProfile');
          this.showRPCResult('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿', profile);
        } catch (error) {
          console.error('âŒ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          this.showStatus(`âŒ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      async updateProfile() {
        try {
          this.showStatus('ğŸ”„ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ä¸­...', 'info');
          const updates = {
            preferences: {
              theme: 'dark',
              notifications: true,
              lastAction: 'profile-update'
            }
          };
          
          const updatedProfile = await this.callRPC('updateProfile', updates);
          this.showRPCResult('æ›´æ–°ã•ã‚ŒãŸãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«', updatedProfile);
        } catch (error) {
          console.error('âŒ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          this.showStatus(`âŒ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      async getPublicData() {
        try {
          this.showStatus('ğŸ”„ å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...', 'info');
          const data = await this.callRPC('getPublicData', null, false);
          this.showRPCResult('å…¬é–‹ãƒ‡ãƒ¼ã‚¿', data);
        } catch (error) {
          console.error('âŒ å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          this.showStatus(`âŒ å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      showLoggedInState() {
        document.getElementById('login-btn').classList.add('hidden');
        document.getElementById('logout-btn').classList.remove('hidden');
        document.getElementById('profile-section').classList.remove('hidden');
        document.getElementById('rpc-section').classList.remove('hidden');

        if (this.user) {
          const placeholderImage = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2363b3ed'/%3E%3Cpath d='M50 45c7.5 0 13.64-6.14 13.64-13.64S57.5 17.72 50 17.72s-13.64 6.14-13.64 13.64S42.5 45 50 45zm0 6.82c-9.09 0-27.28 4.56-27.28 13.64v3.41c0 1.88 1.53 3.41 3.41 3.41h47.74c1.88 0 3.41-1.53 3.41-3.41v-3.41c0-9.08-18.19-13.64-27.28-13.64z' fill='%23fff'/%3E%3C/svg%3E`;
          const profileHtml = `
            <img src="${this.user.picture || placeholderImage}" alt="ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«" class="profile-picture" onerror="this.src='${placeholderImage}'">
            <h3>${this.user.name || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼'}</h3>
            <p><strong>ãƒ¡ãƒ¼ãƒ«:</strong> ${this.user.email || 'æœªæä¾›'}</p>
            <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</strong> ${this.user.sub}</p>
          `;
          document.getElementById('profile-info').innerHTML = profileHtml;
        }
      }

      showLoggedOutState() {
        document.getElementById('login-btn').classList.remove('hidden');
        document.getElementById('logout-btn').classList.add('hidden');
        document.getElementById('profile-section').classList.add('hidden');
        document.getElementById('rpc-section').classList.add('hidden');
      }

      showStatus(message, type = 'info') {
        const statusDiv = document.getElementById('status');
        statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        
        // Auto-hide success and info messages after 5 seconds
        if (type === 'success' || type === 'info') {
          setTimeout(() => {
            statusDiv.innerHTML = '';
          }, 5000);
        }
      }

      showRPCResult(title, data) {
        const resultsDiv = document.getElementById('rpc-results');
        const resultHtml = `
          <div class="status success">
            <h4>${title}</h4>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          </div>
        `;
        resultsDiv.innerHTML = resultHtml;
        this.showStatus('âœ… RPCå‘¼ã³å‡ºã—ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ', 'success');
      }
    }

    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
    const app = new CapnWebAuth0Client();
    app.init().catch(error => {
    // DOMãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ã‚¢ãƒ—ãƒªã‚’åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', initializeApp);

  ã‚¹ãƒ†ãƒƒãƒ—7: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆã¨å®Ÿè¡Œ
  7.1: é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™:

    npm run start

  7.2: ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã‚’é–‹ãã¾ã™

  7.3: å®Œå…¨ãªèªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™:
    - ã€Œãƒ­ã‚°ã‚¤ãƒ³ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦Auth0ã§èªè¨¼ã—ã¾ã™
    - ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™(ãƒ¡ãƒ¼ãƒ«ã¯Auth0ã‹ã‚‰è¡¨ç¤ºã•ã‚Œã¾ã™)
    - è‡ªå·±ç´¹ä»‹ã‚’æ›´æ–°ã—ã¦ä¿å­˜ã—ã¾ã™
    - ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¾ã™ - ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚Šãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ãŒç¶­æŒã•ã‚Œã¾ã™
    - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™
    - RPCå‘¼ã³å‡ºã—ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™(ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°ã€å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã®å–å¾—)
    - WebSocketæ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèªã—ã¾ã™
    - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™

  ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
  - âœ… ä¿è­·ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾ã—ã¦èªè¨¼ã•ã‚Œã¦ã„ãªã„RPCå‘¼ã³å‡ºã—ã‚’æ±ºã—ã¦å—ã‘å…¥ã‚Œãªã„
  - âœ… Auth0ã®JWKSã‚’ä½¿ç”¨ã—ã¦JWTç½²åã‚’å¸¸ã«æ¤œè¨¼ã™ã‚‹
  - âœ… æœŸé™åˆ‡ã‚Œã¾ãŸã¯ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã«å¯¾ã™ã‚‹åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹
  - âœ… ã™ã¹ã¦ã®æ©Ÿå¯†è¨­å®šã«ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã™ã‚‹
  - âœ… å‡¦ç†å‰ã«ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’æ¤œè¨¼ã™ã‚‹
  - âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã¨èªè¨¼è©¦è¡Œã‚’ãƒ­ã‚°ã«è¨˜éŒ²ã™ã‚‹
  - âœ… æœ¬ç•ªç’°å¢ƒã§ã¯å®‰å…¨ãªWebSocketæ¥ç¶š(WSS)ã‚’ä½¿ç”¨ã™ã‚‹
  - âœ… é©åˆ‡ãªCORSãƒãƒªã‚·ãƒ¼ã‚’å®Ÿè£…ã™ã‚‹
  - âœ… æœ¬ç•ªç’°å¢ƒç”¨ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’è¿½åŠ ã™ã‚‹
  - âœ… ä¿å­˜ã¾ãŸã¯é€ä¿¡å‰ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã™ã‚‹

  ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ’ãƒ³ãƒˆ
  - ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§JavaScriptã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèªã™ã‚‹
  - .envãƒ•ã‚¡ã‚¤ãƒ«ã«æ­£ã—ã„Auth0è¨­å®šãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
  - Auth0ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šãŒãƒ­ãƒ¼ã‚«ãƒ«URLã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
  - Auth0 Dashboardã§APIã‚¹ã‚³ãƒ¼ãƒ—ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
  - RPCå‘¼ã³å‡ºã—ãŒå¤±æ•—ã™ã‚‹å ´åˆã¯ã€WebSocketæ¥ç¶šã‚’å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆã™ã‚‹
  - ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚ã«jwt.ioã‚’ä½¿ç”¨ã—ã¦JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã™ã‚‹
  ```
</Accordion>

<div id="get-started">
  ## ã¯ã˜ã‚ã«
</div>

ã“ã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã§ã¯ã€Cap'n Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã« Auth0 èªè¨¼ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚Cap'n Web ã® JavaScript ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ Auth0 SPA ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã‚­ãƒƒãƒˆ (SDK) ã‚’ä½¿ç”¨ã—ã¦ã€å®‰å…¨ãªãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’å‚™ãˆãŸæœ€æ–°ã® RPC ãƒ™ãƒ¼ã‚¹ã® Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

<Steps>
  <Step title="æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ" stepNumber={1}>
    æ–°ã—ã„ Cap&#39;n Web ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ–°è¦ä½œæˆã—ã€åŸºæœ¬çš„ãªæ§‹é€ ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

    ```shellscript
    mkdir capnweb-auth0-app && cd capnweb-auth0-app
    ```

    ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã€ES ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç”¨ã«è¨­å®šã—ã¾ã™ã€‚

    ```shellscript
    npm init -y && npm pkg set type="module"
    ```

    ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã‚’ä½œæˆã—ã¾ã™ï¼š

    ```shellscript
    mkdir -p client server && touch server/index.js client/index.html client/app.js .env.example .env
    ```
  </Step>

  <Step title="ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«" stepNumber={2}>
    Cap&#39;n Web ã¨ã‚³ã‚¢ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

    ```shellscript
    npm install capnweb ws dotenv
    ```

    èªè¨¼ãŠã‚ˆã³ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ç”¨ã® Auth0 ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã‚­ãƒƒãƒˆ (SDK) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™:

    ```shellscript
    npm install @auth0/auth0-spa-js @auth0/auth0-api-js
    ```

    <Info>
      **@auth0/auth0-spa-js** ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼å†…ã§ã®ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã‚’è¡Œã†ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚

      **@auth0/auth0-api-js** ã¯ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã—ã€Auth0 ã® JWKS ã‚’ä½¿ç”¨ã—ã¦ JWT ç½²åã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚
    </Info>

    package.json ã§ start ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨­å®šã—ã¾ã™ã€‚

    ```shellscript
    npm pkg set scripts.start="node server/index.js"
    ```
  </Step>

  <Step title="Auth0 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹" stepNumber={3}>
    æ¬¡ã«ã€Auth0ãƒ†ãƒŠãƒ³ãƒˆã§æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã€ç’°å¢ƒå¤‰æ•°ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

    CLIã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹ã‹ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰æ‰‹å‹•ã§å®Ÿè¡Œã™ã‚‹ã‹ã‚’é¸æŠã§ãã¾ã™:

    <Tabs>
      <Tab title="CLI">
        ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§æ¬¡ã®ã‚·ã‚§ãƒ«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€Auth0 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã€`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

        <AuthCodeGroup>
          ```shellscript Mac
          AUTH0_APP_NAME="My Cap'n Web App" && AUTH0_API_NAME="Cap'n Web API" && AUTH0_API_IDENTIFIER="https://capnweb-api.$(date +%s).com" && brew tap auth0/auth0-cli && brew install auth0 && auth0 login --no-input && auth0 apis create --name "${AUTH0_API_NAME}" --identifier "${AUTH0_API_IDENTIFIER}" --scopes "read:profile,write:profile" --json > auth0-api-details.json && auth0 apps create -n "${AUTH0_APP_NAME}" -t spa -c http://localhost:3000 -l http://localhost:3000 -o http://localhost:3000 --json > auth0-app-details.json && CLIENT_ID=$(jq -r '.client_id' auth0-app-details.json) && DOMAIN=$(auth0 tenants list --json | jq -r '.[] | select(.active == true) | .name') && echo "AUTH0_DOMAIN=${DOMAIN}" > .env && echo "AUTH0_CLIENT_ID=${CLIENT_ID}" >> .env && echo "AUTH0_AUDIENCE=${AUTH0_API_IDENTIFIER}" >> .env && echo "PORT=3000" >> .env && echo "NODE_ENV=development" >> .env && rm auth0-app-details.json auth0-api-details.json && echo ".env file created with your Auth0 details:" && cat .env
          ```

          ```shellscript Windows
          $AppName = "My Cap'n Web App"; $ApiName = "Cap'n Web API"; $ApiIdentifier = "https://capnweb-api.$((Get-Date).Ticks).com"; winget install Auth0.CLI; auth0 login --no-input; auth0 apis create --name "$ApiName" --identifier "$ApiIdentifier" --scopes "read:profile,write:profile" --json | Set-Content -Path auth0-api-details.json; auth0 apps create -n "$AppName" -t spa -c http://localhost:3000 -l http://localhost:3000 -o http://localhost:3000 --json | Set-Content -Path auth0-app-details.json; $ClientId = (Get-Content -Raw auth0-app-details.json | ConvertFrom-Json).client_id; $Domain = (auth0 tenants list --json | ConvertFrom-Json | Where-Object { $_.active -eq $true }).name; Set-Content -Path .env -Value "AUTH0_DOMAIN=$Domain"; Add-Content -Path .env -Value "AUTH0_CLIENT_ID=$ClientId"; Add-Content -Path .env -Value "AUTH0_AUDIENCE=$ApiIdentifier"; Add-Content -Path .env -Value "PORT=3000"; Add-Content -Path .env -Value "NODE_ENV=development"; Remove-Item auth0-app-details.json, auth0-api-details.json; Write-Output ".env file created with your Auth0 details:"; Get-Content .env
          ```
        </AuthCodeGroup>
      </Tab>

      <Tab title="ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰">
        é–‹å§‹ã™ã‚‹å‰ã«ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

        ```shellscript .env
        AUTH0_DOMAIN=YOUR_AUTH0_APP_DOMAIN
        AUTH0_CLIENT_ID=YOUR_AUTH0_APP_CLIENT_ID
        AUTH0_AUDIENCE=https://capnweb-api.yourproject.com
        PORT=3000
        NODE_ENV=development
        ```

        1. [Auth0 Dashboard](https://manage.auth0.com/dashboard/) ã«ç§»å‹•ã—ã¾ã™
        2. **Applications** &gt; **Applications** &gt; **Create Application** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™
        3. ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã‚¢ãƒ—ãƒªã®åå‰ã‚’å…¥åŠ›ã—ã€ã‚¢ãƒ—ãƒªã®ã‚¿ã‚¤ãƒ—ã¨ã—ã¦ `Single Page Web Application` ã‚’é¸æŠã—ã¦ **Create** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™
        4. Application Details ãƒšãƒ¼ã‚¸ã® **Settings** ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™
        5. `.env` ãƒ•ã‚¡ã‚¤ãƒ«å†…ã® `YOUR_AUTH0_APP_DOMAIN` ã¨ `YOUR_AUTH0_APP_CLIENT_ID` ã‚’ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã® **Domain** ã¨ **Client ID** ã®å€¤ã«ç½®ãæ›ãˆã¾ã™

        æœ€å¾Œã«ã€Application Details ãƒšãƒ¼ã‚¸ã® **Settings** ã‚¿ãƒ–ã§æ¬¡ã® URL ã‚’è¨­å®šã—ã¾ã™ã€‚

        **Allowed Callback URLs:**

        ```
        http://localhost:3000
        ```

        **è¨±å¯ã•ã‚ŒãŸãƒ­ã‚°ã‚¢ã‚¦ãƒˆURLï¼š**

        ```
        http://localhost:3000
        ```

        **è¨±å¯ã•ã‚Œã¦ã„ã‚‹ Web ã‚ªãƒªã‚¸ãƒ³:**

        ```
        http://localhost:3000
        ```

        <Info>
          **Allowed Callback URLs** ã¯ã€èªè¨¼å¾Œã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å®‰å…¨ã«ã”åˆ©ç”¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«æˆ»ã™ãŸã‚ã®é‡è¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã§ã™ã€‚ä¸€è‡´ã™ã‚‹ URL ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã¯å¤±æ•—ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ä»£ã‚ã‚Šã« Auth0 ã®ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã™ã€‚

          **Allowed Logout URLs** ã¯ã€ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆæ™‚ã«ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ä¸å¯æ¬ ã§ã™ã€‚ä¸€è‡´ã™ã‚‹ URL ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¾Œã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œãšã€æ±ç”¨ã® Auth0 ãƒšãƒ¼ã‚¸ã«ç•™ã¾ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

          **Allowed Web Origins** ã¯ã€ã‚µã‚¤ãƒ¬ãƒ³ãƒˆèªè¨¼ã®ãŸã‚ã«æ¥µã‚ã¦é‡è¦ã§ã™ã€‚ã“ã‚ŒãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ãŸã‚Šã€å¾Œã§ã‚¢ãƒ—ãƒªã«æˆ»ã£ãŸã‚Šã™ã‚‹ã¨ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
        </Info>

        **å¿…é ˆ: Auth0 API ã‚’ä½œæˆã™ã‚‹**

        ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã‚’è¡Œã†ã«ã¯ã€Auth0 API ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:

        1. Auth0 Dashboard ã§ **APIs** &gt; **Create API** ã«é€²ã¿ã¾ã™
        2. æ¬¡ã®å€¤ã‚’è¨­å®šã—ã¾ã™:
           * **Name**: `Cap'n Web API`
           * **Identifier**: `https://capnweb-api.yourproject.com`ï¼ˆç‹¬è‡ªã®ä¸€æ„ãªè­˜åˆ¥å­ã‚’ä½¿ç”¨ï¼‰
           * **Signing Algorithm**: `RS256`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
        3. **Create** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™
        4. **Scopes** ã‚¿ãƒ–ã§ã€æ¬¡ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¿½åŠ ã—ã¾ã™:
           * `read:profile` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹
           * `write:profile` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹
        5. `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã€API è­˜åˆ¥å­ã‚’ `AUTH0_AUDIENCE` ã¨ã—ã¦è¨­å®šã—ã¾ã™

        <Warning>
          Auth0 API ã‚’ä½œæˆã—ãªã„å ´åˆã€ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã« &quot;access&#95;denied&quot; ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚API è­˜åˆ¥å­ã¯ã€`AUTH0_AUDIENCE` ç’°å¢ƒå¤‰æ•°ã¨å®Œå…¨ã«ä¸€è‡´ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
        </Warning>
      </Tab>
    </Tabs>
  </Step>

  <Step title="ã‚µãƒ¼ãƒãƒ¼ã®ä½œæˆ" stepNumber={5}>
    Auth0çµ±åˆã‚’ä½¿ç”¨ã—ã¦Cap&#39;n Webã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã—ã¾ã™ï¼š

    ```javascript server/index.js expandable lines
    import { RpcTarget, newWebSocketRpcSession } from 'capnweb';
    import { WebSocketServer } from 'ws';
    import { ApiClient } from '@auth0/auth0-api-js';
    import http from 'http';
    import { readFileSync } from 'fs';
    import { dirname, join } from 'path';
    import { fileURLToPath } from 'url';
    import dotenv from 'dotenv';

    dotenv.config();

    const __dirname = dirname(fileURLToPath(import.meta.url));
    const userProfiles = new Map();

    // Auth0 configuration
    const AUTH0_DOMAIN = process.env.AUTH0_DOMAIN;
    const AUTH0_CLIENT_ID = process.env.AUTH0_CLIENT_ID;
    const AUTH0_AUDIENCE = process.env.AUTH0_AUDIENCE;
    const PORT = process.env.PORT || 3000;

    if (!AUTH0_DOMAIN || !AUTH0_CLIENT_ID || !AUTH0_AUDIENCE) {
      console.error('âŒ å¿…é ˆã®Auth0ç’°å¢ƒå¤‰æ•°ãŒä¸è¶³ã—ã¦ã„ã¾ã™');
      if (!AUTH0_DOMAIN) console.error('   - AUTH0_DOMAINãŒå¿…é ˆã§ã™');
      if (!AUTH0_CLIENT_ID) console.error('   - AUTH0_CLIENT_IDãŒå¿…é ˆã§ã™');
      if (!AUTH0_AUDIENCE) console.error('   - AUTH0_AUDIENCEãŒå¿…é ˆã§ã™');
      process.exit(1);
    }

    // Initialize Auth0 API client for token verification
    const auth0ApiClient = new ApiClient({
      domain: AUTH0_DOMAIN,
      audience: AUTH0_AUDIENCE
    });

    async function verifyToken(token) {
      try {
        const payload = await auth0ApiClient.verifyAccessToken({
          accessToken: token
        });
        return payload;
      } catch (error) {
        throw new Error(`ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
      }
    }

    // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ - Cap'n Web RPCã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
    class ProfileService extends RpcTarget {
      async getProfile(accessToken) {
        const decoded = await verifyToken(accessToken);
        const userId = decoded.sub;
        const profile = userProfiles.get(userId) || { bio: '' };
        
        return {
          id: userId,
          email: decoded.email || 'ä¸æ˜ãªãƒ¦ãƒ¼ã‚¶ãƒ¼',
          bio: profile.bio
        };
      }

      async updateProfile(accessToken, bio) {
        const decoded = await verifyToken(accessToken);
        const userId = decoded.sub;
        userProfiles.set(userId, { bio });
        
        return { success: true, message: 'ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸ' };
      }
    }

    // HTTPã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆ
    const server = http.createServer(async (req, res) => {
      res.setHeader('Access-Control-Allow-Origin', '*');
      res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
      res.setHeader('Access-Control-Allow-Headers', 'Content-Type');
      
      if (req.method === 'OPTIONS') {
        res.writeHead(200);
        res.end();
        return;
      }

      if (req.url === '/api/config') {
        const config = { 
          auth0: { 
            domain: AUTH0_DOMAIN, 
            clientId: AUTH0_CLIENT_ID,
            audience: AUTH0_AUDIENCE
          } 
        };
        res.setHeader('Content-Type', 'application/json');
        res.writeHead(200);
        res.end(JSON.stringify(config));
        return;
      }

      // ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ã¨Auth0ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‡¦ç†
      if (req.url === '/' || req.url === '/index.html' || req.url.startsWith('/?code=') || req.url.startsWith('/?error=')) {
        const html = readFileSync(join(__dirname, '../client/index.html'), 'utf8');
        res.setHeader('Content-Type', 'text/html');
        res.writeHead(200);
        res.end(html);
        return;
      }

      if (req.url === '/app.js') {
        const js = readFileSync(join(__dirname, '../client/app.js'), 'utf8');
        res.setHeader('Content-Type', 'application/javascript');
        res.writeHead(200);
        res.end(js);
        return;
      }

      // node_modulesã‹ã‚‰Auth0 SPA JS SDKã‚’æä¾›
      if (req.url === '/@auth0/auth0-spa-js') {
        const modulePath = join(__dirname, '../node_modules/@auth0/auth0-spa-js/dist/auth0-spa-js.production.esm.js');
        const js = readFileSync(modulePath, 'utf8');
        res.setHeader('Content-Type', 'application/javascript');
        res.writeHead(200);
        res.end(js);
        return;
      }

      // node_modulesã‹ã‚‰capnwebã‚’æä¾›
      if (req.url === '/capnweb') {
        const modulePath = join(__dirname, '../node_modules/capnweb/dist/index.js');
        const js = readFileSync(modulePath, 'utf8');
        res.setHeader('Content-Type', 'application/javascript');
        res.writeHead(200);
        res.end(js);
        return;
      }

      res.writeHead(404);
      res.end('è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    });

    // Cap'n Web RPCç”¨WebSocketã‚µãƒ¼ãƒãƒ¼
    const wss = new WebSocketServer({ server });

    wss.on('connection', (ws, req) => {
      // /apiãƒ‘ã‚¹ã®RPCæ¥ç¶šã®ã¿ã‚’å‡¦ç†
      if (req.url === '/api') {
        console.log('ğŸ”— æ–°ã—ã„Cap\'n Web RPCæ¥ç¶š');
        
        // ã“ã®æ¥ç¶šç”¨ã®æ–°ã—ã„ProfileServiceã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
        const profileService = new ProfileService();
        
        // capnwebã®newWebSocketRpcSessionã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šã‚’å‡¦ç†
        newWebSocketRpcSession(ws, profileService);
      }
    });

    // ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
    server.listen(PORT, () => {
      console.log(`ğŸš€ Cap'n Web Auth0ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¾ã—ãŸ`);
      console.log(`ğŸ“ ã‚µãƒ¼ãƒãƒ¼ã¯http://localhost:${PORT}ã§å®Ÿè¡Œä¸­`);
      console.log(`ğŸ” Auth0ãƒ‰ãƒ¡ã‚¤ãƒ³: ${AUTH0_DOMAIN}`);
      console.log(`ğŸ†” ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID: ${AUTH0_CLIENT_ID.substring(0, 8)}...`);
      console.log(`ğŸ¯ APIã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹: ${AUTH0_AUDIENCE}`);
    });
    ```
  </Step>

  <Step title="ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’ä½œæˆã™ã‚‹" stepNumber={6}>
    ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®HTMLã¨JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™:

    <AuthCodeGroup>
      ```html client/index.html expandable lines
      <!DOCTYPE html>
      <html lang="en">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Cap'n Web + Auth0 ãƒ‡ãƒ¢</title>
          <script type="importmap">
          {
            "imports": {
              "@auth0/auth0-spa-js": "/@auth0/auth0-spa-js",
              "capnweb": "/capnweb"
            }
          }
          </script>
          <style>
              body {
                  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                  max-width: 600px;
                  margin: 0 auto;
                  padding: 2rem;
                  line-height: 1.6;
              }
              .auth-section, .profile-section {
                  background: #f8f9fa;
                  border-radius: 8px;
                  padding: 2rem;
                  margin: 1rem 0;
              }
              .profile-section { display: none; }
              button {
                  background: #007bff;
                  color: white;
                  border: none;
                  padding: 0.75rem 1.5rem;
                  border-radius: 4px;
                  cursor: pointer;
                  font-size: 1rem;
                  margin: 0.5rem 0.5rem 0.5rem 0;
              }
              button:hover { background: #0056b3; }
              button.secondary { background: #6c757d; }
              button.secondary:hover { background: #545b62; }
              textarea {
                  width: 100%;
                  min-height: 100px;
                  margin: 1rem 0;
                  padding: 0.75rem;
                  border: 1px solid #ddd;
                  border-radius: 4px;
                  resize: vertical;
              }
              .status {
                  padding: 1rem;
                  margin: 1rem 0;
                  border-radius: 4px;
                  font-weight: 500;
              }
              .status.success { background: #d4edda; color: #155724; }
              .status.error { background: #f8d7da; color: #721c24; }
              .status.info { background: #d1ecf1; color: #0c5460; }
          </style>
      </head>
      <body>
          <h1>Cap'n Web + Auth0 ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¢</h1>
          
          <div id="status" class="status info">åˆæœŸåŒ–ä¸­...</div>
          
          <!-- Login Section -->
          <div id="authSection" class="auth-section">
              <h2>ğŸ” ã‚ˆã†ã“ã!</h2>
              <p>ã“ã®ãƒ‡ãƒ¢ã§ã¯ã€Cap'n Web RPCã‚’ä½¿ç”¨ã—ãŸAuth0èªè¨¼ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚</p>
              <button id="loginBtn">Auth0ã§ãƒ­ã‚°ã‚¤ãƒ³</button>
          </div>
          
          <!-- Profile Section -->
          <div id="profileSection" class="profile-section">
              <h2>ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</h2>
              <p><strong>ãƒ¡ãƒ¼ãƒ«:</strong> <span id="userEmail">èª­ã¿è¾¼ã¿ä¸­...</span></p>
              
              <label for="bioTextarea"><strong>è‡ªå·±ç´¹ä»‹:</strong></label>
              <textarea id="bioTextarea" placeholder="è‡ªå·±ç´¹ä»‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
              
              <div>
                  <button id="fetchBtn">ğŸ”„ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—</button>
                  <button id="saveBtn">ğŸ’¾ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜</button>
                  <button id="logoutBtn" class="secondary">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
              </div>
          </div>

          <script type="module" src="/app.js"></script>
      </body>
      </html>
      ```

      ```javascript client/app.js expandable lines
      import { createAuth0Client } from '@auth0/auth0-spa-js';
      import { newWebSocketRpcSession } from 'capnweb';

      // Auth0è¨­å®š
      let auth0Client = null;
      let profileApi = null;

      // Auth0è¨­å®š - ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å‹•çš„ã«èª­ã¿è¾¼ã¿
      let AUTH0_CONFIG = null;

      // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰Auth0è¨­å®šã‚’èª­ã¿è¾¼ã¿
      async function loadConfig() {
        const response = await fetch('/api/config');
        const config = await response.json();
        
        AUTH0_CONFIG = {
          domain: config.auth0.domain,
          clientId: config.auth0.clientId,
          authorizationParams: {
            redirect_uri: window.location.origin,
            audience: config.auth0.audience,
            scope: 'openid profile email'
          },
          useRefreshTokens: true,
          cacheLocation: 'localstorage'
        };
        
        return AUTH0_CONFIG;
      }

      // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
      async function initializeApp() {
        try {
          showStatus('è¨­å®šã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...', 'info');
          
          const config = await loadConfig();
          
          showStatus('Auth0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™...', 'info');
          auth0Client = await createAuth0Client(config);
          
          const query = window.location.search;
          if (query.includes('code=') && query.includes('state=')) {
            showStatus('ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ä¸­...', 'info');
            await auth0Client.handleRedirectCallback();
            window.history.replaceState({}, document.title, window.location.pathname);
          }
          
          const isAuthenticated = await auth0Client.isAuthenticated();
          
          if (isAuthenticated) {
            showStatus('Cap\'n Web RPCã«æ¥ç¶šä¸­...', 'info');
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            profileApi = newWebSocketRpcSession(`${protocol}//${window.location.host}/api`);
            
            await showProfileSection();
          } else {
            showAuthSection();
          }
          
          setupEventListeners();
          
        } catch (error) {
          console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
          showStatus(`åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      // èªè¨¼é–¢æ•°
      async function login() {
        try {
          showStatus('Auth0ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆä¸­...', 'info');
          await auth0Client.loginWithRedirect();
        } catch (error) {
          showStatus(`ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      async function logout() {
        try {
          if (profileApi) {
            profileApi[Symbol.dispose]();
          }
          await auth0Client.logout({
            logoutParams: { returnTo: window.location.origin }
          });
        } catch (error) {
          showStatus(`ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      async function getAccessToken() {
        try {
          return await auth0Client.getTokenSilently({
            authorizationParams: {
              audience: AUTH0_CONFIG.authorizationParams.audience
            }
          });
        } catch (error) {
          if (error.error === 'consent_required' || error.error === 'interaction_required') {
            await auth0Client.loginWithRedirect({
              authorizationParams: {
                audience: AUTH0_CONFIG.authorizationParams.audience,
                scope: 'openid profile email',
                prompt: 'consent'
              }
            });
          }
          throw error;
        }
      }

      // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†é–¢æ•°
      async function fetchProfile() {
        try {
          showStatus('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ä¸­...', 'info');
          
          const token = await getAccessToken();
          const user = await auth0Client.getUser();
          const profile = await profileApi.getProfile(token);
          
          document.getElementById('userEmail').textContent = user.email || profile.email || 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“';
          document.getElementById('bioTextarea').value = profile.bio || '';
          
          showStatus('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ', 'success');
        } catch (error) {
          showStatus(`ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      async function saveProfile() {
        try {
          showStatus('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ä¸­...', 'info');
          
          const token = await getAccessToken();
          const bio = document.getElementById('bioTextarea').value;
          
          const result = await profileApi.updateProfile(token, bio);
          
          showStatus(result.message || 'ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
        } catch (error) {
          showStatus(`ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }

      // UIãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
      function showAuthSection() {
        document.getElementById('authSection').style.display = 'block';
        document.getElementById('profileSection').style.display = 'none';
        showStatus('ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½', 'info');
      }

      async function showProfileSection() {
        document.getElementById('authSection').style.display = 'none';
        document.getElementById('profileSection').style.display = 'block';
        await fetchProfile();
      }

      function showStatus(message, type) {
        const statusEl = document.getElementById('status');
        statusEl.textContent = message;
        statusEl.className = `status ${type}`;
      }

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      function setupEventListeners() {
        document.getElementById('loginBtn').addEventListener('click', login);
        document.getElementById('logoutBtn').addEventListener('click', logout);
        document.getElementById('fetchBtn').addEventListener('click', fetchProfile);
        document.getElementById('saveBtn').addEventListener('click', saveProfile);
      }

      // DOMèª­ã¿è¾¼ã¿æ™‚ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
      document.addEventListener('DOMContentLoaded', initializeApp);
      ```
    </AuthCodeGroup>
  </Step>

  <Step title="ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã™ã‚‹" stepNumber={7}>
    ```shellscript
    npm run start
    ```
  </Step>
</Steps>

<Check>
  **ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ**

  ã“ã‚Œã§ã€[localhost](http://localhost:3000/) ä¸Šã§ Auth0 ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ãŒå•é¡Œãªãå‹•ä½œã—ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚
</Check>

---

<div id="advanced-usage">
  ## é«˜åº¦ãªåˆ©ç”¨æ–¹æ³•
</div>

<Accordion title="ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ RPC ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£">
  RPC ãƒ¡ã‚½ãƒƒãƒ‰ã«è¿½åŠ ã®æ¤œè¨¼ã‚„ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’åŠ ãˆã¦ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–ã—ã¾ã™ã€‚

  ```javascript server/profile-service.js
  import rateLimit from 'express-rate-limit';

  class ProfileService extends RpcTarget {
    constructor() {
      super();
      this.rateLimiter = new Map(); // å˜ç´”ãªã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªãƒ™ãƒ¼ã‚¹ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™
    }

    async validateAndRateLimit(userId) {
      const now = Date.now();
      const userLimit = this.rateLimiter.get(userId) || { count: 0, resetTime: now + 60000 };
      
      if (now > userLimit.resetTime) {
        userLimit.count = 0;
        userLimit.resetTime = now + 60000;
      }
      
      if (userLimit.count >= 10) {
        throw new Error('Rate limit exceeded. Try again later.');
      }
      
      userLimit.count++;
      this.rateLimiter.set(userId, userLimit);
    }

    async getProfile(accessToken) {
      const decoded = await verifyToken(accessToken);
      await this.validateAndRateLimit(decoded.sub);
      
      const userId = decoded.sub;
      const profile = userProfiles.get(userId) || { bio: '' };
      
      return {
        id: userId,
        email: decoded.email || 'Unknown User',
        bio: profile.bio,
        lastUpdated: profile.lastUpdated || null
      };
    }
  }
  ```
</Accordion>

<Accordion title="WebSocket æ¥ç¶šç®¡ç†">
  è‡ªå‹•å†æ¥ç¶šæ©Ÿèƒ½ä»˜ãã§ã€WebSocket æ¥ç¶šã‚’é©åˆ‡ã«å‡¦ç†ã—ã¾ã™ã€‚

  ```javascript client/connection-manager.js
  import { newWebSocketRpcSession } from 'capnweb';

  class RpcConnectionManager {
    constructor(wsUrl, options = {}) {
      this.wsUrl = wsUrl;
      this.api = null;
      this.reconnectAttempts = 0;
      this.maxReconnectAttempts = options.maxReconnectAttempts || 5;
      this.reconnectDelay = options.reconnectDelay || 1000;
      this.isConnecting = false;
      this.onReconnect = options.onReconnect || (() => {});
    }

    async connect() {
      if (this.isConnecting) return this.api;
      this.isConnecting = true;

      try {
        // æ—¢å­˜ã®æ¥ç¶šãŒã‚ã‚Œã°ç ´æ£„ã™ã‚‹
        if (this.api) {
          this.api[Symbol.dispose]();
        }

        // æ–°ã—ã„ WebSocket RPC ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹
        this.api = newWebSocketRpcSession(this.wsUrl);
        this.reconnectAttempts = 0;
        this.isConnecting = false;
        
        console.log('âœ… RPC connection established');
        this.onReconnect(this.api);
        
        return this.api;
      } catch (error) {
        this.isConnecting = false;
        
        if (this.reconnectAttempts < this.maxReconnectAttempts) {
          this.reconnectAttempts++;
          console.log(`ğŸ”„ Reconnection attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts}`);
          
          await new Promise(resolve => 
            setTimeout(resolve, this.reconnectDelay * this.reconnectAttempts)
          );
          
          return this.connect();
        } else {
          throw new Error('Max reconnection attempts reached');
        }
      }
    }

    disconnect() {
      if (this.api) {
        this.api[Symbol.dispose]();
        this.api = null;
      }
      this.reconnectAttempts = 0;
    }

    getApi() {
      return this.api;
    }
  }

  // app.js ã§ã®ä½¿ç”¨ä¾‹
  const connectionManager = new RpcConnectionManager(
    `${protocol}//${host}/api`,
    {
      maxReconnectAttempts: 5,
      reconnectDelay: 1000,
      onReconnect: async (api) => {
        // å†æ¥ç¶šå¾Œã« UI ã‚’æ›´æ–°ã™ã‚‹ã‹ã€ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿ã™ã‚‹
        await displayProfile(api);
      }
    }
  );

  // èªè¨¼æ¸ˆã¿ã®å ´åˆã«æ¥ç¶šã™ã‚‹
  if (isAuthenticated) {
    await connectionManager.connect();
    profileApi = connectionManager.getApi();
  }
  ```
</Accordion>

<Accordion title="ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆ">
  æœ¬ç•ªç’°å¢ƒã§ã¯ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç½®ãæ›ãˆã¦ãã ã•ã„:

  ```javascript server/database.js
  import { Pool } from 'pg';

  const pool = new Pool({
    connectionString: process.env.DATABASE_URL || 'postgresql://localhost/capnweb_auth0'
  });

  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚’åˆæœŸåŒ–
  async function initializeDatabase() {
    await pool.query(`
      CREATE TABLE IF NOT EXISTS user_profiles (
        user_id VARCHAR(255) PRIMARY KEY,
        bio TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )
    `);
  }

  class DatabaseProfileService extends RpcTarget {
    async getProfile(accessToken) {
      const decoded = await verifyToken(accessToken);
      const result = await pool.query(
        'SELECT bio, updated_at FROM user_profiles WHERE user_id = $1',
        [decoded.sub]
      );
      
      return {
        id: decoded.sub,
        email: decoded.email,
        bio: result.rows[0]?.bio || '',
        lastUpdated: result.rows[0]?.updated_at || null
      };
    }
    
    async updateProfile(accessToken, bio) {
      const decoded = await verifyToken(accessToken);
      await pool.query(`
        INSERT INTO user_profiles (user_id, bio, updated_at) 
        VALUES ($1, $2, CURRENT_TIMESTAMP)
        ON CONFLICT (user_id) 
        DO UPDATE SET bio = $2, updated_at = CURRENT_TIMESTAMP
      `, [decoded.sub, bio]);
      
      return { success: true, message: 'ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸ' };
    }
  }

  export { initializeDatabase, DatabaseProfileService };
  ```
</Accordion>