---
title: Laravel アプリケーションにログインを追加する
sidebarTitle: Laravel

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";
import Web from "/snippets/ja-JP/quickstart/webapp/laravel/web.php.mdx";
import Web2 from "/snippets/ja-JP/quickstart/webapp/laravel/web.php2.mdx";
import Web3 from "/snippets/ja-JP/quickstart/webapp/laravel/web.php3.mdx";

export const sections = [
  { id: "laravel-installation", title: "Laravel のインストール" },
  { id: "sdk-installation", title: "SDK のインストール" },
  { id: "sdk-configuration", title: "SDK の設定" },
  { id: "login-routes", title: "ログイン用ルート" },
  { id: "access-control", title: "アクセス制御" },
  { id: "user-information", title: "ユーザー情報" },
  { id: "user-management", title: "ユーザー管理" },
  { id: "run-the-application", title: "アプリケーションの実行" }
]


<Recipe isSingleColumn>
  <Content>
    [Auth0&#39;s Laravel SDK](https://github.com/auth0/laravel-auth0)を使用すると、Laravelアプリケーションに認証、ユーザープロファイル管理、およびルーティングアクセス制御を迅速に追加できます。このガイドでは、新規(または既存の)[Laravel 9または10](https://github.com/auth0/laravel-auth0#support-policy)アプリケーションにAuth0を統合する方法を説明します。

    テスト変更

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      **まだ Laravel アプリケーションをセットアップしていない場合は**、新しいプロジェクトに適したディレクトリでシェルを開き、次のコマンドを実行します。

      ```sh wrap lines
      composer create-project --prefer-dist laravel/laravel auth0-laravel-app ^9.0
      ```

      このガイドで示すすべてのコマンドは、Laravel プロジェクトのルートディレクトリで実行することを前提としています。そのため、新しいプロジェクトディレクトリに `cd` コマンドで移動してください。

      ```sh lines
      cd auth0-laravel-app
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      プロジェクトディレクトリ内で次のコマンドを実行して、[Auth0 Laravel ソフトウェア開発キット (SDK)](https://github.com/auth0/laravel-auth0) をインストールします。

      ```sh wrap lines
      composer require auth0/login:^7.8 --update-with-all-dependencies
      ```

      次に、アプリケーション用の SDK 構成ファイルを生成します。

      ```sh lines
      php artisan vendor:publish --tag auth0
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      プロジェクトディレクトリから次のコマンドを実行して、Auth0 CLI をダウンロードします。

      ```sh wrap lines
      curl -sSfL https://raw.githubusercontent.com/auth0/auth0-cli/main/install.sh | sh -s -- -b .
      ```

      次に、CLI を Auth0 アカウントで認証します。プロンプトが表示されたら「as a user」を選択します。

      ```sh lines
      ./auth0 login
      ```

      次に、Auth0 で新しいアプリケーションを作成します。

      ```sh lines
      ./auth0 apps create \
        --name "My Laravel Application" \
        --type "regular" \
        --auth-method "post" \
        --callbacks "http://localhost:8000/callback" \
        --logout-urls "http://localhost:8000" \
        --reveal-secrets \
        --no-input \
        --json > .auth0.app.json
      ```

      また、新しい API を作成する必要があります：

      ```sh lines
      ./auth0 apis create \
        --name "私のLaravelアプリケーションのAPI" \
        --identifier "https://github.com/auth0/laravel-auth0" \
        --offline-access \
        --no-input \
        --json > .auth0.api.json
      ```

      これにより、ソフトウェア開発キット (SDK) を構成する 2 つのファイルがプロジェクトディレクトリ内に作成されます。

      これらのファイルにはクレデンシャルが含まれるため、機密情報として扱うことが重要です。これらをバージョン管理にコミットしないようにしてください。Git を使用している場合は、`.gitignore` ファイルに追加してください。

      ```sh lines
      echo ".auth0.*.json" >> .gitignore
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      このソフトウェア開発キット (SDK) は、アプリケーションのユーザーが認証するために必要なすべてのルートを自動的に登録します。

      これらをより細かく制御する必要がある場合や、アプリケーション内の既存のルートと競合する場合は、
      代わりに SDK のコントローラーを手動で登録できます。高度な統合方法については、[SDK の README](https://github.com/auth0/laravel-auth0) を参照してください。

      <LoggedInForm />
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      Laravelの認証機能では、「ガード」を使用して、各リクエストでユーザーをどのように認証するかを定義します。Auth0 SDKの認証ガードを使用して、アプリケーションのルートへのアクセスを制限できます。

      ルートへアクセスする前にユーザーに認証を要求するには、Laravelの `auth` ミドルウェアを使用します。

      ```text lines
      Route::get('/private', function () {
        return response('Welcome! You are logged in.');
      })->middleware('auth');
      ```

      また、Laravel の `can` ミドルウェアと組み合わせることで、認証済みユーザーに特定の [権限](https://auth0.com/docs/manage-users/access-control/rbac)を必須とすることもできます。

      ```text lines
      Route::get('/scope', function () {
        return response('You have `read:messages` permission, and can therefore access this resource.');

      })->middleware('auth')->can('read:messages');
      ```

      <Web />
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      認証済みユーザーに関する情報には、Laravel の `Auth` ファサードまたは
      `auth()` ヘルパー関数を通じてアクセスできます。

      たとえば、ユーザーの ID とメールアドレスを取得するには次のようにします。

      ```text lines
      Route::get('/', function () {
        if (! auth()->check()) {
        return response('You are not logged in.');

        }
        $user = auth()->user();
        $name = $user->name ?? 'User';
        $email = $user->email ?? '';
        return response("Hello {$name}! Your email address is {$email}.");
      });;
      ```

      <Web2 />
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7" isSingleColumn>
      [Auth0 Management API](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md) を使用してユーザー情報を更新できます。すべての Management API エンドポイントには、ソフトウェア開発キット (SDK) の
      `management()` メソッドからアクセスできます。

      **Management API を呼び出す前に、アプリケーションが Management API と通信できるように設定しておく必要があります。** これは [Auth0 Dashboard の API ページ](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq/apis/) から行えます。`Auth0 Management API` を選択し、`Machine to Machine Applications` タブを開きます。Laravel
      アプリケーションを承認し、下向き矢印をクリックして付与したいスコープを選択します。

      次の例では、ユーザーのメタデータを更新し、ランダムな「お気に入りの色」を割り当てます。この場合は、
      `read:users` および `update:users` スコープを付与する必要があります。API エンドポイントの一覧と
      必要なスコープは、[Management
      API ドキュメント](https://auth0.com/docs/api/management/v2) に記載されています。

      ```text lines
      use Auth0\Laravel\Facade\Auth0;
      Route::get('/colors', function () {
      $endpoint = Auth0::management()->users();
      $colors = ['red', 'blue', 'green', 'black', 'white', 'yellow', 'purple', 'orange', 'pink', 'brown'];
      $endpoint->update(
      id: auth()-&gt;id(),

      body: [

          'user_metadata' =&gt; [

              'color' =&gt; $colors[random_int(0, count($colors) - 1)]

          ]

      ]

      );
      $metadata = $endpoint->get(auth()->id());
      $metadata = Auth0::json($metadata);
      $color = $metadata['user_metadata']['color'] ?? 'unknown';
      $name = auth()->user()->name;
      return response("Hello {$name}! Your favorite color is {$color}.");
      })->middleware('auth');
      ```

      すべてのソフトウェア開発キット (SDK) 向け Management API メソッドをまとめたクイックリファレンスガイドは [こちらから参照できます](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md)。

      <Web3 />
    </Section>

    <Section id={sections[7].id} title={sections[7].title} stepNumber="8" isSingleColumn>
      これで、Laravel アプリケーションを起動してリクエストを受け付ける準備ができました。

      ```text lines
      php artisan serve
      ```

      <Info>
        ##### チェックポイント

        Web ブラウザーを開き、次のルートへアクセスしてください。

        * [http://localhost:8000](http://localhost:8000/) にアクセスして、
          パブリックルートを表示します。
        * [http://localhost:8000/private](http://localhost:8000/private) にアクセスして、認証を求められることを確認します。
        * [http://localhost:8000](http://localhost:8000/) にアクセスして、
          認証済み状態でパブリックルートを表示します。
        * [http://localhost:8000/scope](http://localhost:8000/scope) にアクセスして、
          `read:messages` [permission](https://auth0.com/docs/manage-users/access-control/rbac)
          権限を持っているか確認します。
        * [http://localhost:8000/update](http://localhost:8000/update) にアクセスして、ユーザーのプロファイルを更新します。
        * [http://localhost:8000/logout](http://localhost:8000/logout) にアクセスして、ログアウトします。
      </Info>

      ### 追加の参考資料

      * [User Repositories and Models](https://github.com/auth0/laravel-auth0/blob/main/docs/Users.md) では、カスタムユーザーモデルを使用するために Auth0 Laravel ソフトウェア開発キット (SDK) を拡張する方法と、データベースにユーザーを保存し、そこから取得する方法について説明します。
      * [Hooking Events](https://github.com/auth0/laravel-auth0/blob/main/docs/Events.md) では、Auth0 Laravel SDK によって発生するイベントを受け取り、連携の動作を柔軟にカスタマイズする方法について説明します。
      * [Management API](https://github.com/auth0/laravel-auth0/blob/main/docs/Management.md) のサポートは Auth0 Laravel SDK に組み込まれており、Laravel アプリケーションから Management API と連携できます。

      <LoggedInForm />
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントとアプリケーションの構成と管理方法を学びます
    * [laravel-auth0 SDK](https://github.com/auth0/laravel-auth0) - このチュートリアルで使用しているソフトウェア開発キット (SDK) の詳細はこちら
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張するインテグレーションを見つける
  </Content>
</Recipe>