---
title: PHP アプリケーションにログイン機能を追加する
sidebarTitle: PHP

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";
import Index from "/snippets/ja-JP/quickstart/webapp/php/index.php.mdx";
import Login from "/snippets/ja-JP/quickstart/webapp/php/login.php.mdx";
import Logout from "/snippets/ja-JP/quickstart/webapp/php/logout.php.mdx";
import Profile from "/snippets/ja-JP/quickstart/webapp/php/profile.php.mdx";
import Router from "/snippets/ja-JP/quickstart/webapp/php/router.php.mdx";
import Callback from "/snippets/ja-JP/quickstart/webapp/php/callback.php.mdx";

import {AuthCodeGroup} from "/snippets/ja-JP/AuthCodeGroup.jsx";

export const sections = [
      { id: "configure-auth0", title: "Auth0 の設定" },
      { id: "install-the-auth0-php-sdk", title: "Auth0 PHP ソフトウェア開発キット (SDK) のインストール" },
      { id: "create-routes", title: "ルートの作成" },
      { id: "add-login-to-your-application", title: "アプリケーションへのログインの追加" },
      { id: "add-logout-to-your-application", title: "アプリケーションへのログアウトの追加" },
      { id: "show-user-profile-information", title: "ユーザープロファイル情報の表示" }
]


<Recipe isSingleColumn>
  <Content>
    Auth0を使用すると、ほぼすべてのタイプのアプリケーションに認証を迅速に追加できます。このガイドでは、Auth0 PHP ソフトウェア開発キット (SDK) を使用して、任意のPHPアプリケーションにAuth0を統合し、認証を追加して、ユーザープロファイル情報を表示する方法を説明します。

    このクイックスタートを使用するには、次のものが必要です:

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Auth0 のサービスを利用するには、Auth0 Dashboard にアプリケーションを設定しておく必要があります。Auth0 アプリケーションでは、開発中のプロジェクトに対して認証をどのように動作させるかを構成します。

      ### アプリケーションを設定する

      インタラクティブ セレクターを使用して新しい Auth0 アプリケーションを作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0 内の各アプリケーションには、アプリケーションのコードがソフトウェア開発キット (SDK) を通じて Auth0 API を呼び出すときに使用する、英数字から成る一意のクライアントID が割り当てられます。

      このクイックスタートで行った設定内容は、[Dashboard](https://manage.auth0.com/#/) 内の該当アプリケーションに自動的に反映され、今後はそこでアプリケーションを管理できます。

      より完全な設定例を確認したい場合は、代わりにサンプルアプリケーションを参照できます。

      ### Callback URL を設定する

      Callback URL は、ユーザーが認証された後に Auth0 からリダイレクトさせたい、アプリケーション内の URL です。設定されていない場合、ユーザーはログイン後にアプリケーションへ戻されません。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを
        `http://localhost:3000/callback`
        に設定してください。
      </Info>

      ### Logout URL を設定する

      Logout URL は、ユーザーがログアウトした後に Auth0 からリダイレクトさせたい、アプリケーション内の URL です。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーが返されます。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを `http://localhost:3000` に設定してください。
      </Info>

      ### Allowed Web Origins を設定する

      Allowed Web Origin は、認証フローへのアクセスを許可したい URL です。ここには、プロジェクトの URL を含める必要があります。正しく設定されていない場合、プロジェクトは認証トークンをサイレントリフレッシュできず、ユーザーは次にアプリケーションにアクセスしたりページを更新したりしたときにログアウトされてしまいます。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを `http://localhost:3000` に設定してください。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      Auth0 では、PHP アプリで Auth0 を用いた認証および認可を実装するプロセスを簡素化するための [PHP ソフトウェア開発キット (SDK)](https://github.com/auth0/auth0-PHP)（Auth0-PHP）を提供しています。

      Auth0 PHP SDK では、ネットワークリクエストを管理するために、[PSR-17](https://www.php-fig.org/psr/psr-17/) および [PSR-18](https://www.php-fig.org/psr/psr-18/) に準拠した HTTP ライブラリがインストールされている必要があります。ライブラリが利用できない場合は、ターミナルで次のコマンドを実行して、信頼性の高いライブラリをインストールできます。

      ```text lines
      cd <your-project-directory>
      composer require symfony/http-client nyholm/psr7
      ```

      次に、ターミナルで以下のコマンドを実行して、Auth0 PHP ソフトウェア開発キット (SDK) をインストールします。

      ```text lines
      composer require auth0/auth0-php
      ```

      ### Auth0 SDK を設定する

      アプリケーション内に `index.php` という新しいファイルを作成し、右側のインタラクティブパネルの **index.php** タブにあるコードをコピーします。

      SDK を正しく動作させるには、初期化時に Auth0 SDK に次のプロパティを設定する必要があります。

      * `domain`: Auth0 テナントのドメインです。通常、Auth0 Dashboard の Application の Settings にある Domain フィールドで確認できます。[Custom Domain](https://auth0.com/docs/custom-domains) を使用している場合は、そのカスタムドメインの値を設定してください。
      * `clientId`: このクイックスタートの前の手順で設定した Auth0 Application の ID です。Auth0 Dashboard の Application の Settings にある Client ID フィールドで確認できます。
      * `clientSecret`: このクイックスタートの前の手順で設定した Auth0 Application のシークレットです。Auth0 Dashboard の Application の Settings にある Client Secret フィールドで確認できます。
      * `redirectUri`: 認証後に Auth0 からリダイレクトさせたい、アプリケーション内の URL です。これは、このクイックスタートで前に設定したコールバック URL に対応します。この値も Auth0 Dashboard の Application の Settings にある Callback URLs フィールドで確認できます。コード内に指定する値が、先ほど設定した値と一致していることを必ず確認してください。一致しない場合、ユーザーにエラーが表示されます。
      * `cookieSecret`: セッション Cookie を暗号化するために使用される長いシークレット値です。ターミナルで `openssl rand -hex 32` を実行すると、適切な文字列を生成できます。

      <Info>
        ##### チェックポイント

        Auth0 SDK は正しく設定されているはずです。アプリケーションを実行し、次の点を確認してください。

        * SDK が正しく初期化されていること。
        * アプリケーションが Auth0 に関連するエラーをスローしていないこと。
      </Info>

      <AuthCodeGroup>
        <Index />

        <Login />

        <Logout />

        <Profile />

        <Router />

        <Callback />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      次に、ルーティングライブラリをインストールして、受信リクエストをアプリケーションへ振り分けられるようにします。これは必須の手順ではありませんが、このクイックスタートではアプリケーション構成を簡素化するために利用します。

      ```text lines
      composer require steampixel/simple-php-router
      ```

      アプリケーション内に `router.php` という名前の新しいファイルを作成してルートを定義し、右側のインタラクティブパネルに表示されているコードをコピーします。

      <AuthCodeGroup>
        <Router />

        <Index />

        <Login />

        <Logout />

        <Profile />

        <Callback />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      Auth0 アプリケーションと Auth0 PHP ソフトウェア開発キット (SDK) の設定が完了したので、プロジェクトでログイン機能を設定する必要があります。これを行うには、SDK の `login()` メソッドを使用して、ユーザーを Auth0 の Universal Login ページにリダイレクトするログインボタンを作成します。ユーザーが正常に認証されると、このクイックスタートで前に設定したコールバック URL にリダイレクトされます。

      ログイン処理を行うために、アプリケーション内に `login.php` という新しいファイルを作成し、ログインに必要なロジックを含む右側のインタラクティブパネルのコードをコピーします。

      <Info>
        ##### チェックポイント

        ここまでで、ユーザー名とパスワードを使ってログインまたはサインアップできるようになっているはずです。

        ログインリンクをクリックし、次の点を確認してください。

        * アプリケーションが Auth0 の Universal Login ページにリダイレクトされること。
        * ログインまたはサインアップできること。
        * SDK を構成する際に使用した `redirectUri` の値を使って、Auth0 からアプリケーションにリダイレクトされること。
      </Info>

      <AuthCodeGroup>
        <Login />

        <Index />

        <Logout />

        <Profile />

        <Router />

        <Callback />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      プロジェクトにログインしたユーザーには、ログアウトする方法も必要です。ここでは、ソフトウェア開発キット (SDK) の
      `logout()` メソッドを使ってログアウトボタンを処理します。ユーザーがログアウトすると、[Auth0 のログアウト](https://auth0.com/docs/api/authentication?http#logout) エンドポイントにリダイレクトされ、
      そこから、このクイックスタートで前に設定したログアウト URL にすぐにリダイレクトされます。

      アプリケーションに `logout.php` という新しいファイルを作成して処理を行い、ログアウトに必要なロジックを含む
      インタラクティブパネルのコードをコピーします。次に、`index.php` ファイルを更新してログアウトボタンを含めます。

      <Info>
        ##### チェックポイント

        アプリケーションを実行し、ログアウトボタンをクリックして、次を確認します。

        * アプリケーションが、Application Settings（アプリケーション設定）の Allowed Logout URLs（許可されたログアウトURL）の 1 つとして指定したアドレスにリダイレクトされること。
        * アプリケーションにログインしていない状態になっていること。
      </Info>

      <AuthCodeGroup>
        <Logout />

        <Index />

        <Login />

        <Profile />

        <Router />

        <Callback />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      ユーザーがログインおよびログアウトできるようになったら、認証済みユーザーに紐づく[プロファイル情報](https://auth0.com/docs/users/concepts/overview-user-profile)を取得したくなるはずです。たとえば、ログイン中のユーザーの名前やプロファイル画像をプロジェクト内に表示したい場合などです。

      Auth0 PHP ソフトウェア開発キット (SDK) は、`getCredentials()` メソッドを通じてユーザー情報を提供します。インタラクティブパネル内の
      `profile.php` コードを確認して、その使用例を参照してください。

      このメソッドにはユーザーの識別情報などの機微情報が含まれるため、その利用可否はユーザーの認証状態に依存します。レンダーエラーを防ぐため、
      アプリケーションが結果を利用する前に、Auth0 がユーザーを認証しているかどうかを判定するために、`getCredentials()` メソッドが
      `object` か `null` を返すかを必ず確認してください。

      <Info>
        ##### チェックポイント

        次の点を確認します:

        * ログイン後に、`nickname` やその他のユーザープロパティを正しく表示できること。
      </Info>

      <AuthCodeGroup>
        <Profile />

        <Index />

        <Login />

        <Logout />

        <Router />

        <Callback />
      </AuthCodeGroup>
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントとアプリケーションの設定と管理方法について学びます
    * [Auth0-PHP SDK](https://github.com/auth0/auth0-php) - このチュートリアルで使用しているソフトウェア開発キット (SDK) の詳細を確認する
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張できる連携機能を見つける
  </Content>
</Recipe>