---
title: Blazor Server アプリケーションにログインを追加する
sidebarTitle: ASP.NET Core Blazor Server

---

import {AuthCodeGroup} from "/snippets/ja-JP/AuthCodeGroup.jsx";

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx"

import Login from "/snippets/ja-JP/quickstart/webapp/aspnet-core-blazor-server/Login.cshtml.cs.mdx"
import Logout from "/snippets/ja-JP/quickstart/webapp/aspnet-core-blazor-server/Logout.cshtml.cs.mdx"

export const sections = [
      { id: "configure-auth0", title: "Auth0 を設定する" },
      { id: "install-and-configure-the-sdk", title: "ソフトウェア開発キット (SDK) をインストールして設定する" },
      { id: "login", title: "ログイン" },
      { id: "display-user-profile", title: "ユーザープロファイルを表示する" },
      { id: "logout", title: "ログアウト" }
]


<Recipe isSingleColumn>
  <Content>
    Auth0を使用すると、アプリケーションに認証を素早く追加し、ユーザープロファイル情報にアクセスできます。
    このガイドでは、**Auth0.AspNetCore.Authentication** SDK を使用して、新規または既存の Blazor Server アプリケーションに Auth0 を統合する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Auth0 のサービスを利用するには、Auth0 Dashboard に Auth0 アプリケーションを作成しておく必要があります。Auth0 アプリケーションでは、開発中のプロジェクトで認証をどのように動作させるかを設定します。

      ### アプリケーションを設定する

      インタラクティブセレクターを使用して新しい Auth0 アプリケーションを作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0 の各アプリケーションには、英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードはこのクライアントIDを使用して、ソフトウェア開発キット (SDK) 経由で Auth0 API を呼び出します。

      このクイックスタートで設定した内容はすべて、[Dashboard](https://manage.auth0.com/dashboard/us/auth0-dsepaid/) 上の該当する Application に自動的に反映されます。今後はここから Application を管理できます。

      より完全な設定例を確認したい場合は、代わりにサンプルアプリケーションを参照してください。

      ### コールバック URL を設定する

      コールバック URL は、ユーザーが認証を完了した後に Auth0 からリダイレクトしたい、アプリケーション内の URL です。設定されていない場合、ユーザーはログイン後にアプリケーションへ戻ることができません。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを
        `http://localhost:3000/callback` に設定してください。
      </Info>

      ### ログアウト URL を設定する

      ログアウト URL は、ユーザーがログアウトした後に Auth0 からリダイレクトしたい、アプリケーション内の URL です。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーが発生します。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを `http://localhost:3000` に設定してください。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      ### NuGet からインストールする

      Blazor Server と Auth0 を統合するには、ソフトウェア開発キット (SDK) を使用します。アプリケーションに
      `Auth0.AspNetCore.Authentication` [NuGet パッケージ](https://www.nuget.org/packages/Auth0.AspNetCore.Authentication/) をインストールしてください。

      ### ミドルウェアを構成する

      Blazor Server アプリケーションで認証を有効にするには、SDK が提供するミドルウェアを使用します。
      `Program.cs` ファイルを開き、`builder.Services.AddAuth0WebAppAuthentication()` を呼び出して
      SDK のミドルウェアを登録します。

      `Domain` と `ClientId` を必ず構成してください。これらは、SDK がどの Auth0 テナントとアプリケーションを使用するかを認識するために必須のフィールドです。

      `Program.cs` ファイルで認証と認可が有効になっていることを確認してください。

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      ユーザーが Blazor Server アプリケーションにログインできるようにするには、`Pages` ディレクトリに
      `LoginModel` を追加します。

      `LoginModel` の `OnGet` メソッド内で `HttpContext.ChallengeAsync()` を呼び出し、
      認証スキームとして `Auth0Constants.AuthenticationScheme` を渡します。これにより、SDK が内部的に登録している OIDC
      認証ハンドラーが呼び出されます。あわせて、対応する
      `authenticationProperties` を指定する必要があります。これは
      `LoginAuthenticationPropertiesBuilder` を使用して生成できます。

      `HttpContext.ChallengeAsync()` の呼び出しが成功すると、ユーザーは Auth0 にリダイレクトされ、
      アプリケーションにリダイレクトバックされた際に、OIDC ミドルウェアと Cookie ミドルウェアの両方にサインインされます。
      これにより、以降のリクエストでユーザーを認証済みとして扱えるようになります。

      <Info>
        ##### チェックポイント

        ログインを構成したら、アプリケーションを実行して次の点を確認してください。

        * `Login` ページに移動すると Auth0 にリダイレクトされること
        * 認証情報を入力すると、アプリケーションにリダイレクトバックされること
      </Info>

      <AuthCodeGroup>
        <Login />

        <Logout />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      ミドルウェアが Auth0 からトークンの取得に成功すると、IDトークンからユーザーの情報と
      クレームを抽出し、それらを `CascadingParameter` として追加できる `AuthenticationState`
      経由で利用できるようにします。

      Blazor コード内で `AuthenticationState` の `User` プロパティから対応する情報を取得し、
      ビューへ渡すことで、ユーザーの名前や追加のクレーム（メールや写真など）を表示するための
      カスタムユーザープロファイルページを作成できます。

      <Info>
        ##### チェックポイント

        ユーザーのプロファイルをレンダリングする設定が完了したので、アプリケーションを実行して次の点を確認してください。

        * ログインに成功したあとでプロファイルを表示するエンドポイントに移動すると、ユーザーの
          プロファイルが表示されること。
      </Info>

      <AuthCodeGroup>
        <Login />

        <Logout />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      独自のアプリケーションからユーザーをログアウトさせるには、`LogoutModel` の `OnGet` メソッド内で
      `CookieAuthenticationDefaults.AuthenticationScheme` 認証スキームを指定して `HttpContext.SignOutAsync` を呼び出します。

      さらに、Auth0 からもユーザーをログアウトさせたい場合（これにより、シングルサインオンに依存している他のアプリケーションからも
      ログアウトされる可能性があります）は、`Auth0Constants.AuthenticationScheme` 認証スキームと、
      `LogoutAuthenticationPropertiesBuilder` を使用して構築できる適切な
      `authenticationProperties` を指定して `HttpContext.SignOutAsync` を呼び出します。

      <Info>
        ##### チェックポイント

        Logout の設定が完了したら、アプリケーションを実行して次の点を確認してください。

        * `Logout` ページに移動すると、ユーザーがログアウトされること。
        * Auth0 からもログアウトする場合、Auth0 にリダイレクトされ、その後直ちに
          自分のアプリケーションへリダイレクトされること。
      </Info>

      <AuthCodeGroup>
        <Logout />

        <Login />
      </AuthCodeGroup>
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 のテナントとアプリケーションの設定・管理方法を学びます
    * [auth0-aspnetcore-authentication ソフトウェア開発キット (SDK)](https://github.com/auth0/auth0-aspnetcore-authentication) - このチュートリアルで使用しているソフトウェア開発キット (SDK) の詳細をご覧ください
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張できるインテグレーションを見つけましょう
  </Content>
</Recipe>