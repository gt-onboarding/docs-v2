---
title: Spring Webアプリケーションにログインを追加する
sidebarTitle: Java Spring Boot

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";
import Application from "/snippets/ja-JP/quickstart/webapp/java-spring-boot/application.yml.mdx";
import Securityconfig from "/snippets/ja-JP/quickstart/webapp/java-spring-boot/SecurityConfig.java.mdx";
import Index from "/snippets/ja-JP/quickstart/webapp/java-spring-boot/index.html.mdx";
import Homecontroller from "/snippets/ja-JP/quickstart/webapp/java-spring-boot/HomeController.java.mdx";
import Securityconfigwithlogout from "/snippets/ja-JP/quickstart/webapp/java-spring-boot/SecurityConfigWithLogout.java.mdx";

import {AuthCodeGroup} from "/snippets/ja-JP/AuthCodeGroup.jsx";

export const sections = [
  { id: "configure-auth0", title: "Auth0 を設定する" },
  { id: "configure-sprint-boot-application", title: "Spring Boot アプリケーションを設定する" },
  { id: "configure-spring-security", title: "Spring Security を設定する" },
  { id: "add-login-to-your-application", title: "アプリケーションにログイン機能を追加する" },
  { id: "add-front-page", title: "フロントページを追加する" },
  { id: "add-controller", title: "コントローラーを追加する" },
  { id: "add-logout-to-your-application", title: "アプリケーションにログアウト機能を追加する" }
]


<Recipe isSingleColumn>
  <Content>
    <Info>
      このチュートリアルでは [Spring MVC](https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html) を使用します。[Spring WebFlux](https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#spring-web-reactive) を使用している場合、認証を追加する手順はほぼ同じですが、実装の詳細が一部異なります。[Spring Boot WebFlux Sample Code](https://github.com/auth0-samples/auth0-spring-boot-login-samples/tree/master/webflux-login) を参照して、Spring Boot WebFlux アプリケーションに Auth0 を統合する方法を確認してください。
    </Info>

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Auth0 のサービスを利用するには、Auth0 Dashboard 上にアプリケーションを作成しておく必要があります。Auth0 アプリケーションは、開発中のプロジェクトに対して認証をどのように動作させるかを設定する場所です。

      ### アプリケーションを設定する

      インタラクティブセレクターを使用して新しい Auth0 Application を作成するか、統合したいプロジェクトを表す既存の Application を選択します。Auth0 の各 Application には英数字から成る一意のクライアントID が割り当てられており、アプリケーションのコードはこのクライアントID を使用してソフトウェア開発キット (SDK) 経由で Auth0 API を呼び出します。

      このクイックスタートで行った設定は、[Dashboard](https://manage.auth0.com/#/) 上の Application に自動的に反映され、今後はそこで Application を管理できます。

      より完全な構成を確認したい場合は、代わりにサンプルアプリケーションを参照できます。

      ### コールバック URL を設定する

      コールバック URL は、ユーザーが認証を完了した後に Auth0 からリダイレクトしたい、アプリケーション内の URL です。設定されていない場合、ユーザーはログイン後にアプリケーションへ戻されません。

      <Info>
        サンプルプロジェクトに沿って作業している場合は、次の値を設定してください。

        `http://localhost:3000/login/oauth2/code/okta`。
      </Info>

      ### ログアウト URL を設定する

      ログアウト URL は、ユーザーがログアウトした後に Auth0 からリダイレクトしたい、アプリケーション内の URL です。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーが返されます。

      <Info>
        サンプルプロジェクトに沿って作業している場合は、次の値を設定してください。

        `http://localhost:3000`。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      ### Spring の依存関係を追加する

      Spring Boot アプリケーションを Auth0 と統合するには、アプリケーションの依存関係に [Okta Spring Boot
      Starter](https://github.com/okta/okta-spring-boot/) を追加します。

      <Info>
        このガイドでは、ビュー層に [Thymeleaf](https://www.thymeleaf.org/) と [Spring Security integration module](https://github.com/thymeleaf/thymeleaf-extras-springsecurity) を使用します。別のビュー技術を使用している場合でも、Spring Security の設定とコンポーネントは同じです。
      </Info>

      Gradle を使用している場合は、以下のようにこれらの依存関係を追加できます。

      ```text lines
      plugins {
        id 'java'
        id 'org.springframework.boot' version '3.1.4'
        id 'io.spring.dependency-management' version '1.1.3'
      }
      implementation 'com.okta.spring:okta-spring-boot-starter:3.0.5'
      implementation 'org.springframework.boot:spring-boot-starter-web'
      implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
      implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity6'
      implementation 'nz.net.ultraq.thymeleaf:thymeleaf-layout-dialect'
      ```

      Maven を使用する場合:

      ```xml lines expandable
      <parent>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-parent</artifactId>
      <version>3.1.4</version>
      <relativePath/>
      </parent>
      <dependencies>
      <dependency>
      <groupId>com.okta</groupId>
      <artifactId>okta-spring-boot-starter</artifactId>
      <version>3.0.5</version>
      </dependency>
      <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
      </dependency>
      <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-oauth2-client</artifactId>
      </dependency>
      <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-thymeleaf</artifactId>
      </dependency>
      <dependency>
      <groupId>org.thymeleaf.extras</groupId>
      <artifactId>thymeleaf-extras-springsecurity6</artifactId>
      </dependency>
      <dependency>
      <groupId>nz.net.ultraq.thymeleaf</groupId>
      <artifactId>thymeleaf-layout-dialect</artifactId>
      </dependency>
      </dependencies>
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      Okta Spring Boot Starter を使用すると、Auth0 と連携するようにアプリケーションを簡単に設定できます。以下のサンプルでは
      `application.yml` ファイルを使用していますが、プロパティ ファイルや、その他の [サポートされている外部化メカニズム](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config) を使用することもできます。

      ```yml lines
      #src/main/resources/application.yml
      okta:
      oauth2:
      issuer: https://{yourDomain}/

      client-id: {yourClientId}

      client-secret: {yourClientSecret}

      #上記のサンプルと手順では、コールバックおよびログアウト URL の設定にポート 3000 を使用しています。
      #別のポートを使用する場合は、この値を変更し、コールバックおよびログアウト URL が
      #正しいポートで設定されていることを確認してください。
      server:
      port: 3000
      ```

      <AuthCodeGroup>
        <Application />

        <Securityconfig />

        <Index />

        <Homecontroller />

        <Securityconfigwithlogout />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      Auth0 でユーザーのログインを有効にするには、[SecurityFilterChain](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/web/SecurityFilterChain.html) を登録するクラスを作成し、そのクラスに `@Configuration` アノテーションを付与します。

      <Info>
        [HttpSecurity](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html) インスタンスを設定して、すべてのパスまたは特定のパスで認証を必須にすることができます。たとえば、ホームページ以外のすべてのパスで認証を必須にするには、次のようにします：
      </Info>

      ```java lines
      http.authorizeHttpRequests(authorize -> authorize
          .requestMatchers(&quot;/&quot;).permitAll()

          .anyRequest().authenticated()

      );
      ```

      <AuthCodeGroup>
        <Securityconfig />

        <Application />

        <Index />

        <Homecontroller />

        <Securityconfigwithlogout />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      Okta Spring Boot Starter は、先ほど定義したクライアント構成を使用して、ユーザーがアプリケーションの `/oauth2/authorization/okta` パスにアクセスしたときにログインを処理します。これを使って、アプリケーションにログインリンクを作成できます。

      このページでは、ユーザーが認証されるとユーザー属性が返されます。テンプレート内の `/logout` リンクを使用して、ログアウト機能を実装します。

      <AuthCodeGroup>
        <Index />

        <Application />

        <Securityconfig />

        <Homecontroller />

        <Securityconfigwithlogout />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      受信したリクエストを処理するコントローラーを作成します。このコントローラーは `index.html` ページをレンダリングします。
      ユーザーが認証されると、アプリケーションはページをレンダリングするためにユーザーのプロファイル情報の属性を取得します。

      <Info>
        ##### チェックポイント

        ログインリンクをクリックしたときに、アプリケーションが [Auth0 Universal Login](https://auth0.com/universal-login) ページにリダイレクトすることを確認し、ユーザー名とパスワード、またはソーシャルプロバイダーを使用して
        ログインまたはサインアップできることを確認してください。
      </Info>

      <Info>
        Auth0 は新しいテナントでデフォルトで Google ソーシャルプロバイダーを有効にし、[social identity providers](https://auth0.com/docs/connections/identity-providers-social) を使用したログインをテストするための開発者キーを提供します。
        ただし、これらの開発者キーにはいくつかの制限があり、そのためにアプリケーションの動作が通常と異なる場合があります。この動作がどのようなものになる可能性があるか、またその対処方法の詳細については、
        [Test Social Connections with Auth0 Developer Keys](https://auth0.com/docs/connections/social/devkeys#limitations-of-developer-keys) ドキュメントを参照してください。
      </Info>

      <AuthCodeGroup>
        <Homecontroller />

        <Application />

        <Securityconfig />

        <Index />

        <Securityconfigwithlogout />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7" isSingleColumn>
      ユーザーがアプリケーションにログインできるようになったので、次は[ログアウトする方法](https://auth0.com/docs/logout/guides/logout-auth0)が必要です。デフォルトでは、
      ログアウトが有効な場合、Spring Security はアプリケーションからユーザーをログアウトさせ、セッションをクリアします。Auth0 から正しくログアウトできるようにするには、
      `LogoutHandler` を指定してユーザーを [Auth0 のログアウトエンドポイント](https://auth0.com/docs/api/authentication?javascript#logout)
      （`https://{yourDomain}/v2/logout`）にリダイレクトし、その直後にアプリケーションへリダイレクトします。

      `SecurityConfig` クラスで、Auth0 のログアウトエンドポイントにリダイレクトする `LogoutHandler` を指定し、
      `HttpSecurity` を設定してログアウトハンドラーを追加します。

      <Info>
        ##### チェックポイント

        ログアウトリンクをクリックすると、アプリケーションは「設定」の「許可されたログアウトURL」の 1 つとして指定した
        アドレスにリダイレクトされ、その後はアプリケーションにログインしていない状態になっているはずです。
      </Info>

      <AuthCodeGroup>
        <Securityconfigwithlogout />

        <Application />

        <Securityconfig />

        <Index />

        <Homecontroller />
      </AuthCodeGroup>
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントおよびアプリケーションの設定と管理方法を学びます
    * [Okta Spring Boot Starter SDK](https://github.com/okta/okta-spring-boot/) - このチュートリアルで使用するソフトウェア開発キット (SDK) をより詳しく確認できます
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張するための連携機能を見つける
  </Content>
</Recipe>