---
title: Djangoアプリケーションにログインを追加する

sidebarTitle: Django
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";

import HTML from "/snippets/ja-JP/quickstart/webapp/django/templates-index.html.mdx";
import Settings from "/snippets/ja-JP/quickstart/webapp/django/settings.py.mdx";
import Urls from "/snippets/ja-JP/quickstart/webapp/django/urls.py.mdx";
import Views from "/snippets/ja-JP/quickstart/webapp/django/views.py.mdx";
import Views2 from "/snippets/ja-JP/quickstart/webapp/django/views.py2.mdx";

import {AuthCodeGroup} from "/snippets/ja-JP/AuthCodeGroup.jsx";

export const sections = [
  { id: "configure-auth0", title: "Auth0 を設定する" },
  { id: "install-dependencies", title: "依存関係をインストールする" },
  { id: "configure-your-env-file", title: ".env ファイルを設定する" },
  { id: "create-an-application", title: "Application を作成する" },
  { id: "update-settings-py", title: "settings.py を更新する" },
  { id: "setup-your-application", title: "アプリケーションをセットアップする" },
  { id: "setup-your-route-handlers", title: "ルートハンドラーをセットアップする" },
  { id: "register-your-routes", title: "ルートを登録する" },
  { id: "add-templates", title: "テンプレートを追加する" },
  { id: "run-your-application", title: "アプリケーションを実行する" }
]


<Recipe isSingleColumn>
  <Content>
    Auth0を使用すると、アプリケーションに認証を追加し、ユーザープロファイル情報にアクセスできるようになります。このガイドでは、[Authlib](https://authlib.org/) SDK を使用して、Auth0をPython [Django](https://www.djangoproject.com/) アプリケーションと統合する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Auth0 のサービスを利用するには、Auth0 Dashboard でアプリケーションを設定する必要があります。Auth0 アプリケーションは、
      開発しているプロジェクト向けに認証をどのように動作させるかを設定する場所です。

      ### アプリケーションを設定する

      インタラクティブセレクターを使用して新しい Auth0 アプリケーションを作成するか、連携したいプロジェクトを表す既存のアプリケーションを選択します。
      Auth0 の各アプリケーションには英数字で構成された一意のクライアントID が割り当てられ、アプリケーションのコードはこのクライアントID を使用して
      ソフトウェア開発キット (SDK) を通じて Auth0 API を呼び出します。

      このクイックスタートで設定した内容は、[Dashboard](https://manage.auth0.com/dashboard/us/auth0-dsepaid/) 上の該当アプリケーションに自動的に反映されます。
      ここから今後アプリケーションを管理できます。

      より包括的な設定を確認したい場合は、代わりにサンプルアプリケーションを参照できます。

      ### Callback URL を設定する

      Callback URL は、ユーザーが認証を完了した後に Auth0 からリダイレクトされる、アプリケーション内の URL です。
      設定されていない場合、ユーザーはログイン後にアプリケーションへ戻ることができません。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを
        `http://localhost:3000/callback`
        に設定してください。
      </Info>

      ### Logout URL を設定する

      Logout URL は、ユーザーがログアウトした後に Auth0 からリダイレクトされる、アプリケーション内の URL です。
      設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーが発生します。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを `http://localhost:3000` に設定してください。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      この統合では、Authlib などのライブラリをいくつか追加します。プロジェクトディレクトリに
      `requirements.txt` ファイルを作成し、次の内容を記述してください。

      ```text lines
      authlib ~= 1.0
      django ~= 4.0
      python-dotenv ~= 0.19
      requests ~= 2.27
      ```

      これらの依存関係を利用できるようにするために、シェルで次のコマンドを実行してください。

      ```text lines
      pip install -r requirements.txt
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      次に、プロジェクトディレクトリに `.env` ファイルを作成します。このファイルには、クライアントキーやその他の設定情報を記述します。

      ```text lines
      AUTH0_CLIENT_ID={yourClientId}
      AUTH0_CLIENT_SECRET={yourClientSecret}
      AUTH0_DOMAIN={yourDomain}
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      すでに Django アプリケーションのセットアップが完了している場合は、次の手順に進んでください。新しいアプリケーションプロジェクトの場合は、次のコマンドを実行します。

      ```text lines
      django-admin startproject webappexample
      ```

      新しいプロジェクトフォルダーに移動します。

      ```text lines
      cd webappexample
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      `webappexample/settings.py` ファイルを開き、`.env` の値を確認します。

      ファイルの先頭に `os` と `dotenv` のインポートを追加します。

      次に、`BASE_DIR` の定義の直下に `TEMPLATE_DIR` 変数を追加します。

      続いて、`TEMPLATES` 変数を見つけて、`DIRS` の値を更新し、
      `TEMPLATE_DIR` 文字列を追加します。これは、後の手順で作成するテンプレートファイルのパスを
      指定します。この配列のほかの内容はそのままにしておいてください。

      このファイルの末尾に、Auth0 の設定を読み込むコードを追加します。

      <AuthCodeGroup>
        <HTML />

        <Settings />

        <Urls />

        <Views />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      アプリケーションの作成を始めるには、IDE で `webappexample/views.py` ファイルを開きます。

      アプリケーションに必要なライブラリをすべてインポートします。

      これで、Authlib を設定して Auth0 を使ったアプリケーションの認証処理を行えるようになります。

      Authlib の OAuth `register()` メソッドで利用できる設定オプションの詳細については、[Authlib のドキュメント](https://docs.authlib.org/en/latest/client/frameworks.html#using-oauth-2-0-to-log-in)を参照してください。

      <AuthCodeGroup>
        <Views />

        <HTML />

        <Settings />

        <Urls />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7" isSingleColumn>
      この例では、アプリケーションに 4 つのルートを追加します。`login`、`callback`、`logout`、`index` の各ルートです。

      * `login` - アプリの訪問者が `/login` ルートにアクセスすると、認証フローを開始するために Auth0 にリダイレクトされます。
      * `callback` - ユーザーが Auth0 でのログインを完了すると、`/callback` ルートでアプリケーションに戻ります。このルートはユーザーのセッションを保存し、次回戻ってきたときに再度ログインする必要がないようにします。
      * `logout` - `/logout` ルートは、アプリケーションからユーザーをログアウトさせます。このルートはアプリ内のユーザーセッションをクリアし、セッションが保持されないようにするために Auth0 のログアウトエンドポイントへリダイレクトします。その後、アプリケーションはユーザーをホームルートへリダイレクトします。
      * `index` - ホームルートでは、認証済みユーザーの詳細を表示するか、訪問者がログインできるようにします。

      <AuthCodeGroup>
        <Views2 />

        <HTML />

        <Settings />

        <Urls />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[7].id} title={sections[7].title} stepNumber="8" isSingleColumn>
      `webappexample/urls.py` ファイルの内容を、右側に表示されているコードに置き換えて、これらの新しいルートを設定します。

      これにより、`/login`、`/callback`、`/logout`、および `/` のルートが正しいハンドラーにルーティングされます。

      <AuthCodeGroup>
        <Urls />

        <HTML />

        <Settings />

        <Views />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[8].id} title={sections[8].title} stepNumber="9" isSingleColumn>
      次に、ホームページ用のルートで使用するテンプレートファイルを作成します。

      `webappexample` フォルダー内に `templates` という名前の新しいサブディレクトリを作成し、
      その中に `index.html` ファイルを作成します。

      `index.html` ファイルには、ログインしている場合はユーザー情報を表示し、
      ログアウトしている場合はログインボタンを表示するテンプレートコードを記述します。

      <AuthCodeGroup>
        <HTML />

        <Settings />

        <Urls />

        <Views />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[9].id} title={sections[9].title} stepNumber="10" isSingleColumn>
      アプリケーションを実行する準備ができました。プロジェクトディレクトリでシェルを開き、次のコマンドを実行します。

      ```text lines
      python3 manage.py migrate
      python3 manage.py runserver 3000
      ```

      あなたのアプリケーションは、ブラウザーから [http://localhost:3000](http://localhost:3000) で開ける状態になっているはずです。

      <Info>
        ##### チェックポイント

        動作を確認するために [http://localhost:3000](http://localhost:3000/) にアクセスしてください。ログインボタンをクリックすると Auth0 に遷移してログインし、その後アプリケーションに戻ってプロファイル情報が表示されるはずです。
      </Info>

      <LoggedInForm />
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントおよびアプリケーションの設定と管理方法について学ぶ
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張できるインテグレーションを見つける
  </Content>
</Recipe>