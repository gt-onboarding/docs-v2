---
title: Python Flask アプリケーションにログインを追加する
sidebarTitle: Python

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";
import Server from "/snippets/ja-JP/quickstart/webapp/python/server.py.mdx";
import Home from "/snippets/ja-JP/quickstart/webapp/python/home.html.mdx";

import {AuthCodeGroup} from "/snippets/ja-JP/AuthCodeGroup.jsx";

export const sections = [
      { id: "configure-auth0", title: "Auth0 を設定する" },
      { id: "install-dependencies", title: "依存関係をインストールする" },
      { id: "configure-your-env-file", title: ".env ファイルを設定する" },
      { id: "setup-your-application", title: "アプリケーションをセットアップする" },
      { id: "setup-your-routes", title: "ルートをセットアップする" },
      { id: "add-templates", title: "テンプレートを追加する" },
      { id: "run-your-application", title: "アプリケーションを実行する" }
]


<Recipe isSingleColumn>
  <Content>
    Auth0を使用すると、アプリケーションに認証を追加し、ユーザープロファイル情報にアクセスできるようになります。このガイドでは、[Authlib](https://authlib.org/) ソフトウェア開発キット (SDK) を使用して、Auth0をPython [Flask](https://flask.palletsprojects.com/) アプリケーションに統合する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Auth0 のサービスを使用するには、Auth0 Dashboard でアプリケーションを設定しておく必要があります。Auth0 アプリケーションは、
      開発中のプロジェクトで認証をどのように動作させるかを構成する場所です。

      ### アプリケーションを設定する

      インタラクティブセレクターを使用して新しい Auth0 アプリケーションを作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。
      Auth0 内のすべてのアプリケーションには、英数字で構成される一意のクライアントID が割り当てられており、これはアプリケーションのコードが SDK を通じて Auth0 API を呼び出す際に使用されます。

      このクイックスタートを使って構成した設定は、自動的に [Dashboard](https://manage.auth0.com/#/) 上のあなたの Application に反映され、
      今後そこで Application を管理できます。

      より包括的な構成を確認したい場合は、代わりにサンプルアプリケーションを参照することもできます。

      ### コールバック URL を設定する

      コールバック URL は、ユーザーが認証されたあとに、Auth0 からユーザーをリダイレクトしてほしいアプリケーション内の URL です。
      これを設定しない場合、ユーザーはログイン後にアプリケーションへ戻されません。

      <Info>
        サンプルプロジェクトに沿って作業している場合は、これを
        `http://localhost:3000/callback` に設定してください。
      </Info>

      ### ログアウト URL を設定する

      ログアウト URL は、ユーザーがログアウトしたあとに、Auth0 からユーザーをリダイレクトしてほしいアプリケーション内の URL です。
      これを設定しない場合、ユーザーはアプリケーションからログアウトできず、エラーが返されます。

      <Info>
        サンプルプロジェクトに沿って作業している場合は、これを `http://localhost:3000` に設定してください。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      プロジェクトディレクトリ内に `requirements.txt` ファイルを作成します。

      ```txt lines
      # 📁 requirements.txt -----
      flask>=2.0.3
      python-dotenv>=0.19.2
      authlib>=1.0
      requests>=2.27.1
      ```

      シェルで次のコマンドを実行して、これらの依存関係をプロジェクトで有効にします。

      ```bash lines
      pip install -r requirements.txt
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      次に、プロジェクトディレクトリ内に `.env` ファイルを作成します。このファイルには、クライアントキーやその他の設定情報が格納されます。

      ```env lines
      # 📁 .env -----
      AUTH0_CLIENT_ID={yourClientId}
      AUTH0_CLIENT_SECRET={yourClientSecret}
      AUTH0_DOMAIN={yourDomain}
      APP_SECRET_KEY=
      ```

      * シェルから `openssl rand -hex 32` を実行して、`APP_SECRET_KEY` 用の文字列を生成します。

      <LoggedInForm />
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      次にアプリケーションをセットアップします。プロジェクトディレクトリ内に `server.py` ファイルを作成します。このファイルに
      アプリケーションのロジックを記述します。

      アプリケーションで必要となるライブラリをすべてインポートします。

      前のステップで作成した `.env` 設定ファイルを読み込みます。

      Authlib を設定して、Auth0 を用いたアプリケーションの認証を処理できるようにします。Authlib の OAuth `register()` メソッドで利用可能な設定オプションの詳細については、[公式ドキュメント](https://docs.authlib.org/en/latest/client/frameworks.html#using-oauth-2-0-to-log-in)を参照してください。

      <AuthCodeGroup>
        <Home />

        <Server />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      この例では、アプリケーションに login、callback、logout、home の 4 つのルートを追加します。

      訪問者がアプリの `/login` ルートにアクセスすると、アプリケーションは Auth0 の
      ログインページへリダイレクトします。

      ユーザーが Auth0 でログインした後、アプリケーションは `/callback` ルートにルーティングします。
      このルートはユーザーのセッションを保存し、ユーザーが再度アクセスした際に再ログインする必要がないようにします。

      `/logout` ルートは、アプリケーションからユーザーをログアウトさせます。このルートはアプリ内のユーザーセッションをクリアし、
      セッションが保持されないようにするために Auth0 のログアウトエンドポイントへリダイレクトします。その後、アプリケーションは
      ユーザーを home ルートへリダイレクトします。

      `/`home ルートでは、認証済みユーザーの詳細を表示するか、訪問者がログインできるようにします。

      <AuthCodeGroup>
        <Server />

        <Home />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      次に、`render_template()` 呼び出し時に home ルートで使用するテンプレートファイルを作成します。

      プロジェクトフォルダー内に `templates` という名前の新しいサブディレクトリを作成し、そのディレクトリ内に `home.html` を作成します。右側の内容をそのファイルに貼り付けてください。

      <LoggedInForm />
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7" isSingleColumn>
      アプリケーションを実行するには、プロジェクトディレクトリのルートに移動してターミナルを開き、次のコマンドを実行します。

      ```bash lines
      python3 server.py
      ```

      <Info>
        ##### チェックポイント

        [http://localhost:3000](http://localhost:3000/) にアクセスして確認してください。ログインボタンをクリックすると Auth0 のログイン画面に遷移し、その後アプリケーションに戻ってプロファイル情報が表示されるはずです。
      </Info>

      <LoggedInForm />
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントやアプリケーションを設定・管理する方法を学びます
    * [auth0-python ソフトウェア開発キット (SDK)](https://github.com/auth0/auth0-python) - このチュートリアルで使用しているソフトウェア開発キット (SDK) をさらに詳しく確認する
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張できるインテグレーションを見つける
  </Content>
</Recipe>