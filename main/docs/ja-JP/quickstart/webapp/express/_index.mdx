---
title: Express アプリケーションにログイン機能を追加する

sidebarTitle: Express
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";

import Server from "/snippets/ja-JP/quickstart/webapp/express/server.js.mdx";
import Server2 from "/snippets/ja-JP/quickstart/webapp/express/server.js2.mdx";

export const sections = [
      { id: "configure-auth0", title: "Auth0 を設定する" },
      { id: "install-the-express-openid-connect-sdk", title: "Express OpenID Connect ソフトウェア開発キット (SDK) をインストールする" },
      { id: "display-user-profile", title: "ユーザープロファイルを表示する" }
]


<Recipe isSingleColumn>
  <Content>
    Auth0を使用すると、ほぼすべてのアプリケーションタイプに認証を迅速に追加できます。このガイドでは、Express OpenID Connect ソフトウェア開発キット (SDK) を使用して、Node.js ExpressアプリケーションにAuth0を統合し、ユーザーログイン、ログアウト、およびプロファイルを追加する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Auth0 のサービスを利用するには、Auth0 Dashboard 上にアプリケーションを設定する必要があります。Auth0 アプリケーションは、開発中のプロジェクトでどのように認証を行うかを設定する場所です。

      ### Configure an application

      インタラクティブセレクターを使用して新しい Auth0 アプリケーションを作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0 上の各アプリケーションには英数字で一意なクライアントIDが割り当てられ、アプリケーションコードはこのクライアントIDを使用して SDK 経由で Auth0 API を呼び出します。

      このクイックスタートで設定した内容は、[Dashboard](https://manage.auth0.com/#/) 上の該当 Application に自動的に反映され、今後もそこで Application を管理できます。

      完全な設定例を確認したい場合は、代わりにサンプルアプリケーションを参照できます。

      ### Configure Callback URLs

      コールバック URL は、ユーザーが認証された後に Auth0 からリダイレクトしたい、アプリケーション内の URL です。これを設定しないと、ユーザーはログイン後にアプリケーションへ戻ることができません。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを
        `http://localhost:3000/callback` に設定してください。
      </Info>

      ### Configure Logout URLs

      ログアウト URL は、ユーザーがログアウトした後に Auth0 からリダイレクトしたい、アプリケーション内の URL です。これを設定しないと、ユーザーはアプリケーションからログアウトできず、エラーが返されます。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを `http://localhost:3000/` に設定してください。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      アプリケーションには、Auth0 が管理・提供している OIDC 準拠の Express 用ソフトウェア開発キット (SDK) である [express-openid-connect](https://github.com/auth0/express-openid-connect) パッケージが必要です。

      ターミナルで次のコマンドを実行して、Express OpenID Connect SDK をインストールしてください。

      ```sh lines
      cd <your-project-directory>
      npm install express-openid-connect
      ```

      ### ルーターの構成

      Express OpenID Connect ライブラリには、認証ルートをアプリケーションに追加するための `auth` ルーターが用意されています。ルーターには次の構成キーを設定する必要があります。

      * `authRequired` - すべてのルートで認証が必須かどうかを制御します。
      * `auth0Logout` - Auth0 のログアウト機能を使用します。
      * `baseURL` - アプリケーションがホストされている URL。
      * `secret` - 十分に長いランダムな文字列です。
      * `issuerBaseURL` - [Application settings](https://manage.auth0.com/#/applications/\{yourClientId}/settings) にある、セキュアな URL 形式のドメイン。
      * `clientID` - [Application settings](https://manage.auth0.com/#/applications/\{yourClientId}/settings) にある Client ID。

      その他の構成オプションについては、[API ドキュメント](https://auth0.github.io/express-openid-connect) を参照してください。

      <Info>
        `LONG_RANDOM_STRING` に適した文字列は、コマンドラインで `openssl rand -hex 32` を実行して生成できます。
      </Info>

      <Info>
        ##### チェックポイント

        ライブラリが提供する `/login` ルートにアクセスすることで、ユーザーはアプリケーションにログインできるようになりました。プロジェクトを `localhost:3000` で実行している場合、そのリンクは [http://localhost:3000/login](http://localhost:3000/login) になります。
      </Info>

      <Server />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      ユーザーのプロファイルを表示するには、アプリケーションで保護されたルートを用意する必要があります。

      認証が必要なルートには `requiresAuth` ミドルウェアを追加します。このミドルウェアを使用するルートでは、有効なユーザーセッションが存在するかを確認し、存在しない場合はユーザーをログインできるようにリダイレクトします。

      <Info>
        ##### チェックポイント

        ユーザーは、ライブラリによって提供される `/logout` ルートにアクセスすることでアプリケーションからログアウトできます。プロジェクトを `localhost:3000` で実行している場合、そのリンクは [http://localhost:3000/logout](http://localhost:3000/logout) になります。
      </Info>

      <Server2 />
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントとアプリケーションの設定と管理方法を学ぶ
    * [express-openid-connect SDK](https://github.com/auth0/express-openid-connect) - このチュートリアルで使用しているソフトウェア開発キット (SDK) について詳しく見る
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張するために有効化できるインテグレーションを探す
  </Content>
</Recipe>