---
title: ASP.NET MVC アプリケーションにログイン機能を追加する
sidebarTitle: ASP.NET Core MVC

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";

import AppSettingsJSON from "/snippets/ja-JP/quickstart/webapp/aspnet-core/appsettings.json.mdx";
import AccountController from "/snippets/ja-JP/quickstart/webapp/aspnet-core/AccountController.cs.mdx";

import {AuthCodeGroup} from "/snippets/ja-JP/AuthCodeGroup.jsx";

export const sections = [
      { id: "configure-auth0", title: "Auth0 の設定" },
      { id: "install-and-configure-the-sdk", title: "ソフトウェア開発キット (SDK) のインストールと設定" },
      { id: "login", title: "ログイン" },
      { id: "display-user-profile", title: "ユーザープロファイルの表示" },
      { id: "logout", title: "ログアウト" }
]


<Recipe isSingleColumn>
  <Content>
    Auth0を使用すると、アプリケーションに認証を迅速に追加し、ユーザープロファイル情報へのアクセスを取得できます。
    このガイドでは、**Auth0.AspNetCore.Authentication** SDK を使用して、新規または既存のASP.NET MVCアプリケーションとAuth0を統合する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Auth0 のサービスを利用するには、Auth0 Dashboard でアプリケーションをセットアップする必要があります。Auth0 アプリケーションは、
      開発中のプロジェクトに対して認証をどのように動作させるかを設定する場所です。

      ### アプリケーションを設定する

      インタラクティブ セレクターを使用して新しい Auth0 アプリケーションを作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0 内のすべてのアプリケーションには、
      アプリケーションのコードがソフトウェア開発キット (SDK) を通じて Auth0 API を呼び出す際に使用する、英数字で構成された一意のクライアントIDが割り当てられます。

      このクイックスタートを使って構成した設定は、[Dashboard](https://manage.auth0.com/#/) 上のあなたの Application に自動的に反映されます。ここから、
      今後も Application を管理できます。

      より完全な構成を確認したい場合は、代わりにサンプルアプリケーションを参照できます。

      ### コールバック URL を設定する

      コールバック URL は、ユーザーが認証を完了した後に Auth0 からリダイレクトしたい、アプリケーション内の URL です。
      設定されていない場合、ユーザーはログイン後にアプリケーションへ戻ることができません。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを
        `http://localhost:3000/callback` に設定してください。
      </Info>

      ### ログアウト URL を設定する

      ログアウト URL は、ユーザーがログアウトした後に Auth0 からリダイレクトしたい、アプリケーション内の URL です。
      設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーが発生します。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを `http://localhost:3000` に設定してください。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      ### Nuget からインストールする

      Auth0 を ASP.NET Core と統合するには、ソフトウェア開発キット (SDK) を使用します。`Auth0.AspNetCore.Authentication` [Nuget パッケージ](https://www.nuget.org/packages/Auth0.AspNetCore.Authentication/) をアプリケーションにインストールしてください。

      ### ミドルウェアを構成する

      ASP.NET Core アプリケーションで認証を有効にするには、SDK が提供するミドルウェアを使用します。`Program.cs` ファイルを開き、`builder.Services.AddAuth0WebAppAuthentication()` を呼び出して SDK のミドルウェアを登録します。

      `Domain` と `ClientId` を必ず構成してください。これらは、SDK がどの Auth0 テナントとアプリケーションを使用するかを認識するために必須のフィールドです。

      `Program.cs` ファイルで認証と認可を有効にしていることを確認してください。

      <AuthCodeGroup>
        <AppSettingsJSON />

        <AccountController />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      ASP.NET MVC アプリケーションにユーザーがログインできるようにするには、コントローラーに `Login` アクションを追加します。

      `HttpContext.ChallengeAsync()` を呼び出し、認証スキームとして `Auth0Constants.AuthenticationScheme` を渡します。これにより、ソフトウェア開発キット (SDK) が内部的に登録する OIDC 認証ハンドラーが呼び出されます。あわせて、対応する `authenticationProperties` を指定してください。これは `LoginAuthenticationPropertiesBuilder` を使用して構築できます。

      `HttpContext.ChallengeAsync()` の呼び出しが正常に完了すると、ユーザーは Auth0 にリダイレクトされ、アプリケーションにリダイレクトされて戻ってきたときに、OIDC ミドルウェアと Cookie ミドルウェアの両方にサインインされます。これにより、以降のリクエストでユーザーを認証できるようになります。

      <Info>
        ##### チェックポイント

        `Login` の設定が完了したので、アプリケーションを実行して次の点を確認してください。

        * `Login` アクションにアクセスすると Auth0 にリダイレクトされること
        * 認証情報を入力するとアプリケーションにリダイレクトされて戻ってくること
      </Info>

      <AuthCodeGroup>
        <AccountController />

        <AppSettingsJSON />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      ミドルウェアが Auth0 からトークンを正常に取得すると、IDトークンからユーザーの情報と
      クレームを抽出し、それらをコントローラーの `User.Claims` プロパティとして利用できるようにします。

      ユーザーの名前、メールアドレス、およびプロファイル画像を表示するためのカスタムユーザープロファイルページを作成するには、
      対応する情報を `User` から取得して、コントローラーからビューに渡します。

      <Info>
        ##### チェックポイント

        ユーザーのプロファイルをレンダリングするためのアクションを設定したので、アプリケーションを実行して次の点を確認してください。

        * ログインに成功した後に `Profile` アクションへ移動すると、ユーザーの
          プロファイルが表示されること。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      自分のアプリケーションからユーザーをログアウトさせるには、コントローラーのアクション内で
      `CookieAuthenticationDefaults.AuthenticationScheme` 認証スキームを指定して `HttpContext.SignOutAsync` を呼び出します。

      さらに、Auth0 からもユーザーをログアウトさせたい場合（これによりシングルサインオン（SSO）を利用している他のアプリケーションからもログアウトされる可能性があります）は、`Auth0Constants.AuthenticationScheme` 認証スキームと、
      `LogoutAuthenticationPropertiesBuilder` を用いて構成できる適切な
      `authenticationProperties` を指定して `HttpContext.SignOutAsync` を呼び出します。

      <Info>
        ##### チェックポイント

        ログアウトを設定したので、アプリケーションを実行して次の点を確認します。

        * `Logout` アクションにアクセスすると、ユーザーがログアウトされていることを確認できます。
        * Auth0 からもログアウトする場合は、Auth0 にリダイレクトされ、その後すぐに自分のアプリケーションにリダイレクトされるはずです。
      </Info>

      <LoggedInForm />
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントとアプリケーションの構成および管理方法について学ぶ
    * [auth0-aspnetcore-authentication SDK](https://github.com/auth0/auth0-aspnetcore-authentication) - このチュートリアルで使用しているソフトウェア開発キット (SDK) をより詳しく確認する
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張できるインテグレーションを見つける
  </Content>
</Recipe>