---
title: "Go APIï¼šèªå¯"
permalink: "01-authorization"
---

import {AuthCodeBlock} from "/snippets/ja-JP/AuthCodeBlock.jsx";

<div id="by-sergiu-ghitea">
  ##### By Sergiu Ghitea
</div>

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€Go API ã«èªå¯ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚ã”è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‘ã‘ã«æ§‹æˆã•ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«ã‚’ä½¿ã£ã¦ã“ã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚’é€²ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ã€ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚

{/* <Card title="View on Github" href="https://github.com/auth0-samples/auth0-golang-api-samples/tree/master/01-Authorization-RS256" icon="github">
  System requirements: Go 1.21 ä»¥é™
  </Card> */}

<Info>
  **Auth0 ã¯åˆã‚ã¦ã§ã™ã‹ï¼Ÿ** [Auth0 ã®ä»•çµ„ã¿](/docs/ja-JP/get-started/auth0-overview) ã‚„ã€OAuth 2.0 ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ãŸ [API èªè¨¼ã¨èªå¯ã®å®Ÿè£…æ–¹æ³•](/docs/ja-JP/get-started/authentication-and-authorization-flow) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
</Info>

<div id="configure-auth0-apis">
  ## Auth0 ã® API ã‚’è¨­å®šã™ã‚‹
</div>

<div id="create-an-api">
  ### API ã‚’ä½œæˆã™ã‚‹
</div>

Auth0 Dashboard ã® [APIs](https://manage.auth0.com/#/apis) ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ **Create API** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚API ã®åå‰ã¨è­˜åˆ¥å­ã‚’å…¥åŠ›ã—ã¾ã™ï¼ˆä¾‹: `https://quickstarts/api`ï¼‰ã€‚ã“ã®è­˜åˆ¥å­ã¯ã€å¾Œã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ã‚’è¨­å®šã™ã‚‹ã¨ãã« `audience` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚**Signing Algorithm** ã¯ **RS256** ã®ã¾ã¾ã«ã—ã¦ãŠãã¾ã™ã€‚

<Frame>![Create API](https://cdn2.auth0.com/docs/1.14550.0/media/articles/server-apis/create-api.png)</Frame>

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€API ã¯ãƒˆãƒ¼ã‚¯ãƒ³ç½²åã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã—ã¦ RS256 ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚RS256 ã¯ç§˜å¯†éµ/å…¬é–‹éµãƒšã‚¢ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€Auth0 ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å…¬é–‹éµã«å¯¾ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚å…¬é–‹éµã¯ [JSON Web Key Set (JWKS)](/docs/ja-JP/secure/tokens/json-web-tokens/json-web-key-sets) å½¢å¼ã§æä¾›ã•ã‚Œã¦ãŠã‚Šã€[ã“ã¡ã‚‰](https://\{yourDomain}/.well-known/jwks.json) ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

<div id="define-permissions">
  ### ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã™ã‚‹
</div>

ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ç‰¹å®šã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”¨ã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä»£ã‚ã£ã¦ãƒªã‚½ãƒ¼ã‚¹ã¸ã©ã®ã‚ˆã†ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹ã‚’å®šç¾©ã§ãã¾ã™ã€‚ãŸã¨ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’æŒã¤å ´åˆã¯ `messages` ãƒªã‚½ãƒ¼ã‚¹ã¸ã®èª­ã¿å–ã‚Šæ¨©é™ã‚’ä»˜ä¸ã—ã€ç®¡ç†è€…ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’æŒã¤å ´åˆã¯ãã®ãƒªã‚½ãƒ¼ã‚¹ã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ã¨ã„ã£ãŸã“ã¨ãŒã§ãã¾ã™ã€‚

è¨±å¯ã™ã‚‹ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¯ã€Auth0 Dashboard ã® [APIs](https://manage.auth0.com/#/apis) ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ã‚‹ **Permissions** ãƒ“ãƒ¥ãƒ¼ã§å®šç¾©ã§ãã¾ã™ã€‚

<Frame>![Configure Permissions](https://cdn2.auth0.com/docs/1.14550.0/media/articles/server-apis/configure-permissions.png)</Frame>

<Info>
  ã“ã®ä¾‹ã§ã¯ `read:messages` ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
</Info>

ã“ã®ä¾‹ã§ã¯æ¬¡ã®ç‚¹ã‚’ç¤ºã—ã¾ã™ã€‚

* å—ä¿¡ã—ãŸ HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® `Authorization` ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã« JSON Web Token (JWT) ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã€‚
* Auth0 ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® [JSON Web Key Set (JWKS)](/docs/ja-JP/secure/tokens/json-web-tokens/json-web-key-sets) ã‚’ä½¿ç”¨ã—ã¦ã€ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã€‚ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€[ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã™ã‚‹](/docs/ja-JP/secure/tokens/access-tokens/validate-access-tokens)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

<div id="validate-access-tokens">
  ## ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã™ã‚‹
</div>

<div id="download-dependencies">
  ### ä¾å­˜é–¢ä¿‚ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
</div>

ä½¿ç”¨ã™ã‚‹ã™ã¹ã¦ã®ä¾å­˜é–¢ä¿‚ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã«ã€`go.mod` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```go Go lines
// go.mod

module 01-Authorization-RS256

go 1.21

require (
	github.com/auth0/go-jwt-middleware/v2 v2.2.0
	github.com/joho/godotenv v1.5.1
)
```

æ¬¡ã®ã‚·ã‚§ãƒ«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash lines
go mod download
```

<div id="configure-your-application">
  ### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹
</div>

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã«ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆã« `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚

export const codeExample = `# Auth0 ãƒ†ãƒŠãƒ³ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ã® URLã€‚
# ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ãã®å€¤ã‚’ã“ã“ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚
AUTH0_DOMAIN='{yourDomain}'

# Auth0 API ã®è­˜åˆ¥å­ã€‚
AUTH0_AUDIENCE='YOUR_API_IDENTIFIER'`;

<AuthCodeBlock children={codeExample} language="bash" />

<div id="create-a-middleware-to-validate-access-tokens">
  ### ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã™ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ä½œæˆã™ã‚‹
</div>

ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ã¯ã€ä¿è­·ã—ãŸã„ä»»æ„ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é©ç”¨ã§ãã‚‹ `EnsureValidToken` ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢é–¢æ•°å†…ã§è¡Œã„ã¾ã™ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœ‰åŠ¹ãªå ´åˆã¯ã€ãã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæä¾›ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ã—ã€ç„¡åŠ¹ãªå ´åˆã¯ `401 Authorization` ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã—ã¾ã™ã€‚

å—ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã«ã€**go-jwt-middleware** ã‚’è¨­å®šã—ã¾ã™ã€‚

```go Go lines
// middleware/jwt.go

package middleware

import (
	"context"
	"log"
	"net/http"
	"net/url"
	"os"
	"time"

	jwtmiddleware "github.com/auth0/go-jwt-middleware/v2"
	"github.com/auth0/go-jwt-middleware/v2/jwks"
	"github.com/auth0/go-jwt-middleware/v2/validator"
)

// CustomClaims ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰å–å¾—ã—ãŸã„ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¾ã™ã€‚
type CustomClaims struct {
	Scope string `json:"scope"`
}

// Validate ã¯ã“ã®ä¾‹ã§ã¯ä½•ã‚‚è¡Œã„ã¾ã›ã‚“ãŒã€validator.CustomClaims ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æº€ãŸã™ãŸã‚ã«å¿…è¦ã§ã™ã€‚
func (c CustomClaims) Validate(ctx context.Context) error {
	return nil
}

// EnsureValidToken ã¯ JWT ã®æœ‰åŠ¹æ€§ã‚’æ¤œè¨¼ã™ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ã™ã€‚
func EnsureValidToken() func(next http.Handler) http.Handler {
	issuerURL, err := url.Parse("https://" + os.Getenv("AUTH0_DOMAIN") + "/")
	if err != nil {
		log.Fatalf("ç™ºè¡Œè€… URL ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: %v", err)
	}

	provider := jwks.NewCachingProvider(issuerURL, 5*time.Minute)

	jwtValidator, err := validator.New(
		provider.KeyFunc,
		validator.RS256,
		issuerURL.String(),
		[]string{os.Getenv("AUTH0_AUDIENCE")},
		validator.WithCustomClaims(
			func() validator.CustomClaims {
				return &CustomClaims{}
			},
		),
		validator.WithAllowedClockSkew(time.Minute),
	)
	if err != nil {
		log.Fatalf("JWT ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«å¤±æ•—ã—ã¾ã—ãŸ")
	}

	errorHandler := func(w http.ResponseWriter, r *http.Request, err error) {
		log.Printf("JWT ã®æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: %v", err)

		w.Header().Set("Content-Type", "application/json")
		w.WriteHeader(http.StatusUnauthorized)
		w.Write([]byte(`{"message":"JWT ã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"}`))
	}

	middleware := jwtmiddleware.New(
		jwtValidator.ValidateToken,
		jwtmiddleware.WithErrorHandler(errorHandler),
	)

	return func(next http.Handler) http.Handler {
		return middleware.CheckJWT(next)
	}
}
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€API ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã«ç½²åã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã—ã¦ RS256 ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚RS256 ã¯ç§˜å¯†éµ/å…¬é–‹éµãƒšã‚¢ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€Auth0 ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å…¬é–‹éµã«å¯¾ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ã‚’è¡Œã„ã¾ã™ã€‚å…¬é–‹éµã¯ [JSON Web Key Set (JWKS)](/docs/ja-JP/secure/tokens/json-web-tokens/json-web-key-sets) å½¢å¼ã§æä¾›ã•ã‚Œã¦ãŠã‚Šã€[ã“ã¡ã‚‰](https://\{yourDomain}/.well-known/jwks.json) ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

<div id="protect-api-endpoints">
  ## API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä¿è­·ã™ã‚‹
</div>

å€‹ã€…ã®ãƒ«ãƒ¼ãƒˆã‚’ä¿è­·ã™ã‚‹ã«ã¯ã€ä¸Šã§å®šç¾©ã—ãŸ `middleware` ã‚’ HTTP ãƒ«ãƒ¼ãƒˆã«æ¸¡ã—ã¾ã™ã€‚

```go Go lines
// main.go

package main

import (
	"log"
	"net/http"

	"github.com/joho/godotenv"

	"01-Authorization-RS256/middleware"
)

func main() {
	if err := godotenv.Load(); err != nil {
		log.Fatalf("Error loading the .env file: %v", err)
	}

	router := http.NewServeMux()

	// ã“ã®ãƒ«ãƒ¼ãƒˆã¯å¸¸ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚
	router.Handle("/api/public", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		w.Header().Set("Content-Type", "application/json")
		w.WriteHeader(http.StatusOK)
		w.Write([]byte(`{"message":"å…¬é–‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ã“ã‚“ã«ã¡ã¯!ã“ã‚Œã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«èªè¨¼ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"}`))
	}))

	// ã“ã®ãƒ«ãƒ¼ãƒˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæœ‰åŠ¹ãª access_token ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚
	router.Handle("/api/private", middleware.EnsureValidToken()(
		http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
			// CORS ãƒ˜ãƒƒãƒ€ãƒ¼ã€‚
			w.Header().Set("Access-Control-Allow-Credentials", "true")
			w.Header().Set("Access-Control-Allow-Origin", "http://localhost:3000")
			w.Header().Set("Access-Control-Allow-Headers", "Authorization")

			w.Header().Set("Content-Type", "application/json")
			w.WriteHeader(http.StatusOK)
			w.Write([]byte(`{"message":"ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ã“ã‚“ã«ã¡ã¯!ã“ã‚Œã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯èªè¨¼ãŒå¿…è¦ã§ã™ã€‚"}`))
		}),
	))

	log.Print("Server listening on http://localhost:3010")
	if err := http.ListenAndServe("0.0.0.0:3010", router); err != nil {
		log.Fatalf("There was an error with the http server: %v", err)
	}
}
```

<div id="validate-scopes">
  ### ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æ¤œè¨¼ã™ã‚‹
</div>

ä¸Šè¨˜ã® `middleware` ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã¯æ¤œè¨¼ã—ã¾ã™ãŒã€ãã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦æ±‚ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ã«ååˆ†ãª**ã‚¹ã‚³ãƒ¼ãƒ—**ã‚’æŒã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ä»•çµ„ã¿ã¯ã€ã¾ã ç”¨æ„ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

æ­£å¸¸ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™å‰ã«ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ­£ã—ã„ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚

```go Go lines
// ğŸ‘† ä¸Šè¨˜ã®æ‰‹é †ã‹ã‚‰ã®ç¶šãã§ã™ã€‚ã“ã‚Œã‚’ middleware/jwt.go ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

// HasScope ã¯ã€ã‚¯ãƒ¬ãƒ¼ãƒ ã«ç‰¹å®šã®ã‚¹ã‚³ãƒ¼ãƒ—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚
func (c CustomClaims) HasScope(expectedScope string) bool {
    result := strings.Split(c.Scope, " ")
    for i := range result {
        if result[i] == expectedScope {
            return true
        }
    }

    return false
}
```

ã“ã®é–¢æ•°ã¯ã€ã‚¹ã‚³ãƒ¼ãƒ— `read:messages` ã‚’å¿…è¦ã¨ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ä½¿ç”¨ã—ã¾ã™ã€‚

```go Go lines
// ğŸ‘† We're continuing from the steps above. Append this to your main.go file.

func main() {
    // ...
    
    // ã“ã®ãƒ«ãƒ¼ãƒˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ read:messages ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŒã¤
    // æœ‰åŠ¹ãª access_token ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã«ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚
	router.Handle("/api/private-scoped", middleware.EnsureValidToken()(
		http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
			// CORS Headers.
			w.Header().Set("Access-Control-Allow-Credentials", "true")
			w.Header().Set("Access-Control-Allow-Origin", "http://localhost:3000")
			w.Header().Set("Access-Control-Allow-Headers", "Authorization")

			w.Header().Set("Content-Type", "application/json")

			token := r.Context().Value(jwtmiddleware.ContextKey{}).(*validator.ValidatedClaims)

			claims := token.CustomClaims.(*middleware.CustomClaims)
			if !claims.HasScope("read:messages") {
				w.WriteHeader(http.StatusForbidden)
				w.Write([]byte(`{"message":"Insufficient scope."}`))
				return
			}

			w.WriteHeader(http.StatusOK)
			w.Write([]byte(`{"message":"Hello from a private endpoint! You need to be authenticated to see this."}`))
		}),
	))
    
    // ...
}
```

ã“ã®ä¾‹ã§ã¯ã€`read:messages` ã‚¹ã‚³ãƒ¼ãƒ—ã ã‘ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«åˆã‚ã›ã¦ã€`HasScope` é–¢æ•°ã‚’æ‹¡å¼µã™ã‚‹ã‹ã€è¤‡æ•°ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

<Info>
  ##### æ¬¡ã«ã§ãã‚‹ã“ã¨

  <table>
    <tr>
      <td><a href="/docs/ja-JP/authenticate/identity-providers">ä»–ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¨­å®šã™ã‚‹</a></td>
      <td><a href="/docs/ja-JP/secure/multi-factor-authentication">å¤šè¦ç´ èªè¨¼ã‚’æœ‰åŠ¹ã«ã™ã‚‹</a></td>
    </tr>

    <tr>
      <td><a href="/docs/ja-JP/secure/attack-protection">æ”»æ’ƒä¿è­·ã«ã¤ã„ã¦å­¦ã¶</a></td>
      <td><a href="/docs/ja-JP/customize/rules">Rules ã®è©³ç´°ã‚’ç¢ºèªã™ã‚‹</a></td>
    </tr>
  </table>

  [GitHub ã§ç·¨é›†](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>

***
