---
title: "UWP"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/ja-JP/AuthCodeBlock.jsx";

<div id="by-damien-guard">
  ##### Damien Guard による
</div>

このチュートリアルでは、Auth0 を使用して UWP C# アプリケーションにユーザー ログイン機能を追加する方法を説明します。このクイックスタートを進めるにあたっては、ご自身のアカウント向けに構成されたサンプルを利用できるよう、あらかじめログインしておくことをお勧めします。

{/* <Card title="GitHub で表示" href="https://github.com/auth0-samples/auth0-uwp-oidc-samples/tree/master/Quickstart/00-Starter-Seed" icon="github">
  システム要件: Microsoft Visual Studio 2017 | Windows 10 SDK (10.0.10586.0) | Auth0.OidcClient.UWP 2.3.1
  </Card> */}

<Info>
  **認証は初めてですか？** [Auth0 の仕組み](/docs/ja-JP/get-started/auth0-overview)、[ネイティブアプリケーションとの統合方法](/docs/ja-JP/get-started/architecture-scenarios/mobile-api)、および使用する[プロトコル](/docs/ja-JP/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce)について学びましょう。
</Info>

<div id="configure-auth0">
  ## Auth0 を設定する
</div>

<div id="get-your-application-keys">
  ### アプリケーションキーを取得する
</div>

Auth0 にサインアップしたときに、新しいアプリケーションが自動的に作成されているか、あるいはご自身で新しいアプリケーションを作成しているはずです。Auth0 と連携するには、そのアプリケーションに関するいくつかの詳細が必要です。これらの情報は Auth0 Dashboard の [Application Settings](https://manage.auth0.com/#/applications) セクションから取得できます。

<Frame>![App Dashboard](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

<Info>
  Native アプリケーションまたは Single Page Application で Default App を使用する場合は、**Token Endpoint Authentication Method** を `None` に変更し、**Application Type** を `SPA` または `Native` に設定してください。
</Info>

次の情報が必要です。

* **Domain**
* **Client ID**

<Info>
  このページ上部からサンプルをダウンロードした場合、これらの情報はあらかじめ設定されています。
</Info>

<div id="configure-callback-urls">
  ### コールバックURLを設定する
</div>

コールバックURLは、ユーザーが認証を完了した後に Auth0 がユーザーをリダイレクトするアプリケーション内の URL です。あなたのアプリケーションのコールバックURLは、[Application Settings](https://manage.auth0.com/#/applications) の **Allowed Callback URLs** フィールドに追加する必要があります。このフィールドが設定されていない場合、ユーザーはアプリケーションにログインできず、エラーが発生します。

<Info>
  このページの先頭からダウンロードしたサンプルプロジェクトに沿って作業している場合は、**Allowed Callback URLs** を `https://{yourDomain}/mobile` に設定する必要があります。
</Info>

<div id="configure-logout-urls">
  ### ログアウトURLを設定する
</div>

ログアウトURLは、ユーザーが認可サーバーからログアウトされた後に、Auth0 が遷移先として戻るアプリケーション内の URL です。これは `returnTo` クエリパラメータで指定します。アプリケーションのログアウトURLは、[Application Settings](https://manage.auth0.com/#/applications) の **許可されたログアウトURL** フィールドに追加する必要があります。このフィールドが設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーが発生します。

<Info>
  このページ上部からダウンロードしたサンプルプロジェクトに沿って作業している場合、**許可されたログアウトURL** フィールドに追加する必要があるログアウトURLは `https://{yourDomain}/mobile` です。
</Info>

<div id="integrate-auth0-in-your-application">
  ## Auth0 をアプリケーションに統合する
</div>

<div id="install-dependencies">
  ### 依存関係のインストール
</div>

NuGet パッケージ マネージャー コンソール（Tools -&gt; NuGet Package Manager -&gt; Package Manager Console）を使用して、次のコマンドを実行し、`Auth0.OidcClient.UWP` パッケージをインストールします。

```
Install-Package Auth0.OidcClient.UWP
```

<div id="trigger-authentication">
  ## 認証を開始する
</div>

アプリケーションに Auth0 のログインを統合するには、`Auth0Client` クラスのインスタンスを生成し、Auth0 のドメインとクライアントIDを設定するだけです。

export const codeExample = `// MainPage.xaml.cs

using Auth0.OidcClient;

var client = new Auth0Client(new Auth0ClientOptions
{
    Domain = "{yourDomain}",
    ClientId = "{yourClientId}"
});`;

<AuthCodeBlock children={codeExample} language="cs" />

その後、`LoginAsync` メソッドを呼び出してユーザーをログインさせます。

```cs lines
var loginResult = await client.LoginAsync();
```

<Frame>![](https://cdn2.auth0.com/docs/1.14550.0/media/articles/native-platforms/windows-uwp-csharp/universal-login.png)</Frame>

これにより、Auth0 のログイン ページが Web ビューに表示されます。ログイン ページのカスタマイズ方法については、[こちらのドキュメント](/docs/ja-JP/authenticate/login/auth0-universal-login#simple-customization)を参照してください。

<div id="handle-authentication-tokens">
  ## 認証トークンを扱う
</div>

返されたログイン結果では認証の成否が示され、成功している場合はユーザーのトークンおよびクレームが含まれます。

<div id="authentication-error">
  ### 認証エラー
</div>

結果の `IsError` プロパティを確認することで、ログインが失敗したかどうかを判断できます。`ErrorMessage` には、発生したエラーに関する詳細な情報が含まれています。

```cs lines
if (loginResult.IsError)
{
    Debug.WriteLine($"ログイン中にエラーが発生しました: {loginResult.Error}")
}
```

<div id="accessing-the-tokens">
  ### トークンへのアクセス
</div>

ログインが成功すると、ログイン結果には `IdentityToken` プロパティに IDトークンが、`AccessToken` プロパティにアクセストークンが含まれます。

```cs lines
if (!loginResult.IsError)
{
    Debug.WriteLine($"id_token: {loginResult.IdentityToken}");
    Debug.WriteLine($"access_token: {loginResult.AccessToken}");
}
```

<div id="obtaining-the-user-information">
  ### ユーザー情報の取得
</div>

ログインが成功すると、`User` プロパティにユーザー情報が格納されます。これは [ClaimsPrincipal](https://msdn.microsoft.com/en-us/library/system.security.claims.claimsprincipal\(v=vs.110\).aspx) 型です。

ユーザーに関する情報を取得するには、クレームを参照します。たとえば、`name` クレームと `email` クレームから、ユーザーの名前とメールアドレスを取得できます。

```cs lines
if (!loginResult.IsError)
{
    Debug.WriteLine($"name: {loginResult.User.FindFirst(c => c.Type == "name")?.Value}");
    Debug.WriteLine($"email: {loginResult.User.FindFirst(c => c.Type == "email")?.Value}");
}
```

<Info>
  返されるクレームは、リクエストしたスコープによって異なります。詳しくは @scopes を参照してください。
</Info>

`Claims` コレクションを反復処理することで、IDトークンに含まれるすべてのクレームの一覧を取得できます。

```cs lines
if (!loginResult.IsError)
{
    foreach (var claim in loginResult.User.Claims)
    {
        Debug.WriteLine($"{claim.Type} = {claim.Value}");
    }
}
```

<div id="logout">
  ## ログアウト
</div>

ユーザーをログアウトさせるには、`LogoutAsync` メソッドを呼び出してください。

```cs lines
await client.LogoutAsync();
```

<Info>
  ##### 次にできること

  <table>
    <tr>
      <td><a href="/docs/ja-JP/authenticate/identity-providers">他のアイデンティティ プロバイダーを設定する</a></td>
      <td><a href="/docs/ja-JP/secure/multi-factor-authentication">多要素認証を有効にする</a></td>
    </tr>

    <tr>
      <td><a href="/docs/ja-JP/secure/attack-protection">攻撃対策について学ぶ</a></td>
      <td><a href="/docs/ja-JP/customize/rules">Rules について学ぶ</a></td>
    </tr>
  </table>

  [GitHub で編集](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>

***
