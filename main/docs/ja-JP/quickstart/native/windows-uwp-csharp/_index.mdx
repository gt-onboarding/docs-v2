---
title: UWP アプリケーションにログイン機能を追加する
sidebarTitle: UWP

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";
import MainpageXaml from "/snippets/ja-JP/quickstart/native/windows-uwp-csharp/MainPage.xaml.cs.mdx";

export const sections = [
  { id: "system-requirements", title: "システム要件" },
  { id: "configure-auth0", title: "Auth0 を設定する" },
  { id: "install-dependencies", title: "依存関係のインストール" },
  { id: "trigger-authentication", title: "認証を開始する" },
  { id: "handle-authentication-tokens", title: "認証トークンの処理" },
  { id: "logout", title: "ログアウト" }
]

<Recipe isSingleColumn>
  <Content>
    このチュートリアルでは、Auth0を使用してUWP C#アプリケーションにユーザーログインを追加する方法を説明します。アカウントに合わせて設定された例でこのクイックスタートを進めるには、ログインすることをお勧めします。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      このチュートリアルとサンプルプロジェクトは、次の環境でテストされています。

      * Microsoft Visual Studio 2022
      * Windows 10 SDK (10.0.26100.0)
      * Auth0.OidcClient.UWP 4.0.0

      <Info>
        **認証は初めてですか？** Auth0 のしくみについては[Auth0 の動作](/docs/ja-JP/get-started/auth0-overview)、[ネイティブアプリケーションとの統合方法](/docs/ja-JP/get-started/architecture-scenarios/mobile-api)、および使用している[プロトコル](/docs/ja-JP/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce)を参照してください。
      </Info>

      ### アプリケーションキーを取得する

      Auth0 にサインアップすると、新しいアプリケーションが自動的に作成されます。または、自分で新しいアプリケーションを作成している場合もあります。
      Auth0 と通信するには、そのアプリケーションに関するいくつかの情報が必要です。これらの情報は Auth0 Dashboard の [Application Settings](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq/applications) セクションから取得できます。

      <Frame>
        <img src="https://cdn2.auth0.com/docs/1.14546.0/media/articles/dashboard/client_settings.png" />
      </Frame>

      <Info>
        Native アプリケーションまたはシングルページアプリケーションで Default App を使用する場合は、
        **Token Endpoint Authentication Method** を `None` に更新し、
        **Application Type** を `SPA` または `Native` のいずれかに設定してください。
      </Info>

      次の情報が必要です。

      * **Domain**
      * **Client ID**

      <Info>
        このページの上部からサンプルをダウンロードした場合、これらの情報はすでに入力されています。
      </Info>

      markdownlint-disable MD002 MD041

      ### コールバックURLを設定する

      コールバックURLは、ユーザーの認証が完了した後に Auth0 がアプリケーションへリダイレクトする URL です。
      アプリのコールバックURLは、Auth0 Dashboard の [Application Settings](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq/applications) にある **Allowed Callback URLs** フィールドに追加する必要があります。このフィールドが設定されていない場合、ユーザーはアプリケーションにログインできず、エラーが発生します。

      <Info>
        このページの上部からダウンロードしたサンプルプロジェクトに沿って進めている場合は、
        **Allowed Callback URLs** を
        `https://{yourDomain}/mobile`
        に設定する必要があります。
      </Info>

      markdownlint-disable MD002 MD041

      ### ログアウトURLを設定する

      ログアウトURLは、ユーザーが認可サーバーからログアウトされた後に Auth0 がアプリケーションへリダイレクトする先の URL です。これは `returnTo` クエリパラメーターで指定します。アプリのログアウトURLは、Auth0 Dashboard の [Application Settings](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq/applications) にある **Allowed Logout URLs** フィールドに追加する必要があります。このフィールドが設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーが発生します。

      <Info>
        このページの上部からダウンロードしたサンプルプロジェクトに沿って進めている場合、
        **Allowed Logout URLs** フィールドに追加する必要があるログアウトURLは
        `https://{yourDomain}/mobile`
        です。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      ### アプリケーションのキーを取得する

      Auth0 にサインアップすると、新しいアプリケーションが自動的に作成されるか、自分で新しく作成することができます。
      Auth0 と通信するには、そのアプリケーションに関するいくつかの情報が必要です。これらの情報は Auth0 Dashboard の
      [Application Settings](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq/applications) セクションから取得できます。

      <Info>
        Native または Single Page Application で Default App を使用する場合は、
        **Token Endpoint Authentication Method** を `None` に更新し、
        **Application Type** を `SPA` または `Native` のいずれかに設定してください。
      </Info>

      次の情報が必要です。

      * **Domain**
      * **Client ID**

      <Info>
        このページの上部からサンプルをダウンロードした場合、これらの情報はあらかじめ入力されています。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      NuGet Package Manager Console (Tools -&gt; NuGet Package Manager -&gt; Package Manager Console) を使用して、
      次のコマンドを実行して `Auth0.OidcClient.UWP` パッケージをインストールします。

      ```
      Install-Package Auth0.OidcClient.UWP
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      アプリケーションに Auth0 のログイン機能を統合するには、`Auth0Client`
      クラスのインスタンスを生成し、Auth0 のドメインとクライアントIDを設定します。

      ```cs lines
      // MainPage.xaml.cs

      using Auth0.OidcClient;

      var client = new Auth0Client(new Auth0ClientOptions
      {
          Domain = "{yourDomain}",
          ClientId = "{yourClientId}"
      });
      ```

      次に、`LoginAsync` メソッドを呼び出してユーザーをログインさせます。

      ```cs lines
      var loginResult = await client.LoginAsync();
      ```

      <Frame>
        <img src="https://cdn2.auth0.com/docs/1.14546.0/media/articles/native-platforms/windows-uwp-csharp/universal-login.png" />
      </Frame>

      これによって、Auth0 のログインページが WebView に読み込まれます。ログインページのカスタマイズ方法については、[このドキュメント](/docs/ja-JP/authenticate/login/auth0-universal-login#simple-customization)を参照してください。

      <MainpageXaml />
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      返されるログイン結果は、認証が成功したかどうかを示し、成功した場合にはトークンとユーザーに関するクレームを含みます。

      ### 認証エラー

      ログインが失敗したかどうかを確認するには、結果の `IsError` プロパティを参照します。
      `ErrorMessage` には、発生したエラーに関するより詳細な情報が含まれます。

      ```cs lines
      if (loginResult.IsError)
      {
          Debug.WriteLine($"ログイン中にエラーが発生しました: {loginResult.Error}")
      }
      ```

      ### トークンへのアクセス

      ログインが成功すると、ログイン結果には、`IdentityToken` プロパティに IDトークンが、`AccessToken` プロパティにアクセストークンがそれぞれ含まれます。

      ```cs lines
      if (!loginResult.IsError)
      {
          Debug.WriteLine($"id_token: {loginResult.IdentityToken}");
          Debug.WriteLine($"access_token: {loginResult.AccessToken}");
      }
      ```

      ### ユーザー情報の取得

      ログインが成功すると、ログイン結果の `User` プロパティにユーザー情報が含まれます。`User` は
      [ClaimsPrincipal](https://msdn.microsoft.com/en-us/library/system.security.claims.claimsprincipal\(v=vs.110\).aspx)
      です。

      ユーザーに関する情報を取得するには、claims（クレーム）を参照します。たとえば、`name` および `email` の各 claim からユーザーの名前とメールアドレスを取得できます。

      ```cs lines
      if (!loginResult.IsError)
      {
          Debug.WriteLine($"name: {loginResult.User.FindFirst(c => c.Type == "name")?.Value}");
          Debug.WriteLine($"email: {loginResult.User.FindFirst(c => c.Type == "email")?.Value}");
      }
      ```

      <Info>
        返されるクレームは、要求されたスコープによって異なります。詳しくは @scopes を参照してください。
      </Info>

      `Claims` コレクションを列挙することで、IDトークンに含まれるすべてのクレームの一覧を取得できます。

      ```cs lines
      if (!loginResult.IsError)
      {
          foreach (var claim in loginResult.User.Claims)
          {
              Debug.WriteLine($"{claim.Type} = {claim.Value}");
          }
      }
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      ユーザーをログアウトさせるには、`LogoutAsync` メソッドを呼び出してください。

      ```cs lines
      await client.LogoutAsync();
      ```

      <LoggedInForm />
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントとアプリケーションの設定と管理方法について学びます
    * [auth0-oidc-client-net ソフトウェア開発キット (SDK)](https://github.com/auth0/auth0-oidc-client-net) - このチュートリアルで使用しているソフトウェア開発キット (SDK) をより詳しく確認する
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張できるインテグレーションを探す
  </Content>
</Recipe>