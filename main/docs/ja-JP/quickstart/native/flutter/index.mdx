---
title: "Flutter"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/ja-JP/AuthCodeBlock.jsx";

<div id="by-steve-hobbs">
  ##### Steve Hobbs による
</div>

このチュートリアルでは、Auth0 Flutter ソフトウェア開発キット (SDK) を使用して、Android、iOS、または macOS 向けの Flutter アプリに Auth0 を利用したユーザーログイン機能を追加する方法を説明します。ご自身のアカウントに合わせて構成されたサンプルを使用してこのクイックスタートを進められるよう、事前にログインしておくことをおすすめします。

{/* <Card title="GitHub で表示" href="https://github.com/auth0-samples/auth0-flutter-samples/tree/main/sample" icon="github">
  システム要件: Flutter 3 以降 | Android API 21 以降 および Android Studio 4 以降 (Android 用) | iOS 13 以降 および Xcode 14 以降 (iOS 用) | macOS 11 以降 および Xcode 14 以降 (macOS 用)
  </Card> */}

<div id="add-login-to-your-flutter-app">
  # Flutter アプリにログイン機能を追加する
</div>

Auth0 を使用すると、アプリに認証機能をすばやく追加し、ユーザーのプロファイル情報にアクセスできます。このガイドでは、[Auth0 Flutter SDK](https://github.com/auth0/auth0-flutter) を使用して Auth0 を Flutter アプリに統合する方法を説明します。

<Info>
  Auth0 Flutter SDK は現在、Android、iOS、macOS 向けの Flutter アプリのみをサポートしています。
</Info>

<div id="getting-started">
  ## はじめに
</div>

このクイックスタートでは、すでに [Flutter](https://flutter.dev/) アプリが動作していることを前提としています。まだの場合は、[Flutter の「Getting started」ガイド](https://docs.flutter.dev/get-started/install)を参照し、シンプルなアプリを作成してください。

また、[Flutter コマンドラインツール](https://docs.flutter.dev/reference/flutter-cli) にも慣れておく必要があります。

最後に、**Native** Auth0 Application が必要です。まだ Native Auth0 Application がない場合は、続行する前に[作成](/docs/ja-JP/get-started/auth0-overview/create-applications/native-apps)してください。構成が異なりエラーの原因となる可能性があるため、他の Application タイプの使用は避けてください。

<div id="configure-the-callback-and-logout-urls">
  ### コールバックURLとログアウトURLを設定する
</div>

コールバックURLとログアウトURLは、Auth0 がアプリにリダイレクトする際に呼び出す URL です。Auth0 はユーザーを認証した後にコールバックURLを、セッション Cookie を削除した後にログアウトURLを呼び出します。

コールバックURLとログアウトURLが設定されていない場合、ユーザーはアプリにログインおよびログアウトできず、エラーが発生します。

Auth0 アプリケーションの [設定ページ](https://manage.auth0.com/#/applications/\{yourClientId}/settings) に移動し、アプリのプラットフォームに応じて、次の URL を **Allowed Callback URLs** と **Allowed Logout URLs** に追加します。[カスタムドメイン](/docs/ja-JP/customize/custom-domains) を使用している場合は、設定ページに表示されている Auth0 ドメインの代わりにそれを使用してください。

<Info>
  Android では、`SCHEME` プレースホルダーの値は `https` またはその他のカスタムスキームにすることができます。可能な限り、Auth0 は `https` を使用した [Android App Links](https://auth0.com/docs/applications/enable-android-app-links) を、アプリ内のコンテンツへ直接リンクする安全な方法として使用することを推奨します。カスタム URL スキームは [クライアントなりすまし攻撃](https://datatracker.ietf.org/doc/html/rfc8252#section-8.6) の影響を受ける可能性があります。

  iOS 17.4 以降および macOS 14.4 以降では、Universal Links（`https` スキーム）をコールバックURLおよびログアウトURLとして使用できます。有効にすると、SDK は古いバージョンの iOS / macOS ではカスタム URL スキーム（アプリの [bundle identifier](https://developer.apple.com/documentation/appstoreconnectapi/bundle_ids)）にフォールバックします。

  可能な限り、Auth0 は Universal Links を、iOS アプリ内のコンテンツへ直接リンクする安全な方法として使用することを推奨します。カスタム URL スキームは [クライアントなりすまし攻撃](https://datatracker.ietf.org/doc/html/rfc8252#section-8.6) の影響を受ける可能性があります。

  **この機能には Xcode 15.3 以上と有料の Apple Developer アカウントが必要です。**
</Info>

<div id="android">
  #### Android
</div>

```
SCHEME://{yourDomain}/android/YOUR_PACKAGE_NAME/callback
```

<div id="ios">
  #### iOS
</div>

```
https://{yourDomain}/ios/YOUR_BUNDLE_IDENTIFIER/callback,
YOUR_BUNDLE_IDENTIFIER://{yourDomain}/ios/YOUR_BUNDLE_IDENTIFIER/callback
```

<div id="macos">
  #### macOS
</div>

```
https://{yourDomain}/macos/YOUR_BUNDLE_IDENTIFIER/callback,
YOUR_BUNDLE_IDENTIFIER://{yourDomain}/macos/YOUR_BUNDLE_IDENTIFIER/callback
```

たとえば、iOS のバンドル識別子が `com.example.MyApp` で、Auth0 ドメインが `example.us.auth0.com` の場合、この値は次のとおりです。

```
https://example.us.auth0.com/ios/com.example.MyApp/callback,
com.example.MyApp://example.us.auth0.com/ios/com.example.MyApp/callback
```

<div id="install-the-auth0-flutter-sdk">
  ## Auth0 Flutter ソフトウェア開発キット (SDK) をインストールする
</div>

プロジェクトに Auth0 Flutter SDK を追加します。

```
flutter pub add auth0_flutter
```

<div id="configure-android">
  ## Android を構成する
</div>

Android プラットフォーム向けに開発していない場合は、この手順をスキップしてください。

このソフトウェア開発キット (SDK) では、manifest プレースホルダーが必要です。Auth0 は内部的にプレースホルダーを使用して `intent-filter` を定義し、認証コールバック URL を受け取ります。Auth0 テナントのドメインとコールバック URL のスキームを設定する必要があります。

`app/build.gradle` の `defaultConfig` セクション内に、`auth0Domain` と `auth0Scheme` の manifest プレースホルダーを含めるように変更します。

export const codeExample1 = `apply plugin: 'com.android.application'

android {
    defaultConfig {
        applicationId "com.auth0.samples"
        minSdkVersion 21
        targetSdkVersion flutter.targetSdkVersion
        // ...

        // ---> 次の行を追加します
        manifestPlaceholders += [auth0Domain: "{yourDomain}", auth0Scheme: "https"]
        // <---
    }
}`;

<AuthCodeBlock children={codeExample1} language="dart" />

* `auth0Domain`: Auth0 テナントのドメインです。通常は Auth0 Dashboard の **Application Settings** 内にある Domain フィールドで確認できます。カスタムドメインを使用している場合は、そのカスタムドメインの値を設定してください。
* `auth0Scheme`: 使用するスキームです。カスタムスキーム、または [Android App Links](https://auth0.com/docs/applications/enable-android-app-links) を使用したい場合は `https` を指定できます。この値の設定方法については、[Auth0.Android SDK README](https://github.com/auth0/Auth0.Android#a-note-about-app-deep-linking) を参照してください。

<Info>
  マニフェストのプレースホルダーに Auth0 の **Domain** と **Scheme** の値を定義しているため、アクティビティ用に特定の `intent-filter` を宣言する必要はありません。リダイレクト処理はライブラリ側で行われます。
</Info>

変更を反映するために、Android Studio 内で **Sync Project with Gradle Files** を実行します。

<div id="configure-iosmacos">
  ## iOS/macOS の設定
</div>

iOS または macOS プラットフォーム向けに開発していない場合は、この手順をスキップしてください。

<Warning>
  この手順の実行には有料の Apple Developer アカウントが必要です。Universal Links をコールバックおよびログアウト URL として使用するために必要になります。代わりにカスタム URL スキームを使用する場合は、この手順をスキップしてください。
</Warning>

<div id="configure-the-team-id-and-bundle-identifier">
  #### Team ID とバンドル識別子を設定する
</div>

Auth0 アプリケーションの[設定ページ](https://manage.auth0.com/#/applications/\{yourClientId}/settings)に移動し、ページの一番下までスクロールして **Advanced Settings &gt; Device Settings** を開きます。**iOS** セクションで、**Team ID** に自分の [Apple Team ID](https://developer.apple.com/help/account/manage-your-team/locate-your-team-id/) を、**App ID** にアプリのバンドル識別子を設定します。

<Frame>![Auth0 アプリケーション設定ページ内の iOS セクションのスクリーンショット](https://cdn2.auth0.com/docs/1.14550.0/media/articles/native-platforms/ios-swift/ios-device-settings.png)</Frame>

これにより、Auth0 テナントの `apple-app-site-association` ファイルにアプリが追加されます。

<div id="add-the-associated-domain-capability">
  #### 関連ドメイン機能を追加する
</div>

`open ios/Runner.xcworkspace`（または macOS の場合は `open macos/Runner.xcworkspace`）を実行して、Xcode でアプリを開きます。**Runner** ターゲットの設定画面で **Signing and Capabilities** の[タブ](https://developer.apple.com/documentation/xcode/adding-capabilities-to-your-app#Add-a-capability)を開き、**+ Capability** ボタンをクリックします。次に、**Associated Domains** を選択します。

<Frame>![Xcode 内の Capabilities ライブラリのスクリーンショット](https://cdn2.auth0.com/docs/1.14550.0/media/articles/native-platforms/ios-swift/ios-xcode-capabilities.png)</Frame>

続いて、**Associated Domains** の下に次の[エントリ](https://developer.apple.com/documentation/xcode/configuring-an-associated-domain#Define-a-service-and-its-associated-domain)を追加します。

export const codeExample2 = `webcredentials:{yourDomain}`;

<AuthCodeBlock children={codeExample2} language="dart" />

[カスタムドメイン](/docs/ja-JP/customize/custom-domains) を使用している場合は、設定ページにある Auth0 ドメインの代わりにそのカスタムドメインを使用してください。

<Info>
  関連付けられているドメインを機能させるには、**iOS シミュレーター向けにビルドする場合でも**、アプリはチーム証明書で署名されている必要があります。Auth0 アプリケーションの設定ページで Team ID が設定されている Apple Team を使用していることを確認してください。
</Info>

<div id="add-login-to-your-app">
  ## アプリにログイン機能を追加する
</div>

[Universal Login](https://auth0.com/docs/authenticate/login/auth0-universal-login) は、アプリに認証機能を実装する最も簡単な方法です。最良のユーザー体験とセキュリティ、そして最も充実した機能を得るために、Universal Login の利用を推奨します。

Flutter アプリに Auth0 Universal Login を組み込むには、ソフトウェア開発キット (SDK) をインポートし、Auth0 のドメインとクライアントIDの値を使って `Auth0` クラスをインスタンス化します。次の例では、ウィジェットの state オブジェクト内でクラスをインスタンス化しています。

export const codeExample3 = `import 'package:auth0_flutter/auth0_flutter.dart';

class MainView extends StatefulWidget {
  const MainView({Key? key}) : super(key: key);

  @override
  State<MainView> createState() => _MainViewState();
}

class _MainViewState extends State<MainView> {
  Credentials? _credentials;

  late Auth0 auth0;

  @override
  void initState() {
    super.initState();
    auth0 = Auth0('{yourDomain}', '{yourClientId}');
  }

  @override
  Widget build(BuildContext context) {
    // ...
  }
}`;

<AuthCodeBlock children={codeExample3} language="dart" />

次に、`webAuthentication().login()` を使用して Auth0 Universal Login ページにユーザーをリダイレクトします。これは `Future` を返すため、ユーザーのトークンを取得するには `await` する必要があります。押されたときにユーザーをログインさせる `ElevatedButton` ウィジェットの例を次に示します。アプリ内でローカルにユーザーがサインインしているかどうかを判定するために `_credentials` が使用されている点に注意してください。

```dart lines
if (_credentials == null) {
  ElevatedButton(
    onPressed: () async {
      // iOS 17.4+ / macOS 14.4+ では Universal Link コールバック URL を使用
      // useHTTPS は Android では無視される
      final credentials =
          await auth0.webAuthentication().login(useHTTPS: true);

      setState(() {
        _credentials = credentials;
      });
    },
    child: const Text("Log in")
  )
}
```

**Android**: カスタムスキームを使用している場合は、そのスキームを login メソッドに渡して、ソフトウェア開発キット (SDK) がログインページへの遷移と復帰を正しく処理できるようにします。

```dart lines
await auth0.webAuthentication(scheme: 'YOUR CUSTOM SCHEME').login();
```

ユーザーがログインすると、ユーザーはアプリにリダイレクトされます。その後、そのユーザーの ID トークンとアクセストークンにアクセスできるようになります。

<Note>
  ##### チェックポイント

  アプリに、`webAuthentication().login()` を呼び出してユーザーをアプリにログインさせるボタンを追加してください。認証のために Auth0 にリダイレクトされ、その後アプリに戻ってくることを確認します。

  `login` の呼び出し結果からトークンにアクセスできることを確認します。
</Note>

<div id="add-logout-to-your-app">
  ## アプリにログアウト機能を追加する
</div>

ユーザーをログアウトさせるには、Auth0 Flutter ソフトウェア開発キット (SDK) の `webAuthentication().logout()` を呼び出して Auth0 の logout エンドポイントにリダイレクトし、ログインセッションを消去します。詳しくは「[Auth0 からのログアウトについて](https://auth0.com/docs/authenticate/login/logout)」を参照してください。

以下は、アプリからユーザーをログアウトさせる `ElevatedButton` ウィジェットの例です。`_credentials` が `null` に設定されている点に注目してください。これは、ユーザーがアプリにサインインしていない状態であることを示します。

```dart lines
ElevatedButton(
  onPressed: () async {
    // iOS 17.4+ / macOS 14.4+ では Universal Link のログアウト URL を使用
    // Android では useHTTPS は無視されます
    await auth0.webAuthentication().logout(useHTTPS: true);

    setState(() {
      _credentials = null;
    });
  },
  child: const Text("ログアウト"))
```

**Android**: カスタムスキームを使用している場合は、このスキームを logout メソッドに渡し、ソフトウェア開発キット (SDK) が正しくアプリに戻れるようにします。

```dart lines
await auth0.webAuthentication(scheme: 'YOUR CUSTOM SCHEME').logout();
```

<Note>
  ##### チェックポイント

  アプリに `webAuthentication().logout()` を呼び出してユーザーをログアウトさせるボタンを追加します。そのボタンをタップしたときに、Flutter アプリがログアウトエンドポイントにリダイレクトされ、再び戻ってくることを確認してください。アプリにログインしたままになっていないことを確認します。
</Note>

<div id="show-user-profile-information">
  ## ユーザーのプロファイル情報を表示する
</div>

`webAuthentication().login()` を呼び出すと、ユーザープロファイルのプロパティが自動的に取得されます。ログインステップから返されるオブジェクトには、IDトークンをデコードすることで得られた、すべてのユーザープロファイルプロパティを含む `user` プロパティがあります。

画面にユーザープロファイルを表示する `View` コンポーネントの例を次に示します。

```dart lines
import 'package:auth0_flutter/auth0_flutter.dart';
import 'package:flutter/material.dart';

class ProfileView extends StatelessWidget {
  const ProfileView({Key? key, required this.user}) : super(key: key);

  final UserProfile user;

  @override
  Widget build(BuildContext context) {
    return Column(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        if (user.name != null) Text(user.name!),
        if (user.email != null) Text(user.email!)
      ],
    );
  }
}
```

<Note>
  ##### チェックポイント

  ログインして、結果の `user` プロパティを確認します。`email` や `name` など、現在のユーザーのプロファイル情報が含まれていることを確認してください。
</Note>

<Info>
  ##### 次にできること

  <table>
    <tr>
      <td><a href="/docs/ja-JP/authenticate/identity-providers">他のアイデンティティ プロバイダーを設定する</a></td>
      <td><a href="/docs/ja-JP/secure/multi-factor-authentication">多要素認証を有効にする</a></td>
    </tr>

    <tr>
      <td><a href="/docs/ja-JP/secure/attack-protection">攻撃保護について学ぶ</a></td>
      <td><a href="/docs/ja-JP/customize/rules">Rules について学ぶ</a></td>
    </tr>
  </table>

  [GitHub で編集](https://github.com/auth0/docs/edit/master/articles/quickstart/native/flutter/01-login.md)
</Info>

***
