---
title: MAUI アプリケーションにログインを追加する
sidebarTitle: MAUI

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";
import MainpageXaml from "/snippets/ja-JP/quickstart/native/maui/MainPage.xaml.cs.mdx";
import MainpageXaml2 from "/snippets/ja-JP/quickstart/native/maui/MainPage.xaml.cs2.mdx";
import MainpageXaml3 from "/snippets/ja-JP/quickstart/native/maui/MainPage.xaml.cs3.mdx";
import MainpageXaml4 from "/snippets/ja-JP/quickstart/native/maui/MainPage.xaml.cs4.mdx";

export const sections = [
      { id: "configure-auth0", title: "Auth0 を設定する" },
      { id: "install-the-auth0-sdk", title: "Auth0 ソフトウェア開発キット (SDK) をインストールする" },
      { id: "platform-specific-configuration", title: "プラットフォーム固有の設定を行う" },
      { id: "instantiate-the-auth0client", title: "Auth0Client をインスタンス化する" },
      { id: "add-login-to-your-application", title: "アプリケーションにログイン機能を追加する" },
      { id: "add-logout-to-your-application", title: "アプリケーションにログアウト機能を追加する" },
      { id: "show-user-profile-information", title: "ユーザープロファイル情報を表示する" }
]


<Recipe isSingleColumn>
  <Content>
    Auth0を使用すると、ほぼすべてのタイプのアプリケーションに認証を迅速に追加できます。このガイドでは、[MAUI](https://www.nuget.org/packages/Auth0.OidcClient.MAUI/)用Auth0ソフトウェア開発キット (SDK)を使用して、.NET MAUIアプリケーションにAuth0を統合し、認証を追加し、ユーザープロファイル情報を表示する方法を説明します。

    <Info>
      MAUI ソフトウェア開発キット (SDK) は、Android、iOS、macOS、Windows をサポートしています。プラットフォームごとの設定については、以下を参照してください。
    </Info>

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Auth0 のサービスを利用するには、Auth0 Dashboard でアプリケーションを設定しておく必要があります。Auth0 アプリケーションは、
      開発しているプロジェクトで認証をどのように動作させるかを構成する場所です。

      ### アプリケーションを設定する

      インタラクティブセレクターを使用して新しい Auth0 アプリケーションを作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。
      Auth0 内のすべてのアプリケーションには、アプリケーションのコードが SDK を通じて Auth0 API を呼び出す際に使用する、英数字から成る一意のクライアントID が割り当てられます。

      このクイックスタートで構成した内容はすべて、自動的に [Dashboard](https://manage.auth0.com/#/) 上の該当アプリケーションに反映されます。ここから、
      今後もアプリケーションを管理できます。

      より完全な構成例を確認したい場合は、代わりにサンプルアプリケーションを参照できます。

      ### コールバック URL を設定する

      コールバック URL は、ユーザーが認証を完了した後に Auth0 からリダイレクトさせたい、アプリケーション内の URL です。
      設定しない場合、ユーザーはログイン後にアプリケーションへ戻ることができません。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを `myapp://callback` に設定してください。
      </Info>

      ### ログアウト URL を設定する

      ログアウト URL は、ユーザーがログアウトした後に Auth0 からリダイレクトさせたい、アプリケーション内の URL です。
      設定しない場合、ユーザーはアプリケーションからログアウトできず、エラーが返されます。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、これを `myapp://callback` に設定してください。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      Auth0 は、MAUI アプリケーションでの Auth0 認証の実装を簡略化するための [MAUI](https://www.nuget.org/packages/Auth0.OidcClient.MAUI/) ソフトウェア開発キット (SDK) を提供しています。

      NuGet パッケージ マネージャー (Tools -&gt; Library Package Manager -&gt; Package Manager Console) を使用して、`Auth0.OidcClient.MAUI` パッケージをインストールします。

      あるいは、NuGet パッケージ マネージャー コンソール (`Install-Package`) や `dotnet` CLI (`dotnet add`) を使用することもできます。

      ```
      Install-Package Auth0.OidcClient.MAUI
      ```

      ```
      dotnet add package Auth0.OidcClient.MAUI
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      SDK を Android と Windows で使用するには、プラットフォーム固有の設定がいくつか必要です。

      ### Android

      `WebAuthenticatorCallbackActivity` を継承する新しい Activity を作成します。

      ```cs lines
      [Activity(NoHistory = true, LaunchMode = LaunchMode.SingleTop, Exported = true)]
      [IntentFilter(new[] { Intent.ActionView },
      Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
      DataScheme = CALLBACK_SCHEME)]
      public class WebAuthenticatorActivity : Microsoft.Maui.Authentication.WebAuthenticatorCallbackActivity
      {
      const string CALLBACK_SCHEME = "myapp";
      }
      ```

      上記の設定により、Auth0 がログイン後に Android アプリケーションへリダイレクトした際に、アプリケーションが `myapp://callback` URL を処理できるようになります。

      ### Windows

      Auth0 からのリダイレクトでアプリケーションに戻ったときに正しく再アクティブ化できるようにするには、次の 2 点を行う必要があります。

      * 対応するプロトコルを `Package.appxmanifest` に追加します。この例では
        `myapp` に設定していますが、任意の値に変更できます（その場合は、関連するすべての Auth0 URL も更新してください）。

      ```xml lines
      <Applications>
      <Application Id="App" Executable="$targetnametoken$.exe" EntryPoint="$targetentrypoint$">
      <Extensions>
      <uap:Extension Category="windows.protocol">
      <uap:Protocol Name="myapp"/>
      </uap:Extension>
      </Extensions>
      </Application>
      </Applications>
      ```

      * Windows 固有の `App.xaml.cs` ファイル内で `Activator.Default.CheckRedirectionActivation()` を呼び出します。

      ```cs lines
      public App()
      {
      if (Auth0.OidcClient.Platforms.Windows.Activator.Default.CheckRedirectionActivation())
      return;
      this.InitializeComponent();
      }
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      Auth0 をアプリケーションに統合するには、`Auth0Client` クラスのインスタンスを作成し、
      Auth0 ドメイン、クライアントID、および必要なスコープを含む `Auth0ClientOptions` のインスタンスを渡します。
      さらに、設定した URL を使用して Auth0 がアプリケーションにリダイレクトできるようにするために、
      `RedirectUri` と `PostLogoutRedirectUri` も設定する必要があります。

      ```cs lines
      using Auth0.OidcClient;
      var client = new Auth0Client(new Auth0ClientOptions {
      Domain = "{yourDomain}", // ドメイン
      ClientId = "{yourClientId}", // クライアントID
      RedirectUri = "myapp://callback", // リダイレクトURI
      PostLogoutRedirectUri = "myapp://callback", // ログアウト後のリダイレクトURI
      Scope = "openid profile email" // スコープ
      });
      ```

      デフォルトでは、ソフトウェア開発キット (SDK) は Android では Chrome Custom Tabs、iOS と macOS では ASWebAuthenticationSession を使用し、Windows ではシステムの既定のブラウザを使用します。

      <Note>
        ##### チェックポイント

        `Auth0Client` は正しくインスタンス化されているはずです。アプリケーションを実行して、次の点を確認してください。

        * `Auth0Client` が `MainPage` 内で正しくインスタンス化されていること。
        * アプリケーションが Auth0 に関連するエラーを発生していないこと。
      </Note>

      <MainpageXaml />
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      Auth0 アプリケーションと Auth0 ソフトウェア開発キット (SDK) の設定が完了したので、次にプロジェクトにログイン機能を実装する必要があります。
      そのために、SDK の `LoginAsync()` メソッドを使用して、ユーザーを Auth0 の Universal Login ページにリダイレクトするログインボタンを作成します。

      ```cs lines
      var loginResult = await client.LoginAsync();
      ```

      エラーが発生していなければ、`LoginAsync()` から返される `LoginResult` で `User`、`IdentityToken`、`AccessToken`、`RefreshToken` にアクセスできます。

      <Note>
        ##### チェックポイント

        ここまでで、ユーザー名とパスワードを使用してログインまたはサインアップできるようになっているはずです。

        ログインボタンをクリックして、次の点を確認してください。

        * アプリケーションが Auth0 Universal Login ページにリダイレクトされること。
        * ログインまたはサインアップできること。
        * Auth0 からアプリケーションにリダイレクトされること。
      </Note>

      <MainpageXaml2 />
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      あなたのプロジェクトにログインしたユーザーには、ログアウトする手段も必要です。ソフトウェア開発キット (SDK) の
      `LogoutAsync()` メソッドを使って、ログアウトボタンを作成します。ユーザーがログアウトすると、Auth0 のログアウトエンドポイントにリダイレクトされ、
      その後すぐに、このクイックスタートで先ほど設定したログアウト URL にリダイレクトされます。

      ```cs lines
      await client.LogoutAsync();
      ```

      <Note>
        ##### チェックポイント

        アプリケーションを実行しログアウトボタンをクリックして、次の点を確認します：

        * アプリケーションが、アプリケーション設定で許可されたログアウトURLの1つとして指定したアドレスにリダイレクトされること。
        * アプリケーションからログアウトされていること。
      </Note>

      <MainpageXaml3 />
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7" isSingleColumn>
      ユーザーがログインおよびログアウトできるようになったので、認証済みユーザーに関連付けられた[プロファイル情報](https://auth0.com/docs/users/concepts/overview-user-profile)
      を取得したいと思うようになるでしょう。たとえば、ログインしているユーザーの名前や
      プロファイル画像をプロジェクト内に表示したい場合があります。

      MAUI 向け Auth0 ソフトウェア開発キット (SDK) では、`LoginResult.User` プロパティからユーザー情報を取得できます。

      <MainpageXaml4 />
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントとアプリケーションの構成と管理方法について学ぶ
    * [auth0-oidc-client-net ソフトウェア開発キット (SDK)](https://github.com/auth0/auth0-oidc-client-net) - このチュートリアルで使用しているソフトウェア開発キット (SDK) についてさらに詳しく確認する
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張するインテグレーションを見つける
  </Content>
</Recipe>