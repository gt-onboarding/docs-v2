---
title: "React Native"
permalink: "00-login"
---

import {AuthCodeBlock} from "/snippets/ja-JP/AuthCodeBlock.jsx";

<div id="by-steve-hobbs">
  ##### Steve Hobbs による
</div>

このチュートリアルでは、Auth0 を使用して React Native アプリケーションにユーザーログイン機能を追加する方法を説明します。アカウント用に構成されたサンプルを利用できるよう、このクイックスタートを進める前にログインすることをおすすめします。

{/* <Card title="GitHub で表示" href="https://github.com/auth0-samples/auth0-react-native-sample/tree/master/00-Login-Hooks" icon="github">
  システム要件：React Native 0.62.2 | Node.js 10.16
  </Card> */}

このクイックスタートは React Native フレームワーク向けです。Auth0 を Expo アプリケーションに統合する場合は、[Expo Quickstart](https://auth0.com/docs/quickstart/native/react-native-expo/interactive) を参照してください。

<Info>
  **認証が初めてですか？** [Auth0 の仕組み](/docs/ja-JP/get-started/auth0-overview)、[ネイティブ アプリケーションとの統合方法](/docs/ja-JP/get-started/architecture-scenarios/mobile-api)、および Auth0 が使用する[プロトコル](/docs/ja-JP/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce)について学びましょう。
</Info>

<div id="configure-auth0">
  ## Auth0 の設定
</div>

<div id="get-your-application-keys">
  ### アプリケーションキーを取得する
</div>

Auth0 にサインアップしたときに、新しいアプリケーションが自動的に作成されているか、またはご自身で新しいアプリケーションを作成しているはずです。Auth0 と連携するには、そのアプリケーションに関するいくつかの設定値が必要です。これらの情報は Auth0 Dashboard の [Application Settings](https://manage.auth0.com/#/applications) セクションから取得できます。

<Frame>![App Dashboard](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

<Info>
  Native アプリケーションまたは Single Page Application で Default App を使用する場合は、**Token Endpoint Authentication Method** を `None` に変更し、**Application Type** を `SPA` または `Native` に設定してください。
</Info>

次の情報が必要です。

* **Domain**
* **Client ID**

<Info>
  このページ上部からサンプルをダウンロードした場合は、これらの情報はあらかじめ設定されています。
</Info>

<div id="install-dependencies">
  ## 依存関係をインストールする
</div>

このセクションでは React Native Auth0 モジュールをインストールします。

<Info>
  React Native の詳細については、[公式ドキュメント](https://facebook.github.io/react-native/)を参照してください。
</Info>

<div id="yarn">
  ### Yarn
</div>

```bash lines
yarn add react-native-auth0
```

<Info>
  詳しくは yarn の[公式ドキュメント](https://yarnpkg.com/en/docs) を参照してください。
</Info>

<div id="npm">
  ### npm
</div>

```bash lines
npm install react-native-auth0 --save
```

<div id="additional-ios-step-install-the-module-pod">
  ### 追加の iOS 手順: Pod モジュールのインストール
</div>

本ソフトウェア開発キット (SDK) では、iOS の最小デプロイターゲットとして 13.0 が必要です。プロジェクトの `ios/Podfile` で、プラットフォームターゲットが 13.0 に設定されていることを確認してください。

```bash lines
platform :ios '13.0'
```

CocoaPods は、React Native フレームワークがプロジェクトに自身を組み込むために使用する iOS 向けパッケージ管理ツールです。iOS ネイティブモジュールを iOS アプリで動作させるには、まずライブラリ用の Pod をインストールします。古いバージョンの React Native ソフトウェア開発キット (SDK) に慣れている場合は、以前の *ネイティブモジュールをリンクする* 手順に似ています。現在では、そのプロセスは次のように簡略化されています。

`ios` フォルダに移動し、`pod install` を実行します。

```bash lines
cd ios
pod install
```

まず、ユーザーがログインできるようにする必要があります。Auth0 ホスト型の[ログインページ](/docs/ja-JP/authenticate/login/auth0-universal-login)を使用することをお勧めします。

<Frame>![Universal Login](https://cdn2.auth0.com/docs/1.14550.0/media/articles/native-platforms/ios-swift/login-ios.png)</Frame>

<div id="integrate-auth0-in-your-application">
  ## アプリケーションへの Auth0 の統合
</div>

<div id="configure-android">
  ### Android を構成する
</div>

アプリの `build.gradle` ファイル（通常は `android/app/build.gradle`）を開き、次のマニフェストプレースホルダーを追加します。`auth0Domain` の値には、[上で設定した](#get-your-application-keys) Auth0 Application の設定値を指定してください。

export const codeExample1 = `android {
    defaultConfig {
        // 次の行を追加
        manifestPlaceholders = [auth0Domain: "{yourDomain}", auth0Scheme: "\${applicationId}.auth0"]
    }
    ...
}`;

<AuthCodeBlock children={codeExample1} language="gradle" />

<Info>
  実行時には、`applicationId` の値はアプリケーションのパッケージ名または ID（例: `com.example.app`）に自動的に更新されます。この値は `build.gradle` ファイルで変更できます。また、`AndroidManifest.xml` ファイルの先頭でも確認できます。
</Info>

<div id="configure-ios">
  ### iOS の設定
</div>

<div id="appdelegate-setup-choose-based-on-architecture">
  #### AppDelegate のセットアップ（アーキテクチャに応じて選択）
</div>

Swift（`ios/<YOUR PROJECT>/AppDelegat.swift`）を使用している場合は、`AppDelegate` クラス内に次のコードを追加します：

```js lines
func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey : Any] = [:]) -> Bool {
  return RCTLinkingManager.application(app, open: url, options: options)
}
```

(Objective-C++ - `ios/<YOUR PROJECT>/AppDelegate.mm`) を使用している場合は、次を追加してください：

```h lines
#import <React/RCTLinkingManager.h>

- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url
            options:(NSDictionary<UIApplicationOpenURLOptionsKey, id> *)options
{
  return [RCTLinkingManager application:app openURL:url options:options];
}
```

<Info>
  このファイルは、[旧アーキテクチャ](https://reactnative.dev/docs/next/new-architecture-app-intro#ios---use-objective-c-mm-extension)を使用するアプリケーションでは `ios/<YOUR PROJECT>/AppDelegate.m` になります。
</Info>

次に、アプリのバンドル ID を使用して URL スキームを追加します。

`ios` フォルダーで `Info.plist` を開き、`CFBundleIdentifier` の値を探します。

```xml lines
<key>CFBundleIdentifier</key>
<string>$(PRODUCT_BUNDLE_IDENTIFIER)</string>
```

この値の下に URL タイプのエントリを登録し、その際 `CFBundleURLSchemes` には `CFBundleIdentifier` の値を設定します。

```xml lines
<key>CFBundleURLTypes</key>
<array>
    <dict>
        <key>CFBundleTypeRole</key>
        <string>None</string>
        <key>CFBundleURLName</key>
        <string>auth0</string>
        <key>CFBundleURLSchemes</key>
        <array>
            <string>$(PRODUCT_BUNDLE_IDENTIFIER).auth0</string>
        </array>
    </dict>
</array>
```

<Info>
  アプリケーションが React Native CLI を使用して生成されている場合、`$(PRODUCT_BUNDLE_IDENTIFIER)` のデフォルト値は動的に `org.reactjs.native.example.$(PRODUCT_NAME:rfc1034identifier)` に対応します。サンプルアプリでは、この値は `com.auth0samples` になります。
</Info>

この値は後でコールバック URL を定義する際に使用するため、控えておいてください。必要に応じて、次の手順で Xcode を使って変更できます。

* アプリのルートディレクトリで `ios/<YOUR PROJECT>.xcodeproj` ファイルを開くか、ターミナルで `xed ios` を実行します。
* プロジェクトまたは目的のターゲットの Build Settings タブを開き、「Bundle Identifier」を含むセクションを探します。
* 「Bundle Identifier」の値を、目的のアプリケーションのバンドル識別子名に置き換えます。

詳細については、[React Native ドキュメント](https://facebook.github.io/react-native/docs/linking) を参照してください。

<div id="configure-callback-and-logout-urls">
  ### コールバックURLとログアウトURLを設定する
</div>

コールバックURLとログアウトURLは、Auth0 がアプリケーションへリダイレクトする際に使用するURLです。Auth0 はユーザーを認証した後にコールバックURLへ、セッション Cookie を削除した後にログアウトURLへリダイレクトします。

コールバックURLおよびログアウトURLが設定されていない場合、ユーザーはアプリケーションにログインおよびログアウトできず、エラーが発生します。

[Auth0 アプリケーション](https://manage.auth0.com/#/applications/\{yourClientId}/settings) の設定ページに移動し、アプリケーションのプラットフォームに応じて、対応するURLを **許可されたコールバックURL** および **許可されたログアウトURL** に追加します。[カスタムドメイン](/docs/ja-JP/customize/custom-domains) を使用している場合は、設定ページに表示される Auth0 ドメインではなく、カスタムドメインの値を使用してください。

<div id="ios">
  #### iOS
</div>

```
BUNDLE_IDENTIFIER.auth0://{yourDomain}/ios/BUNDLE_IDENTIFIER/callback
```

<div id="android">
  #### Android
</div>

```
PACKAGE_NAME.auth0://{yourDomain}/android/PACKAGE_NAME/callback
```

<Info>
  サンプルプロジェクトに沿って進めている場合は、次の値を設定してください。

  * iOS の場合 - `com.auth0samples.auth0://{yourDomain}/ios/com.auth0samples/callback`
  * Android の場合 - `com.auth0samples.auth0://{yourDomain}/android/com.auth0samples/callback`
</Info>

<div id="add-login-to-your-app">
  ## アプリにログイン機能を追加する
</div>

`react-native-auth0` パッケージから `useAuth0` フックと `Auth0Provider` コンポーネントをインポートします。

```js lines
import {useAuth0, Auth0Provider} from 'react-native-auth0';
```

次に、`Auth0Provider` コンポーネントでアプリケーションをラップし、Auth0 のドメインとクライアントIDの値を渡します。

export const codeExample2 = `const App = () => {
  return (
    <Auth0Provider domain={"{yourDomain}"} clientId={"{yourClientId}"}>
      {/* アプリケーション全体 */}
    </Auth0Provider>
  );
};`;

<AuthCodeBlock children={codeExample2} language="javascript" />

最後に、`useAuth0` フックの `authorize` メソッドを使用して、ホストされたログイン画面を表示します。以下は、ボタンクリックでログインする際の使用例です。

```javascript lines
const LoginButton = () => {
    const {authorize} = useAuth0();

    const onPress = async () => {
        try {
            await authorize();
        } catch (e) {
            console.log(e);
        }
    };

    return <Button onPress={onPress} title="ログイン" />
}
```

<Note>
  ### チェックポイント

  クリック時に `authorize` を呼び出すボタンコンポーネントを追加します。ログイン ページにリダイレクトされ、その後アプリケーションに戻ってくることを確認します。
</Note>

<div id="add-logout-to-your-app">
  ## アプリにログアウト機能を追加する
</div>

ユーザーをログアウトさせるには、`useAuth0` フックから `clearSession` メソッドをインポートして呼び出し、Auth0 のログアウトエンドポイントにリダイレクトします。このメソッドは、認可サーバー上のそのユーザーのセッションを削除します。

クリック時にアプリからユーザーをログアウトさせるボタンの使用例を次に示します。

```javascript lines
const LogoutButton = () => {
    const {clearSession} = useAuth0();

    const onPress = async () => {
        try {
            await clearSession();
        } catch (e) {
            console.log(e);
        }
    };

    return <Button onPress={onPress} title="ログアウト" />
}
```

<Note>
  ### チェックポイント

  クリックしたときに `clearSession` を呼び出すボタンを追加します。ボタンをクリックするとアプリケーションからログアウトされることを確認してください。
</Note>

<div id="show-user-profile-information">
  ## ユーザーのプロファイル情報を表示する
</div>

`useAuth0` フックは、認証されたユーザーに関する情報を含む `user` オブジェクトを提供します。これを使用して、認証されたユーザーのデコード済みのユーザープロファイル情報に [IDトークン](https://auth0.com/docs/secure/tokens/id-tokens) からアクセスできます。

ユーザーが認証されていない場合、このプロパティは `null` になります。

```javascript lines
const Profile = () => {
    const {user} = useAuth0();

    return (
        <>
            {user && <Text>{user.name} としてログイン済み</Text>}
            {!user && <Text>ログインしていません</Text>}
        </>
    )
}
```

<Info>
  ##### 次のステップ

  <table>
    <tr>
      <td><a href="/docs/ja-JP/authenticate/identity-providers">他のアイデンティティ プロバイダーを設定する</a></td>
      <td><a href="/docs/ja-JP/secure/multi-factor-authentication">多要素認証を有効にする</a></td>
    </tr>

    <tr>
      <td><a href="/docs/ja-JP/secure/attack-protection">攻撃保護機能について学ぶ</a></td>
      <td><a href="/docs/ja-JP/customize/rules">Rules について学ぶ</a></td>
    </tr>
  </table>

  [GitHub で編集](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>

***
