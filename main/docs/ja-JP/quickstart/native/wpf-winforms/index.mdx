---
title: "WPF / Winforms"
permalink: "01-login"
---

import {AuthCodeBlock} from "/snippets/ja-JP/AuthCodeBlock.jsx";

<div id="by-damien-guard">
  ##### Damien Guard 著
</div>

このチュートリアルでは、Auth0 を使用して WPF および Windows Forms C# アプリケーションにユーザー ログイン機能を追加する方法を説明します。ご利用のアカウント向けに構成されたサンプルを使ってこのクイックスタートを進められるよう、事前にログインしておくことをお勧めします。

{/* <Card title="GitHub で表示" href="https://github.com/auth0-samples/auth0-WinFormsWPF-oidc-samples/tree/master/Quickstart/00-Starter-Seed" icon="github">
  システム要件: Microsoft Visual Studio 2022 | .NET Framework 4.6.2 | .NET 6
  </Card> */}

<Info>
  **認証は初めてですか？** [Auth0 の仕組み](/docs/ja-JP/get-started/auth0-overview)、[ネイティブアプリケーションとの統合方法](/docs/ja-JP/get-started/architecture-scenarios/mobile-api)、そしてどの[プロトコル](/docs/ja-JP/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce)を使用するのかを学びましょう。
</Info>

<div id="configure-auth0">
  ## Auth0 を設定する
</div>

<div id="get-your-application-keys">
  ### アプリケーションキーを取得する
</div>

Auth0 にサインアップすると、新しいアプリケーションが自動的に作成されるか、自分で新しいアプリケーションを作成できます。Auth0 と連携するには、そのアプリケーションに関するいくつかの情報が必要です。これらの情報は Auth0 Dashboard の [Application Settings](https://manage.auth0.com/#/applications) セクションから取得できます。

<Frame>![App Dashboard](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

<Info>
  Default App をネイティブアプリケーションまたはシングルページアプリケーションで使用する場合は、**Token Endpoint Authentication Method** を `None` に設定し、**Application Type** を `SPA` または `Native` のいずれかに設定してください。
</Info>

次の情報が必要です。

* **Domain**
* **Client ID**

<Info>
  このページの上部からサンプルをダウンロードした場合は、これらの情報はすでに入力されています。
</Info>

<div id="configure-callback-urls">
  ### コールバックURLを設定する
</div>

コールバックURLは、ユーザーが認証を完了した後に Auth0 がユーザーをリダイレクトする、アプリケーション内の URL です。アプリケーションのコールバックURLは、[Application Settings](https://manage.auth0.com/#/applications) にある **Allowed Callback URLs** フィールドに追加する必要があります。このフィールドが設定されていない場合、ユーザーはアプリケーションにログインできず、エラーが発生します。

<Info>
  このページの先頭からダウンロードしたサンプルプロジェクトを使用している場合は、**Allowed Callback URLs** を `https://{yourDomain}/mobile` に設定してください。
</Info>

<div id="configure-logout-urls">
  ### ログアウトURLを設定する
</div>

ログアウトURLは、ユーザーが認可サーバーからログアウトされた後に、Auth0 がリダイレクト先として利用できるアプリケーション内の URL です。これは `returnTo` クエリパラメーターで指定します。アプリケーションのログアウトURLは、[Application Settings](https://manage.auth0.com/#/applications) の **Allowed Logout URLs** フィールドに追加する必要があります。このフィールドが設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーが発生します。

<Info>
  このページの先頭からダウンロードしたサンプルプロジェクトを使用している場合、**Allowed Logout URLs** フィールドに追加する必要があるログアウトURLは `https://{yourDomain}/mobile` です。
</Info>

<div id="integrate-auth0-in-your-application">
  ## Auth0 をアプリケーションに組み込む
</div>

<div id="install-dependencies">
  ### 依存関係のインストール
</div>

`Auth0.OidcClient.WPF` または `Auth0.OidcClient.WinForms` NuGet パッケージを使うと、任意の [Auth0 がサポートするアイデンティティ プロバイダー](/docs/ja-JP/authenticate/identity-providers) を利用してユーザーを認証できます。

NuGet Package Manager（Tools -&gt; Library Package Manager -&gt; Package Manager Console）を使用して、WPF アプリケーションか Windows Forms アプリケーションのどちらを構築しているかに応じて、`Auth0.OidcClient.WPF` または `Auth0.OidcClient.WinForms` パッケージをインストールします。

<div id="trigger-authentication">
  ## 認証を開始する
</div>

アプリケーションに Auth0 のログインを統合するには、`Auth0Client` クラスのインスタンスを生成し、コンストラクターに Auth0 ドメインとクライアントID を渡すだけです。

export const codeExample = `// Form1.cs

using Auth0.OidcClient;

Auth0ClientOptions clientOptions = new Auth0ClientOptions
{
    Domain = "{yourDomain}",
    ClientId = "{yourClientId}"
};
client = new Auth0Client(clientOptions);
clientOptions.PostLogoutRedirectUri = clientOptions.RedirectUri;`;

<AuthCodeBlock children={codeExample} language="cs" />

その後、`LoginAsync` メソッドを呼び出してユーザーをログインさせます。

```cs lines
var loginResult = await client.LoginAsync();
```

<Frame>![](https://cdn2.auth0.com/docs/1.14550.0/media/articles/native-platforms/wpf-winforms/universal-login.png)</Frame>

これにより、Auth0 のログインページが Web ビュー内に読み込まれます。ログインページのカスタマイズ方法については、[こちらのドキュメント](/docs/ja-JP/authenticate/login/auth0-universal-login#simple-customization)を参照してください。

<div id="handle-authentication-tokens">
  ## 認証トークンを処理する
</div>

返されるログイン結果から認証の成否がわかり、成功している場合はトークンとユーザーのクレームが含まれます。

<div id="authentication-error">
  ### 認証エラー
</div>

結果の `IsError` プロパティを確認することで、ログインが失敗したかどうかを判別できます。`ErrorMessage` には、発生したエラーに関する詳細情報が含まれています。

```cs lines
var loginResult = await client.LoginAsync();

if (loginResult.IsError)
{
    Debug.WriteLine($"ログイン中にエラーが発生しました: {loginResult.Error}");
}
```

<div id="accessing-the-tokens">
  ### トークンの取得
</div>

ログインが成功すると、ログイン結果には、`IdentityToken` プロパティに IDトークンが、`AccessToken` プロパティにアクセストークンがそれぞれ含まれます。

```cs lines
var loginResult = await client.LoginAsync();

if (!loginResult.IsError)
{
    Debug.WriteLine($"id_token: {loginResult.IdentityToken}");
    Debug.WriteLine($"access_token: {loginResult.AccessToken}");
}
```

<div id="obtaining-the-user-information">
  ### ユーザー情報の取得
</div>

ログインが成功すると、ログイン結果の `User` プロパティにユーザー情報が格納されます。このプロパティは [ClaimsPrincipal](https://msdn.microsoft.com/en-us/library/system.security.claims.claimsprincipal\(v=vs.110\).aspx) です。

ユーザーに関する情報を取得するには、クレームを照会します。たとえば、`name` クレームと `email` クレームからユーザーの名前とメールアドレスを取得できます。

```cs lines
if (!loginResult.IsError)
{
    Debug.WriteLine($"name: {loginResult.User.FindFirst(c => c.Type == "name")?.Value}");
    Debug.WriteLine($"email: {loginResult.User.FindFirst(c => c.Type == "email")?.Value}");
}
```

<Info>
  返されるクレームは、要求したスコープによって異なります。詳しくは @scopes を参照してください。
</Info>

`Claims` コレクションを反復処理することで、IDトークンに含まれるすべてのクレームの一覧を取得できます。

```cs lines
if (!loginResult.IsError)
{
    foreach (var claim in loginResult.User.Claims)
    {
        Debug.WriteLine($"{claim.Type} = {claim.Value}");
    }
}
```

<div id="logout">
  ## ログアウト
</div>

ユーザーをログアウトさせるには、`LogoutAsync` メソッドを呼び出します。

```cs lines
await client.LogoutAsync();
```

<Info>
  ##### 次のステップ

  <table>
    <tr>
      <td><a href="/docs/ja-JP/authenticate/identity-providers">その他のアイデンティティ プロバイダーを設定する</a></td>
      <td><a href="/docs/ja-JP/secure/multi-factor-authentication">多要素認証を有効にする</a></td>
    </tr>

    <tr>
      <td><a href="/docs/ja-JP/secure/attack-protection">攻撃保護について知る</a></td>
      <td><a href="/docs/ja-JP/customize/rules">Rules について知る</a></td>
    </tr>
  </table>

  [GitHub で編集](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>

***
