---
title: .NET Android および iOS アプリケーションにログイン機能を追加する
sidebarTitle: .NET Android および iOS

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";
import Mainactivity from "/snippets/ja-JP/quickstart/native/net-android-ios/MainActivity.cs.mdx";
import Appdelegate from "/snippets/ja-JP/quickstart/native/net-android-ios/AppDelegate.cs.mdx";
import Myviewcontroller from "/snippets/ja-JP/quickstart/native/net-android-ios/MyViewController.cs.mdx";

import {AuthCodeGroup} from "/snippets/ja-JP/AuthCodeGroup.jsx";

export const sections = [
      { id: "configure-auth0", title: "Auth0 を設定する" },
      { id: "install-the-auth0-sdk", title: "Auth0 ソフトウェア開発キット (SDK) をインストールする" },
      { id: "instantiate-the-auth0client", title: "Auth0Client をインスタンス化する" },
      { id: "configure-android", title: "Android を設定する" },
      { id: "configure-ios", title: "iOS を設定する" },
      { id: "add-login-to-your-application", title: "アプリケーションにログインを追加する" },
      { id: "add-logout-to-your-application", title: "アプリケーションにログアウトを追加する" },
      { id: "show-user-profile-information", title: "ユーープロファイル情報を表示する" }
]


<Recipe isSingleColumn>
  <Content>
    Auth0を使用すると、ほぼすべてのタイプのアプリケーションに認証を迅速に追加できます。このガイドでは、[Android](https://www.nuget.org/packages/Auth0.OidcClient.AndroidX/)および[iOS](https://www.nuget.org/packages/Auth0.OidcClient.iOS)用のAuth0ソフトウェア開発キット (SDK)を使用して、.NET AndroidおよびiOSアプリケーションにAuth0を統合し、認証を追加して、ユーザープロファイル情報を表示する方法を説明します。

    <Info>
      このクイックスタートでは、次世代の `Xamarin.Android` および `Xamarin.iOS` である .NET Android および .NET iOS を対象としています。まだ
      `Xamarin.Android` および `Xamarin.iOS` を使用している場合でも、
      統合方法は同一であり、SDK も互換性があるため、このガイドに従うことができます。
    </Info>

    このクイックスタートを使用するには、次のものが必要です:

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      Auth0 のサービスを利用するには、Auth0 Dashboard でアプリケーションを設定しておく必要があります。Auth0 アプリケーションは、
      プロジェクトで認証をどのように動作させるかを設定する場所です。

      ### アプリケーションを設定する

      インタラクティブ セレクターを使って新しい「ネイティブアプリケーション」を作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。
      Auth0 内の各アプリケーションには、アプリケーションのコードが SDK を通して Auth0 API を呼び出す際に使用する、英数字で一意なクライアント ID が割り当てられます。

      このクイックスタートを使って設定した内容はすべて、[Dashboard](https://manage.auth0.com/#/) 上のアプリケーションに自動的に反映されます。ここで、
      今後もアプリケーションを管理できます。

      より完全な設定内容を確認したい場合は、代わりにサンプルアプリケーションを参照できます。

      ### コールバック URL を設定する

      コールバック URL は、ユーザーが認証された後に Auth0 からユーザーをリダイレクトしたい、アプリケーションの URL です。
      設定しない場合、ユーザーはログイン後にアプリケーションへ戻されません。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、プラットフォームに応じて次のいずれかの URL を設定してください。

        * **Android**: `YOUR_PACKAGE_NAME://{yourDomain}/android/YOUR_PACKAGE_NAME/callback`
        * **iOS**: `YOUR_BUNDLE_ID://{yourDomain}/ios/YOUR_BUNDLE_ID/callback`

        **Android**: `YOUR_PACKAGE_NAME://{yourDomain}/android/YOUR_PACKAGE_NAME/callback`

        **iOS**: `YOUR_BUNDLE_ID://{yourDomain}/ios/YOUR_BUNDLE_ID/callback`
      </Info>

      ### ログアウト URL を設定する

      ログアウト URL は、ユーザーがログアウトした後に Auth0 からユーザーをリダイレクトしたい、アプリケーションの URL です。
      設定しない場合、ユーザーはアプリケーションからログアウトできず、エラーが返されます。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、プラットフォームに応じて次のいずれかの URL を設定してください。

        * **Android**: `YOUR_PACKAGE_NAME://{yourDomain}/android/YOUR_PACKAGE_NAME/callback`
        * **iOS**: `YOUR_BUNDLE_ID://{yourDomain}/ios/YOUR_BUNDLE_ID/callback`

        **Android**: `YOUR_PACKAGE_NAME://{yourDomain}/android/YOUR_PACKAGE_NAME/callback`

        **iOS**: `YOUR_BUNDLE_ID://{yourDomain}/ios/YOUR_BUNDLE_ID/callback`
      </Info>

      最後に、[Application Settings](https://manage.auth0.com/#/applications/) で、アプリケーションの **Application Type** が **Native** に設定されていることを確認してください。

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      Auth0 は、.NET 向けの Android および iOS アプリケーションに Auth0 認証を実装するプロセスを簡素化するための、[Android](https://www.nuget.org/packages/Auth0.OidcClient.AndroidX/) および [iOS](https://www.nuget.org/packages/Auth0.OidcClient.iOS) 向けソフトウェア開発キット (SDK) を提供しています。

      NuGet Package Manager (Tools -&gt; Library Package Manager -&gt; Package Manager Console) を使用して、
      Android アプリケーションか iOS アプリケーションかに応じて
      `Auth0.OidcClient.AndroidX` または `Auth0.OidcClient.iOS` パッケージをインストールします。

      または、NuGet Package Manager Console (`Install-Package`) や
      `dotnet` CLI (`dotnet add`) を使用することもできます。

      ```
      Install-Package Auth0.OidcClient.AndroidX
      Install-Package Auth0.OidcClient.iOS
      ```

      ```
      dotnet add Auth0.OidcClient.AndroidX
      dotnet add Auth0.OidcClient.iOS
      ```

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      Auth0 をアプリケーションに統合するには、`Auth0Client` クラスのインスタンスを生成し、Auth0 ドメインとクライアントIDを含む `Auth0ClientOptions` のインスタンスを渡します。

      ```csharp
      using Auth0.OidcClient;
      var client = new Auth0Client(new Auth0ClientOptions {
      Domain = "{yourDomain}",
      ClientId = "{yourClientId}"
      }, this);
      ```

      デフォルトでは、このソフトウェア開発キット (SDK) は Android では Chrome Custom Tabs を、iOS では ASWebAuthenticationSession を使用します。

      <Note>
        ##### チェックポイント

        `Auth0Client` が正しくインスタンス化されているはずです。アプリケーションを実行して、次の点を確認してください。

        * `Auth0Client` が `Activity`(Android) または
          `UIViewController`(iOS) で正しくインスタンス化されていること。
        * Auth0 に関連するエラーがアプリケーションでスローされていないこと。
      </Note>

      <LoggedInForm />
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      ユーザーが認証に成功すると、このクイックスタートで前に設定したコールバック URL にリダイレクトされます。

      Android デバイスでコールバックを処理するには、このコールバック URL を処理するインテントを登録する必要があります。これを簡単に行う方法は、認証フローを開始するために `LoginAsync` メソッドを呼び出したのと同じアクティビティに、そのインテントを登録することです。

      コードサンプル内の `YOUR_ANDROID_PACKAGE_NAME` を、`com.mycompany.myapplication` のような実際のアプリケーションのパッケージ名に必ず置き換え、`DataScheme`、`DataHost`、`DataPathPrefix` のテキストはすべて小文字にしてください。また、Activity に対して `LaunchMode = LaunchMode.SingleTask` を設定してください。そうしないと、コールバック URL が呼び出されるたびに、システムがアクティビティの新しいインスタンスを作成してしまいます。

      さらに、`Activity` クラスの `OnNewIntent` イベントでインテントを処理する必要があります。呼び出された URL を引数として渡して、`ActivityMediator` シングルトンの `Send` メソッドを呼び出すことで、Auth0 OpenID Connect (OIDC) クライアントに対し、認証フローを完了するよう通知する必要があります。

      ```charp
      protected override void OnNewIntent(Intent intent)
      {

            base.OnNewIntent(intent);

            ActivityMediator.Instance.Send(intent.DataString);

      }
      ```

      <AuthCodeGroup>
        <Mainactivity />

        <Appdelegate />

        <Myviewcontroller />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      ユーザーが正常に認証されると、このクイックスタートの前の手順で設定したコールバック URL にリダイレクトされます。

      iOS デバイスでコールバックを処理するには：

      1. Visual Studio でアプリケーションの `Info.plist` ファイルを開き、**Advanced** タブに移動します。
      2. **URL Types** セクションで、**Add URL Type** ボタンをクリックします。
      3. **Identifier** を Auth0、**URL Schemes** をアプリケーションの `Bundle Identifier` と同じ値、**Role** を `None` に設定します。

      URL Type を追加した後の `info.plist` ファイルの XML 表現の例は次のとおりです。

      ```xml
      <key>CFBundleURLTypes</key>
      <array>
      <dict>
      <key>CFBundleTypeRole</key>
      <string>None</string>
      <key>CFBundleURLName</key>
      <string>Auth0</string>
      <key>CFBundleURLSchemes</key>
      <array>
      <string>YOUR_BUNDLE_IDENTIFIER</string>
      </array>
      </dict>
      </array>
      ```

      さらに、`AppDelegate` クラスの `OpenUrl` イベントでコールバック URL を処理する必要があります。受信した URL を渡して `ActivityMediator` シングルトンの `Send` メソッドを呼び出すことで、Auth0 OIDC クライアントに認証フローを完了するよう通知する必要があります。

      <AuthCodeGroup>
        <Appdelegate />

        <Mainactivity />

        <Myviewcontroller />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      Auth0 アプリケーションと Auth0 ソフトウェア開発キット (SDK) の設定が完了したら、プロジェクトでログイン機能を設定する必要があります。
      これを行うには、SDK の `LoginAsync()` メソッドを使用して、ユーザーを Auth0 の Universal Login ページにリダイレクトするログインボタンを作成します。

      ```csharp
      var loginResult = await client.LoginAsync();
      ```

      エラーが発生していなければ、`LoginAsync()` から返される `LoginResult` の `User`、`IdentityToken`、`AccessToken`、`RefreshToken` にアクセスできます。

      <Note>
        ##### チェックポイント

        ここまでで、ユーザー名とパスワードを使ってログインまたはサインアップできるようになっているはずです。

        ログインボタンをクリックして、次の点を確認してください。

        * Android または iOS アプリケーションが Auth0 Universal Login ページにリダイレクトされる。
        * ログインまたはサインアップができる。
        * Auth0 によってアプリケーションにリダイレクトされる。
      </Note>

      <LoggedInForm />
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7" isSingleColumn>
      プロジェクトにログインするユーザーには、ログアウトする方法も必要です。ソフトウェア開発キット (SDK) の
      `LogoutAsync()` メソッドを使ってログアウトボタンを作成します。ユーザーがログアウトすると、Auth0 のログアウトエンドポイントにリダイレクトされ、
      その後すぐに、このクイックスタートの前の手順で設定したログアウト URL にリダイレクトされます。

      ```csharp
      await client.LogoutAsync();
      ```

      <Note>
        ##### チェックポイント

        アプリケーションを起動し、ログアウトボタンをクリック（タップ）します。次の点を確認してください。

        * Android または iOS アプリケーションが、Application Settings で Allowed
          Logout URLs の 1 つとして指定したアドレスにリダイレクトされること。
        * アプリケーションからログアウトされていること。
      </Note>

      <LoggedInForm />
    </Section>

    <Section id={sections[7].id} title={sections[7].title} stepNumber="8" isSingleColumn>
      ユーザーがログインおよびログアウトできるようになったので、認証済みユーザーに関連付けられたプロファイル情報を取得したいと考えるでしょう。
      たとえば、プロジェクト内にログイン中のユーザーの名前やプロファイル画像を表示したい場合があります。

      Android および iOS 向け Auth0 ソフトウェア開発キット (SDK) は、`LoginResult.User` プロパティ経由でユーザー情報を提供します。

      ```csharp
      if loginResult.IsError == false {
            var user = loginResult.User
            var name = user.FindFirst(c => c.Type == "name")?.Value
            var email = user.FindFirst(c => c.Type == "email")?.Value
            var picture = user.FindFirst(c => c.Type == "picture")?.Value
      }
      ```

      <LoggedInForm />
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントおよびアプリケーションの構成と管理方法について学びます
    * [auth0-oidc-client-net SDK](https://github.com/auth0/auth0-oidc-client-net) - このチュートリアルで使用しているソフトウェア開発キット (SDK) をさらに詳しく見てみましょう
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張するために有効化できる連携機能を見つける
  </Content>
</Recipe>