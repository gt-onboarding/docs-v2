---
title: "Expo"
permalink: "00-login"
---

import {AuthCodeBlock} from "/snippets/ja-JP/AuthCodeBlock.jsx";

<div id="by-poovamraj-thanganadar-thiagarajan">
  ##### Poovamraj Thanganadar Thiagarajan による
</div>

このチュートリアルでは、Auth0 を使用して Expo アプリケーションにユーザーのログイン機能を追加する方法を説明します。ご自身のアカウント向けに構成されたサンプルを使ってこのクイックスタートを進められるよう、あらかじめログインしておくことをお勧めします。

{/* <Card title="GitHub で表示" href="https://github.com/auth0-samples/auth0-react-native-sample/tree/master/00-Login-Expo" icon="github">
  システム要件: React Native 0.62.2 | Node.js 10.16 | Expo SDK 41
  </Card> */}

このクイックスタートは Expo フレームワーク向けです。React Native アプリケーションに Auth0 を統合するには、[React Native クイックスタート](https://auth0.com/docs/quickstart/native/react-native/interactive) を参照してください。

<Warning>
  このソフトウェア開発キット (SDK) は &quot;Expo Go&quot; アプリと互換性がありません。Custom Dev Client と EAS ビルドにのみ対応しています。
</Warning>

<Info>
  **認証は初めてですか？** [Auth0 の仕組み](/docs/ja-JP/get-started/auth0-overview)、[ネイティブアプリケーションとの統合方法](/docs/ja-JP/get-started/architecture-scenarios/mobile-api)、およびどの[プロトコル](/docs/ja-JP/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce)を使用しているかについて学びましょう。
</Info>

<div id="configure-auth0">
  ## Auth0 を設定する
</div>

<div id="get-your-application-keys">
  ### アプリケーションキーを取得する
</div>

Auth0 にサインアップすると、新しいアプリケーションが自動的に作成されます（または、ご自身で新しいアプリケーションを作成している場合もあります）。Auth0 と通信するには、そのアプリケーションに関するいくつかの設定値が必要です。これらの値は Auth0 Dashboard の［Application Settings］(https://manage.auth0.com/#/applications) セクションから取得できます。

<Frame>![アプリケーションダッシュボード](https://cdn2.auth0.com/docs/1.14550.0/media/articles/dashboard/client_settings.png)</Frame>

<Info>
  デフォルトアプリをネイティブアプリケーションまたはシングルページアプリケーションで使用する場合は、**Token Endpoint Authentication Method** を `None` に変更し、**Application Type** を `SPA` または `Native` のいずれかに設定してください。
</Info>

次の情報が必要です。

* **Domain**
* **Client ID**

<Info>
  このページの上部からサンプルをダウンロードした場合、これらの値はすでに入力されています。
</Info>

<div id="install-dependencies">
  ## 依存関係をインストール
</div>

React Native Auth0 モジュールをインストールする方法です。

<Info>
  Expo の詳細については、[公式ドキュメント](https://docs.expo.dev/) を参照してください。
</Info>

<div id="yarn">
  ### Yarn
</div>

```bash lines
yarn add react-native-auth0
```

<Info>
  Yarn についての詳しい情報は、[公式ドキュメント](https://yarnpkg.com/en/docs) を参照してください。
</Info>

<div id="npm">
  ### npm
</div>

```bash lines
npm install react-native-auth0 --save
```

アプリケーションに認証機能を追加する際の最初のステップは、ユーザーがログインできるようにすることです。Auth0 でこれを実現する最も高速かつ安全で、かつ機能が最も充実した方法は、Auth0 がホストする[ログインページ](/docs/ja-JP/authenticate/login/auth0-universal-login)を使用することです。

<Frame>![Universal Login](https://cdn2.auth0.com/docs/1.14550.0/media/articles/native-platforms/ios-swift/login-ios.png)</Frame>

<div id="integrate-auth0-in-your-application">
  ## Auth0 をアプリケーションに統合する
</div>

<div id="setup-auth0-config-plugin">
  ### Auth0 Config Plugin をセットアップする
</div>

Auth0 パッケージでは、ビルド時に設定が必要なカスタムネイティブコードが実行されます。この設定には [Expo Config Plugin](https://docs.expo.dev/guides/config-plugins/) を使用します。

`react-native-auth0` プラグインを、`app.json` または `app.config.js` にある [Expo config](https://docs.expo.dev/workflow/configuration/) ファイルに追加します。

export const codeExample1 = `{ 
  "expo": {
    ...
    "plugins": [
      [
        "react-native-auth0",
        {
          "domain": "{yourDomain}"
        }
      ]
    ]
  }
}`;

<AuthCodeBlock children={codeExample1} language="json" />

<div id="generate-native-source-code">
  ### ネイティブソースコードを生成する
</div>

上記の設定を有効にするには、ネイティブコードを生成する必要があります。これを行うには、次のコマンドを実行します。

```bash lines
expo prebuild
```

Expo の設定にまだ含まれていない場合は、[Android package](https://github.com/expo/fyi/blob/main/android-package.md) と [iOS bundle identifier](https://github.com/expo/fyi/blob/main/bundle-identifier.md) を指定するよう求められます。

```
? What would you like your Android package name to be? > com.auth0samples # または希望するパッケージ名

? What would you like your iOS bundle identifier to be? > com.auth0samples # または希望するバンドル識別子
```

これらの値は、Expo の設定ファイルである `app.json` または `app.config.js` に記述されています。これらはコールバック URL とログアウト URL で使用されます。

```json lines
{
    ...
    "android": {
      "package": "YOUR_ANDROID_PACKAGE_NAME_IS_FOUND_HERE"
    },
    "ios": {
      "bundleIdentifier": "YOUR_IOS_BUNDLE_IDENTIFIER_IS_FOUND_HERE"
    }
  }
}
```

<div id="configure-callback-and-logout-urls">
  ### コールバックURLとログアウトURLを設定する
</div>

コールバックURLとログアウトURLは、Auth0 がアプリケーションにリダイレクトする際に使用する URL です。Auth0 は、ユーザーを認証した後にコールバックURLへ、セッション Cookie を削除した後にログアウトURLへリダイレクトします。

これらの URL が設定されていない場合、ユーザーはアプリケーションにログインおよびログアウトできず、エラーが発生します。

[Auth0 アプリケーション](https://manage.auth0.com/#/applications/\{yourClientId}/settings)の設定ページにアクセスし、アプリケーションのプラットフォームに応じて、該当する URL を **許可されたコールバックURL** と **許可されたログアウトURL** に追加します。[Custom Domain](/docs/ja-JP/customize/custom-domains) を使用している場合は、設定ページに表示されている Auth0 ドメインではなく、Custom Domain で設定したドメインの値を使用してください。

<div id="ios">
  #### iOS
</div>

```
BUNDLE_IDENTIFIER.auth0://{yourDomain}/ios/BUNDLE_IDENTIFIER/callback
```

<div id="android">
  #### Android
</div>

```
PACKAGE_NAME.auth0://{yourDomain}/android/PACKAGE_NAME/callback
```

<Info>
  サンプルプロジェクトに従っている場合は、次のように設定してください。

  * iOS の場合 - `com.auth0samples.auth0://{yourDomain}/ios/com.auth0samples/callback`
  * Android の場合 - `com.auth0samples.auth0://{yourDomain}/android/com.auth0samples/callback`
</Info>

<div id="add-login-to-your-app">
  ## アプリにログイン機能を追加する
</div>

まず、`react-native-auth0` パッケージから `useAuth0` フックと `Auth0Provider` コンポーネントをインポートします。

```js lines
import {useAuth0, Auth0Provider} from 'react-native-auth0';
```

次に、`Auth0Provider` コンポーネントでアプリケーションをラップし、Auth0 ドメインとクライアントIDの値を指定します。

export const codeExample2 = `const App = () => {
  return (
    <Auth0Provider domain={"{yourDomain}"} clientId={"{yourClientId}"}>
      {/* 自分のアプリケーション */}
    </Auth0Provider>
  );
};`;

<AuthCodeBlock children={codeExample2} language="javascript" />

最後に、`useAuth0` フックの `authorize` メソッドを使用して、ホストされたログイン画面を表示します。以下は、ボタンをクリックしたときにログインを実行する使用例です。

```javascript lines
const LoginButton = () => {
    const {authorize} = useAuth0();

    const onPress = async () => {
        try {
            await authorize();
        } catch (e) {
            console.log(e);
        }
    };

    return <Button onPress={onPress} title="ログイン" />
}
```

<Note>
  ### チェックポイント

  クリックされたときに `authorize` を呼び出すボタンコンポーネントを追加します。ログインページにリダイレクトされ、その後アプリケーションに戻ることを確認します。
</Note>

<div id="add-logout-to-your-app">
  ## アプリにログアウト機能を追加する
</div>

ユーザーをログアウトさせるには、`useAuth0` フックから `clearSession` メソッドをインポートして呼び出し、Auth0 のログアウトエンドポイントにリダイレクトします。これにより、認可サーバー上のセッションが削除されます。

次は、クリック時にユーザーをアプリからログアウトさせるボタンの利用例です。

```javascript lines
const LogoutButton = () => {
    const {clearSession} = useAuth0();

    const onPress = async () => {
        try {
            await clearSession();
        } catch (e) {
            console.log(e);
        }
    };

    return <Button onPress={onPress} title="ログアウト" />
}
```

<Note>
  ### チェックポイント

  クリック時に `clearSession` を呼び出すボタンを追加します。クリックするとアプリケーションからログアウトされることを確認してください。
</Note>

<div id="show-user-profile-information">
  ## ユーザープロファイル情報を表示する
</div>

`useAuth0` フックは、認証済みユーザーに関する情報を含む `user` オブジェクトを提供します。これを使用して、[IDトークン](https://auth0.com/docs/secure/tokens/id-tokens) からデコードされた認証済みユーザーのユーザープロファイル情報にアクセスできます。

ユーザーが認証されていない場合、このプロパティは `null` になります。

```javascript lines
const Profile = () => {
    const {user, error} = useAuth0();

    return (
        <>
            {user && <Text>{user.name} としてログイン済み</Text>}
            {!user && <Text>ログインしていません</Text>}
            {error && <Text>{error.message}</Text>}
        </>
    )
}
```

<Note>
  ### チェックポイント

  `user` プロパティを使って画面にユーザー情報を表示するコンポーネントをアプリに追加します。
</Note>

<Info>
  ##### 次にできること

  <table>
    <tr>
      <td><a href="/docs/ja-JP/authenticate/identity-providers">他のアイデンティティ プロバイダーを設定する</a></td>
      <td><a href="/docs/ja-JP/secure/multi-factor-authentication">多要素認証を有効化する</a></td>
    </tr>

    <tr>
      <td><a href="/docs/ja-JP/secure/attack-protection">攻撃対策機能について学ぶ</a></td>
      <td><a href="/docs/ja-JP/customize/rules">Rules について学ぶ</a></td>
    </tr>
  </table>

  [GitHub で編集](https://github.com/auth0/docs/edit/master/articles/quickstart/backend/aspnet-core-webapi/01-authorization.md)
</Info>

***
