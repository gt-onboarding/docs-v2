---
title: Capacitor を使用した Ionic Vue アプリにログイン機能を追加する
sidebarTitle: Ionic & Capacitor (Vue)

---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/ja-JP/recipe.jsx";
import { LoggedInForm } from "/snippets/ja-JP/Login.jsx";
import Main from "/snippets/ja-JP/quickstart/native/ionic-vue/main.ts.mdx";
import Loginbutton from "/snippets/ja-JP/quickstart/native/ionic-vue/LoginButton.vue.mdx";
import Logoutbutton from "/snippets/ja-JP/quickstart/native/ionic-vue/LogoutButton.vue.mdx";
import Userprofile from "/snippets/ja-JP/quickstart/native/ionic-vue/UserProfile.vue.mdx";

import {AuthCodeGroup} from "/snippets/ja-JP/AuthCodeGroup.jsx";

export const sections = [
      { id: "getting-started", title: "はじめに" },
      { id: "configure-auth0", title: "Auth0 を設定" },
      { id: "install-the-auth0-vue-sdk", title: "Auth0 Vue ソフトウェア開発キット (SDK) をインストール" },
      { id: "configure-the-createauht0-plugin", title: "CreateAuht0 プラグインを設定" },
      { id: "add-login-to-your-application", title: "アプリケーションにログイン機能を追加" },
      { id: "handle-the-login-callback", title: "ログインのコールバックを処理" },
      { id: "add-logout-to-your-application", title: "アプリケーションにログアウト機能を追加" },
      { id: "show-the-user-profile", title: "ユーザーのプロファイルを表示" }
]


<Recipe isSingleColumn>
  <Content>
    Auth0を使用すると、アプリケーションに認証を素早く追加し、ユーザープロファイル情報へのアクセスを取得できます。
    このガイドでは、[Auth0 Vue ソフトウェア開発キット (SDK)](https://github.com/auth0/auth0-vue)を使用して、Auth0をIonic (Vue) &amp; Capacitorアプリケーションに統合する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1" isSingleColumn>
      このクイックスタートでは、すでに [Capacitor](https://capacitorjs.com/) を使用した [Ionic](https://ionicframework.com/) アプリケーションが動作していることを前提としています。そうでない場合は、シンプルなアプリから始めるために [Using Capacitor with Ionic Framework guide](https://capacitorjs.com/docs/getting-started/with-ionic) を参照するか、[サンプルアプリ](https://github.com/auth0-samples/auth0-ionic-samples) をクローンしてください。

      また、[Capacitor development workflow](https://capacitorjs.com/docs/basics/workflow) についても理解している必要があります。

      <LoggedInForm />
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2" isSingleColumn>
      Auth0 のサービスを使用するには、Auth0 Dashboard でアプリケーションを設定しておく必要があります。Auth0 アプリケーションは、
      プロジェクトで認証をどのように動作させるかを設定する場所です。

      <Info>
        この記事全体を通して、`YOUR_PACKAGE_ID` はアプリケーションのパッケージ ID を指します。これは
        `capacitor.config.ts` ファイル内の `appId` フィールドで確認および設定できます。詳細は
        [Capacitor&#39;s Config schema](https://capacitorjs.com/docs/config#schema) を参照してください。
      </Info>

      ### アプリケーションを構成する

      インタラクティブ セレクターを使用して新しい Auth0 アプリケーションを作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。
      Auth0 内のすべてのアプリケーションには、アプリケーションのコードが SDK を通じて Auth0 API を呼び出す際に使用する、
      一意の英数字のクライアント ID が割り当てられます。

      このクイックスタートを使って構成した設定はすべて、[Dashboard](https://manage.auth0.com/#/) 上の該当アプリケーションに自動的に反映されます。
      ここから今後もアプリケーションを管理できます。

      完全な構成例を確認したい場合は、代わりにサンプルアプリケーションを参照することもできます。

      ### コールバック URL を構成する

      コールバック URL は、ユーザーが認証を完了した後に Auth0 からリダイレクトしたい、アプリケーション内の URL です。
      設定されていない場合、ユーザーはログイン後にアプリケーションへ戻ることができません。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、次の値を設定してください：
        `YOUR_PACKAGE_ID://{yourDomain}/capacitor/YOUR_PACKAGE_ID/callback`
      </Info>

      ### ログアウト URL を構成する

      ログアウト URL は、ユーザーがログアウトした後に Auth0 からリダイレクトしたい、アプリケーション内の URL です。
      設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーが返されます。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、次の値を設定してください：
        `YOUR_PACKAGE_ID://{yourDomain}/capacitor/YOUR_PACKAGE_ID/callback`
      </Info>

      ### 許可されたオリジンを構成する

      ネイティブアプリケーションから Auth0 へリクエストを送信できるようにするには、
      [Application Settings](https://manage.auth0.com/#/applications/\{yourClientId}/settings) で次の **Allowed Origins** を設定します。

      <Info>
        サンプルプロジェクトに沿って進めている場合は、iOS と Android それぞれに対して
        `capacitor://localhost, http://localhost` を設定してください。
      </Info>

      最後に、[Application Settings](https://manage.auth0.com/#/applications/\{yourClientId}/settings) で、
      アプリケーションの **Application Type** が **Native** に設定されていることを確認してください。

      <LoggedInForm />
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3" isSingleColumn>
      プロジェクトディレクトリ内で以下のコマンドを実行して、Auth0 Vue SDK をインストールします。

      ```bash
      npm install @auth0/auth0-vue
      ```

      ソフトウェア開発キット (SDK) は、モジュールや認証サービスなどを含む、Auth0 を Vue アプリケーションと自然に統合するための複数の型をエクスポートします。

      ### Capacitor プラグインをインストールする

      このクイックスタートとサンプルでは、Capacitor の公式プラグインの一部を使用します。次のコマンドを使用して、これらをアプリにインストールします。

      npm install @capacitor/browser @capacitor/app

      * [@capacitor/browser](https://capacitorjs.com/docs/apis/browser) - デバイスのシステムブラウザーとやり取りでき、Auth0 の認可エンドポイントへの URL を開くために使用されます
      * [@capacitor/app](https://capacitorjs.com/docs/apis/app) - アプリの高レベルなイベントを購読でき、Auth0 からのコールバックを処理する際に便利です

      <Info>
        iOS 上の Capacitor の Browser プラグインは [SFSafariViewController](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller) を使用しますが、これは iOS 11 以降ではデバイス上の Safari と
        cookie を共有しません。そのため、これらのデバイスでは [SSO](https://auth0.com/docs/sso) は機能しません。SSO が必要な場合は、代わりに [ASWebAuthenticationSession](https://developer.apple.com/documentation/authenticationservices/aswebauthenticationsession)
        を利用する互換プラグインを使用してください。
      </Info>

      <LoggedInForm />
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4" isSingleColumn>
      SDK は、SDK の動作に必要なすべてのサービスを含むコンポーザブル `createAuth0` をエクスポートします。このコンポーザブルをアプリケーションに登録し、Auth0 のドメインとクライアントIDで設定する必要があります。

      `createAuth0` コンポーザブルには、次の設定を指定します。

      * `domain`: Auth0 Dashboard で作成したアプリケーションの **Settings** に表示されている `domain` の値、または Auth0 の[カスタムドメイン機能](http://localhost:3000/docs/custom-domains)を使用している場合はそのカスタムドメイン。
      * `clientId`: Auth0 Dashboard で作成したアプリケーションの **Settings** に表示されているクライアントIDの値。
      * `useRefreshTokens`: Android および iOS 上の Ionic で auth0-vue を使用するには、リフレッシュトークンを有効にする必要があります。
      * `useRefreshTokensFallback`: Android および iOS 上の Ionic で auth0-vue を使用するには、iframe フォールバックを無効にする必要があります。
      * `authorizationParams.redirect_uri`: ユーザーが Auth0 で認証した後にリダイレクトする URL。

      <Info>
        アプリケーションを一度閉じて再度開いた後も認証状態を保持したい場合は、SDK を設定する際に `cacheLocation` を `localstorage` に設定することを検討できます。ただし、[localstorage にトークンを保存することによるリスク](https://auth0.com/docs/libraries/auth0-single-page-app-sdk#change-storage-options)を理解しておく必要があります。また、Capacitor アプリでは、特定の状況下でデータが予期せず復元される可能性があるため、localstorage は **一時的な** ものとして扱うべきです。[Capacitor ドキュメントのストレージに関するガイダンス](https://capacitorjs.com/docs/guides/storage#why-cant-i-just-use-localstorage-or-indexeddb)も参照してください。

        さらに、より安全で永続的なストレージメカニズムを使用する必要がある場合は、SDK の機能として、トークンを保存するために[カスタムキャッシュ実装を使用する](https://github.com/auth0/auth0-spa-js/blob/master/EXAMPLES.md#creating-a-custom-cache)こともできます。

        **Note**: トークンの保存に [Capacitor の Storage プラグイン](https://capacitorjs.com/docs/apis/storage)を使用することは推奨しません。このプラグインは iOS では [UserDefaults](https://developer.apple.com/documentation/foundation/userdefaults)、Android では [SharedPreferences](https://developer.android.com/reference/android/content/SharedPreferences) をバックエンドとして使用しているためです。これらの API に保存されたデータは暗号化されず、安全ではなく、クラウドに同期される可能性もあります。
      </Info>

      <Note>
        ##### チェックポイント

        Auth0 Vue SDK でアプリケーションの設定が完了したら、アプリケーションを実行して、SDK がエラーなく初期化されていることと、アプリケーションが設定前と同様に動作していることを確認してください。
      </Note>

      <AuthCodeGroup>
        <Main />

        <Loginbutton />

        <Logoutbutton />

        <Userprofile />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5" isSingleColumn>
      Capacitor アプリケーションでは、[Capacitor の Browser プラグイン](https://capacitorjs.com/docs/apis/browser) が Auth0 の [Universal Login Page](https://auth0.com/universal-login) へのリダイレクトを実行します。`loginWithRedirect` 関数の `openUrl`
      パラメーターを設定して `Browser.open` を使用し、URL がデバイスのシステムブラウザーコンポーネント（iOS では [SFSafariViewController](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller)、Android では [Chrome
      Custom Tabs](https://developer.chrome.com/docs/android/custom-tabs)）で開かれるようにします。

      <Info>
        デフォルトでは、SDK の `loginWithRedirect` メソッドは `window.location.href` を使用して、
        プラットフォームに適したシステムブラウザーコンポーネントではなく、ユーザーのデバイス上のデフォルトのブラウザーアプリケーションでログインページへ
        遷移します。ユーザーは認証のためにアプリケーションから離れることになり、ユーザーエクスペリエンスが最適ではない可能性があります。
      </Info>

      <Note>
        ##### チェックポイント

        `loginWithRedirect` 関数は、`openUrl` パラメーターを設定して `Browser.open` 関数を使用し、
        プラットフォームのシステムブラウザーコンポーネントでログイン用 URL を開くことで、SDK にログインフローの開始を指示します。
        これにより、ユーザーがアプリケーションにログインする手段が提供されます。
        ユーザーは Auth0 のログインページにリダイレクトされ、エラーは発生しません。
      </Note>

      <AuthCodeGroup>
        <Loginbutton />

        <Main />

        <Logoutbutton />

        <Userprofile />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6" isSingleColumn>
      ユーザーが Universal Login ページでログインすると、カスタム URL スキーム付きの URL を介してアプリにリダイレクトされます。`appUrlOpen` イベントはアプリ内で処理する必要があります。Auth0 ソフトウェア開発キット (SDK) の `handleRedirectCallback` メソッドを呼び出して、認証 state を初期化できます。

      このメソッドは Auth0 からのリダイレクトでのみ使用できます。成功を確認するには、URL に `code` と `state` パラメーターが含まれているかを確認してください。

      `Browser.close()` メソッドは、このイベントが発生したときにブラウザーを閉じる必要があります。

      <Info>
        この記事では、アプリケーション内でコールバックを処理するために Custom URL Schemes を使用することを前提としています。これを行うには、選択したプラットフォームで `YOUR_PACKAGE_ID` を URL スキームとして登録してください。詳細については、iOS の [Defining a Custom URL Scheme](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app)、または Android の [Create Deep Links to App Content](https://developer.android.com/training/app-links/deep-linking) を参照してください。
      </Info>

      <Note>
        ##### チェックポイント

        `appUrlOpen` をアプリケーションの `App` コンポーネントのセットアップに追加し、ログインします。ユーザーが認証され、アプリにログインすると、ブラウザーウィンドウが閉じるはずです。
      </Note>

      <AuthCodeGroup>
        <Main />

        <Loginbutton />

        <Logoutbutton />

        <Userprofile />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7" isSingleColumn>
      ユーザーがログインできるようになったので、次は[ログアウトする方法](https://auth0.com/docs/logout/guides/logout-auth0)を設定する必要があります。ブラウザーで Auth0 のログアウトエンドポイントにリダイレクトして、ブラウザーセッションをクリアする必要があります。ここでも、ユーザーがアプリを離れてしまい望ましくない体験にならないように、Capacitor の Browser プラグインを使ってこのリダイレクトを実行する必要があります。

      Auth0 のソフトウェア開発キット (SDK) とあわせて Ionic と Capacitor でこれを実現するには、次のようにします。

      * Auth0 がログアウト後のリダイレクト先として使用する、アプリ用の URL を作成します。これは、登録済みのカスタムスキームと Auth0 ドメインを使用する URL です。この URL を Auth0 Dashboard の **許可されたログアウトURL** 設定に追加します。
      * `logout` を呼び出して SDK からログアウトし、リダイレクト URL を `logoutParams.returnTo` パラメーターとして渡します。
      * `openUrl` パラメーターに、Capacitor の Browser プラグインを使って `Browser.open` で URL を開くコールバックを設定します。

      <Info>
        ログイン手順と同様に、`logout` を呼び出す際に `openUrl` を設定しない場合、SDK はデバイスのデフォルトブラウザーアプリケーションを使ってログアウト URL にユーザーをリダイレクトしますが、これは望ましくないユーザー体験となります。
      </Info>

      <Note>
        ##### チェックポイント

        ユーザーがアプリケーションからログアウトできる手段を提供してください。Auth0 にリダイレクトされ、その後に `returnTo` パラメーターで指定したアドレスにリダイレクトされることを確認します。アプリケーションにログインしたままになっていないことを確認してください。
      </Note>

      <AuthCodeGroup>
        <Logoutbutton />

        <Main />

        <Loginbutton />

        <Userprofile />
      </AuthCodeGroup>
    </Section>

    <Section id={sections[7].id} title={sections[7].title} stepNumber="8" isSingleColumn>
      Auth0 Vue ソフトウェア開発キット (SDK) は、必要なコンポーネント内で、ログイン済みユーザーに関連付けられた[ユーザーのプロファイル](https://auth0.com/docs/users/concepts/overview-user-profile)（ユーザーインターフェースをパーソナライズするための名前やプロフィール画像など）を取得します。プロファイル情報は、`useAuth0()` composable によって公開される `user` プロパティから利用できます。

      SDK の初期化は非同期で行われるため、`isLoading` および `user` プロパティを確認してユーザープロファイルを扱う必要があります。
      `isLoading` が `false` になり、`user` に値が設定されると、ユーザープロファイルを利用できるようになります。

      <Note>
        ##### チェックポイント

        アプリ内でユーザーが自分のユーザープロファイルの詳細を確認できる方法を用意し、ログイン後にプロファイル情報を画面上で取得・表示できることを確認してください。
      </Note>

      <AuthCodeGroup>
        <Userprofile />

        <Main />

        <Loginbutton />

        <Logoutbutton />
      </AuthCodeGroup>
    </Section>

    ## 次のステップ

    素晴らしい!ここまで進めたなら、アプリケーションでログイン、ログアウト、およびユーザープロファイル情報が実装されているはずです。

    これでクイックスタートチュートリアルは終了ですが、他にも多くの機能があります。Auth0でできることの詳細については、以下をご確認ください:

    * [Auth0 Dashboard](https://manage.auth0.com/dashboard/us/dev-gja8kxz4ndtex3rq) - Auth0 テナントとアプリケーションの設定および管理方法を学びます
    * [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0 の機能を拡張するインテグレーションを見つける
  </Content>
</Recipe>