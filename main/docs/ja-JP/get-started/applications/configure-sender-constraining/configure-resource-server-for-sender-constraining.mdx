---
description: Auth0 テナント向け Sender Constraining の設定方法の概要。
'og:image': https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
'og:title': Configure Sender Constraining
'og:url': https://auth0.com/docs/
permalink: configure-resource-server-for-sender-constraining
title: Sender Constraining の設定
'twitter:description': Auth0 テナント向け Sender Constraining の設定方法の概要。
'twitter:title': Configure Sender Constraining
---

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">
  Demonstrating Proof-of-Possession (DPoP) を使用した Sender Constraining トークンは現在 Early Access（早期アクセス）段階です。この機能へのアクセスをリクエストするには、Auth0 担当者にお問い合わせください。
</Callout>

[Sender constraining](/docs/ja-JP/secure/sender-constraining) は、<Tooltip tip="" cta="用語集を表示" href="/docs/ja-JP/glossary?term=OAuth+2.0">OAuth 2.0</Tooltip> および <Tooltip tip="" cta="用語集を表示" href="/docs/ja-JP/glossary?term=OpenID">OpenID</Tooltip> Connect (OIDC) のセキュリティメカニズムであり、アクセストークンおよび <Tooltip tip="" cta="用語集を表示" href="/docs/ja-JP/glossary?term=refresh+tokens">リフレッシュトークン</Tooltip> を、それらを取得した特定のクライアントアプリケーションに暗号的に結び付けることで、トークンの盗難や不正利用を防止します。

Auth0 は mTLS Sender Constraining と Demonstrating Proof-of-Possession (DPoP) をサポートします。クライアントアプリケーションに対して Sender Constraining を有効にする場合は、API 呼び出しを行う対象の <Tooltip tip="" cta="用語集を表示" href="/docs/ja-JP/glossary?term=resource+server">リソースサーバー</Tooltip> に対しても Sender Constraining を強制する必要があります。

Auth0 で Sender Constraining を設定するには、次の操作を行います。

* [クライアントアプリケーションに対して Sender Constraining を設定する](#configure-sender-constraining-for-a-client-application)。
* [リソースサーバーに対して Sender Constraining を設定する](#configure-sender-constraining-for-a-resource-server)。

<div id="how-it-works">
  ## 動作の仕組み
</div>

<Tooltip tip="" cta="用語集を表示" href="/docs/ja-JP/glossary?term=Access+tokens">アクセストークン</Tooltip>は、クライアントアプリケーションおよびリソースサーバーに対する送信者制約の構成方法に応じて、Auth0 で送信者制約が適用されるかどうかが決まります。

1. **要求されたオーディエンスタイプ:** トークンリクエストで、要求されたオーディエンスが `/userinfo` のみか、[`/userinfo`](https://auth0.com/docs/api/authentication/user-profile/get-user-info) エンドポイントでのみ使用されることを意図しているか、あるいは openid スコープも要求した場合に `/userinfo` を含む可能性のあるカスタム API かによって、アクセストークンに送信者制約が適用されるかどうかが変わります。
2. **クライアントアプリケーション:** クライアントアプリケーション側で送信者制約を `required` に設定しているかどうか。
3. **リソースサーバー:** リソースサーバーに対して送信者制約をどのように構成しているか。

   1. `none`: リソースサーバーに対して送信者制約を構成していません。
   2. `allowed`: 送信者制約メソッドを設定することで、リソースサーバーに対して送信者制約を構成しています。
   3. `required`: リソースサーバーに対して送信者制約を必須として構成しており、アクセストークンは特定のアプリケーションに送信者制約されていなければなりません。送信者制約メソッドの設定が必要です。

* **Proof-of-Possession:** クライアントアプリケーションがトークンリクエストで Proof-of-Possession アサーションを送信したかどうか。

  * mTLS 送信者制約: TLS ハンドシェイク中に、クライアント証明書に関連付けられた特定の秘密鍵をクライアントが正常に提示することで、Proof-of-Possession が証明されます。
  * DPoP: クライアントは、自身の秘密鍵で暗号学的に署名した DPoP Proof JWT を作成し、関連するアクセストークンが使用されるすべてのリクエストの DPoP HTTP ヘッダーに `DPoP` Proof JWT を含めることで、Proof-of-Possession を満たします。

次の表は、さまざまなクライアントリクエストパラメーターおよび Auth0 リソースサーバー構成に基づいて、アクセストークンがどのように発行され、送信者制約が適用されるかどうかを説明します。

<table class="table">
  <thead>
    <tr>
      <th><strong>要求されたオーディエンスタイプ</strong></th>
      <th><strong>クライアントが PoP を必須とするか?</strong></th>
      <th><strong>クライアントから Proof-of-Possession (PoP) が送信されたか?</strong></th>
      <th><strong>Auth0 リソースサーバーポリシー: None</strong></th>
      <th><strong>Auth0 リソースサーバーポリシー: Allowed (必須ではない)</strong></th>
      <th><strong>Auth0 リソースサーバーポリシー: Required</strong></th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>Userinfo のみ</td>
      <td>いいえ</td>
      <td>いいえ</td>
      <td>発行される (送信者制約なし)</td>
      <td>N/A</td>
      <td>N/A</td>
    </tr>

    <tr>
      <td>Userinfo のみ</td>
      <td>いいえ</td>
      <td>はい</td>
      <td>発行される (送信者制約付き)</td>
      <td>N/A</td>
      <td>N/A</td>
    </tr>

    <tr>
      <td>Userinfo のみ</td>
      <td>はい</td>
      <td>いいえ</td>
      <td>発行されない</td>
      <td>N/A</td>
      <td>N/A</td>
    </tr>

    <tr>
      <td>Userinfo のみ</td>
      <td>はい</td>
      <td>はい</td>
      <td>発行される (送信者制約付き)</td>
      <td>N/A</td>
      <td>N/A</td>
    </tr>

    <tr>
      <td>カスタムオーディエンス (Userinfo を含む場合がある)</td>
      <td>いいえ</td>
      <td>いいえ</td>
      <td>発行される (送信者制約なし)</td>
      <td>発行される (送信者制約なし)</td>
      <td>発行されない</td>
    </tr>

    <tr>
      <td>カスタムオーディエンス (Userinfo を含む場合がある)</td>
      <td>いいえ</td>
      <td>はい</td>
      <td>発行される (送信者制約なし)</td>
      <td>発行される (送信者制約付き)</td>
      <td>発行される (送信者制約付き)</td>
    </tr>

    <tr>
      <td>カスタムオーディエンス (Userinfo を含む場合がある)</td>
      <td>はい</td>
      <td>いいえ</td>
      <td>発行されない</td>
      <td>発行されない</td>
      <td>発行されない</td>
    </tr>

    <tr>
      <td>カスタムオーディエンス (Userinfo を含む場合がある)</td>
      <td>はい</td>
      <td>はい</td>
      <td>発行されない</td>
      <td>発行される (送信者制約付き)</td>
      <td>発行される (送信者制約付き)</td>
    </tr>
  </tbody>
</table>

<div id="configure-sender-constraining-for-a-client-application">
  ## クライアントアプリケーションに対して Sender Constraining を構成する
</div>

クライアントアプリケーションに対して Sender Constraining を必須にすると、そのアプリケーション専用にアクセストークンが制約されます。Auth0 は、トークンを要求したアプリケーションだけが、そのトークンを使用して関連するリソースへアクセスできるよう、リクエストを検証します。

クライアントアプリケーションで Sender Constraining を必須に設定したら、リソースサーバーを構成する際に、mTLS または DPoP のいずれかを Sender Constraining の方式として設定できます。

クライアントアプリケーションに対して Sender Constraining を構成するには、<Tooltip tip="" cta="用語集を表示" href="/docs/ja-JP/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip> または <Tooltip tip="" cta="用語集を表示" href="/docs/ja-JP/glossary?term=Management+API">Management API</Tooltip> を使用できます。

<Tabs>
  <Tab title="Auth0 Dashboard">
    1. [Dashboard &gt; Applications &gt; Applications](https://manage.auth0.com/#/applications) に移動し、構成するアプリケーションを選択します。
    2. **Settings** で、**Token Sender-Constraining** までスクロールします。
    3. **Require Sender Constraining** をオンに切り替えると、そのアプリケーションに対して Sender Constraining が必須になります。オフに切り替えると、そのアプリケーションに対する Sender Constraining の必須要件が削除されます。

    <Frame>![](/docs/images/cdy7uua7fh8z/3BoGW9NEYKPBkfk2tPBL7l/0f884ac3f64f17b23fd6a0e9436bb472/Screenshot_2024-07-23_at_1.30.19_PM.png)</Frame>
  </Tab>

  <Tab title="Management API">
    クライアントに対して Sender Constraining を構成するには、[Management API](https://auth0.com/docs/api/management/v2) を使用します。

    クライアントに対して Sender Constraining を必須にするには、[クライアント設定を更新する](https://auth0.com/docs/api/management/v2/clients/patch-clients-by-id) PATCH リクエストを送信し、`require_proof_of_possession` パラメーターを `true` に設定します。

    ```json lines
    "require_proof_of_possession": true
    ```

    Sender Constraining の必須要件を削除するには、`require_proof_of_possession` パラメーターを `false` に設定します。

    ```json lines
    "require_proof_of_possession": false
    ```
  </Tab>
</Tabs>

<div id="configure-sender-constraining-for-a-resource-server">
  ## リソースサーバーの送信者制約を構成する
</div>

Auth0 によって発行されるアクセストークンは、API にアクセスする必要がある送信者（つまりクライアントアプリケーション）に制約できます。

Auth0 Dashboard または Management API を使用して、リソースサーバーの送信者制約を構成できます。

<Tabs>
  <Tab title="Auth0 Dashboard">
    Token Binding または送信者制約を有効にするには、API の **API Settings** を構成します。

    1. [Auth0 Dashboard &gt; Applications &gt; APIs](https://manage.auth0.com/#/apis) に移動します。
    2. 構成する API を選択します。
    3. **Settings** タブで、**Token Sender-Constraining** セクションを探します。
    4. 次の項目を構成します。

       1. Sender Constraining Method:

          1. **None:** このリソースサーバーに対して送信者制約メソッドを有効にしません。
          2. **mTLS**: このリソースサーバーの送信者制約メソッドとして mTLS を有効にします。
          3. **DPoP:** このリソースサーバーの送信者制約メソッドとして DPoP を有効にします。

    B. **Require Token Sender Constraining** をオンに切り替えます。この API 用にアプリケーションに発行されるすべてのアクセストークンは、そのアプリケーションに制約されます。

    <Frame>![Auth0 Dashboard > APIs > Settings > Token binding](/docs/images/cdy7uua7fh8z/3Dv98iZosdpJMcZXfXyurn/823fa368ab874218fbb737aacac9b262/Screenshot_2025-07-28_at_3.59.01_PM.png)</Frame>
  </Tab>

  <Tab title="Management API">
    Management API で Sender Constraining を有効にするには、[リソースサーバーを更新](https://auth0.com/docs/api/management/v2/resource-servers/patch-resource-servers-by-id)する PATCH リクエストを送信します。`proof_of_possession` オブジェクトのパラメーターを次のように設定します。

    <table class="table">
      <thead>
        <tr>
          <th><strong>Parameter</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td><code>mechanism</code></td>
          <td>送信者制約メソッドを設定します: <code>none</code>、<code>mtls</code>、または <code>dpop</code>。</td>
        </tr>

        <tr>
          <td><code>required</code></td>
          <td><code>true</code> に設定すると、この API 用にアプリケーションに発行されるすべてのアクセストークンは、そのアプリケーションに制約されます。<code>false</code> に設定すると、そのアプリケーションに対して送信者制約は必須ではありません。</td>
        </tr>
      </tbody>
    </table>

    次のコードサンプルは、mTLS Sender Constraining 用にリソースサーバーを構成するリクエストボディの例です。

    ```json lines
    "proof_of_possession": {
        "mechanism": "mtls",
        "required": true
      }
    ```
  </Tab>
</Tabs>