---
description: Auth0 テナントで Sender Constraining を構成する方法の概要。
'og:image': https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
'og:title': Sender Constraining の構成
'og:url': https://auth0.com/docs/
permalink: configure-client-for-sender-constraining
title: Sender Constraining の構成
'twitter:description': Auth0 テナントで Sender Constraining を構成する方法の概要。
'twitter:title': Sender Constraining の構成
---

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">
  Demonstrating Proof-of-Possession (DPoP) を使用した Sender Constraining によるトークン保護は、現在 Early Access 段階です。この機能へのアクセスをリクエストするには、Auth0 の担当者にお問い合わせください。
</Callout>

[Sender constraining](/docs/ja-JP/secure/sender-constraining) は、<Tooltip tip="" cta="View Glossary" href="/docs/ja-JP/glossary?term=OAuth+2.0">OAuth 2.0</Tooltip> および <Tooltip tip="" cta="View Glossary" href="/docs/ja-JP/glossary?term=OpenID">OpenID</Tooltip> Connect (OIDC) のセキュリティメカニズムであり、アクセストークンおよび <Tooltip tip="" cta="View Glossary" href="/docs/ja-JP/glossary?term=refresh+tokens">リフレッシュトークン</Tooltip> を、それらを取得した特定のクライアントアプリケーションに暗号学的に結び付けることで、トークンの窃取や不正使用を防止します。

Auth0 は mTLS sender constraining と Demonstrating Proof-of-Possession (DPoP) をサポートします。クライアントアプリケーションに対して sender constraining を有効にする場合は、API 呼び出し先の <Tooltip tip="" cta="View Glossary" href="/docs/ja-JP/glossary?term=resource+server">リソースサーバー</Tooltip> に対しても sender constraining を必ず適用する必要があります。

Auth0 で sender constraining を構成するには、次の操作が必要です。

* [クライアントアプリケーションの sender constraining を構成する](#configure-sender-constraining-for-a-client-application)。
* [リソースサーバーの sender constraining を構成する](#configure-sender-constraining-for-a-resource-server)。

<div id="how-it-works">
  ## 動作概要
</div>

<Tooltip tip="" cta="用語集を表示" href="/docs/ja-JP/glossary?term=Access+tokens">Access tokens</Tooltip> は、クライアントアプリケーションおよびリソースサーバーに対して送信者制約（sender constraining）をどのように構成するかによって、Auth0 上で送信者制約が適用されるかどうかが決まります。

1. **要求されたオーディエンス:** トークンリクエストで、要求されたオーディエンスが `/userinfo` のみか、[`/userinfo`](https://auth0.com/docs/api/authentication/user-profile/get-user-info) エンドポイント専用か、あるいは `openid` スコープも要求した際に `/userinfo` を含む可能性のあるカスタム API かによって、アクセストークンが送信者制約されるかどうかが変わります。
2. **クライアントアプリケーション:** クライアントアプリケーションで送信者制約を `required` として設定しているかどうか。
3. **リソースサーバー:** リソースサーバーに対して送信者制約を設定しているかどうか。

   1. `none`: リソースサーバーに対して送信者制約を設定していません。
   2. `allowed`: 送信者制約メソッドを設定することで、リソースサーバーに対して送信者制約を構成しています。
   3. `required`: リソースサーバーに対して送信者制約を必須として構成しており、アクセストークンはアプリケーションに対して送信者制約されていなければなりません。送信者制約メソッドが必要です。

* **Proof-of-Possession（PoP、所有証明）:** クライアントアプリケーションが、トークンリクエストで Proof-of-Possession アサーションを送信したかどうか。

  * mTLS sender constraining: Proof-of-Possession は、TLS ハンドシェイク中にクライアント証明書に関連付けられた特定の秘密鍵を、クライアントが正常に提示することで示されます。
  * DPoP: Proof-of-Possession は、クライアントが自身の秘密鍵で暗号学的に署名した DPoP Proof JWT を作成し、関連付けられたアクセストークンが使用されるすべてのリクエストで、その `DPoP` Proof JWT を DPoP HTTP ヘッダーに含めることで達成されます。

次の表は、さまざまなクライアントリクエストパラメーターと Auth0 リソースサーバー構成に基づいて、アクセストークンがどのように発行されるか、および送信者制約が適用されるかどうかを示します。

<table class="table">
  <thead>
    <tr>
      <th><strong>要求されたオーディエンスタイプ</strong></th>
      <th><strong>クライアントは PoP を必須としているか</strong></th>
      <th><strong>クライアントから Proof-of-Possession (PoP) が送信されたか</strong></th>
      <th><strong>Auth0 リソースサーバーポリシー: None</strong></th>
      <th><strong>Auth0 リソースサーバーポリシー: Allowed (必須ではない)</strong></th>
      <th><strong>Auth0 リソースサーバーポリシー: Required</strong></th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>Userinfo Only</td>
      <td>No</td>
      <td>No</td>
      <td>発行される（送信者制約なし）</td>
      <td>N/A</td>
      <td>N/A</td>
    </tr>

    <tr>
      <td>Userinfo Only</td>
      <td>No</td>
      <td>Yes</td>
      <td>発行される（送信者制約あり）</td>
      <td>N/A</td>
      <td>N/A</td>
    </tr>

    <tr>
      <td>Userinfo Only</td>
      <td>Yes</td>
      <td>No</td>
      <td>発行されない</td>
      <td>N/A</td>
      <td>N/A</td>
    </tr>

    <tr>
      <td>Userinfo Only</td>
      <td>Yes</td>
      <td>Yes</td>
      <td>発行される（送信者制約あり）</td>
      <td>N/A</td>
      <td>N/A</td>
    </tr>

    <tr>
      <td>Custom Audience (may contain Userinfo)</td>
      <td>No</td>
      <td>No</td>
      <td>発行される（送信者制約なし）</td>
      <td>発行される（送信者制約なし）</td>
      <td>発行されない</td>
    </tr>

    <tr>
      <td>Custom Audience (may contain Userinfo)</td>
      <td>No</td>
      <td>Yes</td>
      <td>発行される（送信者制約なし）</td>
      <td>発行される（送信者制約あり）</td>
      <td>発行される（送信者制約あり）</td>
    </tr>

    <tr>
      <td>Custom Audience (may contain Userinfo)</td>
      <td>Yes</td>
      <td>No</td>
      <td>発行されない</td>
      <td>発行されない</td>
      <td>発行されない</td>
    </tr>

    <tr>
      <td>Custom Audience (may contain Userinfo)</td>
      <td>Yes</td>
      <td>Yes</td>
      <td>発行されない</td>
      <td>発行される（送信者制約あり）</td>
      <td>発行される（送信者制約あり）</td>
    </tr>
  </tbody>
</table>

<div id="configure-sender-constraining-for-a-client-application">
  ## クライアントアプリケーションに対して sender constraining を構成する
</div>

クライアントアプリケーションに対して sender constraining を必須にすると、アクセストークンはそのアプリケーションに限定されます。Auth0 はリクエストを検証し、トークンを要求したアプリケーションだけが、そのトークンを使用して関連リソースにアクセスできることを保証します。

クライアントアプリケーションで sender constraining を必須に設定すると、リソースサーバーを構成する際に、mTLS または DPoP のいずれかの sender constraining メソッドを設定できます。

クライアントアプリケーションに対して sender constraining を構成するには、<Tooltip tip="" cta="用語集を表示" href="/docs/ja-JP/glossary?term=Auth0+Dashboard">Auth0 Dashboard</Tooltip> または <Tooltip tip="" cta="用語集を表示" href="/docs/ja-JP/glossary?term=Management+API">Management API</Tooltip> を使用できます。

<Tabs>
  <Tab title="Auth0 Dashboard">
    1. [Dashboard &gt; Applications &gt; Applications](https://manage.auth0.com/#/applications) に移動します。構成するアプリケーションを選択します。
    2. **Settings** セクションで、**Token Sender-Constraining** までスクロールします。
    3. **Require Sender Constraining** をオンに切り替えます。オフに切り替えると、そのアプリケーションに対する Sender Constraining の必須要件が解除されます。

    <Frame>![](/docs/images/cdy7uua7fh8z/3BoGW9NEYKPBkfk2tPBL7l/0f884ac3f64f17b23fd6a0e9436bb472/Screenshot_2024-07-23_at_1.30.19_PM.png)</Frame>
  </Tab>

  <Tab title="Management API">
    クライアントに対して Sender Constraining を構成するには、[Management API](https://auth0.com/docs/api/management/v2) を使用します。

    クライアントに対して Sender Constraining を必須にするには、[クライアント設定を更新する](https://auth0.com/docs/api/management/v2/clients/patch-clients-by-id) PATCH リクエストを送信し、`require_proof_of_possession` パラメータを `true` に設定します。

    ```json lines
    "require_proof_of_possession": true
    ```

    Sender Constraining の必須要件を解除するには、`require_proof_of_possession` パラメータを `false` に設定します。

    ```json lines
    "require_proof_of_possession": false
    ```
  </Tab>
</Tabs>

<div id="configure-sender-constraining-for-a-resource-server">
  ## リソースサーバー向けの sender constraining を設定する
</div>

Auth0 によって発行されるアクセストークンは、API にアクセスする必要がある送信者（つまりクライアントアプリケーション）に制限できます。

Auth0 Dashboard または Management API を使用して、リソースサーバー向けの sender constraining を設定できます。

<Tabs>
  <Tab title="Auth0 Dashboard">
    Token Binding または sender constraining を有効にするには、API の **API Settings** を設定します。

    1. [Auth0 Dashboard &gt; Applications &gt; APIs](https://manage.auth0.com/#/apis) に移動します。
    2. 設定したい API を選択します。
    3. **Settings** タブの **Token Sender-Constraining** セクションを見つけます。
    4. 次の設定を行います。

       1. Sender Constraining Method:

          1. **None:** このリソースサーバーに対して sender constraining method を有効にしません。
          2. **mTLS**: このリソースサーバーの sender constraining method として mTLS を有効にします。
          3. **DPoP:** このリソースサーバーの sender constraining method として DPoP を有効にします。

    B. **Require Token Sender Constraining** をオンにします。この API に対してアプリケーションに発行されるすべてのアクセストークンは、そのアプリケーションに制限されます。

    <Frame>![Auth0 Dashboard > APIs > Settings > Token binding](/docs/images/cdy7uua7fh8z/3Dv98iZosdpJMcZXfXyurn/823fa368ab874218fbb737aacac9b262/Screenshot_2025-07-28_at_3.59.01_PM.png)</Frame>
  </Tab>

  <Tab title="Management API">
    Management API を使用して sender constraining を有効にするには、[リソースサーバーを更新](https://auth0.com/docs/api/management/v2/resource-servers/patch-resource-servers-by-id)する PATCH リクエストを送信します。`proof_of_possession` オブジェクトのパラメーターを次のように設定します。

    <table class="table">
      <thead>
        <tr>
          <th><strong>Parameter</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td><code>mechanism</code></td>
          <td>sender constraining method を設定します: <code>none</code>、<code>mtls</code>、または <code>dpop</code>。</td>
        </tr>

        <tr>
          <td><code>required</code></td>
          <td><code>true</code> に設定すると、この API に対してアプリケーションに発行されるすべてのアクセストークンは、そのアプリケーションに制限されます。<code>false</code> に設定すると、そのアプリケーションに対して sender constraining は必須ではなくなります。</td>
        </tr>
      </tbody>
    </table>

    次のコードサンプルは、mTLS sender constraining 用にリソースサーバーを設定するリクエストボディの例です。

    ```json lines
    "proof_of_possession": {
        "mechanism": "mtls",
        "required": true
      }
    ```
  </Tab>
</Tabs>