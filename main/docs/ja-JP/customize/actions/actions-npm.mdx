---
description: プロジェクトの Actions を @auth0/actions NPM パッケージを使って記述します。
'og:image': https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
'og:title': Actions NPM
'og:url': https://auth0.com/docs/
permalink: actions-npm
title: Actions NPM
'twitter:description': プロジェクトの Actions を @auth0/actions NPM パッケージを使って記述します。
'twitter:title': Actions NPM
---

[**`@auth0/actions`** NPM パッケージ](https://www.npmjs.com/package/@auth0/actions) は、**公式の Actions ライブラリ**であり、**Auth0 Actions 用の TypeScript 型定義**を提供します。これにより、外部エディタや IDE でプロジェクトの Actions を記述およびテストできます。

<div id="benefits">
  ### 利点
</div>

このライブラリは、次のユースケースに役立ちます。

* **IDE / コードエディター支援**: このライブラリを参照することで、IDE やコードエディターが **自動補完**、**オブジェクトおよび関数定義の表示**、**エラー検出やチェック** などを通じて、開発者のコーディングを支援できるようになります。
* **TypeScript 開発**: Actions は現在も Node.js の CommonJS を用いて記述・実行されますが、このライブラリを使用すると、外部のプロジェクトで **TypeScript** を用いて Actions を開発し、それをビルドして CommonJS として Auth0 テナントにデプロイできます。
* **ユニットテストの改善**: 外部プロジェクトでの TypeScript 開発を可能にすることで、このライブラリにより、開発者はベストプラクティスに従い、TypeScript の定義に基づいて **ユニットテストを改善** できます。
* **AI による Actions 生成**: このライブラリにより、AI がより正確な Action のサンプルコードを生成できるようになるための、もう一歩進んだ環境が整います。

***

<div id="how-it-works">
  ### 仕組み
</div>

<div id="installation">
  #### インストール
</div>

次のいずれかのパッケージマネージャーを使用して、このパッケージを**開発時の依存関係**としてインストールします。

> このパッケージは開発ツールを補完する目的で使用するため、開発時の依存関係として追加する必要があります。

* **NPM**: `npm install @auth0/actions --save-dev`
* **Yarn**: `yarn add @auth0/actions --dev`
* **Pnpm**: `pnpm add @auth0/actions --save-dev`

***

<div id="import">
  #### インポート
</div>

このライブラリの**構成**は次のとおりです。

```bash
@auth0/actions
│
└───credentials-exchange
│   └───v1
│   └───v2
└───custom-email-provider
│   └───v1
└───custom-phone-provider
│   └───v1
└───custom-token-exchange
│   └───v1
└───event-stream
│   └───v1
└───password-reset-post-challenge
│   └───v1
└───post-change-password
│   └───v1
│   └───v2
└───post-login
│   └───v1
│   └───v2
│   └───v3
└───post-user-registration
│   └───v1
│   └───v2
└───pre-user-registration
│   └───v1
│   └───v2
└───send-phone-message
    └───v2
```

インポート文は、以前のライブラリ構成を考慮して、それぞれの**トリガー名**と**バージョン番号**に基づいて指定する必要があります。

**次のパターンに従ってください**: `@auth0/actions/[trigger_name]/[trigger_version]`

**例**: `@auth0/actions/post-login/v3`

利用している技術スタックに応じて、次のいずれかの方法で TypeScript 定義を Actions にインポートします。

既存の JavaScript コード構造を変更せずに IntelliSense を有効にしたい場合は、この方法を使用してください:

<Tabs>
  <Tab title="JSDoc @import">
    既存の JavaScript コード構造を変更せずに IntelliSense を有効にしたい場合は、この方法を使用してください:

    ```javascript
    /** @import {Event, PostLoginAPI} from "@auth0/actions/post-login/v3" */

    /**
    * PostLogin フローの実行中に呼び出されるハンドラーです。
    *
    * @param {Event} event - ユーザーおよびそのユーザーがログインしているコンテキストに関する詳細。
    * @param {PostLoginAPI} api - ログインの動作を変更するために使用できるメソッドを提供するインターフェース。
    */
    exports.onExecutePostLogin = async (event, api) => {
      // Your code
    }
    ```
  </Tab>

  <Tab title="JSDoc @param">
    JSDoc コメント内の import 文を使用する JavaScript ファイルで型安全性を確保したい場合は、この方法を使用してください:

    ```javascript
    /**
    * PostLogin フローの実行中に呼び出されるハンドラーです。
    *
    * @param {import('@auth0/actions/post-login/v3').Event} event - ユーザーおよびそのユーザーがログインしているコンテキストに関する詳細。
    * @param {import('@auth0/actions/post-login/v3').PostLoginAPI} api - ログインの動作を変更するために使用できるメソッドを提供するインターフェース。
    */
    exports.onExecutePostLogin = async (event, api) => {
      // Your code
    };
    ```
  </Tab>

  <Tab title="TypeScript import">
    TypeScript で開発しており、完全な型チェックとモダンな構文を利用したい場合は、この方法を使用してください:

    ```javascript
    import type { Event, PostLoginAPI } from '@auth0/actions/post-login/v3';

    /**
    * PostLogin フローの実行中に呼び出されるハンドラーです。
    *
    * @param {Event} event - ユーザーおよびそのユーザーがログインしているコンテキストに関する詳細。
    * @param {PostLoginAPI} api - ログインの動作を変更するために使用できるメソッドを提供するインターフェース。
    */
    exports.onExecutePostLogin = async (event: Event, api: PostLoginAPI) => {
      // Your code
    };
    ```
  </Tab>
</Tabs>

<Warning>
  TypeScript を使用する場合、Auth0 にデプロイする前にコードを JavaScript にコンパイルする必要があります。Auth0 Actions ランタイムは JavaScript のみを実行します。TypeScript コンパイラ（`tsc`）を使用して `.ts` ファイルを `.js` ファイルにトランスパイルしてからデプロイしてください。また、Dashboard で IntelliSense を有効にするには、JSDoc コメントを含める必要があります。
</Warning>

<div id="examples">
  ### 例
</div>

次の Actions の例は、JavaScript と TypeScript の両方で意図的に並べて掲載しており、直接見比べられるようになっています。

<div id="configuration">
  #### 設定
</div>

<Tabs>
  <Tab title="JavaScript">
    `package.json` 内で、Action を記述する際に IntelliSense の補完を利用できるよう、開発用依存関係を定義します。

    ```javascript
    {
      "name": "actions-js",
      "version": "1.0.0",
      "description": "Actions JS",
      "main": "example.js",
      "author": "John Doe",
      "license": "ISC",
      "devDependencies": {
        "@auth0/actions": "^0.7.1"
      }
    }
    ```
  </Tab>

  <Tab title="TypeScript">
    `package.json` 内で、Action を記述する際に IntelliSense の補完を利用できるよう、開発用依存関係を定義します。

    ```typescript
    {
      "name": "actions-ts",
      "version": "1.0.0",
      "description": "Actions TS",
      "main": "example.ts",
      "author": "John Doe",
      "license": "ISC",
      "devDependencies": {
        "@auth0/actions": "^0.7.1",
        "@types/node": "22.14.0",
        "typescript": "^5.9.2"
      }
    }
    ```

    `tsconfig.json` 内で、Action を記述する際に IntelliSense の補完を利用できるよう、設定を行います。

    ```typescript
    {
      "compilerOptions": {
        "target": "ES2020",
        "module": "NodeNext",
        "moduleResolution": "nodenext",
        "esModuleInterop": true,
        "allowSyntheticDefaultImports": true,
        "strict": true,
        "outDir": "dist",
        "declaration": true,
        "sourceMap": true,
        "allowJs": true,
        "checkJs": false,
        "resolveJsonModule": true,
        "skipLibCheck": true,
        "forceConsistentCasingInFileNames": true,
        "isolatedModules": true
      },
      "include": [
        "**/*.ts"
      ],
      "exclude": [
        "node_modules",
        "dist"
      ]
    }
    ```
  </Tab>
</Tabs>

<div id="post-login-access-control-and-id-token-custom-claims">
  #### Post-Login アクセス制御と ID トークンのカスタムクレーム
</div>

以下の Action の例は、Post-Login フロー中に実行されます。ユーザーにロールが割り当てられているかどうかを確認し、見つからない場合は `api.access.deny()` を呼び出します。ロールが存在する場合は、ID トークンにカスタムクレームを設定します。

`import` 文は、コードで外部の型を利用できるように宣言します。これにより、エディターは `event` オブジェクトと `api` オブジェクトの構造を把握できます。

<Tabs>
  <Tab title="JavaScript">
    ```javascript
    /** @import {Event, PostLoginAPI} from "@auth0/actions/post-login/v3" */

    const CUSTOM_CLAIM_NAMESPACE = 'https://example.com';

    /**
    * Post-Login フローの実行中に呼び出されるハンドラー。
    *
    * @param {Event} event - ユーザーと、そのユーザーがログインしているコンテキストに関する詳細。
    * @param {PostLoginAPI} api - ログインの動作を変更するためのメソッドを提供するインターフェース。
    */
    exports.onExecutePostLogin = async (event, api) => {
      const roles = event.authorization?.roles;

      if (roles === undefined || roles.length === 0) {
        api.access.deny('Restricted');
        return;
      }

      api.idToken.setCustomClaim(`${CUSTOM_CLAIM_NAMESPACE}/roles`, roles);
    }
    ```
  </Tab>

  <Tab title="TypeScript">
    ```typescript
    import type { Event, PostLoginAPI } from '@auth0/actions/post-login/v3';

    const CUSTOM_CLAIM_NAMESPACE = 'https://example.com';

    /**
    * Post-Login フローの実行中に呼び出されるハンドラー。
    *
    * @param {Event} event - ユーザーと、そのユーザーがログインしているコンテキストに関する詳細。
    * @param {PostLoginAPI} api - ログインの動作を変更するためのメソッドを提供するインターフェース。
    */
    exports.onExecutePostLogin = async (event: Event, api: PostLoginAPI) => {
      const roles = event.authorization?.roles;

      if (roles === undefined || roles.length === 0) {
        api.access.deny('Restricted');
        return;
      }

      api.idToken.setCustomClaim(`${CUSTOM_CLAIM_NAMESPACE}/roles`, roles);
    };
    ```
  </Tab>
</Tabs>

@auth0/actions の詳細については、https://www.npmjs.com/package/@auth0/actions を参照してください。

Actions の記述方法については、[最初の Action を作成する](/docs/ja-JP/customize/actions/write-your-first-action)を参照してください。