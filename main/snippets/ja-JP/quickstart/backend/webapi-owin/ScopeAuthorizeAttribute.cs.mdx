```cs ScopeAuthorizeAttribute.cs lines highlight={}
public class ScopeAuthorizeAttribute : AuthorizeAttribute
{
    private readonly string scope;

    public ScopeAuthorizeAttribute(string scope)
    {
        this.scope = scope;
    }

    public override void OnAuthorization(HttpActionContext actionContext)
    {
        base.OnAuthorization(actionContext);

        // 発行者を検証するためAuth0ドメインを取得
        var domain = $"https://{ConfigurationManager.AppSettings["Auth0Domain"]}/";

        // クレームプリンシパルを取得
        ClaimsPrincipal principal = actionContext.ControllerContext.RequestContext.Principal as ClaimsPrincipal;

        // スコープクレームを取得。発行者が正しいAuth0ドメインであることを確認
        var scopeClaim = principal?.Claims.FirstOrDefault(c => c.Type == "scope" && c.Issuer == domain);
        if (scopeClaim != null)
        {
            // スコープを分割
            var scopes = scopeClaim.Value.Split(' ');

            // 必要なスコープがスコープ配列に含まれている場合は成功
            if (scopes.Any(s => s == scope))
                return;
        }

        HandleUnauthorizedRequest(actionContext);
    }
}
```
