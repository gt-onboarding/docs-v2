```cs ScopeAuthorizeAttribute.cs lines highlight={}
public class ScopeAuthorizeAttribute : AuthorizeAttribute
{
    private readonly string scope;

    public ScopeAuthorizeAttribute(string scope)
    {
        this.scope = scope;
    }

    public override void OnAuthorization(HttpActionContext actionContext)
    {
        base.OnAuthorization(actionContext);

        // Obtenir le domaine Auth0 pour valider l'émetteur
        var domain = $"https://{ConfigurationManager.AppSettings["Auth0Domain"]}/";

        // Obtenir le principal de la revendication
        ClaimsPrincipal principal = actionContext.ControllerContext.RequestContext.Principal as ClaimsPrincipal;

        // Obtenir la revendication de portée. S'assurer que l'émetteur correspond au bon domaine Auth0
        var scopeClaim = principal?.Claims.FirstOrDefault(c => c.Type == "scope" && c.Issuer == domain);
        if (scopeClaim != null)
        {
            // Séparer les portées
            var scopes = scopeClaim.Value.Split(' ');

            // Réussir si le tableau de portées contient la portée requise
            if (scopes.Any(s => s == scope))
                return;
        }

        HandleUnauthorizedRequest(actionContext);
    }
}
```
